/*
 GridJS
 (c) 2015 Sneezry http://gridjs.org
 License: MIT
*/
(function(B,z,l){function C(a,b){h=h||z.createElement("canvas");var e,d,c,f=h.getContext("2d"),g=new Image;g.addEventListener("load",function(){e=g.width;d=g.height;h.width=e;h.height=d;f.drawImage(g,0,0);c=f.getImageData(0,0,e,d);b(c)},!1);g.src=a}function t(a){var b,e,d=a.width,c=a.height,f=a.data,g={r:[],g:[],b:[],a:[]};for(b=0;b<c;b++)for(g.r[b]=[],g.g[b]=[],g.b[b]=[],g.a[b]=[],a=0;a<d;a++)e=4*(b*d+a),g.r[b][a]=f[e],g.g[b][a]=f[e+1],g.b[b][a]=f[e+2],g.a[b][a]=f[e+3]/255;return g}function v(a){var b,
e,d=a.width,c=a.height,f=a.data,g={G:[],a:[]};for(b=0;b<c;b++)for(g.G[b]=[],g.a[b]=[],a=0;a<d;a++)e=4*(b*d+a),g.G[b][a]=f[e],g.a[b][a]=f[e+3]/255;g.r=g.G;g.g=g.G;g.b=g.G;return g}function u(a){var b,e,d,c=a.a[0].length,f=a.a.length,g=h.getContext("2d").createImageData(c,f);for(e=0;e<f;e++)for(b=0;b<c;b++)d=4*(e*c+b),a.G!==l?(g.data[d]=a.G[e][b],g.data[d+1]=a.G[e][b],g.data[d+2]=a.G[e][b]):(g.data[d]=a.r[e][b],g.data[d+1]=a.g[e][b],g.data[d+2]=a.b[e][b]),g.data[d+3]=Math.round(255*a.a[e][b]);return g}
function A(a){var b=w.getContext("2d");w.width=a.width;w.height=a.height;b.putImageData(a,0,0);return w}var q=B.gridjs=B.gridjs||{},h=z.createElement("canvas"),w=z.createElement("canvas"),k;k=function(){this.originTop=this.originLeft=this.origin=this.imageData=this.pixel=this.height=this.width=null};q.getImageObject=function(a,b){"string"===typeof a?q.getImageObjectFromURL(a,b):!0===Array.isArray(a.r)?b(q.getImageObjectFromPixel(a)):"object"===typeof a&&b(q.getImageObjectFromImageData(a))};q.open=
q.getImageObject;q.getImageObjectFromURL=function(a,b){C(a,function(a){var d=new k;d.imageData=a;d.pixel=t(a);d.width=a.width;d.height=a.height;b(d)})};q.getImageObjectFromImageData=function(a){var b=a.width,e=a.height,d=t(a),c=new k;c.pixel=d;c.imageData=a;c.height=e;c.width=b;return c};q.getImageObjectFromPixel=function(a){var b=a.a[0].length,e=a.a.length,d=u(a),c=new k;c.pixel=a;c.imageData=d;c.height=e;c.width=b;return c};q.convolution=function(a,b){var e,d,c,f,g,h,l,n=[],m=a[0].length,q=a.length,
k=b[0].length,t=b.length,v=Math.round(k/2)-1,p=Math.round(t/2)-1;for(d=0;d<q;d++)for(n[d]=[],e=0;e<m;e++){for(f=l=0;f<t;f++)for(c=0;c<k;c++)g=e-v+c,h=d-p+f,0<=g&&g<m&&0<=h&&h<q&&(l+=a[h][g]*b[f][c]);n[d][e]=l}return n};q.conv=q.convolution;q.abs=function(a){var b,e,d=[],c=a[0].length,f=a.length;for(e=0;e<f;e++)for(d[e]=[],b=0;b<c;b++)d[e][b]=Math.abs(a[e][b]);return d};q.square=function(a){var b,e,d=[],c=a[0].length,f=a.length;for(e=0;e<f;e++)for(d[e]=[],b=0;b<c;b++)d[e][b]=a[e][b]*a[e][b];return d};
q.sqrt=function(a){var b,e,d=[],c=a[0].length,f=a.length;for(e=0;e<f;e++)for(d[e]=[],b=0;b<c;b++)d[e][b]=Math.sqrt(a[e][b]);return d};q.gauseCore=function(a,b,e){var d,c,f,g,h=0,r=Math.round(a/2),n=[];b=b||1;for(c=0;c<a;c++)for(n[c]=[],d=0;d<a;d++){if(d<r&&c<r)switch(f=d-r+1,g=c-r+1,e){case 0:n[c][d]=-f*Math.exp(-(f*f+g*g)/(2*b*b))/(b*b*b);break;case 1:n[c][d]=-g*Math.exp(-(f*f+g*g)/(2*b*b))/(b*b*b);break;case 2:n[c][d]=f*g*Math.exp(-(f*f+g*g)/(2*b*b))/(b*b*b*b*b);break;default:n[c][d]=Math.exp(-(f*
f+g*g)/(2*b*b))/b}else n[c][d]=d<r?1===e||2===e?-n[a-c-1][d]:n[a-c-1][d]:c<r?0===e||2===e?-n[c][a-d-1]:n[c][a-d-1]:0===e||1===e?-n[a-c-1][a-d-1]:n[a-c-1][a-d-1];h+=Math.abs(n[c][d])}if(e!==l)for(c=0;c<a;c++)for(d=0;d<a;d++)n[c][d]/=h;return n};q.gauss=function(a,b,e,d){b=q.gauseCore(b,e,d);return q.convolution(a,b)};q.add=function(a,b){var e,d,c=[],f=a[0].length,g=a.length;for(d=0;d<g;d++)for(c[d]=[],e=0;e<f;e++)c[d][e]=a[d][e]+b[d][e];return c};q.minus=function(a,b){var e,d,c=[],f=a[0].length,g=
a.length;for(d=0;d<g;d++)for(c[d]=[],e=0;e<f;e++)c[d][e]=a[d][e]-b[d][e];return c};q.multiply=function(a,b){var e,d,c=[],f=a[0].length,g=a.length;for(d=0;d<g;d++)for(c[d]=[],e=0;e<f;e++)c[d][e]=a[d][e]*(Array.isArray(b)?b[d][e]:b);return c};q.mul=q.multiply;q.divide=function(a,b,e){var d,c,f,g=[],h=a[0].length,r=a.length;for(c=0;c<r;c++)for(g[c]=[],d=0;d<h;d++)f=Array.isArray(b)?b[c][d]:b,g[c][d]=e!==l?0===f?e:a[c][d]/f:a[c][d]/f;return g};q.div=q.divide;q.zeros=function(a,b){Array.isArray(a)&&(b=
a.length,a=a[0].length);return q.ones(a,b,0)};q.ones=function(a,b,e){var d,c,f=[];Array.isArray(a)&&(e=b,b=a.length,a=a[0].length);e=e===l?1:e;for(c=0;c<b;c++)for(f[c]=[],d=0;d<a;d++)f[c][d]=e;return f};q.normalize=function(a,b,e){var d,c,f,g,h=a[0].length,r=a.length;b=b===l?0:b;e=e===l?1:e;for(c=0;c<r;c++)for(d=0;d<h;d++){if(f===l||f>a[c][d])f=a[c][d];if(g===l||g<a[c][d])g=a[c][d]}for(c=0;c<r;c++)for(d=0;d<h;d++)a[c][d]=(a[c][d]-f)*(e-b)/(g-f)+b;return a};q.norm=q.normalize;q.cutoff=function(a,b){var e,
d,c=a[0].length,f=a.length;for(d=0;d<f;d++)for(e=0;e<c;e++)a[d][e]=Math.min(a[d][e],b);return a};q.kmeans=function(a,b,e,d,c){var f,g,h,r,n,m,k,t,v,w=a.length,p=[],y=[],u=[];d=d||0;e=e||20;if(c===l)for(c=[],h=0;h<b;h++)f=a[h][0],g=a[h][1],c[h]=[f,g];for(h=0;h<w;h++){k=null;f=a[h][0];g=a[h][1];for(r=0;r<b;r++)if(m=(f-c[r][0])*(f-c[r][0])+(g-c[r][1])*(g-c[r][1]),null===k||k>m)k=m,t=f,v=g,n=r;y[n]===l?(y[n]=[t,v],u[n]=1):(y[n][0]+=t,y[n][1]+=v,u[n]++);d+1>e&&(p[n]===l&&(p[n]=[]),p[n].push([t,v]))}for(r=
0;r<b;r++)y[r]===l?(c[r][0]=a[r][0],c[r][1]=a[r][1]):(c[r][0]=y[r][0]/u[r],c[r][1]=y[r][1]/u[r]);return d+1>e?{center:c,cluster:p}:q.kmeans(a,b,e,d+1,c)};q.blank=function(a,b,e){var d=new k,c=h.getContext("2d");e===l&&(e=[]);e[0]=e[0]||0;e[1]=e[1]||0;e[2]=e[2]||0;e[3]=e[3]||0;h.width=a;h.height=b;c.fillStyle="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")";c.fillRect(0,0,a,b);d.width=a;d.height=b;d.imageData=c.getImageData(0,0,a,b);d.pixel=t(d.imageData);return d};k.prototype.grayscale=function(){var a,
b,e,d=this.width,c=this.height,f={G:[],a:[]};for(b=0;b<c;b++)for(f.G[b]=[],f.a[b]=[],a=0;a<d;a++)e=.299*this.pixel.r[b][a]+.587*this.pixel.g[b][a]+.114*this.pixel.b[b][a],f.G[b][a]=Math.round(e),f.a[b][a]=this.pixel.a[b][a];f.r=f.G;f.g=f.G;f.b=f.G;this.pixel=f;this.imageData=u(f);return this};k.prototype.show=function(a){var b;"CANVAS"===a.tagName?(a.width=this.width,a.height=this.height,b=a.getContext("2d"),b.putImageData(this.imageData,0,0)):"IMG"===a.tagName&&(h.width=this.width,h.height=this.height,
b=h.getContext("2d"),b.putImageData(this.imageData,0,0),a.src=h.toDataURL());return this};k.prototype.blend=function(a,b,e,d){var c,f,g=this.width,h=this.height,l=a.width,n=a.height,m={r:[],g:[],b:[],a:[]};b=b||0;e=isNaN(e)?0:Math.round(e);d=isNaN(d)?0:Math.round(d);for(f=0;f<h;f++)for(m.r[f]=[],m.g[f]=[],m.b[f]=[],m.a[f]=[],c=0;c<g;c++)0>f-d||0>c-e||f-d>=n||c-e>=l?(m.a[f][c]=this.pixel.a[f][c],m.r[f][c]=this.pixel.r[f][c],m.g[f][c]=this.pixel.g[f][c],m.b[f][c]=this.pixel.b[f][c]):0===b?(m.a[f][c]=
a.pixel.a[f-d][c-e]+this.pixel.a[f][c]*(1-a.pixel.a[f-d][c-e]),m.r[f][c]=(a.pixel.r[f-d][c-e]*a.pixel.a[f-d][c-e]+this.pixel.r[f][c]*this.pixel.a[f][c]*(1-a.pixel.a[f-d][c-e]))/m.a[f][c],m.g[f][c]=(a.pixel.g[f-d][c-e]*a.pixel.a[f-d][c-e]+this.pixel.g[f][c]*this.pixel.a[f][c]*(1-a.pixel.a[f-d][c-e]))/m.a[f][c],m.b[f][c]=(a.pixel.b[f-d][c-e]*a.pixel.a[f-d][c-e]+this.pixel.b[f][c]*this.pixel.a[f][c]*(1-a.pixel.a[f-d][c-e]))/m.a[f][c]):(m.a[f][c]=this.pixel.a[f][c]+a.pixel.a[f-d][c-e]*(1-this.pixel.a[f][c]),
m.r[f][c]=(this.pixel.r[f][c]*this.pixel.a[f][c]+a.pixel.r[f-d][c-e]*a.pixel.a[f-d][c-e]*(1-this.pixel.a[f][c]))/m.a[f][c],m.g[f][c]=(this.pixel.g[f][c]*this.pixel.a[f][c]+a.pixel.g[f-d][c-e]*a.pixel.a[f-d][c-e]*(1-this.pixel.a[f][c]))/m.a[f][c],m.b[f][c]=(this.pixel.b[f][c]*this.pixel.a[f][c]+a.pixel.b[f-d][c-e]*a.pixel.a[f-d][c-e]*(1-this.pixel.a[f][c]))/m.a[f][c]),m.r[f][c]=Math.round(m.r[f][c]),m.g[f][c]=Math.round(m.g[f][c]),m.b[f][c]=Math.round(m.b[f][c]),.003>m.a[f][c]&&(m.a[f][c]=this.pixel.a[f][c]);
this.width=g;this.height=h;this.pixel=m;this.imageData=u(m);return this};k.prototype.copy=function(){var a,b,e=this.width,d=this.height,c=new k,f={a:[]};this.pixel.G!==l?f.G=[]:(f.r=[],f.g=[],f.b=[]);for(b=0;b<d;b++)for(this.pixel.G!==l?f.G[b]=[]:(f.r[b]=[],f.g[b]=[],f.b[b]=[]),f.a[b]=[],a=0;a<e;a++)this.pixel.G!==l?f.G[b][a]=this.pixel.G[b][a]:(f.r[b][a]=this.pixel.r[b][a],f.g[b][a]=this.pixel.g[b][a],f.b[b][a]=this.pixel.b[b][a]),f.a[b][a]=this.pixel.a[b][a];this.pixel.G!==l&&(f.r=f.G,f.g=f.G,f.b=
f.G);c.pixel=f;c.imageData=u(f);c.height=d;c.width=e;return c};k.prototype.resize=function(a,b){var e=h.getContext("2d"),d=A(this.imageData);1>a&&(a*=this.width,a=Math.round(a));1>b&&(b*=this.height,b=Math.round(b));h.width=a;h.height=b;e.drawImage(d,0,0,a,b);this.width=a;this.height=b;this.imageData=e.getImageData(0,0,a,b);this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);return this};k.prototype.rotate=function(a){var b=this.width,e=this.height;a=-a*Math.PI/180;var d=h.getContext("2d"),
c=A(this.imageData),f,g;f=Math.abs(b*Math.cos(a))+Math.abs(e*Math.sin(a));f=Math.round(f);g=Math.abs(b*Math.sin(a))+Math.abs(e*Math.cos(a));g=Math.round(g);h.width=f;h.height=g;d.translate(f/2,g/2);d.rotate(a);d.translate(-b/2,-e/2);d.drawImage(c,0,0);this.width=f;this.height=g;this.imageData=d.getImageData(0,0,f,g);this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);return this};k.prototype.crop=function(a,b,e,d){var c=h.getContext("2d"),f=A(this.imageData);h.width=e;h.height=d;c.drawImage(f,
a,b,e,d,0,0,e,d);this.width=e;this.height=d;this.imageData=c.getImageData(0,0,e,d);this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);return this};k.prototype.updateImageData=function(){var a=h.getContext("2d");this.pixel.G!==l&&(this.pixel.r=this.pixel.G,this.pixel.g=this.pixel.G,this.pixel.b=this.pixel.G);this.imageData=u(this.pixel);this.width=this.imageData.width;this.height=this.imageData.height;null!==this.origin&&(h.width=this.origin.width,h.height=this.origin.height,a.putImageData(this.origin.imageData,
0,0),a.putImageData(this.imageData,this.originLeft,this.originTop),this.origin.imageData=a.getImageData(0,0,this.origin.width,this.origin.height),this.origin.pixel=this.pixel.G!==l&&this.origin.pixel.G!==l?v(this.origin.imageData):t(this.origin.imageData));return this};k.prototype.updatePixel=function(){var a=h.getContext("2d");this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);this.width=this.imageData.width;this.height=this.imageData.height;null!==this.origin&&(h.width=this.origin.width,
h.height=this.origin.height,a.putImageData(this.origin.imageData,0,0),a.putImageData(this.imageData,this.originLeft,this.originTop),this.origin.imageData=a.getContext(0,0,this.origin.width,this.origin.height),this.origin.pixel=this.pixel.G!==l&&this.origin.pixel.G!==l?v(this.origin.imageData):t(this.origin.imageData));return this};k.prototype.update=k.prototype.updateImageData;k.prototype.paste=function(a,b,e){var d=this.width,c=this.height,f=h.getContext("2d");b=b||0;e=e||0;h.width=d;h.height=c;
f.putImageData(this.imageData,0,0);f.putImageData(a.imageData,b,e);this.imageData=f.getImageData(0,0,d,c);this.pixel=this.pixel.G!==l&&a.pixel.G!==l?v(this.imageData):t(this.imageData);return this};k.prototype.load=function(a,b,e,d){var c=new k,f=h.getContext("2d");h.width=e;h.height=d;f.putImageData(this.imageData,-a,-b);c.width=e;c.height=d;c.imageData=f.getImageData(0,0,e,d);c.pixel=t(c.imageData);c.origin=this;c.originLeft=a;c.originTop=b;c.pixel=this.pixel.G!==l?v(c.imageData):t(c.imageData);
return c};k.prototype.flip=function(a){var b=this.width,e=this.height,d=h.getContext("2d"),c=w.getContext("2d");h.width=b;h.height=e;d.translate(b/2,e/2);w.width=b;w.height=e;c.putImageData(this.imageData,0,0);0===a?d.scale(-1,1):1===a?d.scale(1,-1):2===a&&d.scale(-1,-1);d.drawImage(w,-b/2,-e/2);this.imageData=d.getImageData(0,0,b,e);this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);return this};k.prototype.reverse=function(){var a,b,e=this.width,d=this.height;for(b=0;b<d;b++)for(a=
0;a<e;a++)this.pixel.G!==l?this.pixel.G[b][a]=255-this.pixel.G[b][a]:(this.pixel.r[b][a]=255-this.pixel.r[b][a],this.pixel.g[b][a]=255-this.pixel.g[b][a],this.pixel.b[b][a]=255-this.pixel.b[b][a]);this.imageData=u(this.pixel);return this};k.prototype.rgba=function(){this.pixel=t(this.imageData);return this};k.prototype.rgb=function(){var a=q.blank(this.width,this.height,[255,255,255,1]);this.blend(a,1);return this};k.prototype.plot=function(a,b,e){var d,c,f,g,k,r,n,m,q,w;d="blue";var u=null,x=null,
p=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,p.putImageData(this.imageData,0,0));"number"===typeof a&&"number"===typeof b?(a=[[a,b]],b=e):"number"===typeof a[0]&&(a=[a]);/b/.test(b)?d=this.pixel.G!==l?"#1D1D1D":"#0000FF":/g/.test(b)?d=this.pixel.G!==l?"#969696":"#00FF00":/r/.test(b)?d=this.pixel.G!==l?"#4C4C4C":"#FF0000":/c/.test(b)?d=this.pixel.G!==l?"#B3B3B3":"#00FFFF":/m/.test(b)?d=this.pixel.G!==l?"#696969":"#FF00FF":/y/.test(b)?d=this.pixel.G!==l?"#E2E2E2":
"#FFFF00":/k/.test(b)?d="#000000":/w/.test(b)&&(d="#FFFFFF");1===a.length?u=null:/--/.test(b)?u="solid":/-/.test(b)?u="dashed":/:/.test(b)?u="dotted":b===l&&(u="solid");/\./.test(b)?x="dot":/o/.test(b)?x="circle":/s/.test(b)?x="square":/\*/.test(b)?x="star":/\+/.test(b)?x="plus":/x/.test(b)&&(x="cross");p.strokeStyle=d;p.fillStyle=d;for(b=0;b<a.length;b++)if(e=a[b][0],d=a[b][1],"dot"===x?(p.beginPath(),p.arc(e,d,2,0,2*Math.PI),p.fill()):"circle"===x?(p.beginPath(),p.arc(e,d,3,0,2*Math.PI),p.stroke()):
"square"===x?(p.beginPath(),p.rect(e-2,d-2,5,5),p.fill()):"star"===x?(p.beginPath(),p.moveTo(e-3,d-3),p.lineTo(e+3,d+3),p.moveTo(e-3,d+3),p.lineTo(e+3,d-3),p.moveTo(e,d-5),p.lineTo(e,d+5),p.moveTo(e-5,d),p.lineTo(e+5,d),p.stroke()):"plus"===x?(p.beginPath(),p.moveTo(e,d-5),p.lineTo(e,d+5),p.moveTo(e-5,d),p.lineTo(e+5,d),p.stroke()):"cross"===x&&(p.beginPath(),p.moveTo(e-3,d-3),p.lineTo(e+3,d+3),p.moveTo(e-3,d+3),p.lineTo(e+3,d-3),p.stroke()),0<b)if(g=a[b-1][0],k=a[b-1][1],"solid"===u)p.beginPath(),
p.moveTo(g,k),p.lineTo(e,d),p.stroke();else if("dashed"===u||"dotted"===u){"dashed"===u?(p.lineCap="butt",m=5):(p.lineCap="round",m=2);g!==e?(r=5*Math.cos(Math.atan((d-k)/(e-g))),n=5*Math.sin(Math.atan((d-k)/(e-g)))):k!==d&&(r=5*Math.sin(Math.atan((e-g)/(d-k))),n=5*Math.cos(Math.atan((e-g)/(d-k))));p.beginPath();c=g;for(f=k;Math.abs(c-g)<=Math.abs(e-g)&&Math.abs(f-k)<=Math.abs(d-k);)q=c+m/5*r,w=f+m/5*n,p.moveTo(c,f),p.lineTo(q,w),c=q+r,f=w+n;p.stroke()}!0!==this.holdon&&(this.imageData=p.getImageData(0,
0,this.width,this.height),this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData));return this};k.prototype.hold=function(){var a=h.getContext("2d");this.holdon=!0;h.width=this.width;h.height=this.height;a.putImageData(this.imageData,0,0);return this};k.prototype.flush=function(){var a=h.getContext("2d");this.holdon=!1;this.imageData=a.getImageData(0,0,this.width,this.height);this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);return this};k.prototype.rectangle=function(a,b,e,
d,c,f){var g=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,g.putImageData(this.imageData,0,0));c===l&&(c=[]);c[0]=c[0]||0;c[1]=c[1]||0;c[2]=c[2]||0;c[3]=c[3]||0;f===l&&(f=[]);f[0]=f[0]||0;f[1]=f[1]||0;f[2]=f[2]||0;f[3]=f[3]||0;f[4]=f[4]||0;this.pixel.G!==l&&(c[0]=.299*c[0]+.587*c[1]+.114*c[2],c[0]=Math.round(c[0]),c[1]=c[0],c[2]=c[0],f[0]=.299*f[0]+.587*f[1]+.114*f[2],f[0]=Math.round(f[0]),f[1]=f[0],f[2]=f[0]);g.fillStyle="rgba("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+
")";g.strokeStyle="rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")";g.lineWidth=f[4];g.rect(a,b,e,d);g.fill();g.stroke();!0!==this.holdon&&(this.imageData=g.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData));return this};k.prototype.rect=k.prototype.rectangle;k.prototype.arc=function(a,b,e,d,c,f,g){var k=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,k.putImageData(this.imageData,0,0));f===l&&(f=[]);f[0]=f[0]||0;f[1]=
f[1]||0;f[2]=f[2]||0;f[3]=f[3]||0;g===l&&(g=[]);g[0]=g[0]||0;g[1]=g[1]||0;g[2]=g[2]||0;g[3]=g[3]||0;g[4]=g[4]||0;this.pixel.G!==l&&(f[0]=.299*f[0]+.587*f[1]+.114*f[2],f[0]=Math.round(f[0]),f[1]=f[0],f[2]=f[0],g[0]=.299*g[0]+.587*g[1]+.114*g[2],g[0]=Math.round(g[0]),g[1]=g[0],g[2]=g[0]);k.fillStyle="rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")";k.strokeStyle="rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")";k.lineWidth=g[4];k.arc(a,b,e,d*Math.PI/180,c*Math.PI/180);k.fill();k.stroke();!0!==this.holdon&&
(this.imageData=k.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData));return this};k.prototype.circle=function(a,b,e,d,c){return this.arc(a,b,e,0,360,d,c)};k.prototype.polygon=function(a,b,e){var d=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,d.putImageData(this.imageData,0,0));b===l&&(b=[]);b[0]=b[0]||0;b[1]=b[1]||0;b[2]=b[2]||0;b[3]=b[3]||0;e===l&&(e=[]);e[0]=e[0]||0;e[1]=e[1]||0;e[2]=e[2]||0;e[3]=e[3]||0;e[4]=
e[4]||0;this.pixel.G!==l&&(b[0]=.299*b[0]+.587*b[1]+.114*b[2],b[0]=Math.round(b[0]),b[1]=b[0],b[2]=b[0],e[0]=.299*e[0]+.587*e[1]+.114*e[2],e[0]=Math.round(e[0]),e[1]=e[0],e[2]=e[0]);d.fillStyle="rgba("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")";d.strokeStyle="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")";d.lineWidth=e[4];d.beginPath();for(b=0;b<a.length;b++)0===b?d.moveTo(a[b][0],a[b][1]):d.lineTo(a[b][0],a[b][1]);d.closePath();d.fill();d.stroke();!0!==this.holdon&&(this.imageData=d.getImageData(0,0,
this.width,this.height),this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData));return this};k.prototype.poly=k.prototype.polygon;k.prototype.affine=function(a){var b=this.width,e=this.height,d=w.getContext("2d"),c=h.getContext("2d");w.width=b;w.height=e;d.putImageData(this.imageData,0,0);h.width=b;h.height=e;c.transform(a[0][0],a[1][0],a[0][1],a[1][1],a[0][2],a[1][2]);c.drawImage(w,0,0);this.imageData=c.getImageData(0,0,b,e);this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);
return this};k.prototype.affinec=function(a,b,e,d){var c,f,g,k,r,n=this.width,m=this.height,q=w.getContext("2d"),u=h.getContext("2d");!0===Array.isArray(a)?(g=a[0],a=a[1],!0===Array.isArray(b)&&(c=(b[0]-g)/n,k=(b[1]-a)/n),!0===Array.isArray(e)&&(f=(e[0]-g)/m,r=(e[1]-a)/m),c===l?(c=(d[0]-g-f*m)/n,k=(d[1]-a-r*m)/n):f===l&&(f=(d[0]-g-c*n)/m,r=(d[1]-a-k*n)/m)):(c=(d[0]-a[0])/n,k=(d[1]-a[1])/n,f=(e[0]-b[0]-c*n)/m,r=(e[1]-b[1]-k*n)/m,g=e[0]-f*m,a=e[1]-r*m);w.width=n;w.height=m;q.putImageData(this.imageData,
0,0);h.width=n;h.height=m;u.transform(c,k,f,r,g,a);u.drawImage(w,0,0);this.imageData=u.getImageData(0,0,n,m);this.pixel=this.pixel.G!==l?v(this.imageData):t(this.imageData);return this}})(window,document);
