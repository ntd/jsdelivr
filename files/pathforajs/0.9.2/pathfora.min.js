!function(e,t){var i,a=function(){var e=t.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","../dist/pathfora.min.css"),t.head.appendChild(e)},s=/[\t\r\n\f]/g,o=/\S+/g,n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,r={hasClass:function(e,t){return 1===e.nodeType&&(" "+e.className+" ").replace(s," ").indexOf(" "+t+" ")>=0?!0:!1},addClass:function(e,t){var i,a,r,d,c;if("string"==typeof t&&t&&(i=(t||"").match(o)||[],a=1===e.nodeType&&(e.className?(" "+e.className+" ").replace(s," "):" "))){for(d=0;r=i[d++];)a.indexOf(" "+r+" ")<0&&(a+=r+" ");c=null==a?"":(a+"").replace(n,""),e.className!==c&&(e.className=c)}},removeClass:function(e,t){var i,a,r,d,c;if("string"==typeof t&&t&&1===e.nodeType&&(i=(t||"").match(o)||[],a=e.className?(" "+e.className+" ").replace(s," "):"")){for(d=0;r=i[d++];)for(;a.indexOf(" "+r+" ")>=0;)a=a.replace(" "+r+" "," ");c=t?null==a?"":(a+"").replace(n,""):"",e.className!==c&&(e.className=c)}},readCookie:function(t){var i,a,s,o;for(i=t+"=",a=e.document.cookie.split(";"),s=0;s<a.length;s+=1){for(o=a[s];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(i))return o.substring(i.length,o.length)}return null},saveCookie:function(t,i,a){var s,o;a?(o=new Date,o.setTime(o.getTime()+24*a*60*60*1e3),s="; expires="+o.toGMTString()):s="",e.document.cookie=t+"="+i+s+"; path=/"},generateUniqueId:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},randomChoice:function(e){return e[Math.floor(Math.random()*e.length)]}},d={modal:"",slideout:"left",button:"top-left",bar:"top-fixed",folding:"bottom-left"},c={generic:{className:"pathfora",header:"",theme:"default",themes:{"default":{background:"#ddd",header:"#333",text:"#333",close:"#999",actionText:"#333",actionBackground:"#eee",cancelText:"#333",cancelBackground:"#eee"},dark:{background:"#ddd",header:"#333",text:"#333",close:"#999",actionText:"#333",actionBackground:"#eee",cancelText:"#333",cancelBackground:"#eee"},light:{background:"#ddd",header:"#333",text:"#333",close:"#999",actionText:"#333",actionBackground:"#eee",cancelText:"#333",cancelBackground:"#eee"}},displayConditions:{showOnInit:!0,showDelay:0,hideAfter:0,displayWhenElementVisible:"",scrollPercentageToDisplay:0}},message:{layout:"modal",position:"",variant:"1",cancelButton:!0},subscription:{layout:"modal",position:"",variant:"1",placeholder:"Email"},form:{layout:"modal",position:"",variant:"1",nameField:!0,titleField:!1,placeholders:{name:"Name",title:"Title",email:"Email",message:"Message"}}},l={pageViews:0,timeSpentOnPage:0,closedWidgets:[],completedActions:[],cancelledActions:[],displayedWidgets:[]},p={delayedWidgets:{},openedWidgets:[],initializedWidgets:[],watchers:[],initializeWidget:function(e){var t,i=e.displayConditions;i.displayWhenElementVisible?(t=p.registerElementWatcher(i.displayWhenElementVisible,e),p.watchers.push(t),p.initializeScrollWatchers(p.watchers)):i.scrollPercentageToDisplay?(t=p.registerPositionWatcher(i.scrollPercentageToDisplay,e),p.watchers.push(t),p.initializeScrollWatchers(p.watchers)):i.showOnInit&&pathfora.showWidget(e)},initializeScrollWatchers:function(t){p.scrollListener||(p.scrollListener=function(){for(var e in t)t.hasOwnProperty(e)&&null!==t[e]&&t[e].check()},"function"==typeof e.addEventListener?e.addEventListener("scroll",p.scrollListener,!1):e.onscroll=p.scrollListener)},removeScrollWatchers:function(t){t.forEach(function(e){p.removeWatcher(e)}),e.removeEventListener("scroll",p.scrollListener,!1),delete p.scrollListener},registerDelayedWidget:function(e){this.delayedWidgets[e.id]=setTimeout(function(){p.initializeWidget(e)},1e3*e.displayConditions.showDelay)},cancelDelayedWidget:function(e){var t=this.delayedWidgets[e.id];t&&(clearTimeout(t),delete this.delayedWidgets[e.id])},registerPositionWatcher:function(e,i){var a={check:function(){var s=t.body.offsetHeight*e/100;t.body.scrollTop>=s&&(pathfora.showWidget(i),p.removeWatcher(a))}};return a},registerElementWatcher:function(e,i){var a={elem:t.getElementById(e),check:function(){a.elem.offsetTop-window.innerHeight/2<=t.body.scrollTop&&(pathfora.showWidget(i),p.removeWatcher(a))}};return a},removeWatcher:function(e){for(var t in p.watchers)p.watchers.hasOwnProperty(t)&&e==p.watchers[t]&&p.watchers.splice(t,1)},constructWidgetLayout:function(i,a){switch(a.type){case"form":switch(a.layout){case"folding":case"modal":case"slideout":i.querySelector("form").onsubmit=function(t){t.preventDefault(),p.trackWidgetAction("submit",a,t.target),e.pathfora.closeWidget(i.id,!0)},i.querySelectorAll("input")[0].placeholder=a.placeholders.name,i.querySelectorAll("input")[1].placeholder=a.placeholders.title,i.querySelectorAll("input")[2].placeholder=a.placeholders.email,i.querySelector("textarea").placeholder=a.placeholders.message;break;default:throw new Error("Invalid widget layout value")}case"subscription":switch(a.layout){case"folding":case"modal":case"bar":case"slideout":i.querySelector("form").onsubmit=function(t){t.preventDefault(),p.trackWidgetAction("subscribe",a,t.target),e.pathfora.closeWidget(i.id,!0)},"subscription"===a.type&&(i.querySelector("input").placeholder=a.placeholder);break;default:throw new Error("Invalid widget layout value")}case"message":switch(a.layout){case"modal":case"folding":case"slideout":for(var s=i.querySelectorAll(".pf-widget-header"),o=s.length-1;o>=0;o--)s[o].innerHTML=a.header;case"bar":if(a.image){var n=t.createElement("img");n.src=a.image,n.className="pf-widget-img",i.querySelector(".pf-widget-body").appendChild(n)}else r.addClass(i,"pf-no-img");case"button":i.querySelector(".pf-widget-message").innerHTML=a.msg;break;default:throw new Error("Invalid widget layout value")}}},constructWidgetActions:function(t,i){switch(i.layout){case"folding":var a=t.querySelectorAll(".pf-widget-caption, .pf-widget-caption-left");"left"!==i.position&&setTimeout(function(){t.style.bottom=-t.offsetHeight+"px"},0);for(var s=a.length-1;s>=0;s--)a[s].onclick=function(){r.hasClass(t,"opened")?r.removeClass(t,"opened"):r.addClass(t,"opened")};break;case"button":break;case"modal":case"slideout":case"bar":var o=t.querySelector(".pf-widget-cancel");t.querySelector(".pf-widget-close").onclick=function(){e.pathfora.closeWidget(t.id)},o&&(o.onclick="object"==typeof i.cancelAction?function(){p.trackWidgetAction("cancel",i),i.cancelAction.callback(),e.pathfora.closeWidget(t.id,!0)}:function(){e.pathfora.closeWidget(t.id)})}"object"==typeof i.confirmAction?t.querySelector(".pf-widget-ok").onclick=function(){p.trackWidgetAction("confirm",i),i.confirmAction.callback(),e.pathfora.closeWidget(t.id,!0)}:"message"===i.type&&(t.querySelector(".pf-widget-ok").onclick=function(){e.pathfora.closeWidget(t.id)})},setupWidgetColors:function(e,t){if(void 0===t.theme&&p.setCustomColors(e,c.generic.themes["default"]),t.colors){var i={};p.updateObject(i,c.generic.colors),p.updateObject(i,t.colors),p.setCustomColors(e,i)}},setWidgetClassname:function(e,t){e.className="pf-widget pf-"+t.type+" pf-widget-"+t.layout+(t.position?" pf-position-"+t.position:"")+" pf-widget-variant-"+t.variant+(t.theme?" pf-theme-"+t.theme:"")},validateWidgetPosition:function(e,t){var i,a=function(e,t){return t.indexOf(e)>-1};switch(t.layout){case"modal":i=["",void 0];break;case"slideout":i=["left","right"];break;case"bar":i=["top-fixed","top-scrolling","bottom-scrolling"];break;case"button":i=["left","right","top-left","top-right","bottom-left","bottom-right"];break;case"folding":i=["left","bottom-left","bottom-right"]}a(t.position,i)||console.warn(t.position+" is not valid position for "+t.layout)},setupWidgetPosition:function(e,t){t.position?this.validateWidgetPosition(e,t):t.position=d[t.layout]},createWidgetHtml:function(e){var i=t.createElement("div");return i.innerHTML=g[e.type][e.layout]||"",i.id=e.id,this.setupWidgetPosition(i,e),this.constructWidgetActions(i,e),this.setWidgetClassname(i,e),this.constructWidgetLayout(i,e),this.setupWidgetColors(i,e),i},trackTimeOnPage:function(){p.tickHandler=setInterval(function(){l.timeSpentOnPage+=1},1e3)},checkIfUserJustEntered:function(){var e=r.readCookie("PathforaInit");return e?!1:(r.saveCookie("PathforaInit",!0,30),!0)},setCustomColors:function(e,t){var i=e.querySelector(".pf-widget-close"),a=e.querySelector(".pf-widget-header"),s=e.querySelector(".pf-widget-cancel"),o=e.querySelector(".pf-widget-ok");r.hasClass(e,"pf-widget-modal")?e.querySelector(".pf-widget-content").style.backgroundColor=t.background:e.style.backgroundColor=t.background,i&&(i.style.color=t.close),a&&(a.style.color=t.header),s&&(s.style.color=t.cancelText,s.style.backgroundColor=t.cancelBackground),o&&(o.style.color=t.actionText,o.style.backgroundColor=t.actionBackground),e.querySelector(".pf-widget-message").style.color=t.text},trackWidgetAction:function(e,t,i){var a={"pf-widget-id":t.id,"pf-widget-type":t.type,"pf-widget-layout":t.layout,"pf-widget-variant":t.variant};switch(e){case"show":l.displayedWidgets.push(a);break;case"close":l.closedWidgets.push(a);break;case"confirm":a["pf-widget-action"]=t.confirmAction.name,l.completedActions.push(a);break;case"cancel":a["pf-widget-action"]=t.cancelAction.name,l.cancelledActions.push(a);break;case"submit":var s=i;a["pf-form-username"]=s.elements.username.value,a["pf-form-title"]=s.elements.title.value,a["pf-form-email"]=s.elements.email.value,a["pf-form-message"]=s.elements.message.value;break;case"subscribe":s=i,a["pf-form-email"]=s.elements.email.value}a["pf-widget-event"]=e,f.reportData(a)},updateObject:function(e,t){for(var i in t)null!==typeof t[i]&&"object"==typeof t[i]?t.hasOwnProperty(i)&&(void 0===e[i]&&(e[i]={}),p.updateObject(e[i],t[i])):t.hasOwnProperty(i)&&(e[i]=t[i])},initializeWidgetArray:function(e){for(var t=0;t<e.length;t++){var i=e[t],a=c[i.type],s=c.generic;if(!(this.initializedWidgets.indexOf(i.id)<0))throw new Error("Cannot add two widgets with the same id");this.initializedWidgets.push(i.id),this.updateObject(i,s),this.updateObject(i,a),this.updateObject(i,i.config),i.displayConditions.showDelay?p.registerDelayedWidget(i):p.initializeWidget(i)}},validateWidgetsObject:function(e){if(!e)throw new Error("Widgets not specified");if(e.constructor!==Array&&e.target)for(var t=0;t<e.target.length;t++)if(!e.target[t].segment)throw new Error("All targeted widgets should have segment specified")},prepareWidget:function(e,t){if(void 0===t)throw new Error("Config object is missing");if(void 0===t.msg)throw new Error("Widget message is missing");var i={};return i.type=e,i.config=t,i.id=t.id||r.generateUniqueId(),i}},f={initializeCustomAPI:function(){var e=r.readCookie("seerid");"object"==typeof jstag&&e&&jstag.send({user_id:e})},getData:function(e,t,i){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status?t(a.responseText):4==a.readyState&&i(a.responseText)},a.open("GET",e),a.send()},postData:function(e,t,i,a){var s=new XMLHttpRequest;s.open("POST",e),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){4==s.readyState&&200==s.status?i(s.responseText):4==s.readyState&&a(s.responseText)},s.send(t)},reportData:function(e){"object"==typeof jstag?jstag.send(e):"function"==typeof console&&console.warn("Cannot find Lytics tag, reporting disabled")},checkUserSegments:function(e,t){var i=r.readCookie("seerid");if(!i)throw new Error("Cannot find SEERID cookie");var a="https://api.lytics.io/api/me/"+e+"/"+i+"?segments=true";this.getData(a,function(e){var i=JSON.parse(e);t(i.data.segments)},function(e){console.error(e),t({data:{segments:["all"]}})})}},g={message:{modal:'<div class="pf-widget-container"><div class="pf-va-middle"><div class="pf-widget-content"><a class="pf-widget-close">&times;</a><h2 class="pf-widget-header"></h2><div class="pf-widget-body"><div class="pf-va-middle"><p class="pf-widget-message"></p><a class="pf-widget-btn pf-widget-cancel">Cancel</a><a class="pf-widget-btn pf-widget-ok">Confirm</a></div></div></div></div></div>',slideout:'<a class="pf-widget-close">&times;</a><div class="pf-widget-body"></div><div class="pf-widget-content"><h2 class="pf-widget-header"></h2><p class="pf-widget-message"></p><a class="pf-widget-btn pf-widget-ok">Confirm</a></div>',bar:'<a class="pf-widget-body"></a><a class="pf-widget-close">&times;</a><div class="pf-bar-content"><p class="pf-widget-message"></p><a class="pf-widget-btn pf-widget-ok">Confirm</a></div>',button:'<p class="pf-widget-message pf-widget-ok"></p>',inline:""},subscription:{modal:'<div class="pf-widget-container"><div class="pf-va-middle"><div class="pf-widget-content"><a class="pf-widget-close">&times;</a><h2 class="pf-widget-header"></h2><div class="pf-widget-body"><div class="pf-va-middle"><p class="pf-widget-message"></p><form><input name="email" type="email" required><button type="submit" class="pf-widget-btn pf-widget-ok">X</button></form></div></div></div></div></div>',slideout:'<a class="pf-widget-close">&times;</a><div class="pf-widget-body"></div><div class="pf-widget-content"><h2 class="pf-widget-header"></h2><p class="pf-widget-message"></p><form><input name="email" type="email" required><button type="submit" class="pf-widget-btn pf-widget-ok">X</button></form></div>',folding:'<a class="pf-widget-caption"><p class="pf-widget-header"></p><span>&rsaquo;</span></a><a class="pf-widget-caption-left"><p class="pf-widget-header"></p><span>&rsaquo;</span></a><div class="pf-widget-body"></div><div class="pf-widget-content"><p class="pf-widget-message"></p><form><input name="email" type="email" required><button type="submit" class="pf-widget-btn pf-widget-ok">X</button></form></div>',bar:'<a class="pf-widget-body"></a><a class="pf-widget-close">&times;</a><div class="pf-bar-content"><p class="pf-widget-message"></p><form><input name="email" type="email" required><input type="submit" class="pf-widget-btn pf-widget-ok" /></form></div>'},form:{modal:'<div class="pf-widget-container"><div class="pf-va-middle"><div class="pf-widget-content"><a class="pf-widget-close">&times;</a><h2 class="pf-widget-header"></h2><div class="pf-widget-body"><div class="pf-va-middle"><p class="pf-widget-message"></p><form><input name="username" type="text" required><input name="title" type="text"><input name="email" type="email" required><textarea name="message" rows="5" required></textarea><button type="submit" class="pf-widget-btn pf-widget-ok">Send</button></form></div></div></div></div></div>',slideout:'<a class="pf-widget-close">&times;</a><div class="pf-widget-body"></div><div class="pf-widget-content"><h2 class="pf-widget-header"></h2><p class="pf-widget-message"></p><form><input name="username" type="text"><input name="title" type="text" required><input name="email" type="email" required><textarea name="message" rows="5" required></textarea><button type="submit" class="pf-widget-btn pf-widget-ok">Send</button></form></div>',folding:'<a class="pf-widget-caption"><p class="pf-widget-header"></p><span>&rsaquo;</span></a><a class="pf-widget-caption-left"><p class="pf-widget-header"></p><span>&rsaquo;</span></a><div class="pf-widget-body"></div><div class="pf-widget-content"><p class="pf-widget-message"></p><form><input name="username" type="text" required><input name="title" type="text"><input name="email" type="email" required><textarea  name="message" rows="5" required></textarea><button type="submit" class="pf-widget-btn pf-widget-ok">Send</button></form></div>'}},u=function(){this.initializeWidgets=function(a,s,o){(!t.all||e.atob)&&(f.initializeCustomAPI(),p.validateWidgetsObject(a),p.trackTimeOnPage(),o&&(i=JSON.parse(JSON.stringify(c)),p.updateObject(c,o)),a.constructor===Array?p.initializeWidgetArray(a):(a.common&&(p.initializeWidgetArray(a.common),p.updateObject(c,a.common.config)),a.target&&f.checkUserSegments(s,function(e){for(var t=0;t<a.target.length;t++){var i=a.target[t];if(-1!==e.indexOf(i.segment)){p.initializeWidgetArray(i.widgets);break}}})))},this.previewWidget=function(e){return e.id=r.generateUniqueId(),p.createWidgetHtml(e)},this.Message=function(e){return p.prepareWidget("message",e)},this.Subscription=function(e){return p.prepareWidget("subscription",e)},this.Form=function(e){return p.prepareWidget("form",e)},this.showWidget=function(e){for(var i=0;i<p.openedWidgets.length;i++)if(p.openedWidgets[i]===e)return;p.openedWidgets.push(e),p.trackWidgetAction("show",e);var a=p.createWidgetHtml(e);t.body.appendChild(a),setTimeout(function(){r.addClass(a,"opened")},50),e.displayConditions.hideAfter&&setTimeout(function(){pathfora.closeWidget(e.id)},1e3*e.displayConditions.hideAfter)},this.closeWidget=function(e,i){for(var a=0;a<p.openedWidgets.length;a++)if(p.openedWidgets[a].id===e){i||p.trackWidgetAction("close",p.openedWidgets[a]),p.openedWidgets.splice(a,1);break}var s=t.getElementById(e);r.removeClass(s,"opened"),setTimeout(function(){s.parentNode&&s.parentNode.removeChild(s)},500)},this.getData=function(){return l},this.clearAll=function(){var e=p.openedWidgets;e.forEach(function(e){element=t.getElementById(e.id),r.removeClass(element,"opened"),element.parentNode.removeChild(element)}),e.slice(0);for(var a=p.delayedWidgets,s=a.length;s>-1;s--)p.cancelDelayedWidget(a[s]);p.openedWidgets=[],p.initializedWidgets=[],p.removeScrollWatchers(p.watchers),l={pageViews:0,timeSpentOnPage:0,closedWidgets:[],completedActions:[],cancelledActions:[],displayedWidgets:[]},i&&(c=i)},this.utils=r};a(),e.pathfora=new u}(window,document);