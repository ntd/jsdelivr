!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.AudioFX=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),i=function(){function i(){t(this,i),this.cache=[];try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext}catch(e){o.error("Web Audio API Error: "+e.message)}this.context.createGain||(this.context.createGain=this.context.createGainNode)}return e(i,[{key:"changeVolumeAll",value:function(t){return this.cache.forEach(function(e){e.volume(t)}),this}},{key:"destroyAll",value:function(){return this.cache.forEach(function(t){t.destroy()}),this}}]),i}();!function(){if(!Array.prototype.find){var t=function(t){var e=Object(this),i=e.length<0?0:e.length>>>0;if(0===i)return void 0;if("function"!=typeof t||"[object Function]"!==Object.prototype.toString.call(t))throw new TypeError("Array#find: predicate must be a function");for(var o,n=arguments[1],r=0;i>r;r++)if(o=e[r],t.call(n,o,r,e))return o;return void 0};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"find",{value:t,configurable:!0,enumerable:!1,writable:!0})}catch(e){}Array.prototype.find||(Array.prototype.find=t)}}();var o=function(){function o(e,n,r){t(this,o),this["const"]={QUALITY_MULTIPLIER:30};var u={loop:!1,volume:1,filterFrequency:null,autoplay:!1};this.options=o.isObject(r)?o.extend(u,r):u,this.playing=!1,this.hasLoaded=!1,window.AudioFXGlobal||(window.AudioFXGlobal=new i),"string"!=typeof e?o.error("You have to provide a valid url string."):this.url=e,n&&(o.isFunction(n)?this.onload=n:o.error("Supplied callback is not a function.")),this.buffer=null,this.duration=0,this.source=null,this.gainNode=window.AudioFXGlobal.context.createGain(),this.gainNode.gain.value=this.options.volume,this.filterNode=window.AudioFXGlobal.context.createBiquadFilter(),this.filterNode.type="string"==typeof this.filterNode.type?"lowpass":0,this.filterNode.frequency.value=this.options.filterFrequency?this.options.filterFrequency:window.AudioFXGlobal.context.sampleRate,this._pauseTime=0,this.id=window.AudioFXGlobal.cache.length+1;var s=window.AudioFXGlobal.cache.find(function(t){return t.url===e});window.AudioFXGlobal.cache.length>0&&s?(this.hasLoaded=!0,this.setBuffer(s.buffer)):this.loadFile(e)}return e(o,[{key:"loadFile",value:function(t){this.request=new XMLHttpRequest,this.request.open("GET",t,!0),this.request.responseType="arraybuffer";var e=this;this.request.onload=function(){window.AudioFXGlobal.context.decodeAudioData(e.request.response,function(t){e.setBuffer(t)},function(t){o.error("Error at decodeAudioData"+t)})},this.request.onerror=function(){o.error("XMLHttpRequest errored. Readystate: "+this.readyState+". Status: "+this.status)},this.request.send()}},{key:"setBuffer",value:function(t){return t||o.error("No Buffer found."),window.AudioFXGlobal.cache.push(this),this.buffer=o.clone(t),this.duration=parseFloat(t.duration),this.hasLoaded=!0,this.options.autoplay===!0&&this.play(),o.isFunction(this.onload)&&this.onload(this),this}},{key:"createAndConnectNodes",value:function(){this.source=window.AudioFXGlobal.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.filterNode),this.filterNode.connect(this.gainNode),this.gainNode.connect(window.AudioFXGlobal.context.destination)}},{key:"play",value:function(){var t=void 0===arguments[0]?0:arguments[0];return this.playing===!0&&this.stop(),this.createAndConnectNodes(),this.options.loop&&(this.source.loop=!0),this.source.start||(this.source.start=this.source.noteOn),this._pauseTime?this.source.start(0,this._pauseTime):this.source.start(0,t),this._playTime=window.AudioFXGlobal.context.currentTime,this.playing=!0,this}},{key:"pause",value:function(){if(this._playTime){var t=window.AudioFXGlobal.context.currentTime-this._playTime;this._pauseTime=this._pauseTime+t,this.source.stop||(this.source.stop=this.source.noteOff),this.source.stop(),this.playing=!1}}},{key:"stop",value:function(){var t=void 0===arguments[0]?0:arguments[0];return this.source.stop||(this.source.stop=this.source.noteOff),this._pauseTime=null,this.source.stop(t),this.playing=!1,this}},{key:"toggle",value:function(){return this.playing===!0?this.pause():this.play(),this}},{key:"changeVolume",value:function(t){var e=parseFloat(t);return e>1?e=1:0>e&&(e=0),this.gainNode.gain.value=e*e,this}},{key:"changeFilter",value:function(t,e){var i=40,o=window.AudioFXGlobal.context.sampleRate/2,n=Math.log(o/i)/Math.LN2,r=Math.pow(2,n*(t-1));return this.filterNode.frequency.value=o*r,this.filterNode.Q.value=e*this["const"].QUALITY_MULTIPLIER,this}},{key:"getCurrentTime",value:function(){return this.playing?this._pauseTime+(window.AudioFXGlobal.context.currentTime-this._playTime):this._pauseTime}},{key:"getDuration",value:function(){return this.duration}},{key:"destroy",value:function(){this.playing&&this.stop(),window.AudioFXGlobal.cache.splice(window.AudioFXGlobal.cache.indexOf(this),1);for(var t in this)this.hasOwnProperty(t)&&delete this[t]}},{key:"volume",value:function(t){return this.changeVolume(t)}},{key:"filter",value:function(t,e){return this.changeFilter(t,e)}},{key:"kill",value:function(){return this.destroy()}},{key:"remove",value:function(){return this.destroy()}}],[{key:"extend",value:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}},{key:"clone",value:function(t){for(var e=window.AudioFXGlobal.context.createBuffer(t.numberOfChannels,t.length,t.sampleRate),i=0,o=t.numberOfChannels;o>i;++i){var n=e.getChannelData(i),r=t.getChannelData(i);n.set(r,0)}return e}},{key:"isObject",value:function(t){return null!==t&&"object"==typeof t}},{key:"isFunction",value:function(t){var e={};return t&&"[object Function]"===e.toString.call(t)}},{key:"error",value:function(t){throw new Error("AudioFX: Error! "+t)}}]),o}();return o});