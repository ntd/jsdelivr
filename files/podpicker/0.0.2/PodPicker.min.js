/*!
 * Pod Picker - A Podcast Timeline Generator
 * https://github.com/RoberMac/PodPicker
 *
 * Copyright (c) 2015 RoberTu <robertu0717@gmail.com>
 * @license MIT
 * @version v0.0.2
 */
!function(e,t){"use strict";function r(e,r,i){this.itemsIndex=0,this.preTime=0,this.startTimeSet=[],"undefined"==typeof e?this.throwError("Pod Picker: `container` parameter is required"):e.constructor!==String?this.throwError("Pod Picker: `container` parameter must be an string"):e=t.getElementById(e),e?null:this.throwError("Pod Picker: `container` parameter is not related to an existing ID"),"undefined"==typeof r?this.throwError("Pod Picker: `items` parameter is required"):r.constructor!==Array?this.throwError("Pod Picker: `items` parameter must be an array"):r.length<=0?this.throwError("Pod Picker: `items` parameter cannot be an empty array"):null,"undefined"!=typeof i&&i.constructor!==Object?this.throwError("Pod Picker: `options` parameter must be an object"):i=i||{};var n=this;r=r.sort(function(e,t){var e=n.convertTime(e.start),t=n.convertTime(t.start);return e>t?1:t>e?-1:0}),this.setup(e,r,i)}r.prototype.setup=function(e,r,i){function n(){for(var i=t.createDocumentFragment(""),n=t.createElement("div"),m=t.createElement("span"),l=t.createElement("ul"),d=r.length,c=0;d>c;c++){var p=t.createElement("li"),u=t.createElement("span"),h=a.convertTime(r[c].start);a.startTimeSet.push(h),function(e,t,r){e.addEventListener("click",function(){o.pasued?o.play():null,o.currentTime=r,o.play(),a.setPointerPosition(!1,t,!0)}),e.addEventListener("mouseenter",function(){a.setPointerPosition(!1,t)})}(u,c+1,h),p.className="pp-item",u.appendChild(t.createTextNode(r[c].title)),p.appendChild(u),l.appendChild(p)}n.addEventListener("mouseleave",function(){a.setPointerPosition(!0)}),o.addEventListener("timeupdate",function(){var e=o.currentTime,t=a.startTimeSet,r=t.length;if(Math.abs(a.preTime-e)>1)for(var i=0;r>i;i++)e>t[i]?a.setPointerPosition(!1,i+1,!0):null;else for(var i=0;r>i;i++)e>t[i]-1&&e<=t[i]+1&&a.itemsIndex!==i+1?a.setPointerPosition(!1,i+1,!0):null;a.preTime=e}),l.style.color=s,m.id="pp-pointer",n.id="pp-timeline",n.appendChild(l),n.appendChild(m),i.appendChild(n),e.appendChild(i)}"undefined"!=typeof i.audioElem&&"string"!=typeof i.audioElem?this.throwError("Pod Picker: `options.audioElem` must be an string"):null,"undefined"!=typeof i.timelineColor?"string"!=typeof i.timelineColor?this.throwError("Pod Picker: `options.timelineColor` must be an string"):/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(i.timelineColor)?null:this.throwError("Pod Picker: `options.timelineColor` must be an hex color"):null;var o=i.audioElem?t.getElementById(i.audioElem):t.getElementsByTagName("audio")[0],s=i.timelineColor||"#CECECF",a=this,m=setInterval(function(){var e=o.currentSrc;e&&(clearInterval(m),e.match(/\.mp3/i)?a.throwError("Pod Picker: does not support MP3 file format"):n())},10)},r.prototype.setPointerPosition=function(e,r,i){var n=t.getElementsByClassName("pp-item"),o=t.getElementById("pp-pointer"),s=n[0].offsetHeight,a=n.length;if(i){this.itemsIndex=r,n[r-1].children[0].className="currentSection";for(var m=0;a>m;m++)m!==r-1?n[m].children[0].className="":null}o.style.top=e?0===this.itemsIndex?"0px":this.itemsIndex*s-s/2-6+"px":r*s-s/2-6+"px"},r.prototype.convertTime=function(e){/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/.test(e)?null:this.throwError('Pod Picker: `start` time string must be "hh:mm:ss", "mm:ss" or "ss" format');var t=e.split(":"),r=t.length;switch(r){case 1:return 1*t[0];case 2:return 60*t[0]+1*t[1];case 3:return 60*t[0]*60+60*t[1]+1*t[2];default:this.throwError('Pod Picker: `start` time string must be "hh:mm:ss", "mm:ss" or "ss" format')}},r.prototype.throwError=function(e){throw new Error(e)},e.PodPicker||(e.PodPicker=r)}(window,document);