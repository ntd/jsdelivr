{"version":3,"sources":["node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","build/csscritic.umd.js","build/csscritic.concat.css","node_modules/cssify/browser.js","node_modules/imagediff/imagediff.js","node_modules/ayepromise/ayepromise.js","node_modules/rasterizehtml/dist/rasterizeHTML.js","node_modules/imagediff/browser/canvas.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/url/url.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/punycode/punycode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/is-array/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","node_modules/rasterizehtml/node_modules/css-mediaquery/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js","node_modules/rasterizehtml/node_modules/xmlserializer/lib/serializer.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/encode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/decode.js","node_modules/inlineresources/src/inline.js","node_modules/inlineresources/src/util.js","node_modules/inlineresources/src/inlineScript.js","node_modules/inlineresources/src/inlineImage.js","node_modules/inlineresources/src/inlineCss.js","node_modules/inlineresources/src/cssSupport.js","node_modules/inlineresources/src/backgroundValueParser.js","node_modules/inlineresources/node_modules/cssom/lib/index.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/index.js","node_modules/inlineresources/node_modules/cssom/lib/CSSRule.js","node_modules/inlineresources/node_modules/cssom/lib/MediaList.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSMediaRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleDeclaration.js","node_modules/inlineresources/node_modules/cssom/lib/CSSImportRule.js","node_modules/inlineresources/node_modules/cssom/lib/StyleSheet.js","node_modules/inlineresources/node_modules/cssom/lib/CSSFontFaceRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleSheet.js","node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframesRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframeRule.js","node_modules/inlineresources/node_modules/cssom/lib/MatcherList.js","node_modules/inlineresources/node_modules/cssom/lib/CSSDocumentRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSValue.js","node_modules/inlineresources/node_modules/cssom/lib/parse.js","node_modules/inlineresources/node_modules/cssom/lib/clone.js","node_modules/inlineresources/node_modules/cssom/lib/CSSValueExpression.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/grammar/index.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/util.js"],"names":["root","factory","define","amd","a0","b1","c2","exports","module","require","ayepromise","imagediff","rasterizeHTML","this","csscriticLib","main","regression","reporting","util","storage","selectionFilter","currentComponentLabel","testCases","component","componentLabel","supportUrlAsOnlyTestCaseInput","testCase","url","add","augmentedTestCase","clone","undefined","push","fetchStartingComparisons","all","map","readReferenceImage","then","referenceImageRecord","referenceImage","image","viewport","selectComparisons","configuredComparisons","configuredComparison","selected","isComparisonSelected","reportConfiguredComparisons","comparisonSelection","selection","isSelected","doReportConfiguredComparison","executeTestCase","startingComparison","compare","comparison","doReportComparison","execute","allPassed","startingComp","selectedComparisons","filter","comparisons","hasTestSuitePassed","doReportTestSuite","renderer","toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux","workAroundFirefoxResourcesSporadicallyMissing","htmlImage","diff","workAroundBrowserIssues","pageImage","workAroundTransparencyIssueInFirefox","compareRenderingAndReference","isEqual","adaptedHtmlImage","equal","comparisonResult","textualStatus","renderErrors","result","status","loadPageAndCompare","render","hover","active","width","height","renderResult","errors","viewportFallback","fallbackWidth","fallbackHeight","reporters","addReporter","reporter","testCaseIsResizable","attachPageAcceptHelpers","viewportWidth","viewportHeight","resizePageImage","acceptPage","storeReferenceImage","reportingMethod","reportSelectedComparison","reportDeselectedComparison","reportingFunc","reportComparison","passed","reportTestSuite","success","getDataURIForImage","canvas","window","document","createElement","context","getContext","naturalWidth","naturalHeight","drawImage","toDataURL","getImageForUrl","defer","Image","onload","resolve","onerror","reject","src","promise","getUncachableURL","delimiter","indexOf","Date","now","ajax","xhr","XMLHttpRequest","response","open","send","e","loadAsBlob","responseType","loadBlobAsText","blob","reader","FileReader","target","readAsText","loadBlobAsDataURI","readAsDataURL","excludeKeys","theMap","Array","prototype","slice","call","arguments","newMap","Object","keys","forEach","key","serializeMap","serializationEntries","sort","join","object","i","theClone","hasOwnProperty","successfulPromise","value","dataUri","nonPassingTestCases","length","hasValidTestSetup","functionReturnValues","pendingFunctionCalls","resolvedValues","functionCallResolved","idx","returnValue","browserRenderer","jobQueue","queue","cache","getOrCreateJobQueue","extractErrorMessages","error","msg","logErrorToConsole","console","doRenderHtml","parameters","drawOptions","cacheBucket","executeJs","executeJsTimeout","baseUrl","drawHTML","html","renderHtmlFromBlob","content","loadImageFromBlob","fallbackFilter","windowLocation","storageKey","fullDescription","desc","sessionStorage","getItem","filterFor","setItem","reload","filterForComponent","clearFilter","removeItem","indexeddbstorage","createDb","db","createObjectStore","keyPath","getDb","request","indexedDB","onsuccess","event","onupgradeneeded","buildKey","testCaseParameters","serializedParameters","imageUri","transaction","objectStore","put","reference","close","get","dataObj","img","busy","runJob","job","func","nextInQueue","shift","constructJob","niceReporter","pageNavigationHandlingFallback","packageVersion","originalTitle","escapeValue","toString","replace","RegExp","template","templateStr","values","_","param","elementFor","htmlString","tmp","insertAdjacentHTML","firstChild","findElementIn","container","elementClassName","querySelector","escapeId","id","headerClassName","timeTakenClassName","progressBarClassName","statusTextClassName","headerOptionalClassName","createContainer","parentContainer","reportBody","showHeader","appendChild","elementDimensions","element","initialPosition","getBoundingClientRect","scrollOffsetTop","body","scrollTop","documentElement","scrollOffsetLeft","scrollLeft","top","left","right","px","makeElementFixedOnScroll","dimensions","scrollingClass","smallClass","smallScrollThreshold","isScrolling","isSmall","pseudoInlineElement","addEventListener","scrollY","classList","style","position","parentElement","insertBefore","remove","removeChild","header","updateStatusInDocumentTitle","totalCount","doneCount","title","padNumber","number","renderMilliseconds","time","seconds","Math","floor","milliSeconds","showTimeTaken","timeTakenInMillis","timeTaken","textContent","setOutcomeOnHeader","successful","progressBarPendingClassName","testDescription","comparisonKey","addTickToProgressBar","linkTarget","progressBar","clickableTickTemplate","deactivatedTickTemplate","tickTemplate","tick","install","markTickDone","renderErrorCount","tickElement","singularPlural","singularForm","pluralForm","statusTotalText","selectedCount","totalContent","total","statusIssueText","issueCount","issueContent","doneContent","noTestsContent","doneWithoutErrors","issues","acceptAllClassName","acceptAllButton","showAcceptAllButtonIfNeccessary","acceptableEntries","statusText","button","onclick","acceptableEntry","acceptComparison","entry","setAttribute","installFallbackClearSelectionHandler","preventDefault","updateStatusBar","runAllUrl","clearFilterUrl","runAll","innerHTML","getOrCreateToc","tocClassName","toc","className","addTocEntry","headline","installFallbackComponentSelectionHandler","addComponentHeading","filterUrl","filterUrlForComponent","headlineElement","runningComparisonClassName","referenceImageContainerClassName","errorContainerClassName","imageWrapper","wrapper","serializeValue","installFallbackSelectionHandler","addComparison","titleLinkClassName","filterUrlFor","anchorTarget","referenceImageContainer","titleLink","canvasForImageCanvas","imageData","putImageData","diffPageImages","imageA","imageB","align","embossChanges","d","data","getDifferenceCanvas","differenceImageData","canvasForImage","addImageDiff","imageForDiff","toggleViewClassName","acceptClassName","acceptButton","showPageImage","testCaseUrl","realView","imageContainer","pageAsIframe","pageImageContainer","acceptButtonElement","pageImageContainerClassName","outerPageImageContainer","toggleButton","showRealView","accepted","removeAttribute","showComparisonWithDiff","iframe","scrolling","showComparisonWithoutReference","sameOriginWarning","showComparisonWithError","errorMsg","errorContainer","showRenderErrors","listElement","li","updateComparisonStatus","supportsReadingHtmlFromCanvas","browserIssueChecked","showBrowserWarningIfNeeded","supported","NiceReporter","outerContainer","containerElement","timeStarted","lastComponentLabel","progressTickElements","runningComparisonEntries","acceptableComparisons","registerComparison","comparisonElement","fakeTargetClassName","clearFakeActiveClass","previousTargets","querySelectorAll","elem","triggerFakeActiveClass","targetElement","scrollTo","getElementById","scrollIntoView","globalNavigationHandlingInstalled","installGlobalNavigationHandling","onpopstate","state","targetLink","decodeURIComponent","href","targetId","substr","history","pushState","urlQueryFilter","filterParam","parseUrlSearch","search","paramString","split","keyValue","equalsIdx","serializeKeyValuePair","pair","getFilterValue","filterKeyValue","entryPair","pop","existingQueryParams","queryPart","queryParams","encodeURIComponent","csscritic","installCallChain","self","apply","startsWith","str","prefix","needsFallback","location","indexedDbStorage","queryFilter","css","customDocument","doc","createStyleSheet","sheet","cssText","ownerNode","head","getElementsByTagName","type","styleSheet","createTextNode","byUrl","link","rel","name","definition","Canvas","Error","message","getCanvas","getImageData","clearRect","createImageData","getCanvasRef","isImage","isType","TYPE_IMAGE","isCanvas","TYPE_CANVAS","isContext","TYPE_CONTEXT","isImageData","TYPE_IMAGE_DATA","UNDEFINED","isImageType","match","copyImageData","newImageData","newData","toImageData","toImageDataFromImage","toImageDataFromCanvas","toImageDataFromContext","toCanvas","equalWidth","a","b","equalHeight","equalDimensions","tolerance","aData","bData","abs","options","diffEqual","diffUnequal","c","cData","offsets","rowOffset","columnOffset","row","column","j","max","checkType","imageDataToPNG","outputFile","callback","base64Data","decodedImage","Function","Buffer","writeFile","jasmine","previous","toBeImageData","actual","toImageDiffEqual","expected","div","overflow","createCanvas","noConflict","once","wasCalled","wrappedFunction","getThenableIfExists","obj","aThenHandler","onFulfilled","onRejected","doHandlerCall","setTimeout","TypeError","callFulfilled","callRejected","handle","FULFILLED","PENDING","REJECTED","outcome","thenHandlers","doSettle","settledState","doFulfill","doReject","registerThenHandler","thenHandler","safelyResolveThenable","thenable","onceWrapper","transparentlyResolveThenablesAndSettle","fail","d3","e4","cssMediaQuery","xmlserializer","inlineresources","uniqueIdList","joinUrl","relUrl","getConstantUniqueIdFor","isObject","parseOptionalParameters","args","proxies","monkeyPatchInstanceMethod","methodName","proxyFunc","originalFunc","baseUrlRespectingXhr","XHRObject","xhrConstructor","originalOpen","method","joinedUrl","concat","finishNotifyingXhr","totalXhrCount","doneXhrCount","waitingForPendingToClose","checkAllRequestsFinished","pendingXhrCount","originalSend","waitForRequestsToFinish","documentUtil","asArray","arrayLike","addClassNameRecursively","parentNode","ownerDocument","changeCssRule","rule","newRuleText","parentStyleSheet","ruleIdx","cssRules","insertRule","deleteRule","updateRuleSelector","updatedSelector","styleDefinitions","newRule","cssRulesToText","reduce","rewriteStyleContent","styleElement","matchingSimpleSelectorsRegex","simpleSelectorList","replaceSimpleSelectorsBy","caseInsensitiveReplaceFunc","selectorRegex","matchingRules","selectorText","test","newSelector","prefixMatch","selectorMatch","rewriteCssSelectorWith","oldSelector","lowercaseCssTypeSelectors","matchingTagNames","toLowerCase","findHtmlOnlyNodeNames","currentTagName","treeWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","htmlNodeNames","nonHtmlNodeNames","nextNode","currentNode","tagName","namespaceURI","documentHelper","fakeHover","hoverSelector","fakeHoverClass","fakeActive","activeSelector","fakeActiveClass","fakeFocus","focusSelector","fakeFocusClass","persistInputValues","inputs","textareas","isCheckable","input","checked","textarea","rewriteTagNameSelectorsToLowerCase","mediaQueryHelper","hasEmIssue","svgImgBlueByEmMediaQuery","svg","firstPixelHasColor","r","g","hasEmMediaQueryIssue","needsEmWorkaround","mediaQueryRule","mediaQueries","exchangeRuleWithNewContent","serializeExpression","exp","feature","modifier","serializeQueryPart","q","segments","inverse","expressions","serializeQuery","queryParts","transformEmIntoPx","em","replaceEmValueWithPx","exec","parseFloat","substituteEmWithPx","mediaQuery","parsedQuery","parse","hasChanges","rewrittenValue","replaceEmsWithPx","mediaQueryRules","anyRuleHasChanges","reworkedMediaQueries","media","rewrittenMediaQuery","workAroundWebKitEmSizeIssue","styles","CSSRule","MEDIA_RULE","browser","theWindow","createHiddenElement","visibility","executeJavascript","outerHTML","iframeErrorsMessages","timeout","doResolve","contentDocument","waitForJavaScriptToRun","finishNotifyXhrProxy","contentWindow","baseUrlXhrProxy","resourceType","write","createHiddenSandboxedIFrame","sandbox","createIframeWithSizeAtZoomLevel1","zoom","scaledViewportWidth","scaledViewportHeight","calculateZoomedContentSizeAndRoundUp","actualViewport","requestedWidth","requestedHeight","calculateContentSize","selector","originalWidth","originalHeight","rootFontSize","rect","contentSize","actualViewportWidth","scrollWidth","clientWidth","actualViewportHeight","scrollHeight","clientHeight","getComputedStyle","fontSize","calculateDocumentContentSize","size","clip","addHTMLTagAttributes","htmlTagSubstitute","elementSubstitute","attribute","attributeMatch","helperDoc","implementation","createHTMLDocument","attributes","parseHTML","isParseError","parsedDocument","p","DOMParser","errorneousParse","parseFromString","parsererrorNS","getElementsByTagNameNS","failOnParseError","validateXHTML","xhtml","lastCacheDate","doDocumentLoad","ajaxRequest","augmentedUrl","responseXML","err","loadDocument","svg2image","checkForBlobsResult","urlForSvg","useBlobs","URL","createObjectURL","Blob","cleanUpUrl","revokeObjectURL","simpleForeignObjectSvg","supportsReadingObjectFromCanvas","readingBackFromCanvasBenefitsFromOldSchoolDataUris","blobUrl","supportsReadingFromBlobs","s","supportsBlobBuilding","checkBlobSupport","doesBenefit","checkForBlobs","buildImageUrl","renderSvg","resetEventHandlers","cleanUp","imageUrl","document2svg","zoomedElementSizingAttributes","zoomFactor","closestScaledWith","closestScaledHeight","offsetX","offsetY","round","x","y","transform","workAroundCollapsingMarginsAcrossSVGElementInWebKitLike","workAroundSafariSometimesNotShowingExternalResources","externalResourcesRequired","workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll","serializeAttributes","convertDocumentToSvg","serializeToString","getSvgForDocument","needsWorkaround","drawDocumentAsSvg","focus","rasterize","generalDrawError","drawSvgAsImg","drawImageOnCanvas","doDraw","operateJavaScriptOnDocument","inlineOptions","inlineScripts","inlineReferences","drawResult","getViewportSize","defaultWidth","defaultHeight","constructOptions","params","drawDocument","optionalArguments","workAroundFirefoxNotLoadingStylesheetStyles","replaceChild","extendedOptions","drawURL","workaround","subject","encoding","byteLength","isArray","kMaxLength","RangeError","TYPED_ARRAY_SUPPORT","_augment","Uint8Array","_isBuffer","_set","isArrayish","isBuffer","readUInt8","poolSize","parent","rootParent","SlowBuffer","buf","hexWrite","string","offset","Number","remaining","strLen","parsed","parseInt","isNaN","utf8Write","charsWritten","blitBuffer","utf8ToBytes","asciiWrite","asciiToBytes","binaryWrite","base64Write","base64ToBytes","utf16leWrite","utf16leToBytes","base64Slice","start","end","base64","fromByteArray","utf8Slice","res","min","decodeUtf8Char","String","fromCharCode","asciiSlice","ret","binarySlice","hexSlice","len","out","toHex","utf16leSlice","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","ieee754","writeDouble","base64clean","stringtrim","INVALID_BASE64_RE","trim","n","units","Infinity","codePoint","leadSurrogate","charCodeAt","byteArray","hi","lo","toByteArray","dst","INSPECT_MAX_BYTES","ArrayBuffer","arr","foo","subarray","isEncoding","list","totalLength","pos","item","copy","loweredCase","equals","inspect","val","byteOffset","arrayIndexOf","foundIndex","log","set","v","writeUInt8","isFinite","swap","toJSON","_arr","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","read","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","target_start","fill","toArrayBuffer","buffer","BP","constructor","toLocaleString","Url","protocol","slashes","auth","host","port","hostname","hash","query","pathname","path","urlParse","parseQueryString","slashesDenoteHost","u","urlFormat","isString","format","urlResolve","source","relative","urlResolveObject","resolveObject","arg","isNull","isNullOrUndefined","punycode","protocolPattern","portPattern","delims","unwise","autoEscape","nonHostChars","hostEndingChars","hostnameMaxLen","hostnamePartPattern","hostnamePartStart","unsafeProtocol","javascript","javascript:","hostlessProtocol","slashedProtocol","http","https","ftp","gopher","file","http:","https:","ftp:","gopher:","file:","querystring","rest","proto","lowerProto","hostEnd","hec","atSign","lastIndexOf","parseHost","ipv6Hostname","hostparts","l","part","newpart","k","validParts","notHost","bit","unshift","domainArray","newOut","encode","h","ae","esc","escape","qm","stringify","charAt","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","authInHost","last","hasTrailingSlash","up","splice","isAbsolute","decode","array","fn","mapDomain","regexSeparators","ucs2decode","extra","output","counter","ucs2encode","stringFromCharCode","basicToDigit","base","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","damp","baseMinusTMin","tMax","skew","basic","index","oldi","w","t","baseMinusT","inputLength","initialN","bias","initialBias","maxInt","tMin","handledCPCount","basicLength","m","currentValue","handledCPCountPlusOne","qMinusT","toUnicode","domain","regexPunycode","toASCII","regexNonASCII","freeExports","freeModule","freeGlobal","global","not-basic","invalid-input","version","ucs2","nodeType","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","LN2","matchQuery","parseQuery","some","typeMatch","expressionsMatch","every","expression","expValue","toPx","toDpi","toDecimal","captures","RE_MEDIA_QUERY","RE_MQ_EXPRESSION","RE_MQ_FEATURE","ratio","numbers","decimal","resolution","RE_RESOLUTION_UNIT","RE_LENGTH_UNIT","lookup","elt","code","PLUS","PLUS_URL_SAFE","SLASH","SLASH_URL_SAFE","NUMBER","UPPER","LOWER","b64ToByteArray","b64","L","placeHolders","Arr","uint8ToBase64","uint8","num","tripletToBase64","temp","extraBytes","base64js","removeInvalidCharacters","serializeAttributeValue","serializeTextContent","serializeAttribute","attr","getTagName","node","serializeNamespace","nodeHasXmlnsAttr","attrs","serializeChildren","childNodes","childNode","nodeTreeToXHTML","serializeTag","serializeText","text","nodeValue","serializeComment","serializeCDATA","nodeName","xs","f","stringifyPrimitive","sep","eq","objectKeys","ks","prop","qs","regexp","maxKeys","kstr","vstr","inlineImage","inlineScript","inlineCss","cssSupport","getUrlBasePath","parameterHashFunction","JSON","memoizeFunctionOnCaching","memoize","requestExternalsForStylesheet","styleContent","alreadyLoadedCssUrls","rulesForCssText","loadCSSImportsForRules","cssImportResult","loadAndInlineCSSResourcesForRules","cssResourcesResult","loadAndInlineCssForStyle","processExternals","cloneArray","getCssStyleElements","loadAndInlineStyles","allErrors","getDocumentBaseUrl","substituteLinkWithInlineStyle","oldLinkNode","styleNode","requestStylesheetAndInlineResources","hasChangesFromPathAdjustment","adjustPathsOfCssResources","loadLinkedCSS","cssHref","documentBaseUrl","ajaxOptions","processStylesheet","getCssStylesheetLinks","links","loadAndInlineCssLinks","loadAndInlineImages","inline","loadAndInlineScript","inlineFuncs","baseURI","nodeList","isDataUri","promises","pendingPromiseCount","collectAndReportErrors","overrideMimeType","mimeType","binaryAjax","binaryContent","detectMimeType","substring","getDataURIForImageURL","base64Content","btoa","constantUniqueIdFor","hasher","memo","retValue","argumentHash","funcHash","loadLinkedScript","script","documentBase","escapeClosingTags","substituteExternalScriptWithInline","scriptNode","jsCode","removeNamedItem","getScripts","scripts","encodeImageAsDataURI","dataURI","filterExternalImages","images","filterInputsForImageType","toArray","imageInputs","externalImages","backgroundValueParser","fontFaceSrcValueParser","updateCssPropertyValue","property","setProperty","getPropertyPriority","findBackgroundImageRules","STYLE_RULE","getPropertyValue","findBackgroundDeclarations","rules","backgroundDeclarations","findFontFaceRules","FONT_FACE_RULE","findCSSImportRules","IMPORT_RULE","findExternalBackgroundUrls","parsedBackground","matchIndices","backgroundLayer","findExternalFontFaceUrls","parsedFontFaceSources","sourceIndices","sourceItem","backgroundRules","change","declaration","backgroundValue","externalBackgroundIndices","backgroundLayerIndex","relativeUrl","serialize","externalFontFaceUrlIndices","fontFaceSrcDeclaration","fontFaceUrlIndex","changeFontFaceRuleSrc","cssUrl","exchangeRule","substituteRule","newCssRules","fulfilledPromise","loadAndInlineCSSImport","cssHrefRelativeToDoc","unquoteString","externalCssRules","rulesToInline","moreErrors","loadAndInlineBackgroundImages","externalBackgroundLayerIndices","iterateOverRulesAndInlineBackgroundImages","cssHasChanges","loadAndInlineFontFace","srcDeclarationValue","urlIndex","fontSrc","iterateOverRulesAndInlineFontFace","cssom","quotedUrl","doubleQuoteRegex","singleQuoteRegex","rulesForCssTextFromBrowser","browserHasBackgroundImageUrlIssue","newSrc","trimCSSWhitespace","whitespaceRegex","extractCssUrl","urlRegex","sliceBackgroundDeclaration","backgroundDeclarationText","outerRepeatedMatch","functionParamRegexS","valueRegexS","simpleSingularBackgroundRegexS","simpleBackgroundRegexS","simpleSingularBackgroundRegex","backgroundLayers","getValues","singularBackgroundDeclaration","repeatedMatch","valueRegex","backgroundValues","findBackgroundImageUrlInValues","backgroundLayerValues","urlMatch","preUrl","postUrl","CSSStyleDeclaration","CSSStyleRule","MediaList","CSSMediaRule","CSSImportRule","CSSFontFaceRule","StyleSheet","CSSStyleSheet","CSSKeyframesRule","CSSKeyframeRule","MatcherList","CSSDocumentRule","CSSValue","CSSValueExpression","grammar","SyntaxError","fontFaceSourceValue","itemValue","local","CSSOM","parentRule","PAGE_RULE","WEBKIT_KEYFRAMES_RULE","WEBKIT_KEYFRAME_RULE",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":299,"endcol":14,"endline":21,"pos":290,"col":5,"line":21,"value":"mediaText","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":299,"endcol":14,"endline":21,"pos":290,"col":5,"line":21,"value":"mediaText","type":"name"},"name":"mediaText"},"mediaText","appendMedium","medium","deleteMedium","defineProperty","ruleText","character","SIGNIFICANT_WHITESPACE","styleRule","priority","cssTexts","_importants","removeProperty","prevValue","getPropertyCSSValue","getPropertyShorthand","isPropertyImplicit","properties","dummyRule","cssRule","_vendorPrefix","keyText","matcherText","appendMatcher","matcher","deleteMatcher","_getConstructorName","Exception","token","mediaRule","importRule","fontFaceRule","keyframesRule","documentRule","atRule","importRule-begin","atBlock","documentRule-begin","currentScope","atKeyframesRegExp","parseError","lines","lineCount","charCount","line","__starts","lastIndex","matchKeyframes","info","__ends","stylesheet","cloned","RULE_TYPES",1,4,8,9,"rulesLength","ruleClone","styleClone","styleLength","_token","_idx","paren","_parseJSComment","_parseJSRexExp","_parseJSString","nextChar","endIdx","commentEndChar","startIdx","_findMatchedIdx","before","legalRegx","isLegal","reg","NOT_FOUND","matched","nextNewLineIdx","peg$subclass","child","ctor","found","peg$computePosDetails","advance","details","startPos","endPos","ch","seenCR","peg$cachedPos","peg$cachedPosDetails","peg$fail","peg$maxFailPos","peg$currPos","peg$maxFailExpected","peg$buildException","cleanupExpected","description","buildMessage","stringEscape","hex","toUpperCase","expectedDesc","foundDesc","expectedDescs","posDetails","peg$parsestart","s0","s1","peg$parsesourceEntries","peg$FAILED","peg$reportedPos","peg$c1","s2","s3","s4","s5","peg$parsesourceEntry","peg$parsewhitespace","peg$c3","peg$silentFails","peg$c4","peg$c5","peg$c2","peg$c6","peg$parseurlEntry","peg$parselocalEntry","peg$parseurl","peg$parseformat","peg$c7","peg$c8","peg$c9","peg$c10","peg$parsevalue","peg$c11","peg$c12","peg$c13","peg$c14","peg$c15","peg$c16","peg$c17","peg$c18","peg$c19","peg$c20","peg$c21","peg$c22","peg$c23","peg$result","peg$startRuleFunctions","peg$startRuleFunction","chars","extractValue","startRule"],"mappings":"AAAA;AEAA,GAAI+f,KAAM,0tXAAquXtf,SAAQ,4BAA6Bsf,KAAMvf,OAAOD,QAAUwf;;CDA1yX,SAAU/f,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IAEzCD,QAAQ,aAAa,YAAY,iBAAkB,SAAUE,EAAGC,EAAGC,GACjE,MAAQN,GAAgB,UAAIC,EAAQG,EAAGC,EAAGC,KAEhB,gBAAZC,SAIhBC,OAAOD,QAAUN,EAAQQ,QAAQ,cAAcA,QAAQ,aAAaA,QAAQ,iBAAiBA,QAAQ,kCAErGT,EAAgB,UAAIC,EAAQS,WAAWC,UAAUC,gBAEnDC,KAAM,SAAUH,EAAYC,EAAWC,GAEzC,GAAIE,KAEJA,GAAaC,KAAO,SAAUC,EAAYC,EAAWC,EAAMC,EAASC,GAChE,YAEA,IAGIC,GAHAb,KAEAc,IAIJd,GAAOe,UAAY,SAAUC,GACzBH,EAAwBG,EAI5B,IAAIC,GAAgC,SAAUC,GAC1C,MAAwB,gBAAbA,IAEHC,IAAKD,GAGNA,EAGXlB,GAAOoB,IAAM,SAAUF,GACnB,GAAIG,GAAoBX,EAAKY,MAAML,EAA8BC,GAE7DL,IAAyDU,SAAhCF,EAAkBN,YAC3CM,EAAkBN,UAAYF,GAGlCC,EAAUU,KAAKH,GAInB,IAAII,GAA2B,SAAUX,GACrC,MAAOJ,GAAKgB,IAAIZ,EAAUa,IAAI,SAAUT,GACpC,MAAOP,GAAQiB,mBAAmBV,GAC7BW,KAAK,SAAUC,GACZ,OACIZ,SAAUA,EACVa,eAAgBD,EAAqBE,MACrCC,SAAUH,EAAqBG,WAEpC,WAEC,OACIf,SAAUA,SAM1BgB,EAAoB,SAAUC,GAC9B,MAAOA,GAAsBR,IAAI,SAAUS,GACvC,OACIA,qBAAsBA,EACtBC,UAAWzB,GAAmBA,EAAgB0B,qBAAqBF,OAK3EG,EAA8B,SAAUC,GACxC,MAAO9B,GAAKgB,IAAIc,EAAoBb,IAAI,SAAUc,GAC9C,GAAIC,GAAaD,EAAUJ,QAC3B,OAAO5B,GAAUkC,6BAA6BF,EAAUL,qBAAsBM,OAIlFE,EAAkB,SAAUC,GAC5B,MAAOrC,GAAWsC,QAAQD,GAAoBhB,KAAK,SAAUkB,GACzD,MAAOtC,GAAUuC,mBAAmBD,GAAYlB,KAAK,WACjD,MAAOkB,OAoCnB,OA/BA/C,GAAOiD,QAAU,WACb,GAAIT,GAAqBU,CAEzB,OAAOzB,GAAyBX,GAC3Be,KAAK,SAAUsB,GAGZ,MAFAX,GAAsBN,EAAkBiB,GAEjCZ,EAA4BC,KAEtCX,KAAK,WACF,GAAIuB,GAAsBZ,EAAoBa,OAAO,SAAUZ,GAC3D,MAAOA,GAAUJ,WAClBV,IAAI,SAAUc,GACb,MAAOA,GAAUL,sBAGrB,OAAO1B,GAAKgB,IAAI0B,EAAoBzB,IAChCiB,MAGPf,KAAK,SAAUyB,GACZJ,EAAYxC,EAAK6C,mBAAmBD,KAEvCzB,KAAK,WACF,MAAOpB,GAAU+C,kBAAkBN,KAEtCrB,KAAK,WACF,MAAOqB,MAIZlD,GAGXM,EAAaE,WAAa,SAAUiD,EAAU/C,EAAMP,GAChD,YAEA,IAAIH,MAEA0D,EAA4E,EAE5EC,EAAgD,SAAUC,EAAW7B,GACjEA,GAEA5B,EAAU0D,KAAKD,EAAW7B,IAI9B+B,EAA0B,SAAUC,EAAWhC,GAG/C,MAFA4B,GAA8CI,EAAWhC,GAElDrB,EAAKsD,qCAAqCD,IAGjDE,EAA+B,SAAUF,EAAWhC,GACpD,GAAImC,EAEJ,OAAOJ,GAAwBC,EAAWhC,GAAgBF,KAAK,SAAUsC,GACrE,MAAIpC,IACAmC,EAAU/D,EAAUiE,MAChBD,EACApC,EACA2B,GAEGQ,EAAU,SAAW,UAErB,sBAKfG,EAAmB,SAAUC,EAAepD,EAAUe,EAAUsC,EAAcR,EAAWhC,GACzF,GAAIyC,IACAC,OAAQH,EACRpD,SAAUA,EACVe,SAAUvB,EAAKY,MAAMW,GACrBsC,aAAcA,EASlB,OANIR,KACAS,EAAOT,UAAYA,GAEnBhC,IACAyC,EAAOzC,eAAiBA,GAErByC,GAGPE,EAAqB,SAAUxD,EAAUe,EAAUF,GACnD,MAAO0B,GAASkB,QACZxD,IAAKD,EAASC,IACdyD,MAAO1D,EAAS0D,MAChBC,OAAQ3D,EAAS2D,OACjBC,MAAO7C,EAAS6C,MAChBC,OAAQ9C,EAAS8C,SAClBlD,KAAK,SAAUmD,GACd,MAAOf,GAA6Be,EAAahD,MAAOD,GAAgBF,KAAK,SAAUyC,GACnF,MAAOD,GAAiBC,EACApD,EACAe,EACA+C,EAAaC,OACbD,EAAahD,MACbD,MAE7B,WACC,MAAOsC,GAAiB,QACAnD,EACAe,SAK5BiD,EAAmB,SAAUhE,GAC7B,GAAIiE,GAAgB,IAChBC,EAAiB,GACrB,QACIN,MAAO5D,EAAS4D,OAASK,EACzBJ,OAAQ7D,EAAS6D,QAAUK,GAcnC,OAVApF,GAAO8C,QAAU,SAAUD,GACvB,GAAIZ,GAAWY,EAAmBZ,QAMlC,OAJ0CV,UAAtCsB,EAAmBd,iBACnBE,EAAWiD,EAAiBrC,EAAmB3B,WAG5CwD,EAAmB7B,EAAmB3B,SAAUe,EAAUY,EAAmBd,iBAGjF/B,GAGXM,EAAaG,UAAY,SAAUgD,EAAU9C,EAASD,GAClD,YAEA,IAAIV,MAEAqF,IAEJrF,GAAOsF,YAAc,SAAUC,GAC3BF,EAAU7D,KAAK+D,GAGnB,IAAIC,GAAsB,SAAUtE,GAChC,MAA0BK,UAAnBL,EAAS4D,OAA2CvD,SAApBL,EAAS6D,QAGhDU,EAA0B,SAAU1C,GACpC,GAAI2C,GAAeC,CAEf5C,GAAWgB,YACX2B,EAAgB3C,EAAWd,SAAS6C,MACpCa,EAAiB5C,EAAWd,SAAS8C,OAEjCS,EAAoBzC,EAAW7B,YAC/B6B,EAAW6C,gBAAkB,SAAUd,EAAOC,GAI1C,MAHAW,GAAgBZ,EAChBa,EAAiBZ,EAEVtB,EAASkB,QACZxD,IAAK4B,EAAW7B,SAASC,IACzByD,MAAO7B,EAAW7B,SAAS0D,MAC3BC,OAAQ9B,EAAW7B,SAAS2D,OAC5BC,MAAOA,EACPC,OAAQA,IACTlD,KAAK,SAAUmD,GAEd,MADAjC,GAAWgB,UAAYiB,EAAahD,MAC7BgD,EAAahD,UAIhCe,EAAW8C,WAAa,WACpBlF,EAAQmF,oBAAoB/C,EAAW7B,SAAU6B,EAAWgB,WACxDe,MAAOY,EACPX,OAAQY,OAMpBI,EAAkB,SAAUR,EAAU7C,GACtC,MAAIA,GACO6C,EAASS,yBAETT,EAASU,2BAiCxB,OA7BAjG,GAAO2C,6BAA+B,SAAUP,EAAsBM,GAClE,MAAOhC,GAAKgB,IAAI2D,EAAU1D,IAAI,SAAU4D,GACpC,GAAIW,GAAgBH,EAAgBR,EAAU7C,EAC9C,OAAIwD,GACOA,EAAc9D,GADzB,WAMRpC,EAAOgD,mBAAqB,SAAUD,GAClC,GAAIyB,GAAS9D,EAAKY,MAAMyB,EAIxB,OAFA0C,GAAwBjB,GAEjB9D,EAAKgB,IAAI2D,EAAU1D,IAAI,SAAU4D,GACpC,MAAIA,GAASY,iBACFZ,EAASY,iBAAiB3B,GADrC,WAMRxE,EAAOwD,kBAAoB,SAAU4C,GACjC,MAAO1F,GAAKgB,IAAI2D,EAAU1D,IAAI,SAAU4D,GACpC,MAAIA,GAASc,gBACFd,EAASc,iBAAiBC,QAASF,IAD9C,WAMDpG,GAGXM,EAAaI,KAAO,WAChB,YAEA,IAAIV,KAEJA,GAAOuG,mBAAqB,SAAUvE,GAClC,GAAIwE,GAASC,OAAOC,SAASC,cAAc,UACvCC,EAAUJ,EAAOK,WAAW,KAOhC,OALAL,GAAO1B,MAAQ9C,EAAM8E,aACrBN,EAAOzB,OAAS/C,EAAM+E,cAEtBH,EAAQI,UAAUhF,EAAO,EAAG,GAErBwE,EAAOS,UAAU,cAG5BjH,EAAOkH,eAAiB,SAAU/F,GAC9B,GAAIgG,GAAQjH,EAAWiH,QACnBnF,EAAQ,GAAIyE,QAAOW,KAUvB,OARApF,GAAMqF,OAAS,WACXF,EAAMG,QAAQtF,IAElBA,EAAMuF,QAAU,WACZJ,EAAMK,UAEVxF,EAAMyF,IAAMtG,EAELgG,EAAMO,QAGjB,IAAIC,GAAmB,SAAUxG,GAC7B,GAAIyG,EAMJ,OAJIA,GADAzG,EAAI0G,QAAQ,KAAO,EACP,IAEA,IAET1G,EAAMyG,EAAY,KAAOE,KAAKC,MAGzC/H,GAAOgI,KAAO,SAAU7G,GACpB,GAAIgG,GAAQjH,EAAWiH,QACnBc,EAAM,GAAIC,eAEdD,GAAIZ,OAAS,WACU,MAAfY,EAAIxD,QAAiC,IAAfwD,EAAIxD,OAC1B0C,EAAMG,QAAQW,EAAIE,UAElBhB,EAAMK,UAIdS,EAAIV,QAAU,WACVJ,EAAMK,SAGV,KACIS,EAAIG,KAAK,MAAOT,EAAiBxG,IAAM,GACvC8G,EAAII,OACN,MAAOC,GACLnB,EAAMK,SAGV,MAAOL,GAAMO,SAGjB1H,EAAOuI,WAAa,SAAUpH,GAC1B,GAAIgG,GAAQjH,EAAWiH,QACnBc,EAAM,GAAIC,eAEdD,GAAIZ,OAAS,WACU,MAAfY,EAAIxD,QAAiC,IAAfwD,EAAIxD,OAC1B0C,EAAMG,QAAQW,EAAIE,UAElBhB,EAAMK,UAIdS,EAAIV,QAAU,WACVJ,EAAMK,SAGV,KACIS,EAAIG,KAAK,MAAOT,EAAiBxG,IAAM,GACvC8G,EAAIO,aAAe,OACnBP,EAAII,OACN,MAAOC,GACLnB,EAAMK,SAGV,MAAOL,GAAMO,SAGjB1H,EAAOyI,eAAiB,SAAUC,GAC9B,GAAIvB,GAAQjH,EAAWiH,QACnBwB,EAAS,GAAIC,WAYjB,OAVAD,GAAOtB,OAAS,SAAUiB,GACtBnB,EAAMG,QAAQgB,EAAEO,OAAOrE,SAG3BmE,EAAOpB,QAAU,WACbJ,EAAMK,UAGVmB,EAAOG,WAAWJ,GAEXvB,EAAMO,SAGjB1H,EAAO+I,kBAAoB,SAAUL,GACjC,GAAIvB,GAAQjH,EAAWiH,QACnBwB,EAAS,GAAIC,WAYjB,OAVAD,GAAOtB,OAAS,SAAUiB,GACtBnB,EAAMG,QAAQgB,EAAEO,OAAOrE,SAG3BmE,EAAOpB,QAAU,WACbJ,EAAMK,UAGVmB,EAAOK,cAAcN,GAEdvB,EAAMO,SAKjB1H,EAAOiJ,YAAc,SAAUC,GAC3B,GAAID,GAAcE,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GACpDC,IAQJ,OANAC,QAAOC,KAAKR,GAAQS,QAAQ,SAAUC,GACD,KAA7BX,EAAYpB,QAAQ+B,KACpBJ,EAAOI,GAAOV,EAAOU,MAItBJ,GAGXxJ,EAAO6J,aAAe,SAAUX,GAC5B,GAAIY,MACAJ,EAAOD,OAAOC,KAAKR,EAMvB,OAJAQ,GAAKK,OACLL,EAAKC,QAAQ,SAAUC,GACnBE,EAAqBtI,KAAKoI,EAAM,IAAMV,EAAOU,MAE1CE,EAAqBE,KAAK,MAGrChK,EAAOsB,MAAQ,SAAU2I,GACrB,GACIC,GADAC,IAEJ,KAAKD,IAAKD,GACFA,EAAOG,eAAeF,KACvBC,EAASD,GAAKD,EAAOC,GAG5B,OAAOC,GAGX,IAAIE,GAAoB,SAAUC,GAC9B,GAAInD,GAAQjH,EAAWiH,OAEvB,OADAA,GAAMG,QAAQgD,GACPnD,EAAMO,QA8DjB,OA3DA1H,GAAOgE,qCAAuC,SAAUhC,GAKpD,GAAIuI,EACJ,KACIA,EAAUvK,EAAOuG,mBAAmBvE,GACtC,MAAOsG,GAEL,MAAO+B,GAAkBrI,GAG7B,MAAOhC,GAAOkH,eAAeqD,IAGjCvK,EAAOuD,mBAAqB,SAAUD,GAClC,GAAIkH,GAAsBlH,EAAYD,OAAO,SAAUN,GAC/C,MAA6B,WAAtBA,EAAW0B,SAEtBvB,EAA2C,IAA/BsH,EAAoBC,OAChCC,EAAoBpH,EAAYmH,OAAS,CAE7C,OAAOC,IAAqBxH,GAGhClD,EAAO0B,IAAM,SAAUiJ,GACnB,GAAIxD,GAAQjH,EAAWiH,QACnByD,EAAuBD,EAAqBF,OAC5CI,KAEAC,EAAuB,SAAUR,EAAOS,GACxCH,GAAwB,EACxBC,EAAeE,GAAOT,EAEO,IAAzBM,GACAzD,EAAMG,QAAQuD,GAItB,OAAoC,KAAhCF,EAAqBF,QACrBtD,EAAMG,YACCH,EAAMO,UAGjBiD,EAAqBhB,QAAQ,SAAUqB,EAAaD,GAC5CC,GAAeA,EAAYnJ,KAC3BmJ,EAAYnJ,KAAK,SAAU2C,GACvBsG,EAAqBtG,EAAQuG,IAC9B,SAAUzC,GACTnB,EAAMK,OAAOc,KAGjBwC,EAAqBE,EAAaD,KAGnC5D,EAAMO,UAGV1H,GAGXM,EAAa2K,gBAAkB,SAAUvK,EAAMwK,EAAU9K,GACrD,YAEA,IAII+K,GAJAnL,KAEAoL,KAIAC,EAAsB,WAItB,MAHKF,KACDA,EAAQD,KAELC,GAGPG,EAAuB,SAAUrG,GACjC,MAAOA,GAAOtD,IAAI,SAAU4J,GACxB,MAAOA,GAAMC,OAIjBC,EAAoB,SAAUnD,GAG9B,KAFAoD,SAAQH,MAAMjD,GAERA,GAGNqD,EAAe,SAAUC,GACzB,GAAIC,IACIT,MAAO,WACPU,YAAaV,EACbtG,MAAO8G,EAAW9G,MAClBC,OAAQ6G,EAAW7G,OACnBgH,WAAW,EACXC,iBAAkB,GAClBC,QAASL,EAAWK,QAS5B,OAPIL,GAAWhH,QACXiH,EAAYjH,MAAQgH,EAAWhH,OAE/BgH,EAAW/G,SACXgH,EAAYhH,OAAS+G,EAAW/G,QAG7BzE,EAAc8L,SAASN,EAAWO,KAAMN,GAAahK,KAAK,SAAU2C,GACvE,GAAID,GAAe+G,EAAqB9G,EAAOS,OAE/C,QACIjD,MAAOwC,EAAOxC,MACdiD,OAAQV,IAEbkH,IAGHW,EAAqB,SAAU1D,EAAMkD,GACrC,MAAOlL,GAAK+H,eAAeC,GAAM7G,KAAK,SAAUwK,GAC5C,MAAOV,IACHQ,KAAME,EACNJ,QAASL,EAAWzK,IACpB2D,MAAO8G,EAAW9G,MAClBC,OAAQ6G,EAAW7G,OACnBH,MAAOgH,EAAWhH,MAClBC,OAAQ+G,EAAW/G,YAK3ByH,EAAoB,SAAU5D,EAAMkD,GACpC,MAAOlL,GAAKqI,kBAAkBL,GACzB7G,KAAKnB,EAAKwG,gBACVrF,KAAK,SAAUG,GACZ,OACIA,MAAOA,EACPiD,YAEL,WAEC,MAAOmH,GAAmB1D,EAAMkD,KAe5C,OAXA5L,GAAO2E,OAAS,SAAUiH,GAGtB,MAAOP,KAAsBpI,QAAQ,WACjC,MAAOvC,GAAK6H,WAAWqD,EAAWzK,KAC7BU,KAAK,SAAU6G,GACZ,MAAO4D,GAAkB5D,EAAMkD,QAKxC5L,GAGXM,EAAaiM,eAAiB,SAAUC,GACpC,YAEA,IAAIxM,MAEAyM,EAAa,0BAEbC,EAAkB,SAAUxL,GAC5B,MAAOA,GAASH,UAAYG,EAASH,UAAY,IAAMG,EAASyL,KAAOzL,EAASyL,KA6CpF,OA1CA3M,GAAOsC,qBAAuB,SAAUS,GACpC,GAAIM,GAASuJ,eAAeC,QAAQJ,EAEpC,OAAKpJ,GAIDN,EAAW7B,SAASyL,MAAQD,EAAgB3J,EAAW7B,YAAcmC,GAC9D,EAEPN,EAAW7B,SAASH,WAAagC,EAAW7B,SAASH,YAAcsC,GAC5D,GAGHA,GAAUN,EAAW7B,SAASC,MAAQkC,GAVnC,GAafrD,EAAO8M,UAAY,SAAU5L,GACzB,GAAImC,EAGAA,GADAnC,EAASyL,KACAD,EAAgBxL,GAEhBA,EAASC,IAEtByL,eAAeG,QAAQN,EAAYpJ,GAEnCmJ,EAAeQ,UAGnBhN,EAAOiN,mBAAqB,SAAUjM,GAClC4L,eAAeG,QAAQN,EAAYzL,GAEnCwL,EAAeQ,UAGnBhN,EAAOkN,YAAc,WACjBN,eAAeO,WAAWV,GAE1BD,EAAeQ,UAGZhN,GAGXM,EAAa8M,iBAAmB,SAAU1M,GACtC,YAEA,IAAIV,MAEAqN,EAAW,SAASC,GACpBA,EAAGC,kBAAkB,cAAgBC,QAAS,cAG9CC,EAAQ,WACR,GAAItG,GAAQjH,EAAWiH,QACnBuG,EAAUC,UAAUvF,KAAK,YAAa,EAU1C,OARAsF,GAAQE,UAAY,SAAUC,GAC1B,GAAIP,GAAKO,EAAMhF,OAAOrE,MACtB2C,GAAMG,QAAQgG,IAElBI,EAAQI,gBAAkB,SAAUD,GAChC,GAAIP,GAAKO,EAAMhF,OAAOrE,MACtB6I,GAASC,IAENnG,EAAMO,SAGbqG,EAAW,SAAU7M,GACrB,GAAI8M,GAAqBtN,EAAKuI,YAAY/H,EAAU,OAChD+M,EAAuBvN,EAAKmJ,aAAamE,GACzCpE,EAAM1I,EAASC,GAMnB,OAJI8M,KACArE,GAAO,IAAMqE,GAGVrE,EAoEX,OAjEA5J,GAAO8F,oBAAsB,SAAU5E,EAAUa,EAAgBE,GAC7D,GACIiM,GADA/G,EAAQjH,EAAWiH,OAGvB+G,GAAWxN,EAAK6F,mBAAmBxE,EAEnC,IAAI6H,GAAMmE,EAAS7M,EAoBnB,OAlBAuM,KAAQ5L,KAAK,SAAUyL,GACnB,GAAII,GAAUJ,EAAGa,aAAa,cAAe,aACxCC,YAAY,cACZC,KACGnN,SAAU0I,EACV0E,WACIJ,SAAUA,EACVjM,SAAUA,IAItByL,GAAQE,UAAY,WAChBN,EAAGiB,QAEHpH,EAAMG,aAIPH,EAAMO,SAGjB1H,EAAO4B,mBAAqB,SAAUV,GAClC,GAAIiG,GAAQjH,EAAWiH,QACnByC,EAAMmE,EAAS7M,EA+BnB,OA7BAuM,KAAQ5L,KAAK,SAAUyL,GACnB,GAAII,GAAUJ,EAAGa,aAAa,eACzBC,YAAY,cACZI,IAAI5E,EAET8D,GAAQE,UAAY,WAGhB,GAFAN,EAAGiB,QAEoBhN,SAAnBmM,EAAQlJ,QAAqDjD,SAA7BmM,EAAQlJ,OAAO8J,WAAiE/M,SAAtCmM,EAAQlJ,OAAO8J,UAAUJ,SAEnG,WADA/G,GAAMK,QAIV,IAAIiH,GAAUf,EAAQlJ,OAAO8J,SAE7B5N,GAAKwG,eAAeuH,EAAQP,UAAUrM,KAAK,SAAU6M,GACjD,GAAIzM,GAAWwM,EAAQxM,WACnB6C,MAAO4J,EAAI5J,MACXC,OAAQ2J,EAAI3J,OAGhBoC,GAAMG,SACFtF,MAAO0M,EACPzM,SAAUA,KAEfkF,EAAMK,WAIVL,EAAMO,SAGV1H,GAGXM,EAAa4K,SAAW,WACpB,YAEA,IAAIlL,MAEAkL,KACAyD,GAAO,EAEPC,EAAS,SAAUC,GACnB,GAAIrK,GAASqK,EAAIC,MAGjB,OADAD,GAAIvH,QAAQ9C,GACLA,GAGPuK,EAAc,WACd,GAAIF,EACA3D,GAAST,OAAS,GAClBkE,GAAO,EAEPE,EAAM3D,EAAS8D,QAEfJ,EAAOC,GACFhN,KAAKkN,EAAaA,IAEvBJ,GAAO,GAIXM,EAAe,SAAUH,GACzB,GAAI3H,GAAQjH,EAAWiH,OAEvB,QACI2H,KAAMA,EACNxH,QAASH,EAAMG,QACfI,QAASP,EAAMO,SAevB,OAXA1H,GAAOiD,QAAU,SAAU6L,GACvB,GAAID,GAAMI,EAAaH,EAOvB,OALA5D,GAAS1J,KAAKqN,GACTF,GACDI,IAGGF,EAAInH,SAGR1H,GAGXM,EAAa4O,aAAe,SAAUzI,EAAQ/F,EAAME,EAAiBuO,EAAgC/O,EAAegP,GAChH,YAEA,IAiJIC,GAjJArP,KAIAsP,EAAc,SAAUhF,GACxB,MAAOA,GAAMiF,WACRC,QAAQ,KAAM,SACdA,QAAQ,GAAIC,QAAO,KAAM,OAAQ,KACjCD,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,WAGnBE,EAAW,SAAUC,EAAaC,GAClC,MAAOD,GAAYH,QAAQ,iBAAkB,SAAUK,EAAGC,GACtD,GAAIxF,GAA0B/I,SAAlBqO,EAAOE,GAAuBF,EAAOE,GAAS,EAC1D,OAAOR,GAAYhF,MAIvByF,EAAa,SAAUC,GACvB,GAAIC,GAAMvJ,SAASC,cAAc,OAEjC,OADAsJ,GAAIC,mBAAmB,YAAaF,GAC7BC,EAAIE,YAGXC,EAAgB,SAAUC,EAAWC,GACrC,MAAOD,GAAUE,cAAc,IAAMD,IAGrCE,EAAW,SAAUC,GACrB,MAAOA,GAAGjB,QAAQ,KAAM,MAKxBkB,EAAkB,SAClBC,EAAqB,YACrBC,EAAuB,cACvBC,EAAsB,aACtBC,EAA0B,WAE1BC,EAAkB,SAAUC,GAC5B,GAAIC,GAAalB,EAAW,4CAM5B,OAJAmB,GAAWD,GAEXD,EAAgBG,YAAYF,GAErBA,GAGPG,EAAoB,SAAUC,GAC9B,GAAIC,GAAkBD,EAAQE,wBAC1BC,EAAkB9K,SAAS+K,KAAKC,WAAahL,SAASiL,gBAAgBD,UACtEE,EAAmBlL,SAAS+K,KAAKI,YAAcnL,SAASiL,gBAAgBE,UAE5E,QACIC,IAAKR,EAAgBQ,IAAMN,EAC3BO,KAAMT,EAAgBS,KAAOH,EAC7BI,MAAOV,EAAgBU,MAAQV,EAAgBxM,MAAQ8M,EACvD7M,OAAQuM,EAAgBvM,SAI5BkN,EAAK,SAAU3H,GACf,MAAOA,GAAQ,MAGf4H,EAA2B,SAAUb,GACrC,GAMIc,GANAC,EAAiB,YACjBC,EAAa,QACbC,EAAuB,GACvBC,GAAc,EACdC,GAAU,EACVC,EAAsB/L,SAASC,cAAc,MAGjDF,GAAOiM,iBAAiB,SAAU,WAC1BjM,EAAOkM,QAAU,GACXJ,IACFA,GAAc,EAEdJ,EAAaf,EAAkBC,GAE/BA,EAAQuB,UAAUxR,IAAIgR,GAEtBf,EAAQwB,MAAMC,SAAW,QACzBzB,EAAQwB,MAAMf,IAAMG,EAAGE,EAAWL,KAClCT,EAAQwB,MAAMd,KAAOE,EAAGE,EAAWJ,MACnCV,EAAQwB,MAAMb,MAAQC,EAAGE,EAAWH,OAEpCS,EAAoBI,MAAM9N,OAASkN,EAAGE,EAAWpN,QACjDsM,EAAQ0B,cAAcC,aAAaP,EAAqBpB,KAEtDmB,GAAW/L,EAAOkM,QAAUL,GAC9BE,GAAU,EACVnB,EAAQuB,UAAUxR,IAAIiR,IACfG,GAAW/L,EAAOkM,SAAWL,IACpCE,GAAU,EACVnB,EAAQuB,UAAUK,OAAOZ,KAGzBE,IACAA,GAAc,EAEdlB,EAAQuB,UAAUK,OAAOb,GACzBf,EAAQuB,UAAUK,OAAOZ,GAEzBhB,EAAQwB,MAAMC,SAAW,GACzBzB,EAAQwB,MAAMf,IAAM,GACpBT,EAAQwB,MAAMd,KAAO,GACrBV,EAAQwB,MAAMb,MAAQ,GAEtBX,EAAQ0B,cAAcG,YAAYT,OAM9CvB,EAAa,SAAUb,GACvB,GAAI8C,GAASpD,EAAWL,EAAS,6VAUIgB,gBAAiBA,EACjBC,mBAAoBA,EACpBC,qBAAsBA,EACtBE,wBAAyBA,EACzBD,oBAAqBA,EACrBzB,eAAgBA,IAGrD8C,GAAyBiB,GACzB9C,EAAUc,YAAYgC,IAOtBC,EAA8B,SAAUC,EAAYC,GAC9B/R,SAAlB8N,IACAA,EAAgB3I,SAAS6M,OAG7B7M,SAAS6M,MAAQ,IAAMD,EAAY,IAAMD,EAAa,KAAOhE,GAK7DmE,EAAY,SAAUC,EAAQhJ,GAE9B,IADAgJ,GAAU,GACHA,EAAOhJ,OAASA,GACnBgJ,EAAS,IAAMA,CAEnB,OAAOA,IAGPC,EAAqB,SAAUC,GAC/B,GAAIC,GAAUC,KAAKC,MAAMH,EAAO,KAC5BI,EAAeJ,EAAO,GAC1B,OAAOC,GAAU,IAAMJ,EAAUO,EAAc,IAG/CC,EAAgB,SAAU3D,EAAW4D,GACrC,GAAIC,GAAY9D,EAAcC,EAAWM,EACzCuD,GAAUC,YAAc,eAAiBT,EAAmBO,GAAqB,KAGjFG,EAAqB,SAAU/D,EAAWgE,GAC1C,GAAIlB,GAAS/C,EAAcC,EAAWK,EAEtCyC,GAAOP,UAAUxR,IAAIiT,EAAa,OAAS,SAK3CC,EAA8B,UAE9BC,EAAkB,SAAUrT,GAC5B,GAAIH,EACJ,OAAIG,GAASyL,MACT5L,EAAYG,EAASH,UAAYG,EAASH,UAAY,IAAM,GACrDA,EAAYG,EAASyL,MAErB6H,EAActT,IAIzBuT,EAAuB,SAAUpE,EAAWnP,EAAUwT,GACtD,GAAIC,GAAcvE,EAAcC,EAAWO,GACvCgE,EAAwB,4DACxBC,EAA0B,qCAC1BC,EAAeJ,EAAaE,EAAwBC,EAEpDE,EAAOhF,EAAWL,EAASoF,GAC3BJ,WAAYA,EAAalE,EAASkE,GAAc,GAChDnB,MAAOgB,EAAgBrT,KAS3B,OAPA6T,GAAKnC,UAAUxR,IAAIkT,GACnBK,EAAYxD,YAAY4D,GAEpB5F,GACAA,EAA+B6F,QAAQD,EAAKxE,cAAc,MAGvDwE,GAGPE,EAAe,SAAUxQ,EAAQyQ,EAAkBC,GACnDA,EAAYvC,UAAUK,OAAOqB,GAC7Ba,EAAYvC,UAAUxR,IAAIqD,GACtByQ,EAAmB,GACnBC,EAAYvC,UAAUxR,IAAI,oBAM9BgU,EAAiB,SAAU9K,EAAO+K,EAAcC,GAChD,MAAc,KAAVhL,EACO+K,EAEAC,GAIXC,EAAkB,SAAUlC,EAAYmC,GACxC,GAAIC,GAAe,aAAeL,EAAe/B,EAAY,QAAS,WAAa,IAInF,OAHoBA,GAAhBmC,IACAC,EAAe,mBAAqBA,GAEjC/F,EAAS,SACA+F,EACA,WACZC,MAAOrC,EACPhR,SAAUmT,KAIdG,EAAkB,SAAUC,EAAYJ,EAAelC,GACvD,GAIIjH,GAJAwJ,EAAe,cAAgBT,EAAeQ,EAAY,QAAS,QAAU,aAC7EE,EAAc,WACdC,EAAiB,mBACjBC,EAAoBR,IAAkBlC,GAA4B,IAAfsC,CASvD,OANIvJ,GADkB,IAAlBmJ,EACUO,EACHC,EACGF,EAEAD,EAEPnG,EAAS,SACArD,EACA,WACI4J,OAAQL,KAI5BM,EAAqB,YAErBC,EAAkB,WAClB,MAAOpG,GAAWL,EAAS,2FACvBwG,mBAAoBA,MAIxBE,EAAkC,SAAU/F,EAAWgG,GACvD,GAAIC,GAAalG,EAAcC,EAAWQ,GACtC0F,EAASD,EAAW/F,cAAc,IAAM2F,EAExCG,GAAkB5L,OAAS,IAC3B8L,EAAO3D,UAAUxR,IAAI,UACrBmV,EAAOC,QAAU,WACbH,EAAkB1M,QAAQ,SAAU8M,GAChCA,EAAgB5Q,aAChB6Q,GAAiBD,EAAgBE,SAGrCJ,EAAOK,aAAa,WAAY,eAKxCC,EAAuC,SAAUxF,GAC7CzQ,EAAgBsM,cAChBmE,EAAQmF,QAAU,SAAUlO,GACxB1H,EAAgBsM,cAChB5E,EAAEwO,oBAKVC,EAAkB,SAAU1G,EAAWgD,EAAYmC,EAAeI,EAAYtC,GAC9E,GAAI0D,GAAYpW,EAAgBqW,eAAiBrW,EAAgBqW,iBAAmB,IAChFC,EAASnH,EAAWL,EAAS,gDACzBvO,IAAK6V,KAETV,EAAalG,EAAcC,EAAWQ,EAE1CyF,GAAWa,UAAY,GACvBb,EAAWnF,YAAYpB,EAAWwF,EAAgBlC,EAAYmC,KAC9Dc,EAAWnF,YAAYpB,EAAW4F,EAAgBC,EAAYJ,EAAelC,KAC7EgD,EAAWnF,YAAYgF,KACnB9C,EAAamC,IACbqB,EAAqCK,GACrCZ,EAAWnF,YAAY+F,KAM3BE,EAAiB,SAAU/G,GAC3B,GAAIgH,GAAe,YACfC,EAAMjH,EAAUE,cAAc,IAAM8G,EAQxC,OANKC,KACDA,EAAMvH,EAAWL,EAAS,0DACtB6H,UAAWF,KAEfhH,EAAUE,cAAc,IAAMO,GAAyBK,YAAYmG,IAEhEA,EAAI/G,cAAc,OAGzBiH,EAAc,SAAUnH,EAAWrP,EAAgB0T,GACnD,GAAI4C,GAAMF,EAAe/G,GACrBsG,EAAQ5G,EAAWL,EAAS,wEAGIgF,WAAYlE,EAASkE,GACrB+C,SAAUzW,IAG1CmO,IACAA,EAA+B6F,QAAQ2B,EAAMpG,cAAc,MAG/D+G,EAAInG,YAAYwF,IAKhBe,EAA2C,SAAUrG,EAASrQ,GAC1DJ,EAAgBqM,qBAChBoE,EAAQmF,QAAU,SAAUlO,GACxB1H,EAAgBqM,mBAAmBjM,GACnCsH,EAAEwO,oBAKVa,EAAsB,SAAUtH,EAAWrP,GAC3C,GAAI4W,GAAYhX,EAAgBiX,sBAAwBjX,EAAgBiX,sBAAsB7W,GAAkB,IAC5G8W,EAAkB/H,EAAWL,EAAS,4EAClC+H,SAAUzW,EACV4W,UAAWA,IAGnBF,GAAyCI,EAAiB9W,GAC1DqP,EAAUc,YAAY2G,IAKtBtD,EAAgB,SAAUtT,GAC1B,GAAI8M,GAAqBtN,EAAKuI,YAAY/H,EAAU,OAChD+M,EAAuBvN,EAAKmJ,aAAamE,GACzCpE,EAAM1I,EAASC,GAEnB,OAAI8M,GACOrE,EAAM,IAAMqE,EAGhBrE,GAGPmO,EAA6B,UAC7BC,EAAmC,0BACnCC,EAA0B,YAE1BC,EAAe,SAAUlW,GACzB,GAAImW,GAAUpI,EAAW,mCAEzB,OADAoI,GAAQhH,YAAYnP,GACbmW,GAGPC,EAAiB,SAAU9N,GAC3B,MAAqB,gBAAVA,GACA,IAAMA,EAAQ,IAElBA,GAGP0D,EAAqB,SAAU9M,GAC/B,GAAI0K,GAAalL,EAAKuI,YAAY/H,EAAU,MAAO,OAAQ,aACvDwI,EAAOD,OAAOC,KAAKkC,EAEvB,OAAKlC,GAAKe,QAGVf,EAAKK,OAEE,0BACHL,EAAK/H,IAAI,SAAUiI,GACf,MAAO8F,GAAS,sCACZ9F,IAAKA,EACLU,MAAO8N,EAAexM,EAAWhC,QAEtCI,KAAK,MACR,SAXO,IAcXqO,EAAkC,SAAUhH,EAASnQ,GACjDN,EAAgBkM,YAChBuE,EAAQmF,QAAU,SAAUlO,GACxB1H,EAAgBkM,UAAU5L,GAC1BoH,EAAEwO,oBAKVwB,EAAgB,SAAUjI,EAAWnP,EAAUa,EAAgB6H,GAC/D,GAAI2O,GAAqB,YACrBX,EAAYhX,EAAgB4X,aAAe5X,EAAgB4X,aAAatX,GAAY,IACpF6B,EAAagN,EAAWL,EAAS,gMAIA1B,EAAmB9M,GACnB,qIAMIC,IAAKD,EAASC,IACdoS,MAAOrS,EAASyL,KAAOzL,EAASyL,KAAOzL,EAASC,IAChDyW,UAAWA,EACXG,2BAA4BA,EAC5BE,wBAAyBA,EACzBD,iCAAkCA,EAClCO,mBAAoBA,KAEzDE,EAAe1I,EAAWL,EAAS,6DAC/Be,GAAID,EAAS5G,MAEjB8O,EAA0B3V,EAAWwN,cAAc,IAAMyH,GACzDW,EAAY5V,EAAWwN,cAAc,IAAMgI,EAU/C,OARIxW,IACA2W,EAAwBvH,YAAY+G,EAAanW,IAErDsW,EAAgCM,EAAWzX,GAE3CmP,EAAUc,YAAYsH,GACtBpI,EAAUc,YAAYpO,GAEfA,GAGP6V,GAAuB,SAAUC,GACjC,GACIjS,GADAJ,EAASE,SAASC,cAAc,SASpC,OANAH,GAAOzB,OAAS8T,EAAU9T,OAC1ByB,EAAO1B,MAAS+T,EAAU/T,MAE1B8B,EAAUJ,EAAOK,WAAW,MAC5BD,EAAQkS,aAAaD,EAAW,EAAG,GAE5BrS,GAGPuS,GAAiB,SAAUC,EAAQC,GACnC,MAAO9Y,GAAU0D,KAAKmV,EAAQC,GAASC,MAAO,SAG9CC,GAAgB,SAAUN,GAC1B,GACI3O,GADAkP,EAAIP,EAAUQ,IAElB,KAAKnP,EAAI,EAAGA,EAAIkP,EAAE3O,OAAQP,GAAK,EACd,IAATkP,EAAElP,IAAuB,IAAXkP,EAAElP,EAAE,IAAuB,IAAXkP,EAAElP,EAAE,GAClCkP,EAAElP,EAAE,GAAK,GAETkP,EAAElP,GAAK,EACPkP,EAAElP,EAAE,GAAK,EACTkP,EAAElP,EAAE,GAAK,IACTkP,EAAElP,EAAE,GAAK,IAGjB,OAAO2O,IAGPS,GAAsB,SAAUN,EAAQC,GACxC,GAAIM,GAAsBR,GAAeC,EAAQC,GAC7CzS,EAASoS,GAAqBO,GAAcI,GAGhD,OADA/S,GAAOoM,UAAUxR,IAAI,QACdoF,GAIPgT,GAAiB,SAAUxX,GAC3B,GAGI4E,GAHAJ,EAASE,SAASC,cAAc,UAChC7B,EAAS9C,EAAM8E,aACf/B,EAAS/C,EAAM+E,aAanB,OAVAP,GAAO1B,MAASA,EAChB0B,EAAOzB,OAASA,EAEhB6B,EAAUJ,EAAOK,WAAW,MAC5BD,EAAQI,UAAUhF,EAAO,EAAG,EAAG8C,EAAOC,GAGtCyB,EAAOqM,MAAM/N,MAAQA,EAAQ,KAC7B0B,EAAOqM,MAAM9N,OAASA,EAAS,KAExByB,GAGPiT,GAAe,SAAUzX,EAAO0X,EAAcrJ,GAC9C,GAAIqI,GAA0BrI,EAAUE,cAAc,IAAMyH,EAE5DU,GAAwBvH,YAAYmI,GAAoBtX,EAAO0X,KAG/DC,GAAsB,aACtBC,GAAkB,SAElBlD,GAAmB,SAAUrG,GAC7B,GAAIwJ,GAAexJ,EAAUE,cAAc,IAAMqJ,GACjDC,GAAajD,aAAa,WAAY,YACtCiD,EAAa1F,YAAc,IAC3B9D,EAAUuC,UAAUxR,IAAI,aAGxByY,GAAe,SAAUhU,EAAYwK,GACrC,GAAIkG,GAASxG,EAAWL,EAAS,oEAGIkK,gBAAiBA,KAMtD,OAJArD,GAAOC,QAAU,WACb3Q,IACA6Q,GAAiBrG,IAEdkG,GAGPuD,GAAgB,SAAU/V,EAAWgW,EAAaC,EAAUC,EAAgB5J,GAC5E4J,EAAe9C,UAAY,GACvB6C,GACAC,EAAe9I,YAAY+G,EAAagC,GAAanW,EAAWgW,KAEhE1J,EAAUuC,UAAUxR,IAAI,cAExB6Y,EAAe9I,YAAY+G,EAAanU,IAExCsM,EAAUuC,UAAUK,OAAO,cAI/BkH,GAAqB,SAAUpW,EAAW8B,EAAYkU,EAAa1J,GACnE,GAYI+J,GAZAC,EAA8B,qBAC9BC,EAA0BvK,EAAWL,EAAS,2KAII2K,4BAA6BA,EAC7BV,oBAAqBA,MAEvEQ,EAAqBG,EAAwB/J,cAAc,IAAM8J,GACjEE,EAAeD,EAAwB/J,cAAc,IAAMoJ,IAC3Da,GAAe,EACfC,GAAW,CA2Bf,OAxBI5U,KACAuU,EAAsBP,GAAa,WAC/BY,GAAW,EACX5U,KACDwK,GAEHiK,EAAwBnJ,YAAYiJ,IAGxCN,GAAc/V,EAAWgW,EAAaS,EAAcL,EAAoB9J,GAExEkK,EAAa/D,QAAU,WACnBgE,GAAgBA,EAChBV,GAAc/V,EAAWgW,EAAaS,EAAcL,EAAoB9J,GAEpExK,IACI2U,EACAJ,EAAoBxD,aAAa,WAAY,YACrC6D,GACRL,EAAoBM,gBAAgB,cAKzCJ,GAGPK,GAAyB,SAAU5W,EAAWhC,EAAgB8D,EAAYkU,EAAa1J,GACvFoJ,GAAa1X,EAAgBgC,EAAWsM,GACxCA,EAAUc,YAAYgJ,GAAmBX,GAAezV,GAAY8B,EAAYkU,EAAa1J,KAG7F6J,GAAe,SAAUnW,EAAWgW,GACpC,GAAIa,GAASlU,SAASC,cAAc,SAKpC,OAJAiU,GAAO9V,MAAQf,EAAUe,MACzB8V,EAAO7V,OAAShB,EAAUgB,OAC1B6V,EAAOnT,IAAMsS,EACba,EAAOC,UAAY,KACZD,GAGPE,GAAiC,SAAU/W,EAAW8B,EAAYkU,EAAa1J,GAC/EA,EAAUc,YAAYgJ,GAAmBX,GAAezV,GAAY8B,EAAYkU,EAAa1J,KAG7F0K,GAAoB,0JAMpBC,GAA0B,SAAU7Z,EAAKkP,GACzC,GAAI4K,GAAWlL,EAAWL,EAAS,mDAEAqL,GACA,WACI5Z,IAAKA,KAExC+Z,EAAiB7K,EAAUE,cAAc,IAAM0H,EACnDiD,GAAe/J,YAAY8J,IAG3BE,GAAmB,SAAUlW,EAAQoL,GACrC,GAAI4K,GAAWlL,EAAWL,EAAS,8DAGAqL,GACA,YAC/BK,EAAcH,EAAS1K,cAAc,MACrC2K,EAAiB7K,EAAUE,cAAc,IAAM0H,EAEnDhT,GAAOtD,IAAI,SAAU4J,GACjB,MAAOwE,GAAWL,EAAS,oBAAqBlE,IAAKD,OACtD5B,QAAQ,SAAU0R,GACjBD,EAAYjK,YAAYkK,KAG5BH,EAAe/J,YAAY8J,IAG3BK,GAAyB,SAAU7W,EAAQ4L,GAC3CA,EAAUuC,UAAUK,OAAO8E,GAC3B1H,EAAUuC,UAAUxR,IAAIqD,IAKxB8W,GAAgC,WAChC,MAAOnb,GAAc8L,SAAS,WAAWrK,KAAK,SAAU2C,GACpD,GAAIgC,GAASE,SAASC,cAAc,UAChCC,EAAUJ,EAAOK,WAAW,KAChC,KAII,MAHAD,GAAQI,UAAUxC,EAAOxC,MAAO,EAAG,GAEnCwE,EAAOS,UAAU,cACV,EACT,MAAOqB,GACL,OAAO,MAKfkT,IAAsB,EAEtBC,GAA6B,SAAUpL,GACnCmL,KAGJA,IAAsB,EAEtBD,KAAgC1Z,KAAK,SAAU6Z,GACvCA,GAIJrL,EAAUc,YAAYpB,EAClB,+UAiIZ,OArHA/P,GAAO2b,aAAe,SAAUC,GAC5B,GAOIC,GAAkBC,EAAaC,EAP/B1I,EAAa,EACbmC,EAAgB,EAChBlC,EAAY,EACZsC,EAAa,EACboG,KACAC,KACAC,KAGA7L,EAAY,WAIZ,MAHKwL,KACDA,EAAmB9K,EAAgB6K,GAAkBlV,SAAS+K,OAE3DoK,GAGPM,EAAqB,WACrB9I,GAAc,EACTyI,IACDA,EAAchU,KAAKC,OAGvB0T,GAA2BpL,KAC3B+C,EAA4BC,EAAYC,GACxCyD,EAAgB1G,IAAagD,EAAYmC,EAAeI,GAG5D,QACI3P,2BAA4B,SAAUlD,GAClCoZ,IAEA1H,EAAqBpE,IAAatN,EAAW7B,WAEjD8E,yBAA0B,SAAUjD,GAChC,GAAI6G,GAAM4K,EAAczR,EAAW7B,SACnCsU,IAAiB,EAEbzS,EAAW7B,SAASH,WAAagC,EAAW7B,SAASH,YAAcgb,IACnEA,EAAqBhZ,EAAW7B,SAASH,UACzC4W,EAAoBtH,IAAatN,EAAW7B,SAASH,WACrDyW,EAAYnH,IAAatN,EAAW7B,SAASH,UAAW6I,IAG5DuS,GAEA,IAAIhH,GAAcV,EAAqBpE,IAAatN,EAAW7B,SAAU0I,EACzEoS,GAAqBpS,GAAOuL,CAE5B,IAAIiH,GAAoB9D,EAAcjI,IACAtN,EAAW7B,SACX6B,EAAWhB,eACX6H,EACtCqS,GAAyBrS,GAAOwS,GAEpCjW,iBAAkB,SAAUpD,GACxB,GAAI6G,GAAM4K,EAAczR,EAAW7B,UAC/BiU,EAAc6G,EAAqBpS,GACnC+M,EAAQsF,EAAyBrS,EAErC0J,IAAa,EACa,WAAtBvQ,EAAW0B,SACXmR,GAAc,GAGlBxC,EAA4BC,EAAYC,GACxCyD,EAAgB1G,IAAagD,EAAYmC,EAAeI,EAAYtC,GACpE2B,EAAalS,EAAW0B,OAAQ1B,EAAWwB,aAAakG,OAAQ0K,GAEtC,WAAtBpS,EAAW0B,QACXkW,GAAuB5X,EAAWgB,UACXhB,EAAWhB,eACXgB,EAAW8C,WACX9C,EAAW7B,SAASC,IACpBwV,GACvBuF,EAAsB1a,KAAKuB,IACE,qBAAtBA,EAAW0B,QAClBqW,GAA+B/X,EAAWgB,UACXhB,EAAW8C,WACX9C,EAAW7B,SAASC,IACpBwV,GAC/BuF,EAAsB1a,KAAKuB,IACE,WAAtBA,EAAW0B,OAClBqW,GAA+B/X,EAAWgB,UACXxC,OACAwB,EAAW7B,SAASC,IACpBwV,GACF,UAAtB5T,EAAW0B,QAClBuW,GAAwBjY,EAAW7B,SAASC,IACpBwV,GAGxB5T,EAAWwB,aAAakG,OAAS,GACjC0Q,GAAiBpY,EAAWwB,aAAcoS,GAG9C2E,GAAuBvY,EAAW0B,OAAQkS,IAE9CtQ,gBAAiB,SAAU7B,GACvB,GAAI6R,GAAoB6F,EAAsBva,IAAI,SAAUoB,GACxD,GAAI6G,GAAM4K,EAAczR,EAAW7B,SACnC,QACI2E,WAAY9C,EAAW8C,WACvB8Q,MAAOsF,EAAyBrS,KAIxCwJ,GAA4BC,EAAYC,GACxCyD,EAAgB1G,IAAagD,EAAYmC,EAAeI,EAAYtC,GAEpEU,EAAc3D,IAAayL,EAAchU,KAAKC,MAAQ+T,EAAc,GACpE1H,EAAmB/D,IAAa7L,EAAO8B,SACvC8P,EAAgC/F,IAAagG,MAKlDrW,GAMXM,EAAa6O,+BAAiC,WAC1C,YAEA,IAAInP,MAEAqc,EAAsB,aAEtBC,EAAuB,WACvB,GAAIC,GAAkBpT,MAAMC,UAAUC,MAAMC,KAAK5C,SAAS8V,iBAAiB,IAAMH,GACjFE,GAAgB5S,QAAQ,SAAU8S,GAC9BA,EAAK7J,UAAUK,OAAOoJ,MAI1BK,EAAyB,SAAUC,GACnCA,EAAc/J,UAAUxR,IAAIib,IAG5BO,EAAW,SAAUnM,GACrB,GAAIkM,EAEJL,KACI7L,GACAkM,EAAgBjW,SAASmW,eAAepM,GACxCkM,EAAcG,iBACdJ,EAAuBC,IAEvBlW,OAAOmW,SAAS,EAAG,IAIvBG,GAAoC,EAEpCC,EAAkC,WAC7BD,IACDA,GAAoC,EAEpCtW,OAAOwW,WAAa,SAAU3U,GAC1BsU,EAAStU,EAAE4U,SAkBvB,OAbAld,GAAOgV,QAAU,SAAU3D,GACvB2L,IAEA3L,EAAQmF,QAAU,SAAUlO,GACxB,GAAI6U,GAAaC,mBAAmB9U,EAAEO,OAAOwU,MACzCC,EAAWH,EAAWI,OAAOJ,EAAWtV,QAAQ,KAAK,EAEzD+U,GAASU,GACTE,QAAQC,UAAUH,EAAUA,GAC5BhV,EAAEwO,mBAIH9W,GAGXM,EAAaod,eAAiB,SAAUlR,GACpC,YAEA,IAAIxM,MAEA2d,EAAc,SAEdC,EAAiB,SAAUC,GAC3B,GAAIC,GAAcD,EAAOrO,QAAQ,MAAO,GACxC,OAAKsO,GAGEA,EACFC,MAAM,KACNpc,IAAI,SAAUqc,GACX,GACIpU,GAAKU,EADL2T,EAAYD,EAASnW,QAAQ,IASjC,OANIoW,IAAa,GACbrU,EAAMoU,EAAST,OAAO,EAAGU,GACzB3T,EAAQ0T,EAAST,OAAOU,EAAY,IAEpCrU,EAAMoU,GAGNpU,IAAKA,EACLU,MAAOA,SAKnB4T,EAAwB,SAAUC,GAClC,MAAIA,GAAK7T,MACE6T,EAAKvU,IAAM,IAAMuU,EAAK7T,MAE1B6T,EAAKvU,KAGZwU,EAAiB,WACjB,GAAIC,GAAiBT,EAAepR,EAAeqR,QAC1Cxa,OAAO,SAAUib,GACd,MAAOA,GAAU1U,MAAQ+T,IAE5BY,KAET,OAAIF,GACOjB,mBAAmBiB,EAAe/T,OAD7C,QAKAoC,EAAkB,SAAUxL,GAC5B,MAAOA,GAASH,UAAYG,EAASH,UAAY,IAAMG,EAASyL,KAAOzL,EAASyL,MAGhFtJ,EAAS+a,IACTI,EAAsBZ,EAAepR,EAAeqR,OAIxD7d,GAAOsC,qBAAuB,SAAUS,GACpC,MAAKM,GAIDN,EAAW7B,SAASyL,MAAQD,EAAgB3J,EAAW7B,YAAcmC,GAC9D,EAEPN,EAAW7B,SAASH,WAAagC,EAAW7B,SAASH,YAAcsC,GAC5D,EAEJN,EAAW7B,SAASC,MAAQkC,GATxB,EAcf,IAAIob,GAAY,SAAUhc,GACtB,GAAIic,GAAcF,EACTnb,OAAO,SAAU8a,GACd,MAAOA,GAAKvU,MAAQ+T,GAShC,OAPIlb,IACAic,EAAYld,MACRoI,IAAK+T,EACLrT,MAAOqU,mBAAmBlc,KAI3B,IAAMic,EAAY/c,IAAIuc,GAAuBlU,KAAK,KAkB7D,OAfAhK,GAAO6X,sBAAwB,SAAU7W,GACrC,MAAOyd,GAAUzd,IAGrBhB,EAAOwY,aAAe,SAAUtX,GAC5B,MACWud,GADPvd,EAASyL,KACQD,EAAgBxL,GAEpBA,EAASC,MAG9BnB,EAAOiX,eAAiB,WACpB,MAAOwH,MAGJze,GAGXM,EAAa8O,eAAiB,aAG9B,IAAIwP,GAAa,WACb,YAEA,IAAIC,GAAmB,SAAU/P,EAAMgQ,GACnC,MAAO,YAEH,MADAhQ,GAAKiQ,MAAM,KAAMxV,WACVuV,IAIXE,EAAa,SAAUC,EAAKC,GAE5B,MAAOD,GAAI1B,OAAO,EAAG2B,EAAOzU,UAAYyU,GAIxCC,EAAgB,WAChB,MAAOH,GAAWvY,OAAO2Y,SAAS/B,KAAM,YAGxCjO,EAAiB9O,EAAa8O,gBAAkB,MAChD1O,EAAOJ,EAAaI,OAEpB2e,EAAmB/e,EAAa8M,iBAAiB1M,GAEjDuK,EAAkB3K,EAAa2K,gBAAgBvK,EAAMJ,EAAa4K,SAAU9K,GAC5EK,EAAYH,EAAaG,UAAUwK,EAAiBoU,EAAkB3e,GACtEF,EAAaF,EAAaE,WAAWyK,EAAiBvK,EAAMP,GAC5Dmf,EAAchf,EAAaod,eAAejX,OAAO2Y,UACjD7S,EAAiBjM,EAAaiM,eAAe9F,OAAO2Y,UAEpD/b,EAAS8b,IAAkB5S,EAAiB+S,EAE5C/e,EAAOD,EAAaC,KACpBC,EACAC,EACAC,EACA2e,EACAhc,GAGA8L,EAAiC7O,EAAa6O,+BAA+B1I,OAAO2Y,UACpFlQ,EAAe5O,EAAa4O,aACxBzI,OACA/F,EACA2C,EACA8b,IAAkBhQ,EAAiC5N,OACnDnB,EACAgP,GAIJ0P,IAUJ,OARAA,GAAK1d,IAAMyd,EAAiBte,EAAKa,IAAK0d,GACtCA,EAAK/d,UAAY8d,EAAiBte,EAAKQ,UAAW+d,GAClDA,EAAK7b,QAAU1C,EAAK0C,QAEpB6b,EAAKxZ,YAAcuZ,EAAiBpe,EAAU6E,YAAawZ,GAE3DA,EAAKnD,aAAezM,EAAayM,aAE1BmD,IAGX,OAAOF;;CI94DN,SAAUpf,EAAMC,GACS,kBAAXC,SAAyBA,OAAOC,IACvCD,OAAOD,GACmB,gBAAZM,SACdC,OAAOD,QAAUN,IAEjBD,EAAKU,WAAaT,KAExBY,KAAM,WACJ,YAEA,IAAIH,MAIA0kB,EAAO,WACP,GAAIC,IAAY,CAEhB,OAAO,UAAiBC,GACpB,MAAO,YACCD,IAGJA,GAAY,EACZC,EAAgB/F,MAAM,KAAMxV,eAKpCwb,EAAsB,SAAUC,GAEhC,GAAInjB,GAAOmjB,GAAOA,EAAInjB,IAEtB,OAAmB,gBAARmjB,IAAoC,kBAATnjB,GAE3B,WAAa,MAAOA,GAAKkd,MAAMiG,EAAKzb,YAF/C,QAMA0b,EAAe,SAAUC,EAAaC,GACtC,GAAIhe,GAAQjH,EAAWiH,QAEnBie,EAAgB,SAAUtW,EAAMxE,GAChC+a,WAAW,WACP,GAAIra,EACJ,KACIA,EAAc8D,EAAKxE,GACrB,MAAOhC,GAEL,WADAnB,GAAMK,OAAOc,GAIb0C,IAAgB7D,EAAMO,QACtBP,EAAMK,OAAO,GAAI8d,WAAU,uCAE3Bne,EAAMG,QAAQ0D,IAEnB,IAGHua,EAAgB,SAAUjb,GACtB4a,GAAeA,EAAY5b,KAC3B8b,EAAcF,EAAa5a,GAE3BnD,EAAMG,QAAQgD,IAIlBkb,EAAe,SAAUlb,GACrB6a,GAAcA,EAAW7b,KACzB8b,EAAcD,EAAY7a,GAE1BnD,EAAMK,OAAO8C,GAIrB,QACI5C,QAASP,EAAMO,QACf+d,OAAQ,SAAUvI,EAAO5S,GACjB4S,IAAUwI,EACVH,EAAcjb,GAEdkb,EAAalb,MAOzBqb,EAAU,EACVD,EAAY,EACZE,EAAW,CAmFf,OAjFA1lB,GAAWiH,MAAQ,WACf,GACI0e,GADA3I,EAAQyI,EAERG,KAEAC,EAAW,SAAUC,EAAc1b,GACnC4S,EAAQ8I,EAERH,EAAUvb,EAEVwb,EAAanc,QAAQ,SAAU9H,GAC3BA,EAAK4jB,OAAOvI,EAAO2I,KAIvBC,EAAe,MAGfG,EAAY,SAAU3b,GACtByb,EAASL,EAAWpb,IAGpB4b,EAAW,SAAU3a,GACrBwa,EAASH,EAAUra,IAGnB4a,EAAsB,SAAUjB,EAAaC,GAC7C,GAAIiB,GAAcnB,EAAaC,EAAaC,EAQ5C,OANIjI,KAAUyI,EACVG,EAAatkB,KAAK4kB,GAElBA,EAAYX,OAAOvI,EAAO2I,GAGvBO,EAAY1e,SAGnB2e,EAAwB,SAAUC,GAElC,GAAIC,GAAc3B,GAClB,KACI0B,EACIC,EAAYC,GACZD,EAAYL,IAElB,MAAO5d,GACLie,EAAYL,GAAU5d,KAI1Bke,EAAyC,SAAUlc,GACnD,GAAIgc,EAEJ,KACIA,EAAWvB,EAAoBza,GACjC,MAAOhC,GAEL,WADA4d,GAAS5d,GAITge,EACAD,EAAsBC,GAEtBL,EAAU3b,IAIdic,EAAc3B,GAClB,QACItd,QAASif,EAAYC,GACrBhf,OAAQ+e,EAAYL,GACpBxe,SACI7F,KAAMskB,EACNM,KAAM,SAAUtB,GACZ,MAAOgB,GAAoB,KAAMhB,OAM1CjlB;;AF/KXF,OAAOD,QAAU,SAAUwf,EAAKC,GAC9B,GAAIC,GAAMD,GAAkB9Y,QAC5B,IAAI+Y,EAAIC,iBAAkB,CACxB,GAAIC,GAAQF,EAAIC,kBAEhB,OADAC,GAAMC,QAAUL,EACTI,EAAME,UAEb,GAAIC,GAAOL,EAAIM,qBAAqB,QAAQ,GACxClN,EAAQ4M,EAAI9Y,cAAc,QAW9B,OATAkM,GAAMmN,KAAO,WAETnN,EAAMoN,WACRpN,EAAMoN,WAAWL,QAAUL,EAE3B1M,EAAM1B,YAAYsO,EAAIS,eAAeX,IAGvCO,EAAK3O,YAAY0B,GACVA,GAIX7S,OAAOD,QAAQogB,MAAQ,SAAShf,GAC9B,GAAIuF,SAASgZ,iBACX,MAAOhZ,UAASgZ,iBAAiBve,GAAK0e,SAEtC,IAAIC,GAAOpZ,SAASqZ,qBAAqB,QAAQ,GAC7CK,EAAO1Z,SAASC,cAAc,OAMlC,OAJAyZ,GAAKC,IAAM,aACXD,EAAK/C,KAAOlc,EAEZ2e,EAAK3O,YAAYiP,GACVA;;;;AKgCX,QAAS4D,QAAQsU,EAASC,GACxB,GAAIzZ,GAAOze,IACX,MAAMye,YAAgBkF,SAAS,MAAO,IAAIA,QAAOsU,EAASC,EAE1D,IACI9tB,GADAuV,QAAcsY,EAGlB,IAAa,WAATtY,EACFvV,GAAU6tB,MACL,IAAa,WAATtY,EACTvV,EAASuZ,OAAOwU,WAAWF,EAASC,OAC/B,CAAA,GAAa,WAATvY,GAAiC,OAAZsY,EAK9B,KAAM,IAAIhT,WAAU,kDAHC,YAAjBgT,EAAQtY,MAAqByY,QAAQH,EAAQjf,QAAOif,EAAUA,EAAQjf,MAC1E5O,GAAU6tB,EAAQ7tB,OAKpB,GAAIA,EAASiuB,WACX,KAAM,IAAIC,YAAW,0DACnBD,WAAWnpB,SAAS,IAAM,SAGjB,GAAT9E,EAAYA,EAAS,EACpBA,KAAY,EAEbuZ,OAAO4U,oBAET9Z,EAAOkF,OAAO6U,SAAS,GAAIC,YAAWruB,KAGtCqU,EAAKrU,OAASA,EACdqU,EAAKia,WAAY,EAGnB,IAAI7uB,EACJ,IAAI8Z,OAAO4U,qBAAqD,gBAAvBN,GAAQE,WAE/C1Z,EAAKka,KAAKV,OACL,IAAIW,WAAWX,GAEpB,GAAItU,OAAOkV,SAASZ,GAClB,IAAKpuB,EAAI,EAAOO,EAAJP,EAAYA,IACtB4U,EAAK5U,GAAKouB,EAAQa,UAAUjvB,OAG9B,KAAKA,EAAI,EAAOO,EAAJP,EAAYA,IACtB4U,EAAK5U,IAAOouB,EAAQpuB,GAAK,IAAO,KAAO,QAGtC,IAAa,WAAT8V,EACTlB,EAAK2R,MAAM6H,EAAS,EAAGC,OAClB,IAAa,WAATvY,IAAsBgE,OAAO4U,oBACtC,IAAK1uB,EAAI,EAAOO,EAAJP,EAAYA,IACtB4U,EAAK5U,GAAK,CAMd,OAFIO,GAAS,GAAKA,GAAUuZ,OAAOoV,WAAUta,EAAKua,OAASC,YAEpDxa,EAGT,QAASya,YAAYjB,EAASC,GAC5B,KAAMl4B,eAAgBk5B,aAAa,MAAO,IAAIA,YAAWjB,EAASC,EAElE,IAAIiB,GAAM,GAAIxV,QAAOsU,EAASC,EAE9B,cADOiB,GAAIH,OACJG,EAkOT,QAASC,UAAUD,EAAKE,EAAQC,EAAQlvB,GACtCkvB,EAASC,OAAOD,IAAW,CAC3B,IAAIE,GAAYL,EAAI/uB,OAASkvB,CACxBlvB,IAGHA,EAASmvB,OAAOnvB,GACZA,EAASovB,IACXpvB,EAASovB,IAJXpvB,EAASovB,CASX,IAAIC,GAASJ,EAAOjvB,MACpB,IAAIqvB,EAAS,IAAM,EAAG,KAAM,IAAIrZ,OAAM,qBAElChW,GAASqvB,EAAS,IACpBrvB,EAASqvB,EAAS,EAEpB,KAAK,GAAI5vB,GAAI,EAAOO,EAAJP,EAAYA,IAAK,CAC/B,GAAI6vB,GAASC,SAASN,EAAOnc,OAAW,EAAJrT,EAAO,GAAI,GAC/C,IAAI+vB,MAAMF,GAAS,KAAM,IAAItZ,OAAM,qBACnC+Y,GAAIG,EAASzvB,GAAK6vB,EAEpB,MAAO7vB,GAGT,QAASgwB,WAAWV,EAAKE,EAAQC,EAAQlvB,GACvC,GAAI0vB,GAAeC,WAAWC,YAAYX,EAAQF,EAAI/uB,OAASkvB,GAASH,EAAKG,EAAQlvB,EACrF,OAAO0vB,GAGT,QAASG,YAAYd,EAAKE,EAAQC,EAAQlvB,GACxC,GAAI0vB,GAAeC,WAAWG,aAAab,GAASF,EAAKG,EAAQlvB,EACjE,OAAO0vB,GAGT,QAASK,aAAahB,EAAKE,EAAQC,EAAQlvB,GACzC,MAAO6vB,YAAWd,EAAKE,EAAQC,EAAQlvB,GAGzC,QAASgwB,aAAajB,EAAKE,EAAQC,EAAQlvB,GACzC,GAAI0vB,GAAeC,WAAWM,cAAchB,GAASF,EAAKG,EAAQlvB,EAClE,OAAO0vB,GAGT,QAASQ,cAAcnB,EAAKE,EAAQC,EAAQlvB,GAC1C,GAAI0vB,GAAeC,WAAWQ,eAAelB,EAAQF,EAAI/uB,OAASkvB,GAASH,EAAKG,EAAQlvB,EACxF,OAAO0vB,GAwET,QAASU,aAAarB,EAAKsB,EAAOC,GAChC,MACSC,QAAOC,cADF,IAAVH,GAAeC,IAAQvB,EAAI/uB,OACD+uB,EAEAA,EAAInwB,MAAMyxB,EAAOC,IAIjD,QAASG,WAAW1B,EAAKsB,EAAOC,GAC9B,GAAII,GAAM,GACNlrB,EAAM,EACV8qB,GAAMlnB,KAAKunB,IAAI5B,EAAI/uB,OAAQswB,EAE3B,KAAK,GAAI7wB,GAAI4wB,EAAWC,EAAJ7wB,EAASA,IACvBsvB,EAAItvB,IAAM,KACZixB,GAAOE,eAAeprB,GAAOqrB,OAAOC,aAAa/B,EAAItvB,IACrD+F,EAAM,IAENA,GAAO,IAAMupB,EAAItvB,GAAGqF,SAAS,GAIjC,OAAO4rB,GAAME,eAAeprB,GAG9B,QAASurB,YAAYhC,EAAKsB,EAAOC,GAC/B,GAAIU,GAAM,EACVV,GAAMlnB,KAAKunB,IAAI5B,EAAI/uB,OAAQswB,EAE3B,KAAK,GAAI7wB,GAAI4wB,EAAWC,EAAJ7wB,EAASA,IAC3BuxB,GAAOH,OAAOC,aAAsB,IAAT/B,EAAItvB,GAEjC,OAAOuxB,GAGT,QAASC,aAAalC,EAAKsB,EAAOC,GAChC,GAAIU,GAAM,EACVV,GAAMlnB,KAAKunB,IAAI5B,EAAI/uB,OAAQswB,EAE3B,KAAK,GAAI7wB,GAAI4wB,EAAWC,EAAJ7wB,EAASA,IAC3BuxB,GAAOH,OAAOC,aAAa/B,EAAItvB,GAEjC,OAAOuxB,GAGT,QAASE,UAAUnC,EAAKsB,EAAOC,GAC7B,GAAIa,GAAMpC,EAAI/uB,SAETqwB,GAAiB,EAARA,KAAWA,EAAQ,KAC5BC,GAAa,EAANA,GAAWA,EAAMa,KAAKb,EAAMa,EAGxC,KAAK,GADDC,GAAM,GACD3xB,EAAI4wB,EAAWC,EAAJ7wB,EAASA,IAC3B2xB,GAAOC,MAAMtC,EAAItvB,GAEnB,OAAO2xB,GAGT,QAASE,cAAcvC,EAAKsB,EAAOC,GAGjC,IAAK,GAFDiB,GAAQxC,EAAInwB,MAAMyxB,EAAOC,GACzBI,EAAM,GACDjxB,EAAI,EAAGA,EAAI8xB,EAAMvxB,OAAQP,GAAK,EACrCixB,GAAOG,OAAOC,aAAaS,EAAM9xB,GAAoB,IAAf8xB,EAAM9xB,EAAI,GAElD,OAAOixB,GA2CT,QAASc,aAAatC,EAAQuC,EAAKzxB,GACjC,GAAKkvB,EAAS,IAAO,GAAc,EAATA,EAAY,KAAM,IAAIhB,YAAW,qBAC3D,IAAIgB,EAASuC,EAAMzxB,EAAQ,KAAM,IAAIkuB,YAAW,yCA+JlD,QAASwD,UAAU3C,EAAKlvB,EAAOqvB,EAAQuC,EAAK1Y,EAAK4X,GAC/C,IAAKpX,OAAOkV,SAASM,GAAM,KAAM,IAAIlU,WAAU,mCAC/C,IAAIhb,EAAQkZ,GAAe4X,EAAR9wB,EAAa,KAAM,IAAIquB,YAAW,yBACrD,IAAIgB,EAASuC,EAAM1C,EAAI/uB,OAAQ,KAAM,IAAIkuB,YAAW,sBA4CtD,QAASyD,mBAAmB5C,EAAKlvB,EAAOqvB,EAAQ0C,GAClC,EAAR/xB,IAAWA,EAAQ,MAASA,EAAQ,EACxC,KAAK,GAAIJ,GAAI,EAAGqZ,EAAI1P,KAAKunB,IAAI5B,EAAI/uB,OAASkvB,EAAQ,GAAQpW,EAAJrZ,EAAOA,IAC3DsvB,EAAIG,EAASzvB,IAAMI,EAAS,KAAS,GAAK+xB,EAAenyB,EAAI,EAAIA,MAClC,GAA5BmyB,EAAenyB,EAAI,EAAIA,GA8B9B,QAASoyB,mBAAmB9C,EAAKlvB,EAAOqvB,EAAQ0C,GAClC,EAAR/xB,IAAWA,EAAQ,WAAaA,EAAQ,EAC5C,KAAK,GAAIJ,GAAI,EAAGqZ,EAAI1P,KAAKunB,IAAI5B,EAAI/uB,OAASkvB,EAAQ,GAAQpW,EAAJrZ,EAAOA,IAC3DsvB,EAAIG,EAASzvB,GAAMI,IAAuC,GAA5B+xB,EAAenyB,EAAI,EAAIA,GAAU,IAiJnE,QAASqyB,cAAc/C,EAAKlvB,EAAOqvB,EAAQuC,EAAK1Y,EAAK4X,GACnD,GAAI9wB,EAAQkZ,GAAe4X,EAAR9wB,EAAa,KAAM,IAAIquB,YAAW,yBACrD,IAAIgB,EAASuC,EAAM1C,EAAI/uB,OAAQ,KAAM,IAAIkuB,YAAW,qBACpD,IAAa,EAATgB,EAAY,KAAM,IAAIhB,YAAW,sBAGvC,QAAS6D,YAAYhD,EAAKlvB,EAAOqvB,EAAQ0C,EAAcI,GAKrD,MAJKA,IACHF,aAAa/C,EAAKlvB,EAAOqvB,EAAQ,EAAG,sBAAwB,wBAE9D+C,QAAQjM,MAAM+I,EAAKlvB,EAAOqvB,EAAQ0C,EAAc,GAAI,GAC7C1C,EAAS,EAWlB,QAASgD,aAAanD,EAAKlvB,EAAOqvB,EAAQ0C,EAAcI,GAKtD,MAJKA,IACHF,aAAa/C,EAAKlvB,EAAOqvB,EAAQ,EAAG,uBAAyB,yBAE/D+C,QAAQjM,MAAM+I,EAAKlvB,EAAOqvB,EAAQ0C,EAAc,GAAI,GAC7C1C,EAAS,EA6KlB,QAASiD,aAAa3d,GAIpB,GAFAA,EAAM4d,WAAW5d,GAAKzP,QAAQstB,kBAAmB,IAE7C7d,EAAIxU,OAAS,EAAG,MAAO,EAE3B,MAAOwU,EAAIxU,OAAS,IAAM,GACxBwU,GAAY,GAEd,OAAOA,GAGT,QAAS4d,YAAY5d,GACnB,MAAIA,GAAI8d,KAAa9d,EAAI8d,OAClB9d,EAAIzP,QAAQ,aAAc,IAGnC,QAASypB,YAAYX,GACnB,MAAOG,SAAQH,IAAYtU,OAAOkV,SAASZ,IACvCA,GAA8B,gBAAZA,IACQ,gBAAnBA,GAAQ7tB,OAGrB,QAASqxB,OAAOkB,GACd,MAAQ,IAAJA,EAAe,IAAMA,EAAEztB,SAAS,IAC7BytB,EAAEztB,SAAS,IAGpB,QAAS8qB,aAAaX,EAAQuD,GAC5BA,EAAQA,GAASC,EAAAA,CAOjB,KANA,GAAIC,GACA1yB,EAASivB,EAAOjvB,OAChB2yB,EAAgB,KAChBpB,KACA9xB,EAAI,EAEGO,EAAJP,EAAYA,IAAK,CAItB,GAHAizB,EAAYzD,EAAO2D,WAAWnzB,GAG1BizB,EAAY,OAAsB,MAAZA,EAAoB,CAE5C,IAAIC,EAWG,CAGL,GAAID,EAAY,MAAQ,EAEjBF,GAAS,GAAK,IAAIjB,EAAMx6B,KAAK,IAAM,IAAM,IAC9C,UACK,GAAI0I,EAAI,IAAMO,EAAQ,EAEtBwyB,GAAS,GAAK,IAAIjB,EAAMx6B,KAAK,IAAM,IAAM,IAC9C,UAGA47B,EAAgBD,CAChB,UAvBF,GAAgB,MAAZA,EAAoB,EACjBF,GAAS,GAAK,IAAIjB,EAAMx6B,KAAK,IAAM,IAAM,KAC9C47B,EAAgBD,CAChB,UAGAA,EAAYC,EAAgB,OAAU,GAAKD,EAAY,MAAS,MAChEC,EAAgB,SAmBXA,MAEJH,GAAS,GAAK,IAAIjB,EAAMx6B,KAAK,IAAM,IAAM,KAC9C47B,EAAgB,KAIlB,IAAgB,IAAZD,EAAkB,CACpB,IAAKF,GAAS,GAAK,EAAG,KACtBjB,GAAMx6B,KAAK27B,OACN,IAAgB,KAAZA,EAAmB,CAC5B,IAAKF,GAAS,GAAK,EAAG,KACtBjB,GAAMx6B,KACJ27B,GAAa,EAAM,IACP,GAAZA,EAAmB,SAEhB,IAAgB,MAAZA,EAAqB,CAC9B,IAAKF,GAAS,GAAK,EAAG,KACtBjB,GAAMx6B,KACJ27B,GAAa,GAAM,IACnBA,GAAa,EAAM,GAAO,IACd,GAAZA,EAAmB,SAEhB,CAAA,KAAgB,QAAZA,GAST,KAAM,IAAI1c,OAAM,qBARhB,KAAKwc,GAAS,GAAK,EAAG,KACtBjB,GAAMx6B,KACJ27B,GAAa,GAAO,IACpBA,GAAa,GAAM,GAAO,IAC1BA,GAAa,EAAM,GAAO,IACd,GAAZA,EAAmB,MAOzB,MAAOnB,GAGT,QAASzB,cAActb,GAErB,IAAK,GADDqe,MACKpzB,EAAI,EAAGA,EAAI+U,EAAIxU,OAAQP,IAE9BozB,EAAU97B,KAAyB,IAApByd,EAAIoe,WAAWnzB,GAEhC,OAAOozB,GAGT,QAAS1C,gBAAgB3b,EAAKge,GAG5B,IAAK,GAFDja,GAAGua,EAAIC,EACPF,KACKpzB,EAAI,EAAGA,EAAI+U,EAAIxU,WACjBwyB,GAAS,GAAK,GADW/yB,IAG9B8Y,EAAI/D,EAAIoe,WAAWnzB,GACnBqzB,EAAKva,GAAK,EACVwa,EAAKxa,EAAI,IACTsa,EAAU97B,KAAKg8B,GACfF,EAAU97B,KAAK+7B,EAGjB,OAAOD,GAGT,QAAS5C,eAAezb,GACtB,MAAO+b,QAAOyC,YAAYb,YAAY3d,IAGxC,QAASmb,YAAY3yB,EAAKi2B,EAAK/D,EAAQlvB,GACrC,IAAK,GAAIP,GAAI,EAAOO,EAAJP,KACTA,EAAIyvB,GAAU+D,EAAIjzB,QAAYP,GAAKzC,EAAIgD,QADlBP,IAE1BwzB,EAAIxzB,EAAIyvB,GAAUlyB,EAAIyC,EAExB,OAAOA,GAGT,QAASmxB,gBAAgBpc,GACvB,IACE,MAAO7B,oBAAmB6B,GAC1B,MAAO+U,GACP,MAAOsH,QAAOC,aAAa,QAzyC/B,GAAIP,QAAS/6B,QAAQ,aACjBy8B,QAAUz8B,QAAQ,WAClBw4B,QAAUx4B,QAAQ,WAEtBF,SAAQikB,OAASA,OACjBjkB,QAAQw5B,WAAaA,WACrBx5B,QAAQ49B,kBAAoB,GAC5B3Z,OAAOoV,SAAW,IAElB,IAAIV,YAAa,WACbY,aAwBJtV,QAAO4U,oBAAsB,WAC3B,IACE,GAAIY,GAAM,GAAIoE,aAAY,GACtBC,EAAM,GAAI/E,YAAWU,EAEzB,OADAqE,GAAIC,IAAM,WAAc,MAAO,KACV,KAAdD,EAAIC,OACiB,kBAAjBD,GAAIE,UACqC,IAAhD,GAAIjF,YAAW,GAAGiF,SAAS,EAAG,GAAGvF,WACrC,MAAOlwB,GACP,OAAO,MAwFX0b,OAAOkV,SAAW,SAAmB5W,GACnC,QAAe,MAALA,IAAaA,EAAEyW,YAG3B/U,OAAOlhB,QAAU,SAAkBuf,EAAGC,GACpC,IAAK0B,OAAOkV,SAAS7W,KAAO2B,OAAOkV,SAAS5W,GAC1C,KAAM,IAAIgD,WAAU,4BAGtB,IAAIjD,IAAMC,EAAG,MAAO,EAIpB,KAAK,GAFD4T,GAAI7T,EAAE5X,OACN0rB,EAAI7T,EAAE7X,OACDP,EAAI,EAAG0xB,EAAM/nB,KAAKunB,IAAIlF,EAAGC,GAAQyF,EAAJ1xB,GAAWmY,EAAEnY,KAAOoY,EAAEpY,GAAIA,KAKhE,MAJIA,KAAM0xB,IACR1F,EAAI7T,EAAEnY,GACNisB,EAAI7T,EAAEpY,IAEAisB,EAAJD,EAAc,GACVA,EAAJC,EAAc,EACX,GAGTnS,OAAOga,WAAa,SAAqBzF,GACvC,OAAQ+C,OAAO/C,GAAUxN,eACvB,IAAK,MACL,IAAK,OACL,IAAK,QACL,IAAK,QACL,IAAK,SACL,IAAK,SACL,IAAK,MACL,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAO,CACT,SACE,OAAO,IAIb/G,OAAOiE,OAAS,SAAiBgW,EAAMC,GACrC,IAAKzF,QAAQwF,GAAO,KAAM,IAAI3Y,WAAU,6CAExC,IAAoB,IAAhB2Y,EAAKxzB,OACP,MAAO,IAAIuZ,QAAO,EACb,IAAoB,IAAhBia,EAAKxzB,OACd,MAAOwzB,GAAK,EAGd,IAAI/zB,EACJ,IAAoB3I,SAAhB28B,EAEF,IADAA,EAAc,EACTh0B,EAAI,EAAGA,EAAI+zB,EAAKxzB,OAAQP,IAC3Bg0B,GAAeD,EAAK/zB,GAAGO,MAI3B,IAAI+uB,GAAM,GAAIxV,QAAOka,GACjBC,EAAM,CACV,KAAKj0B,EAAI,EAAGA,EAAI+zB,EAAKxzB,OAAQP,IAAK,CAChC,GAAIk0B,GAAOH,EAAK/zB,EAChBk0B,GAAKC,KAAK7E,EAAK2E,GACfA,GAAOC,EAAK3zB,OAEd,MAAO+uB,IAGTxV,OAAOwU,WAAa,SAAqBvZ,EAAKsZ,GAC5C,GAAIkD,EAEJ,QADAxc,GAAY,GACJsZ,GAAY,QAClB,IAAK,QACL,IAAK,SACL,IAAK,MACHkD,EAAMxc,EAAIxU,MACV,MACF,KAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACHgxB,EAAmB,EAAbxc,EAAIxU,MACV,MACF,KAAK,MACHgxB,EAAMxc,EAAIxU,SAAW,CACrB,MACF,KAAK,OACL,IAAK,QACHgxB,EAAMpB,YAAYpb,GAAKxU,MACvB,MACF,KAAK,SACHgxB,EAAMf,cAAczb,GAAKxU,MACzB,MACF,SACEgxB,EAAMxc,EAAIxU,OAEd,MAAOgxB,IAITzX,OAAO5a,UAAUqB,OAASlJ,OAC1ByiB,OAAO5a,UAAUiwB,OAAS93B,OAG1ByiB,OAAO5a,UAAUmG,SAAW,SAAmBgpB,EAAUuC,EAAOC,GAC9D,GAAIuD,IAAc,CAQlB,IANAxD,KAAkB,EAClBC,EAAcx5B,SAARw5B,GAAqBA,IAAQmC,EAAAA,EAAW78B,KAAKoK,OAASswB,IAAQ,EAE/DxC,IAAUA,EAAW,QACd,EAARuC,IAAWA,EAAQ,GACnBC,EAAM16B,KAAKoK,SAAQswB,EAAM16B,KAAKoK,QACvBqwB,GAAPC,EAAc,MAAO,EAEzB,QACE,OAAQxC,GACN,IAAK,MACH,MAAOoD,UAASt7B,KAAMy6B,EAAOC,EAE/B,KAAK,OACL,IAAK,QACH,MAAOG,WAAU76B,KAAMy6B,EAAOC,EAEhC,KAAK,QACH,MAAOS,YAAWn7B,KAAMy6B,EAAOC,EAEjC,KAAK,SACH,MAAOW,aAAYr7B,KAAMy6B,EAAOC,EAElC,KAAK,SACH,MAAOF,aAAYx6B,KAAMy6B,EAAOC,EAElC,KAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,MAAOgB,cAAa17B,KAAMy6B,EAAOC,EAEnC,SACE,GAAIuD,EAAa,KAAM,IAAIhZ,WAAU,qBAAuBiT,EAC5DA,IAAYA,EAAW,IAAIxN,cAC3BuT,GAAc,IAKtBta,OAAO5a,UAAUm1B,OAAS,SAAiBjc,GACzC,IAAK0B,OAAOkV,SAAS5W,GAAI,KAAM,IAAIgD,WAAU,4BAC7C,OAAIjlB,QAASiiB,GAAU,EACY,IAA5B0B,OAAOlhB,QAAQzC,KAAMiiB,IAG9B0B,OAAO5a,UAAUo1B,QAAU,WACzB,GAAIvf,GAAM,GACNuE,EAAMzjB,QAAQ49B,iBAKlB,OAJIt9B,MAAKoK,OAAS,IAChBwU,EAAM5e,KAAKkP,SAAS,MAAO,EAAGiU,GAAK7B,MAAM,SAAS3X,KAAK,KACnD3J,KAAKoK,OAAS+Y,IAAKvE,GAAO,UAEzB,WAAaA,EAAM,KAG5B+E,OAAO5a,UAAUtG,QAAU,SAAkBwf,GAC3C,IAAK0B,OAAOkV,SAAS5W,GAAI,KAAM,IAAIgD,WAAU,4BAC7C,OAAIjlB,QAASiiB,EAAU,EAChB0B,OAAOlhB,QAAQzC,KAAMiiB,IAG9B0B,OAAO5a,UAAUvB,QAAU,SAAkB42B,EAAKC,GAyBhD,QAASC,GAAcd,EAAKY,EAAKC,GAE/B,IAAK,GADDE,GAAa,GACR10B,EAAI,EAAGw0B,EAAax0B,EAAI2zB,EAAIpzB,OAAQP,IAC3C,GAAI2zB,EAAIa,EAAax0B,KAAOu0B,EAAmB,KAAfG,EAAoB,EAAI10B,EAAI00B,IAE1D,GADmB,KAAfA,IAAmBA,EAAa10B,GAChCA,EAAI00B,EAAa,IAAMH,EAAIh0B,OAAQ,MAAOi0B,GAAaE,MAE3DA,GAAa,EAGjB,OAAO,GA9BT,GAJIF,EAAa,WAAYA,EAAa,WACpB,YAAbA,IAA0BA,EAAa,aAChDA,IAAe,EAEK,IAAhBr+B,KAAKoK,OAAc,MAAO,EAC9B,IAAIi0B,GAAcr+B,KAAKoK,OAAQ,MAAO,EAKtC,IAFiB,EAAbi0B,IAAgBA,EAAa7qB,KAAK2P,IAAInjB,KAAKoK,OAASi0B,EAAY,IAEjD,gBAARD,GACT,MAAmB,KAAfA,EAAIh0B,OAAqB,GACtB6wB,OAAOlyB,UAAUvB,QAAQyB,KAAKjJ,KAAMo+B,EAAKC,EAElD,IAAI1a,OAAOkV,SAASuF,GAClB,MAAOE,GAAat+B,KAAMo+B,EAAKC,EAEjC,IAAmB,gBAARD,GACT,MAAIza,QAAO4U,qBAAwD,aAAjCE,WAAW1vB,UAAUvB,QAC9CixB,WAAW1vB,UAAUvB,QAAQyB,KAAKjJ,KAAMo+B,EAAKC,GAE/CC,EAAat+B,MAAQo+B,GAAOC,EAgBrC,MAAM,IAAIpZ,WAAU,yCAItBtB,OAAO5a,UAAUoF,IAAM,SAAcmrB,GAEnC,MADAjuB,SAAQmzB,IAAI,6DACLx+B,KAAK84B,UAAUQ,IAIxB3V,OAAO5a,UAAU01B,IAAM,SAAcC,EAAGpF,GAEtC,MADAjuB,SAAQmzB,IAAI,6DACLx+B,KAAK2+B,WAAWD,EAAGpF,IAsD5B3V,OAAO5a,UAAUqnB,MAAQ,SAAgBiJ,EAAQC,EAAQlvB,EAAQ8tB,GAG/D,GAAI0G,SAAStF,GACNsF,SAASx0B,KACZ8tB,EAAW9tB,EACXA,EAASlJ,YAEN,CACL,GAAI29B,GAAO3G,CACXA,GAAWoB,EACXA,EAASlvB,EACTA,EAASy0B,EAKX,GAFAvF,EAASC,OAAOD,IAAW,EAEd,EAATlvB,GAAuB,EAATkvB,GAAcA,EAASt5B,KAAKoK,OAC5C,KAAM,IAAIkuB,YAAW,yCAGvB,IAAIkB,GAAYx5B,KAAKoK,OAASkvB,CACzBlvB,IAGHA,EAASmvB,OAAOnvB,GACZA,EAASovB,IACXpvB,EAASovB,IAJXpvB,EAASovB,EAOXtB,EAAW+C,OAAO/C,GAAY,QAAQxN,aAEtC,IAAI0Q,EACJ,QAAQlD,GACN,IAAK,MACHkD,EAAMhC,SAASp5B,KAAMq5B,EAAQC,EAAQlvB,EACrC,MACF,KAAK,OACL,IAAK,QACHgxB,EAAMvB,UAAU75B,KAAMq5B,EAAQC,EAAQlvB,EACtC,MACF,KAAK,QACHgxB,EAAMnB,WAAWj6B,KAAMq5B,EAAQC,EAAQlvB,EACvC,MACF,KAAK,SACHgxB,EAAMjB,YAAYn6B,KAAMq5B,EAAQC,EAAQlvB,EACxC,MACF,KAAK,SACHgxB,EAAMhB,YAAYp6B,KAAMq5B,EAAQC,EAAQlvB,EACxC,MACF,KAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACHgxB,EAAMd,aAAat6B,KAAMq5B,EAAQC,EAAQlvB,EACzC,MACF,SACE,KAAM,IAAI6a,WAAU,qBAAuBiT,GAE/C,MAAOkD,IAGTzX,OAAO5a,UAAU+1B,OAAS,WACxB,OACEnf,KAAM,SACN3G,KAAMlQ,MAAMC,UAAUC,MAAMC,KAAKjJ,KAAK++B,MAAQ/+B,KAAM,KAuExD2jB,OAAO5a,UAAUC,MAAQ,SAAgByxB,EAAOC,GAC9C,GAAIa,GAAMv7B,KAAKoK,MACfqwB,KAAUA,EACVC,EAAcx5B,SAARw5B,EAAoBa,IAAQb,EAEtB,EAARD,GACFA,GAASc,EACG,EAARd,IAAWA,EAAQ,IACdA,EAAQc,IACjBd,EAAQc,GAGA,EAANb,GACFA,GAAOa,EACG,EAANb,IAASA,EAAM,IACVA,EAAMa,IACfb,EAAMa,GAGEd,EAANC,IAAaA,EAAMD,EAEvB,IAAIuE,EACJ,IAAIrb,OAAO4U,oBACTyG,EAASrb,OAAO6U,SAASx4B,KAAK09B,SAASjD,EAAOC,QACzC,CACL,GAAIuE,GAAWvE,EAAMD,CACrBuE,GAAS,GAAIrb,QAAOsb,EAAU/9B,OAC9B,KAAK,GAAI2I,GAAI,EAAOo1B,EAAJp1B,EAAcA,IAC5Bm1B,EAAOn1B,GAAK7J,KAAK6J,EAAI4wB,GAMzB,MAFIuE,GAAO50B,SAAQ40B,EAAOhG,OAASh5B,KAAKg5B,QAAUh5B,MAE3Cg/B,GAWTrb,OAAO5a,UAAUm2B,WAAa,SAAqB5F,EAAQnB,EAAYiE,GACrE9C,KAAoB,EACpBnB,KAA4B,EACvBiE,GAAUR,YAAYtC,EAAQnB,EAAYn4B,KAAKoK,OAKpD,KAHA,GAAIg0B,GAAMp+B,KAAKs5B,GACX6F,EAAM,EACNt1B,EAAI,IACCA,EAAIsuB,IAAegH,GAAO,MACjCf,GAAOp+B,KAAKs5B,EAASzvB,GAAKs1B,CAG5B,OAAOf,IAGTza,OAAO5a,UAAUq2B,WAAa,SAAqB9F,EAAQnB,EAAYiE,GACrE9C,KAAoB,EACpBnB,KAA4B,EACvBiE,GACHR,YAAYtC,EAAQnB,EAAYn4B,KAAKoK,OAKvC,KAFA,GAAIg0B,GAAMp+B,KAAKs5B,IAAWnB,GACtBgH,EAAM,EACHhH,EAAa,IAAMgH,GAAO,MAC/Bf,GAAOp+B,KAAKs5B,IAAWnB,GAAcgH,CAGvC,OAAOf,IAGTza,OAAO5a,UAAU+vB,UAAY,SAAoBQ,EAAQ8C,GAEvD,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACpCpK,KAAKs5B,IAGd3V,OAAO5a,UAAUs2B,aAAe,SAAuB/F,EAAQ8C,GAE7D,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACpCpK,KAAKs5B,GAAWt5B,KAAKs5B,EAAS,IAAM,GAG7C3V,OAAO5a,UAAUu2B,aAAe,SAAuBhG,EAAQ8C,GAE7D,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACnCpK,KAAKs5B,IAAW,EAAKt5B,KAAKs5B,EAAS,IAG7C3V,OAAO5a,UAAUw2B,aAAe,SAAuBjG,EAAQ8C,GAG7D,MAFKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,SAElCpK,KAAKs5B,GACTt5B,KAAKs5B,EAAS,IAAM,EACpBt5B,KAAKs5B,EAAS,IAAM,IACD,SAAnBt5B,KAAKs5B,EAAS,IAGrB3V,OAAO5a,UAAUy2B,aAAe,SAAuBlG,EAAQ8C,GAG7D,MAFKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QAEpB,SAAfpK,KAAKs5B,IACTt5B,KAAKs5B,EAAS,IAAM,GACrBt5B,KAAKs5B,EAAS,IAAM,EACrBt5B,KAAKs5B,EAAS,KAGlB3V,OAAO5a,UAAU02B,UAAY,SAAoBnG,EAAQnB,EAAYiE,GACnE9C,KAAoB,EACpBnB,KAA4B,EACvBiE,GAAUR,YAAYtC,EAAQnB,EAAYn4B,KAAKoK,OAKpD,KAHA,GAAIg0B,GAAMp+B,KAAKs5B,GACX6F,EAAM,EACNt1B,EAAI,IACCA,EAAIsuB,IAAegH,GAAO,MACjCf,GAAOp+B,KAAKs5B,EAASzvB,GAAKs1B,CAM5B,OAJAA,IAAO,IAEHf,GAAOe,IAAKf,GAAO5qB,KAAKksB,IAAI,EAAG,EAAIvH,IAEhCiG,GAGTza,OAAO5a,UAAU42B,UAAY,SAAoBrG,EAAQnB,EAAYiE,GACnE9C,KAAoB,EACpBnB,KAA4B,EACvBiE,GAAUR,YAAYtC,EAAQnB,EAAYn4B,KAAKoK,OAKpD,KAHA,GAAIP,GAAIsuB,EACJgH,EAAM,EACNf,EAAMp+B,KAAKs5B,IAAWzvB,GACnBA,EAAI,IAAMs1B,GAAO,MACtBf,GAAOp+B,KAAKs5B,IAAWzvB,GAAKs1B,CAM9B,OAJAA,IAAO,IAEHf,GAAOe,IAAKf,GAAO5qB,KAAKksB,IAAI,EAAG,EAAIvH,IAEhCiG,GAGTza,OAAO5a,UAAU62B,SAAW,SAAmBtG,EAAQ8C,GAErD,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACtB,IAAfpK,KAAKs5B,GACyB,IAA3B,IAAOt5B,KAAKs5B,GAAU,GADKt5B,KAAKs5B,IAI3C3V,OAAO5a,UAAU82B,YAAc,SAAsBvG,EAAQ8C,GACtDA,GAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,OAC3C,IAAIg0B,GAAMp+B,KAAKs5B,GAAWt5B,KAAKs5B,EAAS,IAAM,CAC9C,OAAc,OAAN8E,EAAsB,WAANA,EAAmBA,GAG7Cza,OAAO5a,UAAU+2B,YAAc,SAAsBxG,EAAQ8C,GACtDA,GAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,OAC3C,IAAIg0B,GAAMp+B,KAAKs5B,EAAS,GAAMt5B,KAAKs5B,IAAW,CAC9C,OAAc,OAAN8E,EAAsB,WAANA,EAAmBA,GAG7Cza,OAAO5a,UAAUg3B,YAAc,SAAsBzG,EAAQ8C,GAG3D,MAFKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QAEnCpK,KAAKs5B,GACVt5B,KAAKs5B,EAAS,IAAM,EACpBt5B,KAAKs5B,EAAS,IAAM,GACpBt5B,KAAKs5B,EAAS,IAAM,IAGzB3V,OAAO5a,UAAUi3B,YAAc,SAAsB1G,EAAQ8C,GAG3D,MAFKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QAEnCpK,KAAKs5B,IAAW,GACrBt5B,KAAKs5B,EAAS,IAAM,GACpBt5B,KAAKs5B,EAAS,IAAM,EACpBt5B,KAAKs5B,EAAS,IAGnB3V,OAAO5a,UAAUk3B,YAAc,SAAsB3G,EAAQ8C,GAE3D,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACpCiyB,QAAQ6D,KAAKlgC,KAAMs5B,GAAQ,EAAM,GAAI,IAG9C3V,OAAO5a,UAAUo3B,YAAc,SAAsB7G,EAAQ8C,GAE3D,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACpCiyB,QAAQ6D,KAAKlgC,KAAMs5B,GAAQ,EAAO,GAAI,IAG/C3V,OAAO5a,UAAUq3B,aAAe,SAAuB9G,EAAQ8C,GAE7D,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACpCiyB,QAAQ6D,KAAKlgC,KAAMs5B,GAAQ,EAAM,GAAI,IAG9C3V,OAAO5a,UAAUs3B,aAAe,SAAuB/G,EAAQ8C,GAE7D,MADKA,IAAUR,YAAYtC,EAAQ,EAAGt5B,KAAKoK,QACpCiyB,QAAQ6D,KAAKlgC,KAAMs5B,GAAQ,EAAO,GAAI,IAS/C3V,OAAO5a,UAAUu3B,YAAc,SAAsBr2B,EAAOqvB,EAAQnB,EAAYiE,GAC9EnyB,GAASA,EACTqvB,KAAoB,EACpBnB,KAA4B,EACvBiE,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQnB,EAAY3kB,KAAKksB,IAAI,EAAG,EAAIvH,GAAa,EAEtF,IAAIgH,GAAM,EACNt1B,EAAI,CAER,KADA7J,KAAKs5B,GAAkB,IAARrvB,IACNJ,EAAIsuB,IAAegH,GAAO,MACjCn/B,KAAKs5B,EAASzvB,GAAMI,EAAQk1B,IAAS,EAAI,GAG3C,OAAO7F,GAASnB,GAGlBxU,OAAO5a,UAAUw3B,YAAc,SAAsBt2B,EAAOqvB,EAAQnB,EAAYiE,GAC9EnyB,GAASA,EACTqvB,KAAoB,EACpBnB,KAA4B,EACvBiE,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQnB,EAAY3kB,KAAKksB,IAAI,EAAG,EAAIvH,GAAa,EAEtF,IAAItuB,GAAIsuB,EAAa,EACjBgH,EAAM,CAEV,KADAn/B,KAAKs5B,EAASzvB,GAAa,IAARI,IACVJ,GAAK,IAAMs1B,GAAO,MACzBn/B,KAAKs5B,EAASzvB,GAAMI,EAAQk1B,IAAS,EAAI,GAG3C,OAAO7F,GAASnB,GAGlBxU,OAAO5a,UAAU41B,WAAa,SAAqB10B,EAAOqvB,EAAQ8C,GAMhE,MALAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,IAAM,GACjD3V,OAAO4U,sBAAqBtuB,EAAQuJ,KAAKC,MAAMxJ,IACpDjK,KAAKs5B,GAAUrvB,EACRqvB,EAAS,GAWlB3V,OAAO5a,UAAUy3B,cAAgB,SAAwBv2B,EAAOqvB,EAAQ8C,GAUtE,MATAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,MAAQ,GACpD3V,OAAO4U,qBACTv4B,KAAKs5B,GAAUrvB,EACfjK,KAAKs5B,EAAS,GAAMrvB,IAAU,GAE9B8xB,kBAAkB/7B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAGlB3V,OAAO5a,UAAU03B,cAAgB,SAAwBx2B,EAAOqvB,EAAQ8C,GAUtE,MATAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,MAAQ,GACpD3V,OAAO4U,qBACTv4B,KAAKs5B,GAAWrvB,IAAU,EAC1BjK,KAAKs5B,EAAS,GAAKrvB,GAEnB8xB,kBAAkB/7B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAUlB3V,OAAO5a,UAAU23B,cAAgB,SAAwBz2B,EAAOqvB,EAAQ8C,GAYtE,MAXAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,WAAY,GACxD3V,OAAO4U,qBACTv4B,KAAKs5B,EAAS,GAAMrvB,IAAU,GAC9BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,GAC9BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,EAC9BjK,KAAKs5B,GAAUrvB,GAEfgyB,kBAAkBj8B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAGlB3V,OAAO5a,UAAU43B,cAAgB,SAAwB12B,EAAOqvB,EAAQ8C,GAYtE,MAXAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,WAAY,GACxD3V,OAAO4U,qBACTv4B,KAAKs5B,GAAWrvB,IAAU,GAC1BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,GAC9BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,EAC9BjK,KAAKs5B,EAAS,GAAKrvB,GAEnBgyB,kBAAkBj8B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAGlB3V,OAAO5a,UAAU63B,WAAa,SAAqB32B,EAAOqvB,EAAQnB,EAAYiE,GAC5EnyB,GAASA,EACTqvB,KAAoB,EACf8C,GACHN,SACE97B,KAAMiK,EAAOqvB,EAAQnB,EACrB3kB,KAAKksB,IAAI,EAAG,EAAIvH,EAAa,GAAK,GACjC3kB,KAAKksB,IAAI,EAAG,EAAIvH,EAAa,GAIlC,IAAItuB,GAAI,EACJs1B,EAAM,EACN0B,EAAc,EAAR52B,EAAY,EAAI,CAE1B,KADAjK,KAAKs5B,GAAkB,IAARrvB,IACNJ,EAAIsuB,IAAegH,GAAO,MACjCn/B,KAAKs5B,EAASzvB,IAAOI,EAAQk1B,GAAQ,GAAK0B,EAAM,GAGlD,OAAOvH,GAASnB,GAGlBxU,OAAO5a,UAAU+3B,WAAa,SAAqB72B,EAAOqvB,EAAQnB,EAAYiE,GAC5EnyB,GAASA,EACTqvB,KAAoB,EACf8C,GACHN,SACE97B,KAAMiK,EAAOqvB,EAAQnB,EACrB3kB,KAAKksB,IAAI,EAAG,EAAIvH,EAAa,GAAK,GACjC3kB,KAAKksB,IAAI,EAAG,EAAIvH,EAAa,GAIlC,IAAItuB,GAAIsuB,EAAa,EACjBgH,EAAM,EACN0B,EAAc,EAAR52B,EAAY,EAAI,CAE1B,KADAjK,KAAKs5B,EAASzvB,GAAa,IAARI,IACVJ,GAAK,IAAMs1B,GAAO,MACzBn/B,KAAKs5B,EAASzvB,IAAOI,EAAQk1B,GAAQ,GAAK0B,EAAM,GAGlD,OAAOvH,GAASnB,GAGlBxU,OAAO5a,UAAUg4B,UAAY,SAAoB92B,EAAOqvB,EAAQ8C,GAO9D,MANAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,IAAM,MACjD3V,OAAO4U,sBAAqBtuB,EAAQuJ,KAAKC,MAAMxJ,IACxC,EAARA,IAAWA,EAAQ,IAAOA,EAAQ,GACtCjK,KAAKs5B,GAAUrvB,EACRqvB,EAAS,GAGlB3V,OAAO5a,UAAUi4B,aAAe,SAAuB/2B,EAAOqvB,EAAQ8C,GAUpE,MATAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,MAAQ,QACpD3V,OAAO4U,qBACTv4B,KAAKs5B,GAAUrvB,EACfjK,KAAKs5B,EAAS,GAAMrvB,IAAU,GAE9B8xB,kBAAkB/7B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAGlB3V,OAAO5a,UAAUk4B,aAAe,SAAuBh3B,EAAOqvB,EAAQ8C,GAUpE,MATAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,MAAQ,QACpD3V,OAAO4U,qBACTv4B,KAAKs5B,GAAWrvB,IAAU,EAC1BjK,KAAKs5B,EAAS,GAAKrvB,GAEnB8xB,kBAAkB/7B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAGlB3V,OAAO5a,UAAUm4B,aAAe,SAAuBj3B,EAAOqvB,EAAQ8C,GAYpE,MAXAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,WAAY,aACxD3V,OAAO4U,qBACTv4B,KAAKs5B,GAAUrvB,EACfjK,KAAKs5B,EAAS,GAAMrvB,IAAU,EAC9BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,GAC9BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,IAE9BgyB,kBAAkBj8B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAGlB3V,OAAO5a,UAAUo4B,aAAe,SAAuBl3B,EAAOqvB,EAAQ8C,GAapE,MAZAnyB,IAASA,EACTqvB,KAAoB,EACf8C,GAAUN,SAAS97B,KAAMiK,EAAOqvB,EAAQ,EAAG,WAAY,aAChD,EAARrvB,IAAWA,EAAQ,WAAaA,EAAQ,GACxC0Z,OAAO4U,qBACTv4B,KAAKs5B,GAAWrvB,IAAU,GAC1BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,GAC9BjK,KAAKs5B,EAAS,GAAMrvB,IAAU,EAC9BjK,KAAKs5B,EAAS,GAAKrvB,GAEnBgyB,kBAAkBj8B,KAAMiK,EAAOqvB,GAAQ,GAElCA,EAAS,GAiBlB3V,OAAO5a,UAAUq4B,aAAe,SAAuBn3B,EAAOqvB,EAAQ8C,GACpE,MAAOD,YAAWn8B,KAAMiK,EAAOqvB,GAAQ,EAAM8C,IAG/CzY,OAAO5a,UAAUs4B,aAAe,SAAuBp3B,EAAOqvB,EAAQ8C,GACpE,MAAOD,YAAWn8B,KAAMiK,EAAOqvB,GAAQ,EAAO8C,IAWhDzY,OAAO5a,UAAUu4B,cAAgB,SAAwBr3B,EAAOqvB,EAAQ8C,GACtE,MAAOE,aAAYt8B,KAAMiK,EAAOqvB,GAAQ,EAAM8C,IAGhDzY,OAAO5a,UAAUw4B,cAAgB,SAAwBt3B,EAAOqvB,EAAQ8C,GACtE,MAAOE,aAAYt8B,KAAMiK,EAAOqvB,GAAQ,EAAO8C,IAIjDzY,OAAO5a,UAAUi1B,KAAO,SAAex1B,EAAQg5B,EAAc/G,EAAOC,GAQlE,GAPKD,IAAOA,EAAQ,GACfC,GAAe,IAARA,IAAWA,EAAM16B,KAAKoK,QAC9Bo3B,GAAgBh5B,EAAO4B,SAAQo3B,EAAeh5B,EAAO4B,QACpDo3B,IAAcA,EAAe,GAC9B9G,EAAM,GAAWD,EAANC,IAAaA,EAAMD,GAG9BC,IAAQD,EAAO,MAAO,EAC1B,IAAsB,IAAlBjyB,EAAO4B,QAAgC,IAAhBpK,KAAKoK,OAAc,MAAO,EAGrD,IAAmB,EAAfo3B,EACF,KAAM,IAAIlJ,YAAW,4BAEvB,IAAY,EAARmC,GAAaA,GAASz6B,KAAKoK,OAAQ,KAAM,IAAIkuB,YAAW,4BAC5D,IAAU,EAANoC,EAAS,KAAM,IAAIpC,YAAW,0BAG9BoC,GAAM16B,KAAKoK,SAAQswB,EAAM16B,KAAKoK,QAC9B5B,EAAO4B,OAASo3B,EAAe9G,EAAMD,IACvCC,EAAMlyB,EAAO4B,OAASo3B,EAAe/G,EAGvC,IAAIc,GAAMb,EAAMD,CAEhB,IAAU,IAANc,IAAe5X,OAAO4U,oBACxB,IAAK,GAAI1uB,GAAI,EAAO0xB,EAAJ1xB,EAASA,IACvBrB,EAAOqB,EAAI23B,GAAgBxhC,KAAK6J,EAAI4wB,OAGtCjyB,GAAOmwB,KAAK34B,KAAK09B,SAASjD,EAAOA,EAAQc,GAAMiG,EAGjD,OAAOjG,IAIT5X,OAAO5a,UAAU04B,KAAO,SAAex3B,EAAOwwB,EAAOC,GAKnD,GAJKzwB,IAAOA,EAAQ,GACfwwB,IAAOA,EAAQ,GACfC,IAAKA,EAAM16B,KAAKoK,QAEXqwB,EAANC,EAAa,KAAM,IAAIpC,YAAW,cAGtC,IAAIoC,IAAQD,GACQ,IAAhBz6B,KAAKoK,OAAT,CAEA,GAAY,EAARqwB,GAAaA,GAASz6B,KAAKoK,OAAQ,KAAM,IAAIkuB,YAAW,sBAC5D,IAAU,EAANoC,GAAWA,EAAM16B,KAAKoK,OAAQ,KAAM,IAAIkuB,YAAW,oBAEvD,IAAIzuB,EACJ,IAAqB,gBAAVI,GACT,IAAKJ,EAAI4wB,EAAWC,EAAJ7wB,EAASA,IACvB7J,KAAK6J,GAAKI,MAEP,CACL,GAAI0xB,GAAQ3B,YAAY/vB,EAAMiF,YAC1BqsB,EAAMI,EAAMvxB,MAChB,KAAKP,EAAI4wB,EAAWC,EAAJ7wB,EAASA,IACvB7J,KAAK6J,GAAK8xB,EAAM9xB,EAAI0xB,GAIxB,MAAOv7B,QAOT2jB,OAAO5a,UAAU24B,cAAgB,WAC/B,GAA0B,mBAAfjJ,YAA4B,CACrC,GAAI9U,OAAO4U,oBACT,MAAO,IAAK5U,QAAO3jB,MAAO2hC,MAG1B,KAAK,GADDxI,GAAM,GAAIV,YAAWz4B,KAAKoK,QACrBP,EAAI,EAAG0xB,EAAMpC,EAAI/uB,OAAYmxB,EAAJ1xB,EAASA,GAAK,EAC9CsvB,EAAItvB,GAAK7J,KAAK6J,EAEhB,OAAOsvB,GAAIwI,OAGb,KAAM,IAAI1c,WAAU,sDAOxB,IAAI2c,IAAKje,OAAO5a,SAKhB4a,QAAO6U,SAAW,SAAmBgF,GA4DnC,MA3DAA,GAAIqE,YAAcle,OAClB6Z,EAAI9E,WAAY,EAGhB8E,EAAI7E,KAAO6E,EAAIiB,IAGfjB,EAAIrvB,IAAMyzB,GAAGzzB,IACbqvB,EAAIiB,IAAMmD,GAAGnD,IAEbjB,EAAIpN,MAAQwR,GAAGxR,MACfoN,EAAItuB,SAAW0yB,GAAG1yB,SAClBsuB,EAAIsE,eAAiBF,GAAG1yB,SACxBsuB,EAAIsB,OAAS8C,GAAG9C,OAChBtB,EAAIU,OAAS0D,GAAG1D,OAChBV,EAAI/6B,QAAUm/B,GAAGn/B,QACjB+6B,EAAIh2B,QAAUo6B,GAAGp6B,QACjBg2B,EAAIQ,KAAO4D,GAAG5D,KACdR,EAAIx0B,MAAQ44B,GAAG54B,MACfw0B,EAAI0B,WAAa0C,GAAG1C,WACpB1B,EAAI4B,WAAawC,GAAGxC,WACpB5B,EAAI1E,UAAY8I,GAAG9I,UACnB0E,EAAI6B,aAAeuC,GAAGvC,aACtB7B,EAAI8B,aAAesC,GAAGtC,aACtB9B,EAAI+B,aAAeqC,GAAGrC,aACtB/B,EAAIgC,aAAeoC,GAAGpC,aACtBhC,EAAIiC,UAAYmC,GAAGnC,UACnBjC,EAAImC,UAAYiC,GAAGjC,UACnBnC,EAAIoC,SAAWgC,GAAGhC,SAClBpC,EAAIqC,YAAc+B,GAAG/B,YACrBrC,EAAIsC,YAAc8B,GAAG9B,YACrBtC,EAAIuC,YAAc6B,GAAG7B,YACrBvC,EAAIwC,YAAc4B,GAAG5B,YACrBxC,EAAIyC,YAAc2B,GAAG3B,YACrBzC,EAAI2C,YAAcyB,GAAGzB,YACrB3C,EAAI4C,aAAewB,GAAGxB,aACtB5C,EAAI6C,aAAeuB,GAAGvB,aACtB7C,EAAImB,WAAaiD,GAAGjD,WACpBnB,EAAI8C,YAAcsB,GAAGtB,YACrB9C,EAAI+C,YAAcqB,GAAGrB,YACrB/C,EAAIgD,cAAgBoB,GAAGpB,cACvBhD,EAAIiD,cAAgBmB,GAAGnB,cACvBjD,EAAIkD,cAAgBkB,GAAGlB,cACvBlD,EAAImD,cAAgBiB,GAAGjB,cACvBnD,EAAIoD,WAAagB,GAAGhB,WACpBpD,EAAIsD,WAAac,GAAGd,WACpBtD,EAAIuD,UAAYa,GAAGb,UACnBvD,EAAIwD,aAAeY,GAAGZ,aACtBxD,EAAIyD,aAAeW,GAAGX,aACtBzD,EAAI0D,aAAeU,GAAGV,aACtB1D,EAAI2D,aAAeS,GAAGT,aACtB3D,EAAI4D,aAAeQ,GAAGR,aACtB5D,EAAI6D,aAAeO,GAAGP,aACtB7D,EAAI8D,cAAgBM,GAAGN,cACvB9D,EAAI+D,cAAgBK,GAAGL,cACvB/D,EAAIiE,KAAOG,GAAGH,KACdjE,EAAIW,QAAUyD,GAAGzD,QACjBX,EAAIkE,cAAgBE,GAAGF,cAEhBlE,EAGT,IAAIf,mBAAoB;;AOxpCxB,GAAI2Q,QAAS,oEAEX,SAAU1tC,GACX,YAcA,SAASmoC,GAAQwF,GAChB,GAAIC,GAAOD,EAAIrQ,WAAW,EAC1B,OAAIsQ,KAASC,GACTD,IAASE,EACL,GACJF,IAASG,GACTH,IAASI,EACL,GACGC,EAAPL,EACI,GACGK,EAAS,GAAhBL,EACIA,EAAOK,EAAS,GAAK,GAClBC,EAAQ,GAAfN,EACIA,EAAOM,EACJC,EAAQ,GAAfP,EACIA,EAAOO,EAAQ,GADvB,OAID,QAASC,GAAgBC,GAuBxB,QAAS5sC,GAAMu9B,GACdlB,EAAIwQ,KAAOtP,EAvBZ,GAAI70B,GAAGqZ,EAAG4iB,EAAGl2B,EAAKq+B,EAAczQ,CAEhC,IAAIuQ,EAAI3jC,OAAS,EAAI,EACpB,KAAM,IAAIgW,OAAM,iDAQjB,IAAImb,GAAMwS,EAAI3jC,MACd6jC,GAAe,MAAQF,EAAIhH,OAAOxL,EAAM,GAAK,EAAI,MAAQwS,EAAIhH,OAAOxL,EAAM,GAAK,EAAI,EAGnFiC,EAAM,GAAI0Q,GAAiB,EAAbH,EAAI3jC,OAAa,EAAI6jC,GAGnCnI,EAAImI,EAAe,EAAIF,EAAI3jC,OAAS,EAAI2jC,EAAI3jC,MAE5C,IAAI4jC,GAAI,CAMR,KAAKnkC,EAAI,EAAGqZ,EAAI,EAAO4iB,EAAJj8B,EAAOA,GAAK,EAAGqZ,GAAK,EACtCtT,EAAOi4B,EAAOkG,EAAIhH,OAAOl9B,KAAO,GAAOg+B,EAAOkG,EAAIhH,OAAOl9B,EAAI,KAAO,GAAOg+B,EAAOkG,EAAIhH,OAAOl9B,EAAI,KAAO,EAAKg+B,EAAOkG,EAAIhH,OAAOl9B,EAAI,IACnI1I,GAAY,SAANyO,IAAmB,IACzBzO,GAAY,MAANyO,IAAiB,GACvBzO,EAAW,IAANyO,EAYN,OATqB,KAAjBq+B,GACHr+B,EAAOi4B,EAAOkG,EAAIhH,OAAOl9B,KAAO,EAAMg+B,EAAOkG,EAAIhH,OAAOl9B,EAAI,KAAO,EACnE1I,EAAW,IAANyO,IACsB,IAAjBq+B,IACVr+B,EAAOi4B,EAAOkG,EAAIhH,OAAOl9B,KAAO,GAAOg+B,EAAOkG,EAAIhH,OAAOl9B,EAAI,KAAO,EAAMg+B,EAAOkG,EAAIhH,OAAOl9B,EAAI,KAAO,EACvG1I,EAAMyO,GAAO,EAAK,KAClBzO,EAAW,IAANyO,IAGC4tB,EAGR,QAAS2Q,GAAeC,GAMvB,QAAS5H,GAAQ6H,GAChB,MAAOjB,QAAOrG,OAAOsH,GAGtB,QAASC,GAAiBD,GACzB,MAAO7H,GAAO6H,GAAO,GAAK,IAAQ7H,EAAO6H,GAAO,GAAK,IAAQ7H,EAAO6H,GAAO,EAAI,IAAQ7H,EAAa,GAAN6H,GAV/F,GAAIxkC,GAGH0kC,EAAMnkC,EAFNokC,EAAaJ,EAAMhkC,OAAS,EAC5Bg+B,EAAS,EAYV,KAAKv+B,EAAI,EAAGO,EAASgkC,EAAMhkC,OAASokC,EAAgBpkC,EAAJP,EAAYA,GAAK,EAChE0kC,GAAQH,EAAMvkC,IAAM,KAAOukC,EAAMvkC,EAAI,IAAM,GAAMukC,EAAMvkC,EAAI,GAC3Du+B,GAAUkG,EAAgBC,EAI3B,QAAQC,GACP,IAAK,GACJD,EAAOH,EAAMA,EAAMhkC,OAAS,GAC5Bg+B,GAAU5B,EAAO+H,GAAQ,GACzBnG,GAAU5B,EAAQ+H,GAAQ,EAAK,IAC/BnG,GAAU,IACV,MACD,KAAK,GACJmG,GAAQH,EAAMA,EAAMhkC,OAAS,IAAM,GAAMgkC,EAAMA,EAAMhkC,OAAS,GAC9Dg+B,GAAU5B,EAAO+H,GAAQ,IACzBnG,GAAU5B,EAAQ+H,GAAQ,EAAK,IAC/BnG,GAAU5B,EAAQ+H,GAAQ,EAAK,IAC/BnG,GAAU,IAIZ,MAAOA,GAjHP,GAAI8F,GAA6B,mBAAfzV,YACdA,WACA3vB,MAEDykC,EAAS,IAAIvQ,WAAW,GACxByQ,EAAS,IAAIzQ,WAAW,GACxB2Q,EAAS,IAAI3Q,WAAW,GACxB6Q,EAAS,IAAI7Q,WAAW,GACxB4Q,EAAS,IAAI5Q,WAAW,GACxBwQ,EAAgB,IAAIxQ,WAAW,GAC/B0Q,EAAiB,IAAI1Q,WAAW,EA0GpCt9B,GAAQ09B,YAAc0Q,EACtBpuC,EAAQk7B,cAAgBuT,GACJ,mBAAZzuC,SAA2BM,KAAKyuC,YAAiB/uC;;AF3H1DA,QAAQwgC,KAAO,SAASyB,EAAQrI,EAAQ+R,EAAMC,EAAMC,GAClD,GAAItjC,GAAGkiC,EACHqB,EAAgB,EAATD,EAAaD,EAAO,EAC3BG,GAAQ,GAAKD,GAAQ,EACrBE,EAAQD,GAAQ,EAChBE,EAAQ,GACR9hC,EAAIwhC,EAAQE,EAAS,EAAK,EAC1BxyB,EAAIsyB,EAAO,GAAK,EAChB1W,EAAIgN,EAAOrI,EAASzvB,EAOxB,KALAA,GAAKkP,EAEL9Q,EAAI0sB,GAAM,IAAOgX,GAAU,EAC3BhX,KAAQgX,EACRA,GAASH,EACFG,EAAQ,EAAG1jC,EAAQ,IAAJA,EAAU05B,EAAOrI,EAASzvB,GAAIA,GAAKkP,EAAG4yB,GAAS,GAKrE,IAHAxB,EAAIliC,GAAM,IAAO0jC,GAAU,EAC3B1jC,KAAQ0jC,EACRA,GAASL,EACFK,EAAQ,EAAGxB,EAAQ,IAAJA,EAAUxI,EAAOrI,EAASzvB,GAAIA,GAAKkP,EAAG4yB,GAAS,GAErE,GAAU,IAAN1jC,EACFA,EAAI,EAAIyjC,MACH,CAAA,GAAIzjC,IAAMwjC,EACf,MAAOtB,GAAIyB,EAAAA,GAAQjX,EAAI,GAAK,IAAKkI,EAAAA,EAEjCsN,IAAQ32B,KAAKksB,IAAI,EAAG4L,GACpBrjC,GAAQyjC,EAEV,OAAQ/W,EAAI,GAAK,GAAKwV,EAAI32B,KAAKksB,IAAI,EAAGz3B,EAAIqjC,IAG5C5rC,QAAQ0wB,MAAQ,SAASuR,EAAQ13B,EAAOqvB,EAAQ+R,EAAMC,EAAMC,GAC1D,GAAItjC,GAAGkiC,EAAGxnB,EACN6oB,EAAgB,EAATD,EAAaD,EAAO,EAC3BG,GAAQ,GAAKD,GAAQ,EACrBE,EAAQD,GAAQ,EAChBI,EAAe,KAATP,EAAc93B,KAAKksB,IAAI,EAAG,KAAOlsB,KAAKksB,IAAI,EAAG,KAAO,EAC1D71B,EAAIwhC,EAAO,EAAKE,EAAS,EACzBxyB,EAAIsyB,EAAO,EAAI,GACf1W,EAAY,EAAR1qB,GAAwB,IAAVA,GAA2B,EAAZ,EAAIA,EAAa,EAAI,CAmC1D,KAjCAA,EAAQuJ,KAAK+O,IAAItY,GAEb2vB,MAAM3vB,IAAUA,IAAU4yB,EAAAA,GAC5BsN,EAAIvQ,MAAM3vB,GAAS,EAAI,EACvBhC,EAAIwjC,IAEJxjC,EAAIuL,KAAKC,MAAMD,KAAKgrB,IAAIv0B,GAASuJ,KAAKs4B,KAClC7hC,GAAS0Y,EAAInP,KAAKksB,IAAI,GAAIz3B,IAAM,IAClCA,IACA0a,GAAK,GAGL1Y,GADEhC,EAAIyjC,GAAS,EACNG,EAAKlpB,EAELkpB,EAAKr4B,KAAKksB,IAAI,EAAG,EAAIgM,GAE5BzhC,EAAQ0Y,GAAK,IACf1a,IACA0a,GAAK,GAGH1a,EAAIyjC,GAASD,GACftB,EAAI,EACJliC,EAAIwjC,GACKxjC,EAAIyjC,GAAS,GACtBvB,GAAKlgC,EAAQ0Y,EAAI,GAAKnP,KAAKksB,IAAI,EAAG4L,GAClCrjC,GAAQyjC,IAERvB,EAAIlgC,EAAQuJ,KAAKksB,IAAI,EAAGgM,EAAQ,GAAKl4B,KAAKksB,IAAI,EAAG4L,GACjDrjC,EAAI,IAIDqjC,GAAQ,EAAG3J,EAAOrI,EAASzvB,GAAS,IAAJsgC,EAAUtgC,GAAKkP,EAAGoxB,GAAK,IAAKmB,GAAQ,GAI3E,IAFArjC,EAAKA,GAAKqjC,EAAQnB,EAClBqB,GAAQF,EACDE,EAAO,EAAG7J,EAAOrI,EAASzvB,GAAS,IAAJ5B,EAAU4B,GAAKkP,EAAG9Q,GAAK,IAAKujC,GAAQ,GAE1E7J,EAAOrI,EAASzvB,EAAIkP,IAAU,IAAJ4b;;AD7E5B,GAAIyD,SAAUtvB,MAAMsvB,QAMhBxZ,IAAMxV,OAAOL,UAAUmG,QAmB3BvP,QAAOD,QAAU04B,SAAW,SAAUgG,GACpC,QAAUA,GAAO,kBAAoBxf,IAAI3V,KAAKm1B;;;CD9B9C,SAASj/B,GA2DV,QAAS+L,GAAMyU,GACd,KAAM2Y,YAAW1zB,EAAO+a,IAWzB,QAASre,GAAIwmC,EAAOC,GAEnB,IADA,GAAI39B,GAAS09B,EAAM19B,OACZA,KACN09B,EAAM19B,GAAU29B,EAAGD,EAAM19B,GAE1B,OAAO09B,GAYR,QAASE,GAAU3O,EAAQ0O,GAC1B,MAAOzmC,GAAI+3B,EAAO3b,MAAMuqB,GAAkBF,GAAIp+B,KAAK,KAgBpD,QAASu+B,GAAW7O,GAMnB,IALA,GAGIpvB,GACAk+B,EAJAC,KACAC,EAAU,EACVj+B,EAASivB,EAAOjvB,OAGHA,EAAVi+B,GACNp+B,EAAQovB,EAAO2D,WAAWqL,KACtBp+B,GAAS,OAAmB,OAATA,GAA6BG,EAAVi+B,GAEzCF,EAAQ9O,EAAO2D,WAAWqL,KACF,QAAX,MAARF,GACJC,EAAOjnC,OAAe,KAAR8I,IAAkB,KAAe,KAARk+B,GAAiB,QAIxDC,EAAOjnC,KAAK8I,GACZo+B,MAGDD,EAAOjnC,KAAK8I,EAGd,OAAOm+B,GAWR,QAASE,GAAWR,GACnB,MAAOxmC,GAAIwmC,EAAO,SAAS79B,GAC1B,GAAIm+B,GAAS,EAOb,OANIn+B,GAAQ,QACXA,GAAS,MACTm+B,GAAUG,EAAmBt+B,IAAU,GAAK,KAAQ,OACpDA,EAAQ,MAAiB,KAARA,GAElBm+B,GAAUG,EAAmBt+B,KAE3BN,KAAK,IAYT,QAAS6+B,GAAa1L,GACrB,MAAqB,IAAjBA,EAAY,GACRA,EAAY,GAEC,GAAjBA,EAAY,GACRA,EAAY,GAEC,GAAjBA,EAAY,GACRA,EAAY,GAEb2L,EAcR,QAASC,GAAaC,EAAOC,GAG5B,MAAOD,GAAQ,GAAK,IAAc,GAARA,KAAwB,GAARC,IAAc,GAQzD,QAASC,GAAMC,EAAOC,EAAWC,GAChC,GAAI/C,GAAI,CAGR,KAFA6C,EAAQE,EAAYv1B,EAAMq1B,EAAQG,GAAQH,GAAS,EACnDA,GAASr1B,EAAMq1B,EAAQC,GACOD,EAAQI,EAAgBC,GAAQ,EAAGlD,GAAKwC,EACrEK,EAAQr1B,EAAMq1B,EAAQI,EAEvB,OAAOz1B,GAAMwyB,GAAKiD,EAAgB,GAAKJ,GAASA,EAAQM,IAUzD,QAASvB,GAAOxb,GAEf,GAEImP,GAIA6N,EACAnmB,EACAomB,EACAC,EACAC,EACAvD,EACA0C,EACAc,EAEAC,EAfAtB,KACAuB,EAActd,EAAMjiB,OAEpBP,EAAI,EACJ8yB,EAAIiN,EACJC,EAAOC,CAqBX,KALAT,EAAQhd,EAAMqZ,YAAYn+B,GACd,EAAR8hC,IACHA,EAAQ,GAGJnmB,EAAI,EAAOmmB,EAAJnmB,IAAaA,EAEpBmJ,EAAM2Q,WAAW9Z,IAAM,KAC1BhY,EAAM,aAEPk9B,EAAOjnC,KAAKkrB,EAAM2Q,WAAW9Z,GAM9B,KAAKomB,EAAQD,EAAQ,EAAIA,EAAQ,EAAI,EAAWM,EAARL,GAAgD,CAOvF,IAAKC,EAAO1/B,EAAG2/B,EAAI,EAAGvD,EAAIwC,EAErBa,GAASK,GACZz+B,EAAM,iBAGPy9B,EAAQH,EAAanc,EAAM2Q,WAAWsM,OAElCX,GAASF,GAAQE,EAAQl1B,GAAOs2B,EAASlgC,GAAK2/B,KACjDt+B,EAAM,YAGPrB,GAAK8+B,EAAQa,EACbC,EAASI,GAAL5D,EAAY+D,EAAQ/D,GAAK4D,EAAOV,EAAOA,EAAOlD,EAAI4D,IAE1CJ,EAARd,GAf+C1C,GAAKwC,EAmBxDiB,EAAajB,EAAOgB,EAChBD,EAAI/1B,EAAMs2B,EAASL,IACtBx+B,EAAM,YAGPs+B,GAAKE,CAINlO,GAAM4M,EAAOh+B,OAAS,EACtBy/B,EAAOhB,EAAMh/B,EAAI0/B,EAAM/N,EAAa,GAAR+N,GAIxB91B,EAAM5J,EAAI2xB,GAAOuO,EAASpN,GAC7BzxB,EAAM,YAGPyxB,GAAKlpB,EAAM5J,EAAI2xB,GACf3xB,GAAK2xB,EAGL4M,EAAOT,OAAO99B,IAAK,EAAG8yB,GAIvB,MAAO2L,GAAWF,GAUnB,QAAS5B,GAAOna,GACf,GAAIsQ,GACAmM,EACAmB,EACAC,EACAL,EACA3mB,EACAinB,EACAzc,EACAuY,EACAwD,EACAW,EAGAT,EAEAU,EACAX,EACAY,EANAlC,IAoBJ,KAXA/b,EAAQ6b,EAAW7b,GAGnBsd,EAActd,EAAMjiB,OAGpBuyB,EAAIiN,EACJd,EAAQ,EACRe,EAAOC,EAGF5mB,EAAI,EAAOymB,EAAJzmB,IAAmBA,EAC9BknB,EAAe/d,EAAMnJ,GACF,IAAfknB,GACHhC,EAAOjnC,KAAKonC,EAAmB6B,GAejC,KAXAH,EAAiBC,EAAc9B,EAAOh+B,OAMlC8/B,GACH9B,EAAOjnC,KAAKoG,GAIWoiC,EAAjBM,GAA8B,CAIpC,IAAKE,EAAIJ,EAAQ7mB,EAAI,EAAOymB,EAAJzmB,IAAmBA,EAC1CknB,EAAe/d,EAAMnJ,GACjBknB,GAAgBzN,GAAoBwN,EAAfC,IACxBD,EAAIC,EAcN,KARAC,EAAwBJ,EAAiB,EACrCE,EAAIxN,EAAIlpB,GAAOs2B,EAASjB,GAASuB,IACpCn/B,EAAM,YAGP49B,IAAUqB,EAAIxN,GAAK0N,EACnB1N,EAAIwN,EAECjnB,EAAI,EAAOymB,EAAJzmB,IAAmBA,EAO9B,GANAknB,EAAe/d,EAAMnJ,GAEFyZ,EAAfyN,KAAsBtB,EAAQiB,GACjC7+B,EAAM,YAGHk/B,GAAgBzN,EAAG,CAEtB,IAAKjP,EAAIob,EAAO7C,EAAIwC,EACnBgB,EAASI,GAAL5D,EAAY+D,EAAQ/D,GAAK4D,EAAOV,EAAOA,EAAOlD,EAAI4D,IAC9CJ,EAAJ/b,GAFyCuY,GAAKwC,EAKlD6B,EAAU5c,EAAI+b,EACdC,EAAajB,EAAOgB,EACpBrB,EAAOjnC,KACNonC,EAAmBG,EAAae,EAAIa,EAAUZ,EAAY,KAE3Dhc,EAAIja,EAAM62B,EAAUZ,EAGrBtB,GAAOjnC,KAAKonC,EAAmBG,EAAahb,EAAG,KAC/Cmc,EAAOhB,EAAMC,EAAOuB,EAAuBJ,GAAkBC,GAC7DpB,EAAQ,IACNmB,IAIFnB,IACAnM,EAGH,MAAOyL,GAAOz+B,KAAK,IAapB,QAAS4gC,GAAUC,GAClB,MAAOxC,GAAUwC,EAAQ,SAASnR,GACjC,MAAOoR,GAAcvgB,KAAKmP,GACvBwO,EAAOxO,EAAOrwB,MAAM,GAAG0hB,eACvB2O,IAYL,QAASqR,GAAQF,GAChB,MAAOxC,GAAUwC,EAAQ,SAASnR,GACjC,MAAOsR,GAAczgB,KAAKmP,GACvB,OAASmN,EAAOnN,GAChBA,IAhcL,GAAIuR,GAAgC,gBAAXlrC,UAAuBA,QAC5CmrC,EAA8B,gBAAVlrC,SAAsBA,QAC7CA,OAAOD,SAAWkrC,GAAejrC,OAC9BmrC,EAA8B,gBAAVC,SAAsBA,QAC1CD,EAAWC,SAAWD,GAAcA,EAAW1kC,SAAW0kC,KAC7D3rC,EAAO2rC,EAQR,IAAIrH,GAiCJl6B,EA9BAwgC,EAAS,WAGTtB,EAAO,GACPuB,EAAO,EACPb,EAAO,GACPC,EAAO,GACPH,EAAO,IACPa,EAAc,GACdF,EAAW,IACXriC,EAAY,IAGZkjC,EAAgB,QAChBE,EAAgB,SAChB1C,EAAkB,6BAGlBrjC,GACCwf,SAAY,kDACZ4mB,YAAa,iDACbC,gBAAiB,iBAIlB/B,EAAgBT,EAAOuB,EACvBv2B,EAAQD,KAAKC,MACb80B,EAAqBtN,OAAOC,YAub5B,IA3BAuI,GAMCyH,QAAW,QAQXC,MACCtD,OAAUK,EACV1B,OAAU8B,GAEXT,OAAUA,EACVrB,OAAUA,EACVkE,QAAWA,EACXH,UAAaA,GAOI,kBAAVlrC,SACc,gBAAdA,QAAOC,KACdD,OAAOC,IAEPD,OAAO,WAAY,WAClB,MAAOokC,SAEF,IAAImH,IAAgBA,EAAYQ,SACtC,GAAIP,EACHA,EAAWnrC,QAAU+jC,MAErB,KAAKl6B,IAAOk6B,GACXA,EAAS15B,eAAeR,KAASqhC,EAAYrhC,GAAOk6B,EAASl6B,QAI/DpK,GAAKskC,SAAWA,GAGhBzjC;;;;AOreF,YAKA,SAAS+J,gBAAe4a,EAAK2rB,GAC3B,MAAOlnC,QAAOL,UAAUgB,eAAed,KAAK0b,EAAK2rB,GAGnD3wC,OAAOD,QAAU,SAAS6wC,EAAIL,EAAKC,EAAI3tB,GACrC0tB,EAAMA,GAAO,IACbC,EAAKA,GAAM,GACX,IAAIxrB,KAEJ,IAAkB,gBAAP4rB,IAAiC,IAAdA,EAAGnmC,OAC/B,MAAOua,EAGT,IAAI6rB,GAAS,KACbD,GAAKA,EAAG7yB,MAAMwyB,EAEd,IAAIO,GAAU,GACVjuB,IAAsC,gBAApBA,GAAQiuB,UAC5BA,EAAUjuB,EAAQiuB,QAGpB,IAAIlV,GAAMgV,EAAGnmC,MAETqmC,GAAU,GAAKlV,EAAMkV,IACvBlV,EAAMkV,EAGR,KAAK,GAAI5mC,GAAI,EAAO0xB,EAAJ1xB,IAAWA,EAAG,CAC5B,GAEI6mC,GAAMC,EAAM1K,EAAGvH,EAFf7I,EAAI0a,EAAG1mC,GAAGsF,QAAQqhC,EAAQ,OAC1B9lC,EAAMmrB,EAAEruB,QAAQ2oC,EAGhBzlC,IAAO,GACTgmC,EAAO7a,EAAE3Y,OAAO,EAAGxS,GACnBimC,EAAO9a,EAAE3Y,OAAOxS,EAAM,KAEtBgmC,EAAO7a,EACP8a,EAAO,IAGT1K,EAAIlpB,mBAAmB2zB,GACvBhS,EAAI3hB,mBAAmB4zB,GAElB5mC,eAAe4a,EAAKshB,GAEd7N,QAAQzT,EAAIshB,IACrBthB,EAAIshB,GAAG9kC,KAAKu9B,GAEZ/Z,EAAIshB,IAAMthB,EAAIshB,GAAIvH,GAJlB/Z,EAAIshB,GAAKvH,EAQb,MAAO/Z,GAGT,IAAIyT,SAAUtvB,MAAMsvB,SAAW,SAAU2X,GACvC,MAA8C,mBAAvC3mC,OAAOL,UAAUmG,SAASjG,KAAK8mC;;AD7DxC,YAgDA,SAASzuC,KAAKyuC,EAAIC,GAChB,GAAID,EAAGzuC,IAAK,MAAOyuC,GAAGzuC,IAAI0uC,EAE1B,KAAK,GADDlV,MACKjxB,EAAI,EAAGA,EAAIkmC,EAAG3lC,OAAQP,IAC7BixB,EAAI35B,KAAK6uC,EAAED,EAAGlmC,GAAIA,GAEpB,OAAOixB,GApDT,GAAImV,oBAAqB,SAASvR,GAChC,aAAeA,IACb,IAAK,SACH,MAAOA,EAET,KAAK,UACH,MAAOA,GAAI,OAAS,OAEtB,KAAK,SACH,MAAOE,UAASF,GAAKA,EAAI,EAE3B,SACE,MAAO,IAIb/+B,QAAOD,QAAU,SAASilB,EAAKurB,EAAKC,EAAIlwB,GAOtC,MANAiwB,GAAMA,GAAO,IACbC,EAAKA,GAAM,IACC,OAARxrB,IACFA,EAAMzjB,QAGW,gBAARyjB,GACFrjB,IAAI8uC,WAAWzrB,GAAM,SAASshB,GACnC,GAAIoK,GAAK/xB,mBAAmB2xB,mBAAmBhK,IAAMkK,CACrD,OAAI/X,SAAQzT,EAAIshB,IACP3kC,IAAIqjB,EAAIshB,GAAI,SAASvH,GAC1B,MAAO2R,GAAK/xB,mBAAmB2xB,mBAAmBvR,MACjD/0B,KAAKumC,GAEDG,EAAK/xB,mBAAmB2xB,mBAAmBtrB,EAAIshB,OAEvDt8B,KAAKumC,GAILjwB,EACE3B,mBAAmB2xB,mBAAmBhwB,IAASkwB,EAC/C7xB,mBAAmB2xB,mBAAmBtrB,IAF3B,GAKpB,IAAIyT,SAAUtvB,MAAMsvB,SAAW,SAAU2X,GACvC,MAA8C,mBAAvC3mC,OAAOL,UAAUmG,SAASjG,KAAK8mC,IAYpCK,WAAahnC,OAAOC,MAAQ,SAAUsb,GACxC,GAAImW,KACJ,KAAK,GAAIvxB,KAAOob,GACVvb,OAAOL,UAAUgB,eAAed,KAAK0b,EAAKpb,IAAMuxB,EAAI35B,KAAKoI,EAE/D,OAAOuxB;;APnFT,YAEAp7B,SAAQmoC,OAASnoC,QAAQ8uB,MAAQ5uB,QAAQ,YACzCF,QAAQ8mC,OAAS9mC,QAAQonC,UAAYlnC,QAAQ;;AD2B7C,QAASmiC,OACP/hC,KAAKgiC,SAAW,KAChBhiC,KAAKiiC,QAAU,KACfjiC,KAAKkiC,KAAO,KACZliC,KAAKmiC,KAAO,KACZniC,KAAKoiC,KAAO,KACZpiC,KAAKqiC,SAAW,KAChBriC,KAAKsiC,KAAO,KACZtiC,KAAKwd,OAAS,KACdxd,KAAKuiC,MAAQ,KACbviC,KAAKwiC,SAAW,KAChBxiC,KAAKyiC,KAAO,KACZziC,KAAKgd,KAAO,KAqDd,QAAS0lB,UAAS5hC,EAAK6hC,EAAkBC,GACvC,GAAI9hC,GAAOgmB,SAAShmB,IAAQA,YAAeihC,KAAK,MAAOjhC,EAEvD,IAAI+hC,GAAI,GAAId,IAEZ,OADAc,GAAErU,MAAM1tB,EAAK6hC,EAAkBC,GACxBC,EA6OT,QAASC,WAAUne,GAMjB,MADIoe,UAASpe,KAAMA,EAAM+d,SAAS/d,IAC5BA,YAAeod,KACdpd,EAAIqe,SADuBjB,IAAIh5B,UAAUi6B,OAAO/5B,KAAK0b,GA4D9D,QAASse,YAAWC,EAAQC,GAC1B,MAAOT,UAASQ,GAAQ,GAAO,GAAMj8B,QAAQk8B,GAO/C,QAASC,kBAAiBF,EAAQC,GAChC,MAAKD,GACER,SAASQ,GAAQ,GAAO,GAAMG,cAAcF,GAD/BA,EAyRtB,QAASJ,UAASO,GAChB,MAAsB,gBAARA,GAGhB,QAASxc,UAASwc,GAChB,MAAsB,gBAARA,IAA4B,OAARA,EAGpC,QAASC,QAAOD,GACd,MAAe,QAARA,EAET,QAASE,mBAAkBF,GACzB,MAAe,OAAPA,EA5qBV,GAAIG,UAAW7jC,QAAQ,WAEvBF,SAAQ8uB,MAAQkU,SAChBhjC,QAAQuH,QAAUg8B,WAClBvjC,QAAQ2jC,cAAgBD,iBACxB1jC,QAAQsjC,OAASF,UAEjBpjC,QAAQqiC,IAAMA,GAqBd,IAAI2B,iBAAkB,oBAClBC,YAAc,WAIdC,QAAU,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAG/CC,QAAU,IAAK,IAAK,IAAK,KAAM,IAAK,KAAKjc,OAAOgc,QAGhDE,YAAc,KAAMlc,OAAOic,QAK3BE,cAAgB,IAAK,IAAK,IAAK,IAAK,KAAKnc,OAAOkc,YAChDE,iBAAmB,IAAK,IAAK,KAC7BC,eAAiB,IACjBC,oBAAsB,wBACtBC,kBAAoB,8BAEpBC,gBACEC,YAAc,EACdC,eAAe,GAGjBC,kBACEF,YAAc,EACdC,eAAe,GAGjBE,iBACEC,MAAQ,EACRC,OAAS,EACTC,KAAO,EACPC,QAAU,EACVC,MAAQ,EACRC,SAAS,EACTC,UAAU,EACVC,QAAQ,EACRC,WAAW,EACXC,SAAS,GAEXC,YAAcvlC,QAAQ,cAU1BmiC,KAAIh5B,UAAUylB,MAAQ,SAAS1tB,EAAK6hC,EAAkBC,GACpD,IAAKG,SAASjiC,GACZ,KAAM,IAAImkB,WAAU,+CAAkDnkB,GAGxE,IAAIskC,GAAOtkC,CAIXskC,GAAOA,EAAK1I,MAEZ,IAAI2I,GAAQ3B,gBAAgBvV,KAAKiX,EACjC,IAAIC,EAAO,CACTA,EAAQA,EAAM,EACd,IAAIC,GAAaD,EAAM3a,aACvB1qB,MAAKgiC,SAAWsD,EAChBF,EAAOA,EAAKloB,OAAOmoB,EAAMj7B,QAO3B,GAAIw4B,GAAqByC,GAASD,EAAK9jB,MAAM,wBAAyB,CACpE,GAAI2gB,GAAgC,OAAtBmD,EAAKloB,OAAO,EAAG,IACzB+kB,GAAaoD,GAASd,iBAAiBc,KACzCD,EAAOA,EAAKloB,OAAO,GACnBld,KAAKiiC,SAAU,GAInB,IAAKsC,iBAAiBc,KACjBpD,GAAYoD,IAAUb,gBAAgBa,IAAU,CAmBnD,IAAK,GADDE,GAAU,GACL17B,EAAI,EAAGA,EAAIm6B,gBAAgB55B,OAAQP,IAAK,CAC/C,GAAI27B,GAAMJ,EAAK59B,QAAQw8B,gBAAgBn6B,GAC3B,MAAR27B,IAA2B,KAAZD,GAAwBA,EAANC,KACnCD,EAAUC,GAKd,GAAItD,GAAMuD,CAGRA,GAFc,KAAZF,EAEOH,EAAKM,YAAY,KAIjBN,EAAKM,YAAY,IAAKH,GAKlB,KAAXE,IACFvD,EAAOkD,EAAKp8B,MAAM,EAAGy8B,GACrBL,EAAOA,EAAKp8B,MAAMy8B,EAAS,GAC3BzlC,KAAKkiC,KAAOnlB,mBAAmBmlB,IAIjCqD,EAAU,EACV,KAAK,GAAI17B,GAAI,EAAGA,EAAIk6B,aAAa35B,OAAQP,IAAK,CAC5C,GAAI27B,GAAMJ,EAAK59B,QAAQu8B,aAAal6B,GACxB,MAAR27B,IAA2B,KAAZD,GAAwBA,EAANC,KACnCD,EAAUC,GAGE,KAAZD,IACFA,EAAUH,EAAKh7B,QAEjBpK,KAAKmiC,KAAOiD,EAAKp8B,MAAM,EAAGu8B,GAC1BH,EAAOA,EAAKp8B,MAAMu8B,GAGlBvlC,KAAK2lC,YAIL3lC,KAAKqiC,SAAWriC,KAAKqiC,UAAY,EAIjC,IAAIuD,GAAoC,MAArB5lC,KAAKqiC,SAAS,IACe,MAA5CriC,KAAKqiC,SAASriC,KAAKqiC,SAASj4B,OAAS,EAGzC,KAAKw7B,EAEH,IAAK,GADDC,GAAY7lC,KAAKqiC,SAAS3kB,MAAM,MAC3B7T,EAAI,EAAGi8B,EAAID,EAAUz7B,OAAY07B,EAAJj8B,EAAOA,IAAK,CAChD,GAAIk8B,GAAOF,EAAUh8B,EACrB,IAAKk8B,IACAA,EAAKzkB,MAAM4iB,qBAAsB,CAEpC,IAAK,GADD8B,GAAU,GACL9iB,EAAI,EAAG+iB,EAAIF,EAAK37B,OAAY67B,EAAJ/iB,EAAOA,IAKpC8iB,GAJED,EAAK/I,WAAW9Z,GAAK,IAIZ,IAEA6iB,EAAK7iB,EAIpB,KAAK8iB,EAAQ1kB,MAAM4iB,qBAAsB,CACvC,GAAIgC,GAAaL,EAAU78B,MAAM,EAAGa,GAChCs8B,EAAUN,EAAU78B,MAAMa,EAAI,GAC9Bu8B,EAAML,EAAKzkB,MAAM6iB,kBACjBiC,KACFF,EAAW/kC,KAAKilC,EAAI,IACpBD,EAAQE,QAAQD,EAAI,KAElBD,EAAQ/7B,SACVg7B,EAAO,IAAMe,EAAQx8B,KAAK,KAAOy7B,GAEnCplC,KAAKqiC,SAAW6D,EAAWv8B,KAAK,IAChC,SAaR,GAPI3J,KAAKqiC,SAASj4B,OAAS65B,eACzBjkC,KAAKqiC,SAAW,GAGhBriC,KAAKqiC,SAAWriC,KAAKqiC,SAAS3X,eAG3Bkb,EAAc,CAOjB,IAAK,GAFDU,GAActmC,KAAKqiC,SAAS3kB,MAAM,KAClC6oB,KACK18B,EAAI,EAAGA,EAAIy8B,EAAYl8B,SAAUP,EAAG,CAC3C,GAAI8qB,GAAI2R,EAAYz8B,EACpB08B,GAAOplC,KAAKwzB,EAAErT,MAAM,kBAChB,OAASmiB,SAAS+C,OAAO7R,GAAKA,GAEpC30B,KAAKqiC,SAAWkE,EAAO58B,KAAK,KAG9B,GAAIkpB,GAAI7yB,KAAKoiC,KAAO,IAAMpiC,KAAKoiC,KAAO,GAClCqE,EAAIzmC,KAAKqiC,UAAY,EACzBriC,MAAKmiC,KAAOsE,EAAI5T,EAChB7yB,KAAKgd,MAAQhd,KAAKmiC,KAIdyD,IACF5lC,KAAKqiC,SAAWriC,KAAKqiC,SAASnlB,OAAO,EAAGld,KAAKqiC,SAASj4B,OAAS,GAC/C,MAAZg7B,EAAK,KACPA,EAAO,IAAMA,IAOnB,IAAKhB,eAAekB,GAKlB,IAAK,GAAIz7B,GAAI,EAAGi8B,EAAIhC,WAAW15B,OAAY07B,EAAJj8B,EAAOA,IAAK,CACjD,GAAI68B,GAAK5C,WAAWj6B,GAChB88B,EAAMroB,mBAAmBooB,EACzBC,KAAQD,IACVC,EAAMC,OAAOF,IAEftB,EAAOA,EAAK1nB,MAAMgpB,GAAI/8B,KAAKg9B,GAM/B,GAAIrE,GAAO8C,EAAK59B,QAAQ,IACX,MAAT86B,IAEFtiC,KAAKsiC,KAAO8C,EAAKloB,OAAOolB,GACxB8C,EAAOA,EAAKp8B,MAAM,EAAGs5B,GAEvB,IAAIuE,GAAKzB,EAAK59B,QAAQ,IAoBtB,IAnBW,KAAPq/B,GACF7mC,KAAKwd,OAAS4nB,EAAKloB,OAAO2pB,GAC1B7mC,KAAKuiC,MAAQ6C,EAAKloB,OAAO2pB,EAAK,GAC1BlE,IACF3iC,KAAKuiC,MAAQ4C,YAAY3W,MAAMxuB,KAAKuiC,QAEtC6C,EAAOA,EAAKp8B,MAAM,EAAG69B,IACZlE,IAET3iC,KAAKwd,OAAS,GACdxd,KAAKuiC,UAEH6C,IAAMplC,KAAKwiC,SAAW4C,GACtBZ,gBAAgBc,IAChBtlC,KAAKqiC,WAAariC,KAAKwiC,WACzBxiC,KAAKwiC,SAAW,KAIdxiC,KAAKwiC,UAAYxiC,KAAKwd,OAAQ,CAChC,GAAIqV,GAAI7yB,KAAKwiC,UAAY,GACrB7N,EAAI30B,KAAKwd,QAAU,EACvBxd,MAAKyiC,KAAO5P,EAAI8B,EAKlB,MADA30B,MAAKgd,KAAOhd,KAAKgjC,SACVhjC,MAcT+hC,IAAIh5B,UAAUi6B,OAAS,WACrB,GAAId,GAAOliC,KAAKkiC,MAAQ,EACpBA,KACFA,EAAO5jB,mBAAmB4jB,GAC1BA,EAAOA,EAAK/yB,QAAQ,OAAQ,KAC5B+yB,GAAQ,IAGV,IAAIF,GAAWhiC,KAAKgiC,UAAY,GAC5BQ,EAAWxiC,KAAKwiC,UAAY,GAC5BF,EAAOtiC,KAAKsiC,MAAQ,GACpBH,GAAO,EACPI,EAAQ,EAERviC,MAAKmiC,KACPA,EAAOD,EAAOliC,KAAKmiC,KACVniC,KAAKqiC,WACdF,EAAOD,GAAuC,KAA/BliC,KAAKqiC,SAAS76B,QAAQ,KACjCxH,KAAKqiC,SACL,IAAMriC,KAAKqiC,SAAW,KACtBriC,KAAKoiC,OACPD,GAAQ,IAAMniC,KAAKoiC,OAInBpiC,KAAKuiC,OACLzb,SAAS9mB,KAAKuiC,QACdn5B,OAAOC,KAAKrJ,KAAKuiC,OAAOn4B,SAC1Bm4B,EAAQ4C,YAAY2B,UAAU9mC,KAAKuiC,OAGrC,IAAI/kB,GAASxd,KAAKwd,QAAW+kB,GAAU,IAAMA,GAAW,EAsBxD,OApBIP,IAAoC,MAAxBA,EAAS9kB,OAAO,MAAa8kB,GAAY,KAIrDhiC,KAAKiiC,WACHD,GAAYwC,gBAAgBxC,KAAcG,KAAS,GACvDA,EAAO,MAAQA,GAAQ,IACnBK,GAAmC,MAAvBA,EAASuE,OAAO,KAAYvE,EAAW,IAAMA,IACnDL,IACVA,EAAO,IAGLG,GAA2B,MAAnBA,EAAKyE,OAAO,KAAYzE,EAAO,IAAMA,GAC7C9kB,GAA+B,MAArBA,EAAOupB,OAAO,KAAYvpB,EAAS,IAAMA,GAEvDglB,EAAWA,EAASrzB,QAAQ,QAAS,SAASmS,GAC5C,MAAOhD,oBAAmBgD,KAE5B9D,EAASA,EAAOrO,QAAQ,IAAK,OAEtB6yB,EAAWG,EAAOK,EAAWhlB,EAAS8kB,GAO/CP,IAAIh5B,UAAU9B,QAAU,SAASk8B,GAC/B,MAAOnjC,MAAKqjC,cAAcX,SAASS,GAAU,GAAO,IAAOH,UAQ7DjB,IAAIh5B,UAAUs6B,cAAgB,SAASF,GACrC,GAAIJ,SAASI,GAAW,CACtB,GAAInjB,GAAM,GAAI+hB,IACd/hB,GAAIwO,MAAM2U,GAAU,GAAO,GAC3BA,EAAWnjB,EAGb,GAAI7b,GAAS,GAAI49B,IAUjB,IATA34B,OAAOC,KAAKrJ,MAAMsJ,QAAQ,SAAS28B,GACjC9hC,EAAO8hC,GAAKjmC,KAAKimC,IAChBjmC,MAIHmE,EAAOm+B,KAAOa,EAASb,KAGD,KAAlBa,EAASnmB,KAEX,MADA7Y,GAAO6Y,KAAO7Y,EAAO6+B,SACd7+B,CAIT,IAAIg/B,EAASlB,UAAYkB,EAASnB,SAchC,MAZA54B,QAAOC,KAAK85B,GAAU75B,QAAQ,SAAS28B,GAC3B,aAANA,IACF9hC,EAAO8hC,GAAK9C,EAAS8C,MAIrBzB,gBAAgBrgC,EAAO69B,WACvB79B,EAAOk+B,WAAal+B,EAAOq+B,WAC7Br+B,EAAOs+B,KAAOt+B,EAAOq+B,SAAW,KAGlCr+B,EAAO6Y,KAAO7Y,EAAO6+B,SACd7+B,CAGT,IAAIg/B,EAASnB,UAAYmB,EAASnB,WAAa79B,EAAO69B,SAAU,CAS9D,IAAKwC,gBAAgBrB,EAASnB,UAK5B,MAJA54B,QAAOC,KAAK85B,GAAU75B,QAAQ,SAAS28B,GACrC9hC,EAAO8hC,GAAK9C,EAAS8C,KAEvB9hC,EAAO6Y,KAAO7Y,EAAO6+B,SACd7+B,CAIT,IADAA,EAAO69B,SAAWmB,EAASnB,SACtBmB,EAAShB,MAASoC,iBAAiBpB,EAASnB,UAS/C79B,EAAOq+B,SAAWW,EAASX,aAT+B,CAE1D,IADA,GAAIwE,IAAW7D,EAASX,UAAY,IAAI9kB,MAAM,KACvCspB,EAAQ58B,UAAY+4B,EAAShB,KAAO6E,EAAQr4B,WAC9Cw0B,EAAShB,OAAMgB,EAAShB,KAAO,IAC/BgB,EAASd,WAAUc,EAASd,SAAW,IACzB,KAAf2E,EAAQ,IAAWA,EAAQX,QAAQ,IACnCW,EAAQ58B,OAAS,GAAG48B,EAAQX,QAAQ,IACxCliC,EAAOq+B,SAAWwE,EAAQr9B,KAAK,KAWjC,GAPAxF,EAAOqZ,OAAS2lB,EAAS3lB,OACzBrZ,EAAOo+B,MAAQY,EAASZ,MACxBp+B,EAAOg+B,KAAOgB,EAAShB,MAAQ,GAC/Bh+B,EAAO+9B,KAAOiB,EAASjB,KACvB/9B,EAAOk+B,SAAWc,EAASd,UAAYc,EAAShB,KAChDh+B,EAAOi+B,KAAOe,EAASf,KAEnBj+B,EAAOq+B,UAAYr+B,EAAOqZ,OAAQ,CACpC,GAAIqV,GAAI1uB,EAAOq+B,UAAY,GACvB7N,EAAIxwB,EAAOqZ,QAAU,EACzBrZ,GAAOs+B,KAAO5P,EAAI8B,EAIpB,MAFAxwB,GAAO89B,QAAU99B,EAAO89B,SAAWkB,EAASlB,QAC5C99B,EAAO6Y,KAAO7Y,EAAO6+B,SACd7+B,EAGT,GAAI8iC,GAAe9iC,EAAOq+B,UAA0C,MAA9Br+B,EAAOq+B,SAASuE,OAAO,GACzDG,EACI/D,EAAShB,MACTgB,EAASX,UAA4C,MAAhCW,EAASX,SAASuE,OAAO,GAElDI,EAAcD,GAAYD,GACX9iC,EAAOg+B,MAAQgB,EAASX,SACvC4E,EAAgBD,EAChBE,EAAUljC,EAAOq+B,UAAYr+B,EAAOq+B,SAAS9kB,MAAM,SACnDspB,EAAU7D,EAASX,UAAYW,EAASX,SAAS9kB,MAAM,SACvD4pB,EAAYnjC,EAAO69B,WAAawC,gBAAgBrgC,EAAO69B,SA2B3D,IApBIsF,IACFnjC,EAAOk+B,SAAW,GAClBl+B,EAAOi+B,KAAO,KACVj+B,EAAOg+B,OACU,KAAfkF,EAAQ,GAAWA,EAAQ,GAAKljC,EAAOg+B,KACtCkF,EAAQhB,QAAQliC,EAAOg+B,OAE9Bh+B,EAAOg+B,KAAO,GACVgB,EAASnB,WACXmB,EAASd,SAAW,KACpBc,EAASf,KAAO,KACZe,EAAShB,OACQ,KAAf6E,EAAQ,GAAWA,EAAQ,GAAK7D,EAAShB,KACxC6E,EAAQX,QAAQlD,EAAShB,OAEhCgB,EAAShB,KAAO,MAElBgF,EAAaA,IAA8B,KAAfH,EAAQ,IAA4B,KAAfK,EAAQ,KAGvDH,EAEF/iC,EAAOg+B,KAAQgB,EAAShB,MAA0B,KAAlBgB,EAAShB,KAC3BgB,EAAShB,KAAOh+B,EAAOg+B,KACrCh+B,EAAOk+B,SAAYc,EAASd,UAAkC,KAAtBc,EAASd,SAC/Bc,EAASd,SAAWl+B,EAAOk+B,SAC7Cl+B,EAAOqZ,OAAS2lB,EAAS3lB,OACzBrZ,EAAOo+B,MAAQY,EAASZ,MACxB8E,EAAUL,MAEL,IAAIA,EAAQ58B,OAGZi9B,IAASA,MACdA,EAAQnpB,MACRmpB,EAAUA,EAAQzf,OAAOof,GACzB7iC,EAAOqZ,OAAS2lB,EAAS3lB,OACzBrZ,EAAOo+B,MAAQY,EAASZ,UACnB,KAAKiB,kBAAkBL,EAAS3lB,QAAS,CAI9C,GAAI8pB,EAAW,CACbnjC,EAAOk+B,SAAWl+B,EAAOg+B,KAAOkF,EAAQ14B,OAIxC,IAAI44B,GAAapjC,EAAOg+B,MAAQh+B,EAAOg+B,KAAK36B,QAAQ,KAAO,EAC1CrD,EAAOg+B,KAAKzkB,MAAM,MAAO,CACtC6pB,KACFpjC,EAAO+9B,KAAOqF,EAAW54B,QACzBxK,EAAOg+B,KAAOh+B,EAAOk+B,SAAWkF,EAAW54B,SAW/C,MARAxK,GAAOqZ,OAAS2lB,EAAS3lB,OACzBrZ,EAAOo+B,MAAQY,EAASZ,MAEnBgB,OAAOp/B,EAAOq+B,WAAce,OAAOp/B,EAAOqZ,UAC7CrZ,EAAOs+B,MAAQt+B,EAAOq+B,SAAWr+B,EAAOq+B,SAAW,KACpCr+B,EAAOqZ,OAASrZ,EAAOqZ,OAAS,KAEjDrZ,EAAO6Y,KAAO7Y,EAAO6+B,SACd7+B,EAGT,IAAKkjC,EAAQj9B,OAWX,MARAjG,GAAOq+B,SAAW,KAEdr+B,EAAOqZ,OACTrZ,EAAOs+B,KAAO,IAAMt+B,EAAOqZ,OAE3BrZ,EAAOs+B,KAAO,KAEhBt+B,EAAO6Y,KAAO7Y,EAAO6+B,SACd7+B,CAcT,KAAK,GARDqjC,GAAOH,EAAQr+B,MAAM,IAAI,GACzBy+B,GACCtjC,EAAOg+B,MAAQgB,EAAShB,QAAmB,MAATqF,GAAyB,OAATA,IAC1C,KAATA,EAIAE,EAAK,EACA79B,EAAIw9B,EAAQj9B,OAAQP,GAAK,EAAGA,IACnC29B,EAAOH,EAAQx9B,GACH,KAAR29B,EACFH,EAAQM,OAAO99B,EAAG,GACA,OAAT29B,GACTH,EAAQM,OAAO99B,EAAG,GAClB69B,KACSA,IACTL,EAAQM,OAAO99B,EAAG,GAClB69B,IAKJ,KAAKP,IAAeC,EAClB,KAAOM,IAAMA,EACXL,EAAQhB,QAAQ,OAIhBc,GAA6B,KAAfE,EAAQ,IACpBA,EAAQ,IAA+B,MAAzBA,EAAQ,GAAGN,OAAO,IACpCM,EAAQhB,QAAQ,IAGdoB,GAAsD,MAAjCJ,EAAQ19B,KAAK,KAAKuT,OAAO,KAChDmqB,EAAQlmC,KAAK,GAGf,IAAIymC,GAA4B,KAAfP,EAAQ,IACpBA,EAAQ,IAA+B,MAAzBA,EAAQ,GAAGN,OAAO,EAGrC,IAAIO,EAAW,CACbnjC,EAAOk+B,SAAWl+B,EAAOg+B,KAAOyF,EAAa,GACbP,EAAQj9B,OAASi9B,EAAQ14B,QAAU,EAInE,IAAI44B,GAAapjC,EAAOg+B,MAAQh+B,EAAOg+B,KAAK36B,QAAQ,KAAO,EAC1CrD,EAAOg+B,KAAKzkB,MAAM,MAAO,CACtC6pB,KACFpjC,EAAO+9B,KAAOqF,EAAW54B,QACzBxK,EAAOg+B,KAAOh+B,EAAOk+B,SAAWkF,EAAW54B,SAyB/C,MArBAw4B,GAAaA,GAAehjC,EAAOg+B,MAAQkF,EAAQj9B,OAE/C+8B,IAAeS,GACjBP,EAAQhB,QAAQ,IAGbgB,EAAQj9B,OAIXjG,EAAOq+B,SAAW6E,EAAQ19B,KAAK,MAH/BxF,EAAOq+B,SAAW,KAClBr+B,EAAOs+B,KAAO,MAMXc,OAAOp/B,EAAOq+B,WAAce,OAAOp/B,EAAOqZ,UAC7CrZ,EAAOs+B,MAAQt+B,EAAOq+B,SAAWr+B,EAAOq+B,SAAW,KACpCr+B,EAAOqZ,OAASrZ,EAAOqZ,OAAS,KAEjDrZ,EAAO+9B,KAAOiB,EAASjB,MAAQ/9B,EAAO+9B,KACtC/9B,EAAO89B,QAAU99B,EAAO89B,SAAWkB,EAASlB,QAC5C99B,EAAO6Y,KAAO7Y,EAAO6+B,SACd7+B,GAGT49B,IAAIh5B,UAAU48B,UAAY,WACxB,GAAIxD,GAAOniC,KAAKmiC,KACZC,EAAOuB,YAAYxV,KAAKgU,EACxBC,KACFA,EAAOA,EAAK,GACC,MAATA,IACFpiC,KAAKoiC,KAAOA,EAAKllB,OAAO,IAE1BilB,EAAOA,EAAKjlB,OAAO,EAAGilB,EAAK/3B,OAASg4B,EAAKh4B,SAEvC+3B,IAAMniC,KAAKqiC,SAAWF;;AFlrB5B,YAEAxiC,QAAOD,QAAU,WACf,MAAO2G,UAASC,cAAc;;;CHGhC,SAAW2Z,EAAMC,GACf,GAAI/gB,GAAOa,IACX,IAAsB,mBAAXL,QAAwB,CACjC,IACE,GAAIwgB,GAASvgB,QAAQ,UACrB,MAAOqI,GACP,KAAM,IAAImY,OACRnY,EAAEoY,QAAU,2FAIhB1gB,OAAOD,QAAUwgB,EAAW/gB,EAAM8gB,EAAME,OACb,kBAAX9gB,SAA+C,gBAAfA,QAAOC,IACvDD,OAAO6gB,GAEP/gB,EAAK8gB,GAAQC,EAAW/gB,EAAM8gB,IAE/B,YAAa,SAAU9gB,EAAM8gB,EAAME,GAiBpC,QAASG,GAAW7b,EAAOC,GACzB,GACEyB,GAASga,EACP,GAAIA,GACJ9Z,SAASC,cAAc,SAG3B,OAFI7B,KAAO0B,EAAO1B,MAAQA,GACtBC,IAAQyB,EAAOzB,OAASA,GACrByB,EAET,QAASoa,GAAc9b,EAAOC,GAI5B,MAHAyB,GAAO1B,MAAQA,EACf0B,EAAOzB,OAASA,EAChB6B,EAAQia,UAAU,EAAG,EAAG/b,EAAOC,GACxB6B,EAAQka,gBAAgBhc,EAAOC,GAGxC,QAASgc,KACP,MAAOP,GAKT,QAASQ,GAAS/W,GAChB,MAAOgX,GAAOhX,EAAQiX,GAExB,QAASC,GAAUlX,GACjB,MAAOgX,GAAOhX,EAAQmX,GAExB,QAASC,GAAWpX,GAClB,MAAOgX,GAAOhX,EAAQqX,GAExB,QAASC,GAAatX,GACpB,SAAUA,IACRgX,EAAOhX,EAAQuX,UACRvX,GAAY,QAAMwX,SAClBxX,GAAa,SAAMwX,SACnBxX,GAAW,OAAMwX,GAE5B,QAASC,GAAazX,GACpB,MACE+W,GAAQ/W,IACRkX,EAASlX,IACToX,EAAUpX,IACVsX,EAAYtX,GAGhB,QAASgX,GAAQhX,EAAQ+V,GACvB,MAA2B,gBAAb,MAA2BvW,OAAOL,UAAUmG,SAASwP,MAAM9U,GAAQ0X,MAAM3B,GAKzF,QAAS4B,GAAe/I,GACtB,GAIEgJ,GAAcC,EAAS5X,EAHvBnF,EAAS8T,EAAU9T,OACnBD,EAAQ+T,EAAU/T,MAClBuU,EAAOR,EAAUQ,IAQnB,KALA7S,EAAO1B,MAAQA,EACf0B,EAAOzB,OAASA,EAChB8c,EAAejb,EAAQga,aAAa,EAAG,EAAG9b,EAAOC,GACjD+c,EAAUD,EAAaxI,KAElBnP,EAAI2O,EAAUQ,KAAK5O,OAAQP,KAC5B4X,EAAQ5X,GAAKmP,EAAKnP,EAGtB,OAAO2X,GAET,QAASE,GAAa9X,GACpB,MAAI+W,GAAQ/W,GAAkB+X,EAAqB/X,GAC/CkX,EAASlX,GAAkBgY,EAAsBhY,GACjDoX,EAAUpX,GAAkBiY,EAAuBjY,GACnDsX,EAAYtX,GAAkBA,EAAlC,OAEF,QAAS+X,GAAsBhgB,GAC7B,GACE+C,GAAS/C,EAAM+C,OACfD,EAAQ9C,EAAM8C,KAKhB,OAJA0B,GAAO1B,MAAQA,EACf0B,EAAOzB,OAASA,EAChB6B,EAAQia,UAAU,EAAG,EAAG/b,EAAOC,GAC/B6B,EAAQI,UAAUhF,EAAO,EAAG,GACrB4E,EAAQga,aAAa,EAAG,EAAG9b,EAAOC,GAE3C,QAASkd,GAAuBzb,GAC9B,GACEzB,GAASyB,EAAOzB,OAChBD,EAAQ0B,EAAO1B,MACf8B,EAAUJ,EAAOK,WAAW,KAC9B,OAAOD,GAAQga,aAAa,EAAG,EAAG9b,EAAOC,GAE3C,QAASmd,GAAwBtb,GAC/B,GACEJ,GAASI,EAAQJ,OACjBzB,EAASyB,EAAOzB,OAChBD,EAAQ0B,EAAO1B,KACjB,OAAO8B,GAAQga,aAAa,EAAG,EAAG9b,EAAOC,GAE3C,QAASod,GAAUlY,GACjB,GACEoP,GAAO0I,EAAY9X,GACnBzD,EAASma,EAAUtH,EAAKvU,MAAOuU,EAAKtU,QACpC6B,EAAUJ,EAAOK,WAAW,KAG9B,OADAD,GAAQkS,aAAaO,EAAM,EAAG,GACvB7S,EAKT,QAAS4b,GAAYC,EAAGC,GACtB,MAAOD,GAAEvd,QAAUwd,EAAExd,MAEvB,QAASyd,GAAaF,EAAGC,GACvB,MAAOD,GAAEtd,SAAWud,EAAEvd,OAExB,QAASyd,GAAiBH,EAAGC,GAC3B,MAAOC,GAAYF,EAAGC,IAAMF,EAAWC,EAAGC,GAE5C,QAASle,GAAOie,EAAGC,EAAGG,GAEpB,GAIEvY,GAHAwY,EAAYL,EAAEhJ,KACdsJ,EAAYL,EAAEjJ,KACd5O,EAAYiY,EAAMjY,MAKpB,IAFAgY,EAAYA,GAAa,GAEpBD,EAAgBH,EAAGC,GAAI,OAAO,CACnC,KAAKpY,EAAIO,EAAQP,KAAM,GAAIwY,EAAMxY,KAAOyY,EAAMzY,IAAM2J,KAAK+O,IAAIF,EAAMxY,GAAKyY,EAAMzY,IAAMuY,EAAW,OAAO,CAEtG,QAAO,EAKT,QAAS5e,GAAMwe,EAAGC,EAAGO,GACnB,OAAQL,EAAgBH,EAAGC,GAAKQ,EAAYC,GAAaV,EAAGC,EAAGO,GAEjE,QAASC,GAAWT,EAAGC,EAAGO,GAExB,GASE3Y,GARAnF,EAAUsd,EAAEtd,OACZD,EAAUud,EAAEvd,MACZke,EAAUpC,EAAa9b,EAAOC,GAC9B2d,EAAUL,EAAEhJ,KACZsJ,EAAUL,EAAEjJ,KACZ4J,EAAUD,EAAE3J,KACZ5O,EAAUwY,EAAMxY,MAIlB,KAAKP,EAAI,EAAOO,EAAJP,EAAYA,GAAK,EAC3B+Y,EAAM/Y,GAAK2J,KAAK+O,IAAIF,EAAMxY,GAAKyY,EAAMzY,IACrC+Y,EAAM/Y,EAAE,GAAK2J,KAAK+O,IAAIF,EAAMxY,EAAE,GAAKyY,EAAMzY,EAAE,IAC3C+Y,EAAM/Y,EAAE,GAAK2J,KAAK+O,IAAIF,EAAMxY,EAAE,GAAKyY,EAAMzY,EAAE,IAC3C+Y,EAAM/Y,EAAE,GAAK2J,KAAK+O,IAAI,IAAM/O,KAAK+O,IAAIF,EAAMxY,EAAE,GAAKyY,EAAMzY,EAAE,IAG5D,OAAO8Y,GAET,QAASD,GAAaV,EAAGC,EAAGO,GA8C1B,QAASK,GAASrK,GACF,QAAVK,GACFiK,EAAY,EACZC,EAAe,IAEfD,EAAYtP,KAAKC,OAAO/O,EAAS8T,EAAU9T,QAAU,GACrDqe,EAAevP,KAAKC,OAAOhP,EAAQ+T,EAAU/T,OAAS,IAlD1D,GAQEqe,GACAC,EACAC,EAAKC,EACLpZ,EAAGqZ,EAVHxe,EAAU8O,KAAK2P,IAAInB,EAAEtd,OAAQud,EAAEvd,QAC/BD,EAAU+O,KAAK2P,IAAInB,EAAEvd,MAAOwd,EAAExd,OAC9Bke,EAAUpC,EAAa9b,EAAOC,GAC9B2d,EAAUL,EAAEhJ,KACZsJ,EAAUL,EAAEjJ,KACZ4J,EAAUD,EAAE3J,KACZH,EAAU2J,GAAWA,EAAQ3J,KAO/B,KAAKhP,EAAI+Y,EAAMxY,OAAS,EAAGP,EAAI,EAAGA,GAAQ,EACxC+Y,EAAM/Y,GAAK,GAKb,KADAgZ,EAAQb,GACHgB,EAAMhB,EAAEtd,OAAQse,KACnB,IAAKC,EAASjB,EAAEvd,MAAOwe,KACrBpZ,EAAI,IAAMmZ,EAAMF,GAAare,GAASwe,EAASF,IAC/CG,EAAI,GAAKF,EAAMhB,EAAEvd,MAAQwe,GACzBL,EAAM/Y,EAAE,GAAKwY,EAAMa,EAAE,GACrBN,EAAM/Y,EAAE,GAAKwY,EAAMa,EAAE,GACrBN,EAAM/Y,EAAE,GAAKwY,EAAMa,EAAE,EAOzB,KADAL,EAAQZ,GACHe,EAAMf,EAAEvd,OAAQse,KACnB,IAAKC,EAAShB,EAAExd,MAAOwe,KACrBpZ,EAAI,IAAMmZ,EAAMF,GAAare,GAASwe,EAASF,IAC/CG,EAAI,GAAKF,EAAMf,EAAExd,MAAQwe,GACzBL,EAAM/Y,EAAE,GAAK2J,KAAK+O,IAAIK,EAAM/Y,EAAE,GAAKyY,EAAMY,EAAE,IAC3CN,EAAM/Y,EAAE,GAAK2J,KAAK+O,IAAIK,EAAM/Y,EAAE,GAAKyY,EAAMY,EAAE,IAC3CN,EAAM/Y,EAAE,GAAK2J,KAAK+O,IAAIK,EAAM/Y,EAAE,GAAKyY,EAAMY,EAAE,GAe/C,OAAOP,GAKT,QAASS,KACP,GAAIvZ,EACJ,KAAKA,EAAI,EAAGA,EAAIX,UAAUkB,OAAQP,IAChC,IAAKwX,EAAYnY,UAAUW,IACzB,MACEoW,KAAO,iBACPI,QAAU,sCAQlB,QAASlS,GAAK6C,EAAShF,GAKrB,MAJAgF,GAAU3K,SAASC,cAAc0K,GAC7BA,GAAWhF,IACbgF,EAAQ8F,UAAY9K,GAEfgF,EAsDT,QAASqS,GAAgB7K,EAAW8K,EAAYC,GAE9C,GAEEC,GACAC,EAFAtd,EAAS2b,EAAStJ,EAIpB+K,GAAWA,GAAYG,SAEvBF,EAAard,EAAOS,YAAYuI,QAAQ,2BAA2B,IACnEsU,EAAe,GAAIE,QAAOH,EAAY,UACtC5jB,QAAQ,MAAMgkB,UAAUN,EAAYG,EAAcF,GApUpD,GAYEzjB,GAAW+jB,EAVX9C,EAAoB,yCACpBE,EAAoB,uCACpBJ,EAAoB,uCACpBM,EAAoB,wBAEpBC,EAAoB,YAEpBjb,EAAoBma,IACpB/Z,EAAoBJ,EAAOK,WAAW,MACtCsd,EAAoB3kB,EAAK8gB,EA0W3B,OA/GA4D,IAEEE,cAAgB,WACd,MAAOjkB,GAAUohB,YAAYlhB,KAAKgkB,SAGpCC,iBAAmB,SAAUC,EAAU9B,GAuCrC,aArCW,YAAehB,IACxBphB,KAAKqgB,QAAU,WACb,GAOE9Z,GANA4d,EAAUhW,EAAI,OACd6T,EAAU7T,EAAI,MAAO,sBACrB8T,EAAU9T,EAAI,MAAO,wBACrBwU,EAAUxU,EAAI,MAAO,oBACrB3K,EAAU1D,EAAU0D,KAAKxD,KAAKgkB,OAAQE,GACtC/d,EAAUma,GAsBZ,OAnBAna,GAAOzB,OAASlB,EAAKkB,OACrByB,EAAO1B,MAASjB,EAAKiB,MAErB0f,EAAI3R,MAAM4R,SAAW,SACrBpC,EAAExP,MAAFwP,SAAgB,OAChBC,EAAEzP,MAAFyP,SAAgB,OAChBU,EAAEnQ,MAAFmQ,SAAgB,OAEhBpc,EAAUJ,EAAOK,WAAW,MAC5BD,EAAQkS,aAAajV,EAAM,EAAG,GAE9Bwe,EAAElR,YAAYgR,EAAS9hB,KAAKgkB,SAC5B/B,EAAEnR,YAAYgR,EAASoC,IACvBvB,EAAE7R,YAAY3K,GAEdge,EAAIrT,YAAYkR,GAChBmC,EAAIrT,YAAYmR,GAChBkC,EAAIrT,YAAY6R,IAGdwB,EACA,+BAKCrkB,EAAUiE,MAAM/D,KAAKgkB,OAAQE,EAAU9B,KAsBlDtiB,GAEEukB,aAAe/D,EACfG,gBAAkBF,EAClBG,aAAcA,EAEdC,QAAUA,EACVG,SAAWA,EACXE,UAAYA,EACZE,YAAcA,EACdG,YAAcA,EAEdK,YAAc,SAAU9X,GAEtB,MADAwZ,GAAUxZ,GACNsX,EAAYtX,GAAkB2X,EAAc3X,GACzC8X,EAAY9X,IAGrB7F,MAAQ,SAAUie,EAAGC,EAAGG,GAItB,MAHAgB,GAAUpB,EAAGC,GACbD,EAAIN,EAAYM,GAChBC,EAAIP,EAAYO,GACTle,EAAMie,EAAGC,EAAGG,IAErB5e,KAAO,SAAUwe,EAAGC,EAAGO,GAIrB,MAHAY,GAAUpB,EAAGC,GACbD,EAAIN,EAAYM,GAChBC,EAAIP,EAAYO,GACTze,EAAKwe,EAAGC,EAAGO,IAGpBqB,QAAUA,EAGVS,WAAa,WAEX,MADAnlB,GAAK8gB,GAAQ6D,EACNhkB,IAIW,mBAAXH,UACTG,EAAUujB,eAAiBA,GAGtBvjB;;;;AyC9YTH,OAAOD,QAAU,WAOf,QAASiiD,GAAaC,EAAO5oB,GAC3B,QAAS6oB,KAAS7hD,KAAK6hC,YAAc+f,EACrCC,EAAK94C,UAAYiwB,EAAOjwB,UACxB64C,EAAM74C,UAAY,GAAI84C,GAGxB,QAAS3F,GAAY77B,EAAS6D,EAAU49B,EAAOxoB,EAAQkmB,EAAMv8B,GAC3DjjB,KAAKqgB,QAAWA,EAChBrgB,KAAKkkB,SAAWA,EAChBlkB,KAAK8hD,MAAWA,EAChB9hD,KAAKs5B,OAAWA,EAChBt5B,KAAKw/C,KAAWA,EAChBx/C,KAAKijB,OAAWA,EAEhBjjB,KAAKigB,KAAW,cAKlB,QAASuO,GAAMnC,GA+Eb,QAAS01B,GAAsBjkB,GAC7B,QAASkkB,GAAQC,EAASC,EAAUC,GAClC,GAAItvB,GAAGuvB,CAEP,KAAKvvB,EAAIqvB,EAAcC,EAAJtvB,EAAYA,IAC7BuvB,EAAK/1B,EAAM0a,OAAOlU,GACP,OAAPuvB,GACGH,EAAQI,QAAUJ,EAAQzC,OAC/ByC,EAAQh/B,OAAS,EACjBg/B,EAAQI,QAAS,GACD,OAAPD,GAAsB,WAAPA,GAA0B,WAAPA,GAC3CH,EAAQzC,OACRyC,EAAQh/B,OAAS,EACjBg/B,EAAQI,QAAS,IAEjBJ,EAAQh/B,SACRg/B,EAAQI,QAAS,GAcvB,MATIC,KAAkBxkB,IAChBwkB,EAAgBxkB,IAClBwkB,EAAgB,EAChBC,GAAyB/C,KAAM,EAAGv8B,OAAQ,EAAGo/B,QAAQ,IAEvDL,EAAQO,EAAsBD,EAAexkB,GAC7CwkB,EAAgBxkB,GAGXykB,EAGT,QAASC,GAASt+B,GACEu+B,EAAdC,IAEAA,EAAcD,IAChBA,EAAiBC,EACjBC,MAGFA,EAAoBxhD,KAAK+iB,IAG3B,QAAS0+B,GAAmBviC,EAAS6D,EAAU4Z,GAC7C,QAAS+kB,GAAgB3+B,GACvB,GAAIra,GAAI,CAYR,KAVAqa,EAASxa,KAAK,SAASsY,EAAGC,GACxB,MAAID,GAAE8gC,YAAc7gC,EAAE6gC,YACb,GACE9gC,EAAE8gC,YAAc7gC,EAAE6gC,YACpB,EAEA,IAIJj5C,EAAIqa,EAAS9Z,QACd8Z,EAASra,EAAI,KAAOqa,EAASra,GAC/Bqa,EAASyjB,OAAO99B,EAAG,GAEnBA,IAKN,QAASk5C,GAAa7+B,EAAU49B,GAC9B,QAASkB,GAAaruB,GACpB,QAASsuB,GAAIb,GAAM,MAAOA,GAAGplB,WAAW,GAAG9tB,SAAS,IAAIg0C,cAExD,MAAOvuB,GACJxlB,QAAQ,MAAS,QACjBA,QAAQ,KAAS,OACjBA,QAAQ,QAAS,OACjBA,QAAQ,MAAS,OACjBA,QAAQ,MAAS,OACjBA,QAAQ,MAAS,OACjBA,QAAQ,MAAS,OACjBA,QAAQ,2BAA4B,SAASizC,GAAM,MAAO,OAASa,EAAIb,KACvEjzC,QAAQ,wBAA4B,SAASizC,GAAM,MAAO,MAASa,EAAIb,KACvEjzC,QAAQ,mBAA4B,SAASizC,GAAM,MAAO,OAASa,EAAIb,KACvEjzC,QAAQ,mBAA4B,SAASizC,GAAM,MAAO,MAASa,EAAIb,KAG5E,GACIe,GAAcC,EAAWv5C,EADzBw5C,EAAgB,GAAIv6C,OAAMob,EAAS9Z,OAGvC,KAAKP,EAAI,EAAGA,EAAIqa,EAAS9Z,OAAQP,IAC/Bw5C,EAAcx5C,GAAKqa,EAASra,GAAGi5C,WAWjC,OARAK,GAAej/B,EAAS9Z,OAAS,EAC7Bi5C,EAAcr6C,MAAM,EAAG,IAAIW,KAAK,MAC5B,OACA05C,EAAcn/B,EAAS9Z,OAAS,GACpCi5C,EAAc,GAElBD,EAAYtB,EAAQ,IAAOkB,EAAalB,GAAS,IAAO,eAEjD,YAAcqB,EAAe,QAAUC,EAAY,UAG5D,GAAIE,GAAavB,EAAsBjkB,GACnCgkB,EAAahkB,EAAMzR,EAAMjiB,OAASiiB,EAAM0a,OAAOjJ,GAAO,IAM1D,OAJiB,QAAb5Z,GACF2+B,EAAgB3+B,GAGX,GAAIg4B,GACG,OAAZ77B,EAAmBA,EAAU0iC,EAAa7+B,EAAU49B,GACpD59B,EACA49B,EACAhkB,EACAwlB,EAAW9D,KACX8D,EAAWrgC,QAIf,QAASsgC,KACP,GAAIC,GAAIC,CAaR,OAXAD,GAAKE,IACDF,IAAOG,IACTH,EAAKd,EACLe,KACIA,IAAOE,IACTC,EAAkBJ,EAClBC,EAAKI,KAEPL,EAAKC,GAGAD,EAGT,QAASE,KACP,GAAIF,GAAIC,EAAIK,EAAIC,EAAIC,EAAIC,CAIxB,IAFAT,EAAKd,EACLe,EAAKS,IACDT,IAAOE,EAAY,CAGrB,IAFAG,KACAC,EAAKI,IACEJ,IAAOJ,GACZG,EAAG3iD,KAAK4iD,GACRA,EAAKI,GAEP,IAAIL,IAAOH,EAQT,GAPsC,KAAlCt3B,EAAM2Q,WAAW0lB,IACnBqB,EAAKK,EACL1B,MAEAqB,EAAKJ,EACmB,IAApBU,GAAyB7B,EAAS8B,IAEpCP,IAAOJ,EAAY,CAGrB,IAFAK,KACAC,EAAKE,IACEF,IAAON,GACZK,EAAG7iD,KAAK8iD,GACRA,EAAKE,GAEHH,KAAOL,GACTM,EAAKP,IACDO,IAAON,GACTC,EAAkBJ,EAClBC,EAAKc,EAAOd,EAAIQ,GAChBT,EAAKC,IAELf,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,OAGP9B,GAAcc,EACdA,EAAKgB,MAGP9B,GAAcc,EACdA,EAAKgB,MAGP9B,GAAcc,EACdA,EAAKgB,CAYP,OAVIhB,KAAOG,IACTH,EAAKd,EACLe,EAAKS,IACDT,IAAOE,IACTC,EAAkBJ,EAClBC,EAAKgB,EAAOhB,IAEdD,EAAKC,GAGAD,EAGT,QAASU,KACP,GAAIV,EAOJ,OALAA,GAAKkB,IACDlB,IAAOG,IACTH,EAAKmB,KAGAnB,EAGT,QAASkB,KACP,GAAIlB,GAAIC,EAAIK,EAAIC,CAIhB,IAFAP,EAAKd,EACLe,EAAKmB,IACDnB,IAAOE,EAAY,CAGrB,GAFAG,KACAC,EAAKI,IACDJ,IAAOJ,EACT,KAAOI,IAAOJ,GACZG,EAAG3iD,KAAK4iD,GACRA,EAAKI,QAGPL,GAAKU,CAEHV,KAAOH,GACTI,EAAKc,IACDd,IAAOJ,GACTC,EAAkBJ,EAClBC,EAAKqB,EAAOrB,EAAIM,GAChBP,EAAKC,IAELf,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,OAGP9B,GAAcc,EACdA,EAAKgB,CAYP,OAVIhB,KAAOG,IACTH,EAAKd,EACLe,EAAKmB,IACDnB,IAAOE,IACTC,EAAkBJ,EAClBC,EAAKsB,EAAOtB,IAEdD,EAAKC,GAGAD,EAGT,QAASoB,KACP,GAAIpB,GAAIC,EAAIK,EAAIC,CAqChB,OAnCAP,GAAKd,EACDr2B,EAAMnP,OAAOwlC,EAAa,KAAOsC,GACnCvB,EAAKuB,EACLtC,GAAe,IAEfe,EAAKE,EACmB,IAApBU,GAAyB7B,EAASyC,IAEpCxB,IAAOE,GACTG,EAAKoB,IACDpB,IAAOH,GAC6B,KAAlCt3B,EAAM2Q,WAAW0lB,IACnBqB,EAAKoB,EACLzC,MAEAqB,EAAKJ,EACmB,IAApBU,GAAyB7B,EAAS4C,IAEpCrB,IAAOJ,GACTC,EAAkBJ,EAClBC,EAAK4B,EAAQvB,GACbN,EAAKC,IAELf,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,GAGAhB,EAGT,QAASqB,KACP,GAAIrB,GAAIC,EAAIK,EAAIC,CAqChB,OAnCAP,GAAKd,EACDr2B,EAAMnP,OAAOwlC,EAAa,KAAO4C,GACnC7B,EAAK6B,EACL5C,GAAe,IAEfe,EAAKE,EACmB,IAApBU,GAAyB7B,EAAS+C,IAEpC9B,IAAOE,GACTG,EAAKoB,IACDpB,IAAOH,GAC6B,KAAlCt3B,EAAM2Q,WAAW0lB,IACnBqB,EAAKoB,EACLzC,MAEAqB,EAAKJ,EACmB,IAApBU,GAAyB7B,EAAS4C,IAEpCrB,IAAOJ,GACTC,EAAkBJ,EAClBC,EAAK4B,EAAQvB,GACbN,EAAKC,IAELf,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,GAGAhB,EAGT,QAASmB,KACP,GAAInB,GAAIC,EAAIK,EAAIC,CAqChB,OAnCAP,GAAKd,EACDr2B,EAAMnP,OAAOwlC,EAAa,KAAO8C,GACnC/B,EAAK+B,EACL9C,GAAe,IAEfe,EAAKE,EACmB,IAApBU,GAAyB7B,EAASiD,IAEpChC,IAAOE,GACTG,EAAKoB,IACDpB,IAAOH,GAC6B,KAAlCt3B,EAAM2Q,WAAW0lB,IACnBqB,EAAKoB,EACLzC,MAEAqB,EAAKJ,EACmB,IAApBU,GAAyB7B,EAAS4C,IAEpCrB,IAAOJ,GACTC,EAAkBJ,EAClBC,EAAKiC,EAAQ5B,GACbN,EAAKC,IAELf,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,KAGP9B,EAAcc,EACdA,EAAKgB,GAGAhB,EAGT,QAAS0B,KACP,GAAI1B,GAAIC,EAAIK,CAWZ,IATAN,EAAKd,EACLe,KACIkC,EAAQz7B,KAAKmC,EAAM0a,OAAO2b,KAC5BoB,EAAKz3B,EAAM0a,OAAO2b,GAClBA,MAEAoB,EAAKH,EACmB,IAApBU,GAAyB7B,EAASoD,IAEpC9B,IAAOH,EACT,KAAOG,IAAOH,GACZF,EAAGtiD,KAAK2iD,GACJ6B,EAAQz7B,KAAKmC,EAAM0a,OAAO2b,KAC5BoB,EAAKz3B,EAAM0a,OAAO2b,GAClBA,MAEAoB,EAAKH,EACmB,IAApBU,GAAyB7B,EAASoD,QAI1CnC,GAAKe,CAQP,OANIf,KAAOE,IACTC,EAAkBJ,EAClBC,EAAKoC,EAAQpC,IAEfD,EAAKC,EAKP,QAASU,KACP,GAAIX,EAUJ,OARIsC,GAAQ57B,KAAKmC,EAAM0a,OAAO2b,KAC5Bc,EAAKn3B,EAAM0a,OAAO2b,GAClBA,MAEAc,EAAKG,EACmB,IAApBU,GAAyB7B,EAASuD,IAGjCvC,EA5fT,GAwCIwC,GAxCAxjC,EAAUtZ,UAAUkB,OAAS,EAAIlB,UAAU,MAE3Cy6C,KAEAsC,GAA2BxrB,MAAO8oB,GAClC2C,EAAyB3C,EAGzBM,EAAS,WAAa,UACtBW,EAASb,EACTS,EAAS,IACTE,GAAW3kC,KAAM,UAAW1V,MAAO,IAAK64C,YAAa,OACrDyB,EAAS,SAAS1uB,EAAGka,GAAM,OAAQla,GAAGjO,OAAOmoB,IAC7C0U,EAAS,SAASnuC,GAAS,OAAQA,IACnCwuC,EAAS,SAAShkD,EAAKkiC,GAAU,OAAQliC,IAAKA,EAAKkiC,OAAQA,IAC3D+hB,EAAS,SAASjkD,GAAO,OAAQA,IAAKA,IACtCkkD,EAAS,OACTC,GAAYtlC,KAAM,UAAW1V,MAAO,OAAQ64C,YAAa,UACzDqC,EAAU,IACVC,GAAYzlC,KAAM,UAAW1V,MAAO,IAAK64C,YAAa,OACtDuC,EAAU,SAASp7C,GAAS,MAAOA,IACnCq7C,EAAU,UACVC,GAAY5lC,KAAM,UAAW1V,MAAO,UAAW64C,YAAa,aAC5D0C,EAAU,SACVC,GAAY9lC,KAAM,UAAW1V,MAAO,SAAU64C,YAAa,YAC3D4C,EAAU,SAASz7C,GAAS,OAAQoyC,MAAOpyC,IAC3C07C,EAAU,QACVC,GAAYjmC,KAAM,QAAS1V,MAAO,OAAQ64C,YAAa,QACvD+C,EAAU,SAASM,GAAS,MAAO9lD,GAAK+lD,aAAaD,EAAMx8C,KAAK,MAChEm8C,EAAU,eACVC,GAAYpmC,KAAM,QAAS1V,MAAO,kBAAmB64C,YAAa,mBAElEJ,EAAuB,EACvBkB,EAAuB,EACvBtB,EAAuB,EACvBC,GAAyB/C,KAAM,EAAGv8B,OAAQ,EAAGo/B,QAAQ,GACrDI,EAAuB,EACvBE,KACA0B,EAAuB,CAI3B,IAAI,aAAe7hC,GAAS,CAC1B,KAAMA,EAAQ6jC,YAAaJ,IACzB,KAAM,IAAI7lC,OAAM,mCAAqCoC,EAAQ6jC,UAAY,KAG3EH,GAAwBD,EAAuBzjC,EAAQ6jC,WAidvD,GAAIhmD,GAAOT,QAAQ,UAKrB,IAFAomD,EAAaE,IAETF,IAAerC,GAAcjB,IAAgBr2B,EAAMjiB,OACrD,MAAO47C,EAMP,MAJIA,KAAerC,GAAcjB,EAAcr2B,EAAMjiB,QACnDo4C,GAAW7iC,KAAM,MAAOmjC,YAAa,iBAGjCF,EAAmB,KAAMD,EAAqBF,GAIxD,MAnhBAd,GAAazF,EAAa97B,QAohBxB87B,YAAaA,EACb1tB,MAAaA;;AlB7iBjB,GAAIytB,SAAUr8C,QAAQ,YAGtBF,SAAQw8C,YAAc,SAAU77B,EAASiZ,GACrCt5B,KAAKqgB,QAAWA,EAChBrgB,KAAKs5B,OAAWA,GAGpB55B,QAAQ8uB,MAAQ,SAAU2tB,GACtB,IACI,MAAOF,SAAQztB,MAAM2tB,GACvB,MAAOl0C,GACL,KAAM,IAAIvI,SAAQw8C,YAAYj0C,EAAEoY,QAASpY,EAAEqxB,UAInD55B,QAAQk4C,UAAY,SAAUV,GAC1B,MAAOA,GAAsB51C,IAAI,SAAU81C,GACvC,GAAIgF,EAUJ,OARIhF,GAAWt2C,KACXs7C,EAAY,QAAUhF,EAAWt2C,IAAM,KACnCs2C,EAAWpU,SACXoZ,GAAa,YAAchF,EAAWpU,OAAS,OAGnDoZ,EAAY,UAAYhF,EAAWiF,MAAQ,KAExCD,IACRzyC,KAAK;;AmB7BZ,GAAIiwC,mBAAoB,SAAU3vC,GAC9B,GAAI4vC,GAAkB,iCAEtB,OAAO5vC,GAAMkF,QAAQ0qC,EAAiB,OAGtCrB,cAAgB,SAAUc,GAC1B,GAAIC,GAAmB,WACnBC,EAAmB,UAEvB,OAAID,GAAiBrvB,KAAKovB,GACfA,EAAUnqC,QAAQoqC,EAAkB,MAEvCC,EAAiBtvB,KAAKovB,GACfA,EAAUnqC,QAAQqqC,EAAkB,MAEpCF,EAKnB55C,SAAQ0mD,aAAe,SAAUn8C,GAC7B,MAAOuuC,eAAcoB,kBAAkB3vC;;ANrB3C,GAAIqyC,QACAntB,QAASvvB,QAAQ,aAAauvB,QAC9B0sB,YAAaj8C,QAAQ,iBAAiBi8C,YAS1CS,OAAMR,gBAAkB,WACpBQ,MAAMntB,QAAQlmB,KAAKjJ,MACnBA,KAAKo+C,QAAU,GAAI9B,OAAMT,YACzB77C,KAAKgpB,aAGTszB,MAAMR,gBAAgB/yC,UAAY,GAAIuzC,OAAMntB,QAC5CmtB,MAAMR,gBAAgB/yC,UAAU84B,YAAcya,MAAMR,gBACpDQ,MAAMR,gBAAgB/yC,UAAU4W,KAAO,GAKvCvW,OAAO4zC,eAAeV,MAAMR,gBAAgB/yC,UAAW,WACrDoF,IAAK,WAEH,IAAK,GADDmvC,MACKzzC,EAAE,EAAGO,EAAOpK,KAAKgpB,SAAS5e,OAAYA,EAAJP,EAAYA,IACnDyzC,EAASn8C,KAAKnB,KAAKgpB,SAASnf,GAAG0V,QAEnC,OAAO,kBAAoBvf,KAAKo+C,QAAQF,YAAc,KAAOZ,EAAS3zC,KAAK,IAAM,OAMrFjK,QAAQo8C,gBAAkBQ,MAAMR;;ALpChC,GAAIQ,QACHnB,oBAAqBv7C,QAAQ,yBAAyBu7C,oBACtDhsB,QAASvvB,QAAQ,aAAauvB,QAS/BmtB,OAAMd,gBAAkB,WACvBc,MAAMntB,QAAQlmB,KAAKjJ,MACnBA,KAAKwS,MAAQ,GAAI8pC,OAAMnB,oBACvBn7C,KAAKwS,MAAM+pC,WAAav8C,MAGzBs8C,MAAMd,gBAAgBzyC,UAAY,GAAIuzC,OAAMntB,QAC5CmtB,MAAMd,gBAAgBzyC,UAAU84B,YAAcya,MAAMd,gBACpDc,MAAMd,gBAAgBzyC,UAAU4W,KAAO,EAMvCvW,OAAO4zC,eAAeV,MAAMd,gBAAgBzyC,UAAW,WACrDoF,IAAK,WACH,MAAO,eAAiBnO,KAAKwS,MAAM+M,QAAU,OAMjD7f,QAAQ87C,gBAAkBc,MAAMd;;AFjChC,GAAIc,QACHntB,QAASvvB,QAAQ,aAAauvB,QAC9BusB,cAAe97C,QAAQ,mBAAmB87C,cAC1CL,UAAWz7C,QAAQ,eAAey7C,UAUnCiB,OAAMf,cAAgB,WACrBe,MAAMntB,QAAQlmB,KAAKjJ,MACnBA,KAAKgd,KAAO,GACZhd,KAAK+uB,MAAQ,GAAIutB,OAAMjB,UACvBr7C,KAAK4f,WAAa,GAAI08B,OAAMZ,eAG7BY,MAAMf,cAAcxyC,UAAY,GAAIuzC,OAAMntB,QAC1CmtB,MAAMf,cAAcxyC,UAAU84B,YAAcya,MAAMf,cAClDe,MAAMf,cAAcxyC,UAAU4W,KAAO,EAErCvW,OAAO4zC,eAAeV,MAAMf,cAAcxyC,UAAW,WACnDoF,IAAK,WACH,GAAIyuC,GAAY58C,KAAK+uB,MAAM6tB,SAC3B,OAAO,eAAiB58C,KAAKgd,KAAO,KAAO4/B,EAAY,IAAMA,EAAY,IAAM,KAEjFne,IAAK,SAASlf,GAeZ,IAAK,GAFD+pB,GAEK4T,EAdLrzC,EAAI,EASJgT,EAAQ,GAER8kB,EAAS,GAGOub,EAAY39B,EAAQwnB,OAAOl9B,GAAIA,IAEjD,OAAQqzC,GACN,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,KACL,IAAK,KACW,iBAAVrgC,EACFA,EAAQ,MAER8kB,GAAUub,CAEZ,MAEF,KAAK,IACErgC,GAAS0C,EAAQ/X,QAAQ,UAAWqC,KAAOA,IAC9CgT,EAAQ,eACRhT,GAAK,SAASO,OACdu3B,EAAS,GAEX,MAEF,KAAK,IACH,GAAc,QAAV9kB,GAAmB0C,EAAQ/X,QAAQ,OAAQqC,KAAOA,EAAG,CAEvD,GADAy/B,EAAQ/pB,EAAQ/X,QAAQ,IAAKqC,EAAI,GACnB,KAAVy/B,EACF,KAAMz/B,GAAI,iBAEZA,IAAK,OAAOO,MACZ,IAAItJ,GAAMye,EAAQvW,MAAMa,EAAGy/B,EACvBxoC,GAAI,KAAOA,EAAIA,EAAIsJ,OAAS,KACf,MAAXtJ,EAAI,IAAyB,MAAXA,EAAI,MACxBA,EAAMA,EAAIkI,MAAM,EAAG,KAGvBhJ,KAAKgd,KAAOlc,EACZ+I,EAAIy/B,EACJzsB,EAAQ,QAEV,KAEF,KAAK,IACH,GAAc,QAAVA,EAAiB,CAEnB,GADAysB,EAAQ/pB,EAAQ/X,QAAQ,IAAKqC,EAAI,IAC5By/B,EACH,KAAMz/B,GAAI,kBAEZ7J,MAAKgd,KAAOuC,EAAQvW,MAAMa,EAAI,EAAGy/B,GACjCz/B,EAAIy/B,EACJzsB,EAAQ,QAEV,KAEF,KAAK,IACH,GAAc,QAAVA,EAAiB,CAEnB,GADAysB,EAAQ/pB,EAAQ/X,QAAQ,IAAKqC,EAAI,IAC5By/B,EACH,KAAMz/B,GAAI,kBAEZ7J,MAAKgd,KAAOuC,EAAQvW,MAAMa,EAAI,EAAGy/B,GACjCz/B,EAAIy/B,EACJzsB,EAAQ,QAEV,KAEF,KAAK,IACW,UAAVA,GACE8kB,IACF3hC,KAAK+uB,MAAM6tB,UAAYjb,EAAOjF,OAGlC,MAEF,SACgB,UAAV7f,IACF8kB,GAAUub,OAUtBx9C,QAAQ67C,cAAgBe,MAAMf;;AKlI9B,GAAIe,QACHntB,QAASvvB,QAAQ,aAAauvB,QAC9BgsB,oBAAqBv7C,QAAQ,yBAAyBu7C,oBASvDmB,OAAMV,gBAAkB,WACvBU,MAAMntB,QAAQlmB,KAAKjJ,MACnBA,KAAKi+C,QAAU,GACfj+C,KAAKwS,MAAQ,GAAI8pC,OAAMnB,oBACvBn7C,KAAKwS,MAAM+pC,WAAav8C,MAGzBs8C,MAAMV,gBAAgB7yC,UAAY,GAAIuzC,OAAMntB,QAC5CmtB,MAAMV,gBAAgB7yC,UAAU84B,YAAcya,MAAMV,gBACpDU,MAAMV,gBAAgB7yC,UAAU4W,KAAO,EAMvCvW,OAAO4zC,eAAeV,MAAMV,gBAAgB7yC,UAAW,WACrDoF,IAAK,WACH,MAAOnO,MAAKi+C,QAAU,KAAOj+C,KAAKwS,MAAM+M,QAAU,QAMtD7f,QAAQk8C,gBAAkBU,MAAMV;;ADlChC,GAAIU,QACHntB,QAASvvB,QAAQ,aAAauvB,QAS/BmtB,OAAMX,iBAAmB,WACxBW,MAAMntB,QAAQlmB,KAAKjJ,MACnBA,KAAKigB,KAAO,GACZjgB,KAAKgpB,aAGNszB,MAAMX,iBAAiB5yC,UAAY,GAAIuzC,OAAMntB,QAC7CmtB,MAAMX,iBAAiB5yC,UAAU84B,YAAcya,MAAMX,iBACrDW,MAAMX,iBAAiB5yC,UAAU4W,KAAO,EAMxCvW,OAAO4zC,eAAeV,MAAMX,iBAAiB5yC,UAAW,WACtDoF,IAAK,WAEH,IAAK,GADDmvC,MACKzzC,EAAE,EAAGO,EAAOpK,KAAKgpB,SAAS5e,OAAYA,EAAJP,EAAYA,IACrDyzC,EAASn8C,KAAK,KAAOnB,KAAKgpB,SAASnf,GAAG0V,QAExC,OAAO,KAAOvf,KAAKg+C,eAAiB,IAAM,aAAeh+C,KAAKigB,KAAO,QAAUq9B,EAAS3zC,KAAK,MAAQ,SAMzGjK,QAAQi8C,iBAAmBW,MAAMX;;ANpCjC,GAAIW,QACHntB,QAASvvB,QAAQ,aAAauvB,QAC9BksB,UAAWz7C,QAAQ,eAAey7C,UAUnCiB,OAAMhB,aAAe,WACpBgB,MAAMntB,QAAQlmB,KAAKjJ,MACnBA,KAAK+uB,MAAQ,GAAIutB,OAAMjB,UACvBr7C,KAAKgpB,aAGNszB,MAAMhB,aAAavyC,UAAY,GAAIuzC,OAAMntB,QACzCmtB,MAAMhB,aAAavyC,UAAU84B,YAAcya,MAAMhB,aACjDgB,MAAMhB,aAAavyC,UAAU4W,KAAO,EAMpCvW,OAAO4zC,eAAeV,MAAMhB,aAAavyC,UAAW,WAClDoF,IAAK,WAEH,IAAK,GADDmvC,MACKzzC,EAAE,EAAGO,EAAOpK,KAAKgpB,SAAS5e,OAAYA,EAAJP,EAAYA,IACrDyzC,EAASn8C,KAAKnB,KAAKgpB,SAASnf,GAAG0V,QAEjC,OAAO,UAAYvf,KAAK+uB,MAAM6tB,UAAY,KAAOU,EAAS3zC,KAAK,IAAM,OAMzEjK,QAAQ47C,aAAegB,MAAMhB;;AHtC7B,GAAIgB,SASJA,OAAMntB,QAAU,WACfnvB,KAAKu8C,WAAa,KAClBv8C,KAAK8oB,iBAAmB,MAGzBwzB,MAAMntB,QAAQinB,WAAa,EAC3BkG,MAAMntB,QAAQynB,YAAc,EAC5B0F,MAAMntB,QAAQC,WAAa,EAC3BktB,MAAMntB,QAAQunB,eAAiB,EAC/B4F,MAAMntB,QAAQqtB,UAAY,EAC1BF,MAAMntB,QAAQstB,sBAAwB,EACtCH,MAAMntB,QAAQutB,qBAAuB,EASrCJ,MAAMntB,QAAQpmB,WACb84B,YAAaya,MAAMntB,SAMpBzvB,QAAQyvB,QAAUmtB,MAAMntB;;AIpCxB,GAAImtB,SAQJA,OAAMnB,oBAAsB,WAC3Bn7C,KAAKoK,OAAS,EACdpK,KAAKu8C,WAAa,KAGlBv8C,KAAKu9C,gBAINjB,MAAMnB,oBAAoBpyC,WAEzB84B,YAAaya,MAAMnB,oBASnB9E,iBAAkB,SAASp2B,GAC1B,MAAOjgB,MAAKigB,IAAS,IAUtBg2B,YAAa,SAASh2B,EAAMhW,EAAOozC,GAClC,GAAIr9C,KAAKigB,GAAO,CAEf,GAAIqpB,GAAQxgC,MAAMC,UAAUvB,QAAQyB,KAAKjJ,KAAMigB,EACnC,GAARqpB,IACHtpC,KAAKA,KAAKoK,QAAU6V,EACpBjgB,KAAKoK,cAINpK,MAAKA,KAAKoK,QAAU6V,EACpBjgB,KAAKoK,QAENpK,MAAKigB,GAAQhW,EACbjK,KAAKu9C,YAAYt9B,GAAQo9B,GAU1BG,eAAgB,SAASv9B,GACxB,KAAMA,IAAQjgB,OACb,MAAO,EAER,IAAIspC,GAAQxgC,MAAMC,UAAUvB,QAAQyB,KAAKjJ,KAAMigB,EAC/C,IAAY,EAARqpB,EACH,MAAO,EAER,IAAImU,GAAYz9C,KAAKigB,EASrB,OARAjgB,MAAKigB,GAAQ,GAGbnX,MAAMC,UAAU4+B,OAAO1+B,KAAKjJ,KAAMspC,EAAO,GAKlCmU,GAGRC,oBAAqB,aAQrBxH,oBAAqB,SAASj2B,GAC7B,MAAOjgB,MAAKu9C,YAAYt9B,IAAS,IASlC09B,qBAAsB,aAItBC,mBAAoB,aAKpBjB,GAAIp9B,WAEH,IAAK,GADDs+B,MACKh0C,EAAE,EAAGO,EAAOpK,KAAKoK,OAAYA,EAAJP,IAAcA,EAAG,CAClD,GAAIoW,GAAOjgB,KAAK6J,GACZI,EAAQjK,KAAKq2C,iBAAiBp2B,GAC9Bo9B,EAAWr9C,KAAKk2C,oBAAoBj2B,EACpCo9B,KACHA,EAAW,KAAOA,GAEnBQ,EAAWh0C,GAAKoW,EAAO,KAAOhW,EAAQozC,EAAW,IAElD,MAAOQ,GAAWl0C,KAAK,MAGxBgzC,GAAIp9B,SAAQA,GACX,GAAI1V,GAAGoW,CACP,KAAKpW,EAAI7J,KAAKoK,OAAQP,KACrBoW,EAAOjgB,KAAK6J,GACZ7J,KAAKigB,GAAQ,EAEdnX,OAAMC,UAAU4+B,OAAO1+B,KAAKjJ,KAAM,EAAGA,KAAKoK,QAC1CpK,KAAKu9C,cAEL,IAAIO,GAAYxB,MAAM9tB,MAAM,UAAYjP,EAAU,KAAKyJ,SAAS,GAAGxW,MAC/DpI,EAAS0zC,EAAU1zC,MACvB,KAAKP,EAAI,EAAOO,EAAJP,IAAcA,EACzBoW,EAAO69B,EAAUj0C,GACjB7J,KAAKi2C,YAAY6H,EAAUj0C,GAAIi0C,EAAUzH,iBAAiBp2B,GAAO69B,EAAU5H,oBAAoBj2B,MAOlGvgB,QAAQy7C,oBAAsBmB,MAAMnB,oBACpCmB,MAAM9tB,MAAQ5uB,QAAQ,WAAW4uB;;AFjJjC,GAAI8tB,QACHnB,oBAAqBv7C,QAAQ,yBAAyBu7C,oBACtDhsB,QAASvvB,QAAQ,aAAauvB,QAU/BmtB,OAAMlB,aAAe,WACpBkB,MAAMntB,QAAQlmB,KAAKjJ,MACnBA,KAAKiqB,aAAe,GACpBjqB,KAAKwS,MAAQ,GAAI8pC,OAAMnB,oBACvBn7C,KAAKwS,MAAM+pC,WAAav8C,MAGzBs8C,MAAMlB,aAAaryC,UAAY,GAAIuzC,OAAMntB,QACzCmtB,MAAMlB,aAAaryC,UAAU84B,YAAcya,MAAMlB,aACjDkB,MAAMlB,aAAaryC,UAAU4W,KAAO,EAEpCvW,OAAO4zC,eAAeV,MAAMlB,aAAaryC,UAAW,WACnDoF,IAAK,WACJ,GAAIuhC,EAMJ,OAJCA,GADG1vC,KAAKiqB,aACDjqB,KAAKiqB,aAAe,KAAOjqB,KAAKwS,MAAM+M,QAAU,IAEhD,IAITkf,IAAK,SAASlf,GACb,GAAIqJ,GAAO0zB,MAAMlB,aAAa5sB,MAAMjP,EACpCvf,MAAKwS,MAAQoW,EAAKpW,MAClBxS,KAAKiqB,aAAerB,EAAKqB,gBAW3BqyB,MAAMlB,aAAa5sB,MAAQ,SAASyuB,GAenC,IAAK,GAZD3T,GAUUrpB,EAELi9B,EAdLrzC,EAAI,EACJgT,EAAQ,WAERqG,EAAIrZ,EACJ83B,EAAS,GAETwb,GACHnsB,UAAY,EACZ/mB,OAAS,GAGNmzC,EAAY,GAAId,OAAMlB,aACCiC,EAAS,GAEhBH,EAAYD,EAASlW,OAAOl9B,GAAIA,IAEnD,OAAQqzC,GAER,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,KACL,IAAK,KACJ,GAAIC,EAAuBtgC,GAE1B,OAAQogC,EAASlW,OAAOl9B,EAAI,IAC3B,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,KACL,IAAK,KACJ,KACD,SACC83B,GAAU,IAIb,KAGD,KAAK,IAGJ,GAFAze,EAAIrZ,EAAI,EACRy/B,EAAQ2T,EAASz1C,QAAQ,IAAK0b,GAAK,GAC9BomB,EACJ,KAAM,cAEP3H,IAAUsb,EAASj0C,MAAMa,EAAGy/B,GAC5Bz/B,EAAIy/B,EAAQ,CACZ,MAED,KAAK,IAGJ,GAFApmB,EAAIrZ,EAAI,EACRy/B,EAAQ2T,EAASz1C,QAAQ,IAAK0b,GAAK,GAC9BomB,EACJ,KAAM,cAEP3H,IAAUsb,EAASj0C,MAAMa,EAAGy/B,GAC5Bz/B,EAAIy/B,EAAQ,CACZ,MAGD,KAAK,IACJ,GAA+B,MAA3B2T,EAASlW,OAAOl9B,EAAI,GAAY,CAGnC,GAFAA,GAAK,EACLy/B,EAAQ2T,EAASz1C,QAAQ,KAAMqC,GACjB,KAAVy/B,EACH,KAAM,IAAI4S,aAAY,aAEtBryC,GAAIy/B,EAAQ,MAGb3H,IAAUub,CAEX,MAED,KAAK,IACU,aAAVrgC,IACHugC,EAAUnzB,aAAe0X,EAAOjF,OAChCiF,EAAS,GACT9kB,EAAQ,OAET,MAED,KAAK,IACU,SAAVA,GACHoD,EAAO0hB,EAAOjF,OACdiF,EAAS,GACT9kB,EAAQ,SAER8kB,GAAUub,CAEX,MAED,KAAK,IACU,UAAVrgC,GAAqBogC,EAASz1C,QAAQ,aAAcqC,KAAOA,GAC9DwzC,EAAW,YACXxzC,GAAK,YAAYO,QAEjBu3B,GAAUub,CAEX,MAED,KAAK,IACU,UAAVrgC,GACHugC,EAAU5qC,MAAMyjC,YAAYh2B,EAAM0hB,EAAOjF,OAAQ2gB,GACjDA,EAAW,GACX1b,EAAS,GACT9kB,EAAQ,QAER8kB,GAAUub,CAEX,MAED,KAAK,IACJ,GAAc,UAAVrgC,EACHugC,EAAU5qC,MAAMyjC,YAAYh2B,EAAM0hB,EAAOjF,OAAQ2gB,GACjDA,EAAW,GACX1b,EAAS,OACH,CAAA,GAAc,SAAV9kB,EACV,KAEA8kB,IAAUub,EAEXrgC,EAAQ,UACR,MAED,SACC8kB,GAAUub,EAMZ,MAAOE,IAMR19C,QAAQ07C,aAAekB,MAAMlB;;AM3L7B,GAAIkB,QACHb,WAAY77C,QAAQ,gBAAgB67C,WACpCL,aAAcx7C,QAAQ,kBAAkBw7C,aASzCkB,OAAMZ,cAAgB,WACrBY,MAAMb,WAAWxyC,KAAKjJ,MACtBA,KAAKgpB,aAINszB,MAAMZ,cAAc3yC,UAAY,GAAIuzC,OAAMb,WAC1Ca,MAAMZ,cAAc3yC,UAAU84B,YAAcya,MAAMZ,cAmBlDY,MAAMZ,cAAc3yC,UAAUkgB,WAAa,SAASL,EAAM0gB,GACzD,GAAY,EAARA,GAAaA,EAAQtpC,KAAKgpB,SAAS5e,OACtC,KAAM,IAAIkuB,YAAW,iBAEtB,IAAIylB,GAAUzB,MAAM9tB,MAAM5F,GAAMI,SAAS,EAGzC,OAFA+0B,GAAQj1B,iBAAmB9oB,KAC3BA,KAAKgpB,SAAS2e,OAAO2B,EAAO,EAAGyU,GACxBzU,GAiBRgT,MAAMZ,cAAc3yC,UAAUmgB,WAAa,SAASogB,GACnD,GAAY,EAARA,GAAaA,GAAStpC,KAAKgpB,SAAS5e,OACvC,KAAM,IAAIkuB,YAAW,iBAEtBt4B,MAAKgpB,SAAS2e,OAAO2B,EAAO,IAQ7BgT,MAAMZ,cAAc3yC,UAAUmG,SAAW,WAGxC,IAAK,GAFD/K,GAAS,GACToyC,EAAQv2C,KAAKgpB,SACRnf,EAAE,EAAGA,EAAE0sC,EAAMnsC,OAAQP,IAC7B1F,GAAUoyC,EAAM1sC,GAAG0V,QAAU,IAE9B,OAAOpb,IAKRzE,QAAQg8C,cAAgBY,MAAMZ,cAC9BY,MAAM9tB,MAAQ5uB,QAAQ,WAAW4uB;;AKrFjC,GAAI8tB,SAUJA,OAAMP,SAAW,aAGjBO,MAAMP,SAAShzC,WACd84B,YAAaya,MAAMP,SAGnBY,GAAIp9B,SAAQmwB,GACX,GAAIzvB,GAAOjgB,KAAKs+C,qBAEhB,MAAM,IAAIC,WAAU,wCAA0Ct+B,EAAO,mBAGtE08B,GAAIp9B,WACH,GAAIU,GAAOjgB,KAAKs+C,qBAEhB,MAAM,IAAIC,WAAU,wBAA0Bt+B,EAAO,0BAGtDq+B,oBAAqB,WACpB,GAAI3pB,GAAI30B,KAAK6hC,YAAY3yB,WACvByT,EAAIgS,EAAErT,MAAM,sBACZrB,EAAO0C,EAAE,EAEX,OAAO1C,KAMTvgB,QAAQq8C,SAAWO,MAAMP;;AGxCzB,GAAIO,QACHP,SAAUn8C,QAAQ,cAAcm8C,SAUjCO,OAAMN,mBAAqB,SAA4BwC,EAAO9zC,GAC7D1K,KAAKygD,OAASjC,EACdx+C,KAAK0gD,KAAOh2C,GAGb4xC,MAAMN,mBAAmBjzC,UAAY,GAAIuzC,OAAMP,SAC/CO,MAAMN,mBAAmBjzC,UAAU84B,YAAcya,MAAMN,mBAiBvDM,MAAMN,mBAAmBjzC,UAAUylB,MAAQ,WAW1C,IAVA,GAMEoxB,GANEpB,EAAQx+C,KAAKygD,OACf/1C,EAAM1K,KAAK0gD,KAETxD,EAAY,GACd7Q,EAAa,GACbnhC,EAAQ,GAERy1C,QAGSj2C,EAAK,CAIf,GAHAwyC,EAAYsB,EAAMzX,OAAOr8B,GAGR,IAAbwyC,EAAiB,CACpBhyC,EAAQ,8CACR,OAGD,OAAOgyC,GACN,IAAK,IACJyD,EAAMx/C,KAAK+7C,GACX7Q,GAAc6Q,CACd,MAED,KAAK,IACJyD,EAAMziC,IAAIg/B,GACV7Q,GAAc6Q,CACd,MAED,KAAK,KACA0C,EAAO5/C,KAAK4gD,gBAAgBpC,EAAO9zC,IAClCk1C,EAAK10C,MACRA,EAAQ,0DAERR,EAAMk1C,EAAKl1C,KAGFk1C,EAAO5/C,KAAK6gD,eAAerC,EAAO9zC,KAC5CA,EAAMk1C,EAAKl1C,IACX2hC,GAAcuT,EAAKlQ,MAEnBrD,GAAc6Q,CAEf,MAED,KAAK,IACL,IAAK,IACJ0C,EAAO5/C,KAAK8gD,eAAetC,EAAO9zC,EAAKwyC,GACnC0C,GACHl1C,EAAMk1C,EAAKl1C,IACX2hC,GAAcuT,EAAKlQ,MAEnBrD,GAAc6Q,CAEf,MAED,SACC7Q,GAAc6Q,EAIhB,GAAIhyC,EACH,KAID,IAAoB,GAAhBy1C,EAAMv2C,OACT,MAIF,GAAIgxB,EAYJ,OAVCA,GADGlwB,GAEFA,MAAOA,IAIPR,IAAKA,EACL2hC,WAAYA,IAmBfiQ,MAAMN,mBAAmBjzC,UAAU63C,gBAAkB,SAASpC,EAAO9zC,GACpE,GACEglC,GADEqR,EAAWvC,EAAMzX,OAAOr8B,EAAM,EAGlC,IAAgB,KAAZq2C,GAA+B,KAAZA,EAAiB,CACvC,GACEC,GACAC,EAFEC,EAAWx2C,CAWf,OAPgB,KAAZq2C,EACHE,EAAiB,KACK,KAAZF,IACVE,EAAiB,MAGlBD,EAASxC,EAAMh3C,QAAQy5C,EAAgBC,EAAW,EAAI,GACvC,KAAXF,GACHA,EAASA,EAASC,EAAe72C,OAAS,EAC1CslC,EAAO8O,EAAMvK,UAAUvpC,EAAKs2C,EAAS,IAEpCt2C,IAAKs2C,EACLtR,KAAMA,KAGPxkC,MAAQ,2DAEPA,MAAOA,QAIT,OAAO,GAcToxC,MAAMN,mBAAmBjzC,UAAU+3C,eAAiB,SAAStC,EAAO9zC,EAAKwlC,GACxE,GACER,GADEsR,EAAShhD,KAAKmhD,gBAAgB3C,EAAO9zC,EAAKwlC,EAG9C,OAAe,KAAX8Q,GACI,GAEPtR,EAAO8O,EAAMvK,UAAUvpC,EAAKs2C,EAAS9Q,EAAI9lC,SAGxCM,IAAKs2C,EACLtR,KAAMA,KAgET4M,MAAMN,mBAAmBjzC,UAAU83C,eAAiB,SAASrC,EAAO9zC,GACnE,GAAI02C,GAAS5C,EAAMvK,UAAU,EAAGvpC,GAAKyE,QAAQ,OAAQ,IACnDkyC,GACC,KACA,MACA,MACA,MACA,MACA,MACA,MACA,QACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,UACA,MACA,cACA,OACA,UACA,SAGCC,EAAUD,EAAUpV,KAAK,SAASsV,GACrC,MAAOA,GAAIr3B,KAAKk3B,IAGjB,IAAKE,EAEE,CACN,GAAIpR,GAAM,GAGV,OAAOlwC,MAAK8gD,eAAetC,EAAO9zC,EAAKwlC,GALvC,OAAO,GAiBToM,MAAMN,mBAAmBjzC,UAAUo4C,gBAAkB,SAAS3C,EAAO9zC,EAAKwlC,GAMzE,IALA,GACE8Q,GADEE,EAAWx2C,EAGX82C,EAAY,KAEJ,CAGX,GAFAR,EAASxC,EAAMh3C,QAAQ0oC,EAAKgR,EAAW,GAExB,KAAXF,EAAe,CAClBA,EAASQ,CACT,OAEA,GAAI9R,GAAO8O,EAAMvK,UAAUvpC,EAAM,EAAGs2C,GAClCS,EAAU/R,EAAKpuB,MAAM,OACvB,KAAKmgC,GAAWA,EAAQ,GAAK,GAAK,EACjC,KAEAP,GAAWF,EAMd,GAAIU,GAAiBlD,EAAMh3C,QAAQ,KAAMkD,EAAM,EAM/C,OALqBs2C,GAAjBU,IACHV,EAASQ,GAIHR,GAORthD,QAAQs8C,mBAAqBM,MAAMN;;ALrVnC,GAAIM,SAQJA,OAAMT,YAAc,WAChB77C,KAAKoK,OAAS,GAGlBkyC,MAAMT,YAAY9yC,WAEd84B,YAAaya,MAAMT,YAKnBc,GAAIuB,eACA,MAAOp1C,OAAMC,UAAUY,KAAKV,KAAKjJ,KAAM,OAM3C28C,GAAIuB,aAAYj0C,GAIZ,IAAK,GAFDsF,GAAStF,EAAMyT,MAAM,KACrBtT,EAASpK,KAAKoK,OAASmF,EAAOnF,OACzBP,EAAE,EAAKO,EAAFP,EAAUA,IACpB7J,KAAK6J,GAAK0F,EAAO1F,GAAG6yB,QAO5ByhB,cAAe,SAASC,GACgC,KAAhDt1C,MAAMC,UAAUvB,QAAQyB,KAAKjJ,KAAMo+C,KACnCp+C,KAAKA,KAAKoK,QAAUg0C,EACpBp+C,KAAKoK,WAObi0C,cAAe,SAASD,GACpB,GAAI9U,GAAQxgC,MAAMC,UAAUvB,QAAQyB,KAAKjJ,KAAMo+C,EACjC,MAAV9U,GACAxgC,MAAMC,UAAU4+B,OAAO1+B,KAAKjJ,KAAMspC,EAAO,KAQrD5pC,QAAQm8C,YAAcS,MAAMT;;AV3D5B,GAAIS,SAQJA,OAAMjB,UAAY,WACjBr7C,KAAKoK,OAAS,GAGfkyC,MAAMjB,UAAUtyC,WAEf84B,YAAaya,MAAMjB,UAKnBsB,GAAIC,aACH,MAAO9zC,OAAMC,UAAUY,KAAKV,KAAKjJ,KAAM,OAMxC28C,GAAIC,WAAU3yC,GAGb,IAAK,GAFDsF,GAAStF,EAAMyT,MAAM,KACrBtT,EAASpK,KAAKoK,OAASmF,EAAOnF,OACzBP,EAAE,EAAKO,EAAFP,EAAUA,IACvB7J,KAAK6J,GAAK0F,EAAO1F,GAAG6yB,QAOtBmgB,aAAc,SAASC,GAC6B,KAA/Ch0C,MAAMC,UAAUvB,QAAQyB,KAAKjJ,KAAM88C,KACtC98C,KAAKA,KAAKoK,QAAU0yC,EACpB98C,KAAKoK,WAOP2yC,aAAc,SAASD,GACtB,GAAIxT,GAAQxgC,MAAMC,UAAUvB,QAAQyB,KAAKjJ,KAAM88C,EACjC,MAAVxT,GACHxgC,MAAMC,UAAU4+B,OAAO1+B,KAAKjJ,KAAMspC,EAAO,KAQ5C5pC,QAAQ27C,UAAYiB,MAAMjB;;AK1D1B,GAAIiB,SAQJA,OAAMb,WAAa,WAClBz7C,KAAK8oB,iBAAmB,MAKzBppB,QAAQ+7C,WAAaa,MAAMb;;ASd3B,GAAIa,QACHZ,cAAe97C,QAAQ,mBAAmB87C,cAC1CN,aAAcx7C,QAAQ,kBAAkBw7C,aACxCE,aAAc17C,QAAQ,kBAAkB07C,aACxCH,oBAAqBv7C,QAAQ,yBAAyBu7C,oBACtDS,gBAAiBh8C,QAAQ,qBAAqBg8C,gBAC9CD,iBAAkB/7C,QAAQ,sBAAsB+7C,iBAWjDW,OAAMr7C,MAAQ,QAASA,GAAM6+C,GAE5B,GAAIC,GAAS,GAAIzD,OAAMZ,cAEnBnF,EAAQuJ,EAAW92B,QACvB,KAAKutB,EACJ,MAAOwJ,EAaR,KAAK,GAVDC,IACHC,EAAG3D,MAAMlB,aACT8E,EAAG5D,MAAMhB,aAIT6E,EAAG7D,MAAMX,iBACTyE,EAAG9D,MAAMV,iBAGD/xC,EAAE,EAAGw2C,EAAY9J,EAAMnsC,OAAYi2C,EAAJx2C,EAAiBA,IAAK,CAC7D,GAAI+e,GAAO2tB,EAAM1sC,GACby2C,EAAYP,EAAO/2B,SAASnf,GAAK,GAAIm2C,GAAWp3B,EAAKjJ,MAErDnN,EAAQoW,EAAKpW,KACjB,IAAIA,EAAO,CAEV,IAAK,GADD+tC,GAAaD,EAAU9tC,MAAQ,GAAI8pC,OAAMnB,oBACpCj4B,EAAE,EAAGs9B,EAAYhuC,EAAMpI,OAAYo2C,EAAJt9B,EAAiBA,IAAK,CAC7D,GAAIjD,GAAOsgC,EAAWr9B,GAAK1Q,EAAM0Q,EACjCq9B,GAAWtgC,GAAQzN,EAAMyN,GACzBsgC,EAAWhD,YAAYt9B,GAAQzN,EAAM0jC,oBAAoBj2B,GAE1DsgC,EAAWn2C,OAASoI,EAAMpI,OAGvBwe,EAAK7e,eAAe,aACvBu2C,EAAUrC,QAAUr1B,EAAKq1B,SAGtBr1B,EAAK7e,eAAe,kBACvBu2C,EAAUr2B,aAAerB,EAAKqB,cAG3BrB,EAAK7e,eAAe,eACvBu2C,EAAU1D,UAAYh0B,EAAKg0B,WAGxBh0B,EAAK7e,eAAe,cACvBu2C,EAAUt3B,SAAW/nB,EAAM2nB,GAAMI,UAInC,MAAO+2B,IAKRrgD,QAAQuB,MAAQq7C,MAAMr7C;;AjB1EtB,YAEAvB,SAAQy7C,oBAAsBv7C,QAAQ,yBAAyBu7C,oBAC/Dz7C,QAAQyvB,QAAUvvB,QAAQ,aAAauvB,QACvCzvB,QAAQ07C,aAAex7C,QAAQ,kBAAkBw7C,aACjD17C,QAAQ27C,UAAYz7C,QAAQ,eAAey7C,UAC3C37C,QAAQ47C,aAAe17C,QAAQ,kBAAkB07C,aACjD57C,QAAQ67C,cAAgB37C,QAAQ,mBAAmB27C,cACnD77C,QAAQ87C,gBAAkB57C,QAAQ,qBAAqB47C,gBACvD97C,QAAQ+7C,WAAa77C,QAAQ,gBAAgB67C,WAC7C/7C,QAAQg8C,cAAgB97C,QAAQ,mBAAmB87C,cACnDh8C,QAAQi8C,iBAAmB/7C,QAAQ,sBAAsB+7C,iBACzDj8C,QAAQk8C,gBAAkBh8C,QAAQ,qBAAqBg8C,gBACvDl8C,QAAQm8C,YAAcj8C,QAAQ,iBAAiBi8C,YAC/Cn8C,QAAQo8C,gBAAkBl8C,QAAQ,qBAAqBk8C,gBACvDp8C,QAAQq8C,SAAWn8C,QAAQ,cAAcm8C,SACzCr8C,QAAQs8C,mBAAqBp8C,QAAQ,wBAAwBo8C,mBAC7Dt8C,QAAQ8uB,MAAQ5uB,QAAQ,WAAW4uB,MACnC9uB,QAAQuB,MAAQrB,QAAQ,WAAWqB;;AgBjBnC,GAAIq7C,SAOJA,OAAM9tB,MAAQ,SAAegwB,GAoD5B,IAAK,GApCDlV,GAmBAiT,EAEUt8B,EAA0Bm9B,EAAWqB,EAAWC,EAAYC,EAAcC,EAA6BC,EAe5G3B,EAlDLrzC,EAAI,EAYJgT,EAAQ,kBAGR8kB,EAAS,GAETwb,GACHnsB,UAAY,EACZ/mB,OAAS,EACT60C,QAAU,EACVC,oBAAoB,EACpBL,YAAc,EACdM,SAAW,EACXC,sBAAsB,GAGnBr/B,EAAa,GAAI08B,OAAMZ,cAGvBwD,EAAet/B,EAKQy9B,EAAS,GAEhC8B,EAAoB,2BAEpBC,EAAa,SAAS/+B,GACzB,GAAIg/B,GAAQb,EAAMvK,UAAU,EAAGpqC,GAAG6T,MAAM,MACpC4hC,EAAYD,EAAMj1C,OAClBm1C,EAAYF,EAAMnhC,MAAM9T,OAAS,EACjCc,EAAQ,GAAIkV,OAAMC,EAAU,UAAYi/B,EAAY,UAAYC,EAAY,IAIhF,MAHAr0C,GAAMs0C,KAAOF,EACbp0C,EAAAA,QAAaq0C,EACbr0C,EAAM0U,WAAaA,EACb1U,GAGagyC,EAAYsB,EAAMzX,OAAOl9B,GAAIA,IAEhD,OAAQqzC,GAER,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,KACL,IAAK,KACAC,EAAuBtgC,KAC1B8kB,GAAUub,EAEX,MAGD,KAAK,IACJ5T,EAAQz/B,EAAI,CACZ,GACCy/B,GAAQkV,EAAMh3C,QAAQ,IAAK8hC,GAAS,EAC/BA,GACJ8V,EAAW,qBAEiB,OAArBZ,EAAMlV,EAAQ,GAGvB,QAFA3H,GAAU6c,EAAMx1C,MAAMa,EAAGy/B,GACzBz/B,EAAIy/B,EAAQ,EACJzsB,GACP,IAAK,eACJA,EAAQ,OACR,MACD,KAAK,mBACJA,EAAQ,aAGV,KAED,KAAK,IACJysB,EAAQz/B,EAAI,CACZ,GACCy/B,GAAQkV,EAAMh3C,QAAQ,IAAK8hC,GAAS,EAC/BA,GACJ8V,EAAW,qBAEiB,OAArBZ,EAAMlV,EAAQ,GAGvB,QAFA3H,GAAU6c,EAAMx1C,MAAMa,EAAGy/B,GACzBz/B,EAAIy/B,EAAQ,EACJzsB,GACP,IAAK,eACJA,EAAQ,OACR,MACD,KAAK,mBACJA,EAAQ,aAGV,KAGD,KAAK,IACwB,MAAxB2hC,EAAMzX,OAAOl9B,EAAI,IACpBA,GAAK,EACLy/B,EAAQkV,EAAMh3C,QAAQ,KAAMqC,GACd,KAAVy/B,EACH8V,EAAW,cAEXv1C,EAAIy/B,EAAQ,GAGb3H,GAAUub,EAEG,qBAAVrgC,IACH8kB,GAAU,IACV9kB,EAAQ,aAET,MAGD,KAAK,IACJ,GAAI2hC,EAAMh3C,QAAQ,iBAAkBqC,KAAOA,EAAG,CAC7CgT,EAAQ,qBACRgiC,EAAe,GAAIvC,OAAMR,gBACzB+C,EAAaY,SAAW51C,EACxBA,GAAK,gBAAgBO,OACrBu3B,EAAS,EACT,OACM,GAAI6c,EAAMh3C,QAAQ,SAAUqC,KAAOA,EAAG,CAC5CgT,EAAQ,UACR4hC,EAAY,GAAInC,OAAMhB,aACtBmD,EAAUgB,SAAW51C,EACrBA,GAAK,QAAQO,OACbu3B,EAAS,EACT,OACM,GAAI6c,EAAMh3C,QAAQ,UAAWqC,KAAOA,EAAG,CAC7CgT,EAAQ,mBACRhT,GAAK,SAASO,OACdu3B,GAAU,SACV,OACM,GAAI6c,EAAMh3C,QAAQ,aAAcqC,KAAOA,EAAG,CAChDgT,EAAQ,qBACRhT,GAAK,YAAYO,OACjBu0C,EAAe,GAAIrC,OAAMd,gBACzBmD,EAAac,SAAW51C,EACxB83B,EAAS,EACT,OAEAwd,EAAkBO,UAAY71C,CAC9B,IAAI81C,GAAiBR,EAAkBhxB,KAAKqwB,EAC5C,IAAImB,GAAkBA,EAAerW,QAAUz/B,EAAG,CACjDgT,EAAQ,sBACR+hC,EAAgB,GAAItC,OAAMX,iBAC1BiD,EAAca,SAAW51C,EACzB+0C,EAAcZ,cAAgB2B,EAAe,GAC7C91C,GAAK81C,EAAe,GAAGv1C,OAAS,EAChCu3B,EAAS,EACT,OACmB,YAAT9kB,IACVA,EAAQ,UAGV8kB,GAAUub,CACV,MAED,KAAK,IACU,aAAVrgC,GAAkC,WAAVA,GAC3BugC,EAAUnzB,aAAe0X,EAAOjF,OAChC0gB,EAAU5qC,MAAMitC,SAAW51C,EAC3B83B,EAAS,GACT9kB,EAAQ,eACY,YAAVA,GACV4hC,EAAU1vB,MAAM6tB,UAAYjb,EAAOjF,OACnCwiB,EAAe3C,EAAakC,EAC5BA,EAAU31B,iBAAmBlJ,EAC7B+hB,EAAS,GACT9kB,EAAQ,mBACY,uBAAVA,GACN0/B,IACHoC,EAAapC,WAAaA,GAE3BoC,EAAa71B,iBAAmBlJ,EAChCw9B,EAAYuB,EACZhd,EAAS,GACT9kB,EAAQ,eACY,wBAAVA,GACV+hC,EAAc3+B,KAAO0hB,EAAOjF,OACxB6f,IACHqC,EAAcrC,WAAaA,GAE5BqC,EAAc91B,iBAAmBlJ,EACjCs/B,EAAe3C,EAAaqC,EAC5Bjd,EAAS,GACT9kB,EAAQ,sBACY,uBAAVA,GACVugC,EAAY,GAAId,OAAMV,gBACtBwB,EAAUa,QAAUtc,EAAOjF,OAC3B0gB,EAAUqC,SAAW51C,EACrB83B,EAAS,GACT9kB,EAAQ,eACY,uBAAVA,IAEVgiC,EAAaT,QAAQF,YAAcvc,EAAOjF,OACtC6f,IACHsC,EAAatC,WAAaA,GAE3B2C,EAAe3C,EAAasC,EAC5BA,EAAa/1B,iBAAmBlJ,EAChC+hB,EAAS,GACT9kB,EAAQ,kBAET,MAED,KAAK,IACU,SAAVA,GACHoD,EAAO0hB,EAAOjF,OACdiF,EAAS,GACT9kB,EAAQ,gBAER8kB,GAAUub,CAEX,MAED,KAAK,IACJ,GAAc,UAAVrgC,EAEH,GAAqB,cAAjB8kB,EAAOjF,OAAwB,CAClC,GAAIkjB,GAAO,GAAKtD,OAAMN,mBAAmBwC,EAAO30C,GAAI2kB,OAEhDoxB,GAAK10C,MACRk0C,EAAWQ,EAAK10C,QAEhBy2B,GAAUie,EAAKvT,WACfxiC,EAAI+1C,EAAKl1C,SAGV4+B,GAAQkV,EAAMh3C,QAAQ,IAAKqC,EAAI,GACjB,KAAVy/B,GACH8V,EAAW,iBAEZzd,GAAU6c,EAAMx1C,MAAMa,EAAGy/B,EAAQ,GACjCz/B,EAAIy/B,MAGL3H,IAAUub,CAGX,MAED,KAAK,IACU,UAAVrgC,GAAqB2hC,EAAMh3C,QAAQ,aAAcqC,KAAOA,GAC3DwzC,EAAW,YACXxzC,GAAK,YAAYO,QAEjBu3B,GAAUub,CAEX,MAED,KAAK,IACJ,OAAQrgC,GACP,IAAK,QACJugC,EAAU5qC,MAAMyjC,YAAYh2B,EAAM0hB,EAAOjF,OAAQ2gB,GACjDA,EAAW,GACX1b,EAAS,GACT9kB,EAAQ,aACR,MACD,KAAK,SACJ8kB,EAAS,GACT9kB,EAAQ,iBACR,MACD,KAAK,aACJ6hC,EAAa,GAAIpC,OAAMf,cACvBmD,EAAW51B,iBAAmB41B,EAAW9+B,WAAWkJ,iBAAmBlJ,EACvE8+B,EAAWn/B,QAAUoiB,EAASub,EAC9Bt9B,EAAWoJ,SAAS7nB,KAAKu9C,GACzB/c,EAAS,GACT9kB,EAAQ,iBACR,MACD,SACC8kB,GAAUub,EAGZ,KAED,KAAK,IACJ,OAAQrgC,GACP,IAAK,QACJugC,EAAU5qC,MAAMyjC,YAAYh2B,EAAM0hB,EAAOjF,OAAQ2gB,GACjDA,EAAW,EACZ,KAAK,cACL,IAAK,OACJD,EAAUyC,OAASh2C,EAAI,EACnB0yC,IACHa,EAAUb,WAAaA,GAExBa,EAAUt0B,iBAAmBlJ,EAC7Bs/B,EAAal2B,SAAS7nB,KAAKi8C,GAC3Bzb,EAAS,GAER9kB,EADGqiC,EAAard,cAAgBya,MAAMX,iBAC9B,qBAEA,iBAET,MACD,KAAK,qBACL,IAAK,kBACL,IAAK,WAECY,GACJ6C,EAAW,gBAEZF,EAAaW,OAASh2C,EAAI,EAE1B+V,EAAWoJ,SAAS7nB,KAAK+9C,GACzBA,EAAet/B,EACf28B,EAAa,KACb5a,EAAS,GACT9kB,EAAQ,kBAGV,KAED,SACC,OAAQA,GACP,IAAK,kBACJA,EAAQ,WACRugC,EAAY,GAAId,OAAMlB,aACtBgC,EAAUqC,SAAW51C,CACrB,MACD,KAAK,cACJgT,EAAQ,MACR,MACD,KAAK,eACJA,EAAQ,OACR,MACD,KAAK,mBACJA,EAAQ,aAGV8kB,GAAUub,EAKZ,MAAOt9B,IAKRlgB,QAAQ8uB,MAAQ8tB,MAAM9tB,MAEtB8tB,MAAMZ,cAAgB97C,QAAQ,mBAAmB87C,cACjDY,MAAMlB,aAAex7C,QAAQ,kBAAkBw7C,aAC/CkB,MAAMf,cAAgB37C,QAAQ,mBAAmB27C,cACjDe,MAAMhB,aAAe17C,QAAQ,kBAAkB07C,aAC/CgB,MAAMd,gBAAkB57C,QAAQ,qBAAqB47C,gBACrDc,MAAMnB,oBAAsBv7C,QAAQ,yBAAyBu7C,oBAC7DmB,MAAMV,gBAAkBh8C,QAAQ,qBAAqBg8C,gBACrDU,MAAMX,iBAAmB/7C,QAAQ,sBAAsB+7C,iBACvDW,MAAMN,mBAAqBp8C,QAAQ,wBAAwBo8C,mBAC3DM,MAAMR,gBAAkBl8C,QAAQ,qBAAqBk8C;;AjBtXrD,YAEA,IAAI/K,YAAanxC,QAAQ,gBAGrBg6C,kBAAoB,SAAU94C,GAC9B,GAAI+4C,GAAkB,iCAEtB,OAAO/4C,GAAIqO,QAAQ0qC,EAAiB,MAIxCn6C,SAAQo6C,cAAgB,SAAU7B,GAC9B,GACIqB,GADAS,EAAW,kBAGf,KAAKA,EAAS7vB,KAAK+tB,GACf,KAAM,IAAI73B,OAAM,cAIpB,OADAk5B,GAAYS,EAAS5rB,KAAK8pB,GAAQ,GAC3BlH,WAAWyH,cAAcoB,kBAAkBN,IAGtD,IAAIU,4BAA6B,SAAUC,GACvC,GAOIC,GAPAC,EAAsB,yCACtBC,EAAc,UAAiBD,EAAsB,gBACrDE,EAAiC,UAAYD,EAAc,KAC3DE,EAAyB,SAAWD,EAAiC,iBACzBA,EAAiC,WAE7EE,EAAgC,GAAInrC,QAAOirC,EAAgC,KAE3EG,KACAC,EAAY,SAAUC,GAClB,GAEIC,GAFAC,EAAa,GAAIxrC,QAAOgrC,EAAa,KACrCS,IAIJ,KADAF,EAAgBC,EAAWzsB,KAAKusB,GACzBC,GACHE,EAAiB15C,KAAKw5C,EAAc,IACpCA,EAAgBC,EAAWzsB,KAAKusB,EAEpC,OAAOG,GAGf,IAAIZ,EAA0B34B,MAAM,GAAIlS,QAAOkrC,IAA0B,CAErE,IADAJ,EAAqBK,EAA8BpsB,KAAK8rB,GACjDC,GACHM,EAAiBr5C,KAAKs5C,EAAUP,EAAmB,KACnDA,EAAqBK,EAA8BpsB,KAAK8rB,EAG5D,OAAOO,GAEX,UAGAM,+BAAiC,SAAUvrC,GAC3C,GAAI1F,GAAG/I,CAEP,KAAI+I,EAAI,EAAGA,EAAI0F,EAAOnF,OAAQP,IAC1B,IAEI,MADA/I,GAAMpB,QAAQo6C,cAAcvqC,EAAO1F,KAE/B/I,IAAKA,EACL4J,IAAKb,GAEX,MAAO5B,KAIjBvI,SAAQ8uB,MAAQ,SAAUgpB,GACtB,GAAIgD,GAAmBR,2BAA2BxC,EAElD,OAAOgD,GAAiBl5C,IAAI,SAAUy5C,GAClC,GAAIC,GAAWF,+BAA+BC,EAE9C,OAAIC,IAEIC,OAAQF,EAAsB/xC,MAAM,EAAGgyC,EAAStwC,KAChD5J,IAAKk6C,EAASl6C,IACdo6C,QAASH,EAAsB/xC,MAAMgyC,EAAStwC,IAAI,KAIlDuwC,OAAQF,MAMxBr7C,QAAQk4C,UAAY,SAAUd,GAC1B,GAAI0D,GAAmB1D,EAAiBx1C,IAAI,SAAU01C,GAClD,GAAIznC,MAAYqY,OAAOovB,EAAgBiE,OASvC,OAPIjE,GAAgBl2C,KAChByO,EAAOpO,KAAK,QAAU61C,EAAgBl2C,IAAM,MAE5Ck2C,EAAgBkE,UAChB3rC,EAASA,EAAOqY,OAAOovB,EAAgBkE,UAGpC3rC,EAAO5F,KAAK,MAGvB,OAAO6wC,GAAiB7wC,KAAK;;AD5GjC,YAEA,IAAI0vC,OAAQz5C,QAAQ,QAGpBF,SAAQ84C,cAAgB,SAAUc,GAC9B,GAAIC,GAAmB,WACnBC,EAAmB,UAEvB,OAAID,GAAiBrvB,KAAKovB,GACfA,EAAUnqC,QAAQoqC,EAAkB,MAEvCC,EAAiBtvB,KAAKovB,GACfA,EAAUnqC,QAAQqqC,EAAkB,MAEpCF,EAKnB,IAAIG,4BAA6B,SAAUnI,GACvC,GAEIiF,GAFAn3B,EAAM/Y,SAASksB,eAAeC,mBAAmB,IACjD9I,EAAerjB,SAASC,cAAc,QAQ1C,OALAojB,GAAa5V,YAAcw9B,EAE3BlyB,EAAIhO,KAAKN,YAAY4Y,GACrB6sB,EAAQ7sB,EAAapK,MAAM0J,SAEpBlgB,MAAMC,UAAUC,MAAMC,KAAKstC,IAGlCmD,kCAAqC,WAErC,GAAInD,GAAQkD,2BAA2B,uBACvC,QAAQlD,EAAMnsC,QAAUmsC,EAAM,GAAGh3B,QAAQ/X,QAAQ,UAAY,IAGjE9H,SAAQ8xC,gBAAkB,SAAUF,GAChC,MAAIoI,oCAAqCL,MAAM7qB,MACpC6qB,MAAM7qB,MAAM8iB,GAActoB,SAE1BywB,2BAA2BnI,IAI1C5xC,QAAQ6pB,eAAiB,SAAUP,GAC/B,MAAOA,GAASQ,OAAO,SAAUjK,EAASqJ,GACtC,MAAOrJ,GAAUqJ,EAAKrJ,SACvB,KAGP7f,QAAQw4C,aAAe,SAAUlvB,EAAUJ,EAAMC,GAC7C,GAAIE,GAAUC,EAASxhB,QAAQohB,GAC3BhJ,EAAagJ,EAAKE,gBAGtBlJ,GAAWqJ,WAAWJ,EAAaE,EAAQ,GAC3CnJ,EAAWsJ,WAAWH,GAEtBC,EAASD,GAAWnJ,EAAWoJ,SAASD,IAI5CrpB,QAAQs4C,sBAAwB,SAAUhvB,EAAUJ,EAAM+wB,GACtD,GAAI9wB,GAAc,6BAA+BD,EAAKpW,MAAM6jC,iBAAiB,eAAiB,IAE1FztB,GAAKpW,MAAM6jC,iBAAiB,gBAC5BxtB,GAAe,eAAiBD,EAAKpW,MAAM6jC,iBAAiB,cAAgB,MAG5EztB,EAAKpW,MAAM6jC,iBAAiB,iBAC5BxtB,GAAe,gBAAkBD,EAAKpW,MAAM6jC,iBAAiB,eAAiB,MAGlFxtB,GAAe,QAAU8wB,EAAS,IAClCj6C,QAAQw4C,aAAalvB,EAAUJ,EAAMC;;AL7EzC,YAEA,IAAIxoB,MAAOT,QAAQ,UACfgxC,YAAchxC,QAAQ,iBACtBixC,aAAejxC,QAAQ,kBACvBkxC,UAAYlxC,QAAQ,eACpBmxC,WAAanxC,QAAQ,gBAGrBoxC,eAAiB,SAAUlwC,GAC3B,MAAOT,MAAKsmB,QAAQ7lB,EAAK,MAGzBmwC,sBAAwB,SAAUxZ,GAGlC,GAAIzV,GAAIyV,EAAOn2B,IAAI,SAAUmO,EAAO/E,GAQhC,MANIA,KAAS+sB,EAAOrtB,OAAS,IACzBqF,GAEI7D,QAASolC,eAAevhC,EAAM7D,WAG/BslC,KAAKpK,UAAUr3B,IAE1B,OAAOuS,IAGPmvB,yBAA2B,SAAU1iC,EAAM+T,GAC3C,MAAKA,GAAQzX,SAAU,GAA2B,SAAlByX,EAAQzX,OAAqByX,EAAQ/W,YAC1DpL,KAAK+wC,QAAQ3iC,EAAMwiC,sBAAuBzuB,EAAQ/W,aAElDgD,GAMX4iC,8BAAgC,SAAUC,EAAcC,EAAsB/uB,GAC9E,GAAIwG,GAAW+nB,WAAWS,gBAAgBF,EAE1C,OAAOR,WAAUW,uBAAuBzoB,EAAUuoB,EAAsB/uB,GAAShhB,KAAK,SAAUkwC,GAC5F,MAAOZ,WAAUa,kCAAkC3oB,EAAUxG,GAAShhB,KAAK,SAAUowC,GACjF,GAAIhtC,GAAS8sC,EAAgB9sC,OAAOgjB,OAAOgqB,EAAmBhtC,QAC1D6pB,EAAaijB,EAAgBjjB,YAAcmjB,EAAmBnjB,UAMlE,OAJIA,KACA6iB,EAAeP,WAAWxnB,eAAeP,KAIzCyF,WAAYA,EACZziB,QAASslC,EACT1sC,OAAQA,QAMpBitC,yBAA2B,SAAUr/B,EAAOgQ,EAAS+uB,GACrD,GAAID,GAAe9+B,EAAMsB,YACrBg+B,EAAmBX,yBAAyBE,8BAA+B7uB,EAE/E,OAAOsvB,GAAiBR,EAAcC,EAAsB/uB,GAAShhB,KAAK,SAAU2C,GAKhF,MAJIA,GAAOsqB,aACPjc,EAAM68B,WAAW,GAAGM,UAAYxrC,EAAO6H,SAGpC3L,KAAK0xC,WAAW5tC,EAAOS,WAIlCotC,oBAAsB,SAAU5yB,GAChC,GAAI8P,GAAS9P,EAAIM,qBAAqB,QAEtC,OAAO5W,OAAMC,UAAU/F,OAAOiG,KAAKimB,EAAQ,SAAU1c,GACjD,OAAQA,EAAMigB,WAAW9S,MAA4C,aAApCnN,EAAMigB,WAAW9S,KAAKgwB,YAI/DjwC,SAAQuyC,oBAAsB,SAAU7yB,EAAKoD,GACzC,GAGIyU,GAHA/H,EAAS8iB,oBAAoB5yB,GAC7B8yB,KACAX,IAMJ,OAHAta,GAAgB52B,KAAKY,MAAMuhB,GAC3ByU,EAAcrrB,QAAUqrB,EAAcrrB,SAAWvL,KAAK8xC,mBAAmB/yB,GAElE/e,KAAKgB,IAAI6tB,EAAO5tB,IAAI,SAAUkR,GACjC,MAAOq/B,0BAAyBr/B,EAAOykB,EAAesa,GAAsB/vC,KAAK,SAAUoD,GACvFstC,EAAYA,EAAUtqB,OAAOhjB,QAEjCpD,KAAK,WACL,MAAO0wC,KAMf,IAAIE,+BAAgC,SAAUC,EAAaf,GACvD,GACIgB,GADAtZ,EAASqZ,EAAY5pB,UAGzB6oB,GAAeA,EAAa5U,OACxB4U,IACAgB,EAAYD,EAAY3pB,cAAcpiB,cAAc,SACpDgsC,EAAU3yB,KAAO,WACjB2yB,EAAUxhC,YAAYuhC,EAAY3pB,cAAc7I,eAAeyxB,IAE/DtY,EAAOrmB,aAAa2/B,EAAWD,IAGnCrZ,EAAOnmB,YAAYw/B,IAGnBE,oCAAsC,SAAUzxC,EAAK0hB,GACrD,MAAOniB,MAAKsH,KAAK7G,EAAK0hB,GACjBhhB,KAAK,SAAUwK,GACZ,GAAIgd,GAAW+nB,WAAWS,gBAAgBxlC,EAE1C,QACIA,QAASA,EACTgd,SAAUA,KAGjBxnB,KAAK,SAAU2C,GACZ,GAAIquC,GAA+B1B,UAAU2B,0BAA0B3xC,EAAKqD,EAAO6kB,SAEnF,QACIhd,QAAS7H,EAAO6H,QAChBgd,SAAU7kB,EAAO6kB,SACjByF,WAAY+jB,KAGnBhxC,KAAK,SAAU2C,GACZ,MAAO2sC,WAAUW,uBAAuBttC,EAAO6kB,YAAcxG,GACxDhhB,KAAK,SAAUkwC,GACZ,OACI1lC,QAAS7H,EAAO6H,QAChBgd,SAAU7kB,EAAO6kB,SACjByF,WAAYtqB,EAAOsqB,YAAcijB,EAAgBjjB,WACjD7pB,OAAQ8sC,EAAgB9sC,YAIvCpD,KAAK,SAAU2C,GACZ,MAAO2sC,WAAUa,kCAAkCxtC,EAAO6kB,SAAUxG,GAC/DhhB,KAAK,SAAUowC,GACZ,OACI5lC,QAAS7H,EAAO6H,QAChBgd,SAAU7kB,EAAO6kB,SACjByF,WAAYtqB,EAAOsqB,YAAcmjB,EAAmBnjB,WACpD7pB,OAAQT,EAAOS,OAAOgjB,OAAOgqB,EAAmBhtC,aAI/DpD,KAAK,SAAU2C,GACZ,GAAI6H,GAAU7H,EAAO6H,OAIrB,OAHI7H,GAAOsqB,aACPziB,EAAU+kC,WAAWxnB,eAAeplB,EAAO6kB,YAG3Chd,QAASA,EACTpH,OAAQT,EAAOS,WAK3B8tC,cAAgB,SAAU3yB,EAAMyC,GAChC,GAAImwB,GAAU5yB,EAAK0S,WAAWzV,KAAK2yB,UAC/BiD,EAAkBvyC,KAAK8xC,mBAAmBpyB,EAAK2I,eAC/CmqB,EAAcxyC,KAAKY,MAAMuhB,IAExBqwB,EAAYjnC,SAAWgnC,IACxBC,EAAYjnC,QAAUgnC,EAG1B,IAAIE,GAAoB3B,yBAAyBoB,oCAAqC/vB,EAEtF,OAAOswB,GAAkBH,EAASE,GAAarxC,KAAK,SAAU2C,GAC1D,OACI6H,QAAS7H,EAAO6H,QAChBpH,OAAQvE,KAAK0xC,WAAW5tC,EAAOS,YAKvCmuC,sBAAwB,SAAU3zB,GAClC,GAAI4zB,GAAQ5zB,EAAIM,qBAAqB,OAErC,OAAO5W,OAAMC,UAAU/F,OAAOiG,KAAK+pC,EAAO,SAAUjzB,GAChD,MAAOA,GAAK0S,WAAWzS,KAAyC,eAAlCD,EAAK0S,WAAWzS,IAAI2vB,aAC5C5vB,EAAK0S,WAAW9S,MAA2C,aAAnCI,EAAK0S,WAAW9S,KAAKgwB,aAI3DjwC,SAAQuzC,sBAAwB,SAAU7zB,EAAKoD,GAC3C,GAAIwwB,GAAQD,sBAAsB3zB,GAC9Bxa,IAEJ,OAAOvE,MAAKgB,IAAI2xC,EAAM1xC,IAAI,SAAUye,GAChC,MAAO2yB,eAAc3yB,EAAMyC,GAAShhB,KAAK,SAAS2C,GAC9CiuC,8BAA8BryB,EAAM5b,EAAO6H,QAAU,MAErDpH,EAASA,EAAOgjB,OAAOzjB,EAAOS,SAC/B,SAAUqD,GACTrD,EAAOzD,MACHgvB,aAAc,aACdrvB,IAAKmH,EAAEnH,IACPqK,IAAK,6BAA+BlD,EAAEnH,WAG9CU,KAAK,WACL,MAAOoD,MAMflF,QAAQwzC,oBAAsBtC,YAAYuC,OAC1CzzC,QAAQ0zC,oBAAsBvC,aAAasC,OAE3CzzC,QAAQy3B,iBAAmB,SAAU/X,EAAKoD,GACtC,GAAI0vB,MACAmB,GACI3zC,QAAQwzC,oBACRxzC,QAAQuyC,oBACRvyC,QAAQuzC,sBAMhB,OAJIzwB,GAAQ0U,iBAAkB,GAC1Bmc,EAAYlyC,KAAKzB,QAAQ0zC,qBAGtB/yC,KAAKgB,IAAIgyC,EAAY/xC,IAAI,SAAUmN,GACtC,MAAOA,GAAK2Q,EAAKoD,GACZhhB,KAAK,SAAUoD,GACZstC,EAAYA,EAAUtqB,OAAOhjB,QAErCpD,KAAK,WACL,MAAO0wC;;AIjPf,YAEA,IAAIryC,YAAaD,QAAQ,cACrBS,KAAOT,QAAQ,UACfmxC,WAAanxC,QAAQ,gBACrBi2C,sBAAwBj2C,QAAQ,2BAChCk2C,uBAAyBl2C,QAAQ,qBAGjCm2C,uBAAyB,SAAUntB,EAAMotB,EAAU/rC,GACnD2e,EAAKpW,MAAMyjC,YAAYD,EAAU/rC,EAAO2e,EAAKpW,MAAM0jC,oBAAoBF,KAGvEG,yBAA2B,SAAUntB,GACrC,MAAOA,GAAShmB,OAAO,SAAU4lB,GAC7B,MAAOA,GAAKjJ,OAASvZ,OAAO+oB,QAAQinB,aAAextB,EAAKpW,MAAM6jC,iBAAiB,qBAAuBztB,EAAKpW,MAAM6jC,iBAAiB,kBAItIC,2BAA6B,SAAUC,GACvC,GAAIC,KAkBJ,OAhBAD,GAAMjtC,QAAQ,SAAUsf,GAChBA,EAAKpW,MAAM6jC,iBAAiB,oBAC5BG,EAAuBr1C,MACnB60C,SAAU,mBACV/rC,MAAO2e,EAAKpW,MAAM6jC,iBAAiB,oBACnCztB,KAAMA,IAEHA,EAAKpW,MAAM6jC,iBAAiB,eACnCG,EAAuBr1C,MACnB60C,SAAU,aACV/rC,MAAO2e,EAAKpW,MAAM6jC,iBAAiB,cACnCztB,KAAMA,MAKX4tB,GAGPC,kBAAoB,SAAUztB,GAC9B,MAAOA,GAAShmB,OAAO,SAAU4lB,GAC7B,MAAOA,GAAKjJ,OAASvZ,OAAO+oB,QAAQunB,gBAAkB9tB,EAAKpW,MAAM6jC,iBAAiB,UAItFM,mBAAqB,SAAU3tB,GAC/B,MAAOA,GAAShmB,OAAO,SAAU4lB,GAC7B,MAAOA,GAAKjJ,OAASvZ,OAAO+oB,QAAQynB,aAAehuB,EAAK5L,QAI5D65B,2BAA6B,SAAUC,GACvC,GAAIC,KAQJ,OANAD,GAAiBxtC,QAAQ,SAAU0tC,EAAiBntC,GAC5CmtC,EAAgBl2C,MAAQT,KAAKmzC,UAAUwD,EAAgBl2C,MACvDi2C,EAAa51C,KAAK0I,KAInBktC,GAGPE,yBAA2B,SAAUC,GACrC,GAAIC,KAMJ,OALAD,GAAsB5tC,QAAQ,SAAU8tC,EAAYvtC,GAC5CutC,EAAWt2C,MAAQT,KAAKmzC,UAAU4D,EAAWt2C,MAC7Cq2C,EAAch2C,KAAK0I,KAGpBstC,EAGXz3C,SAAQ+yC,0BAA4B,SAAU7mC,EAASod,GACnD,GAAIquB,GAAkBlB,yBAAyBntB,GAC3CwtB,EAAyBF,2BAA2Be,GACpDC,GAAS,CAsDb,OApDAd,GAAuBltC,QAAQ,SAAUiuC,GACrC,GAEIC,GAFAV,EAAmBjB,sBAAsBrnB,MAAM+oB,EAAYttC,OAC3DwtC,EAA4BZ,2BAA2BC,EAGvDW,GAA0BrtC,OAAS,IACnCqtC,EAA0BnuC,QAAQ,SAAUouC,GACxC,GAAIC,GAAcb,EAAiBY,GAAsB52C,IACrDA,EAAMT,KAAKsmB,QAAQ/a,EAAS+rC,EAChCb,GAAiBY,GAAsB52C,IAAMA,IAGjD02C,EAAkB3B,sBAAsB+B,UAAUd,GAElDf,uBAAuBwB,EAAY3uB,KAAM2uB,EAAYvB,SAAUwB,GAE/DF,GAAS,KAGjBb,kBAAkBztB,GAAU1f,QAAQ,SAAUsf,GAC1C,GACIsuB,GAAuBW,EADvBC,EAAyBlvB,EAAKpW,MAAM6jC,iBAAiB,MAGzD,KACIa,EAAwBpB,uBAAuBtnB,MAAMspB,GACvD,MAAO7vC,GACL,OAEJ4vC,EAA6BZ,yBAAyBC,GAElDW,EAA2BztC,OAAS,IACpCytC,EAA2BvuC,QAAQ,SAAUyuC,GACzC,GAAIJ,GAAcT,EAAsBa,GAAkBj3C,IACtDA,EAAMT,KAAKsmB,QAAQ/a,EAAS+rC,EAEhCT,GAAsBa,GAAkBj3C,IAAMA,IAGlDiwC,WAAWiH,sBAAsBhvB,EAAUJ,EAAMktB,uBAAuB8B,UAAUV,IAElFI,GAAS,KAGjBX,mBAAmB3tB,GAAU1f,QAAQ,SAAUsf,GAC3C,GAAIqvB,GAASrvB,EAAK5L,KACdlc,EAAMT,KAAKsmB,QAAQ/a,EAASqsC,EAEhClH,YAAWmH,aAAalvB,EAAUJ,EAAM,eAAiB9nB,EAAM,MAE/Dw2C,GAAS,IAGNA,EAKX,IAAIa,gBAAiB,SAAUnvB,EAAUJ,EAAMwvB,GAC3C,GAAI3lC,GAAWuW,EAASxhB,QAAQohB,EAEhCI,GAAS2e,OAAOl1B,EAAU,GAE1B2lC,EAAY9uC,QAAQ,SAAUggB,EAASzf,GACnCmf,EAAS2e,OAAOl1B,EAAW5I,EAAG,EAAGyf,MAIrC+uB,iBAAmB,SAAUpuC,GAC7B,GAAInD,GAAQjH,WAAWiH,OAEvB,OADAA,GAAMG,QAAQgD,GACPnD,EAAMO,SAGbixC,uBAAyB,SAAUtvB,EAAUJ,EAAM2oB,EAAsB/uB,GACzE,GACI+1B,GADAz3C,EAAM8nB,EAAK5L,IAOf,OAJAlc,GAAMiwC,WAAWyH,cAAc13C,GAE/By3C,EAAuBl4C,KAAKsmB,QAAQnE,EAAQ5W,QAAS9K,GAEjDywC,EAAqB/pC,QAAQ+wC,IAAyB,GAEtDJ,eAAenvB,EAAUJ,MAClByvB,uBAEP9G,EAAqBpwC,KAAKo3C,GAGvBl4C,KAAKsH,KAAK7G,EAAK0hB,GACjBhhB,KAAK,SAAU+d,GACZ,GAAIk5B,GAAmB1H,WAAWS,gBAAgBjyB,EAGlD,OAAO7f,SAAQ+xC,uBAAuBgH,EAAkBlH,EAAsB/uB,GACzEhhB,KAAK,SAAU2C,GAKZ,MAJAzE,SAAQ+yC,0BAA0B3xC,EAAK23C,GAEvCN,eAAenvB,EAAUJ,EAAM6vB,GAExBt0C,EAAOS,UAEvB,SAAUqD,GACT,MACIkoB,aAAc,aACdrvB,IAAKmH,EAAEnH,IACPqK,IAAK,6BAA+BlD,EAAEnH,QAKtDpB,SAAQ+xC,uBAAyB,SAAUzoB,EAAUuoB,EAAsB/uB,GACvE,GAAIk2B,GAAgB/B,mBAAmB3tB,GACnCpkB,KACA6pB,GAAa,CAEjB,OAAOpuB,MAAKgB,IAAIq3C,EAAcp3C,IAAI,SAAUsnB,GACxC,MAAO0vB,wBAAuBtvB,EAAUJ,EAAM2oB,EAAsB/uB,GAAShhB,KAAK,SAAUm3C,GACxF/zC,EAASA,EAAOgjB,OAAO+wB,GAEvBlqB,GAAa,GACd,SAAUxmB,GACTrD,EAAOzD,KAAK8G,QAEhBzG,KAAK,WACL,OACIitB,WAAYA,EACZ7pB,OAAQA,KAOpB,IAAIg0C,+BAAgC,SAAUpB,EAAiBh1B,GAC3D,GAAIs0B,GAAmBjB,sBAAsBrnB,MAAMgpB,GAC/CqB,EAAiChC,2BAA2BC,GAC5DroB,GAAa,CAEjB,OAAOpuB,MAAKszC,uBAAuBkF,EAA+Bv3C,IAAI,SAAUo2C,GAC5E,GAAI52C,GAAMg2C,EAAiBY,GAAsB52C,GAEjD,OAAOT,MAAK6zC,sBAAsBpzC,EAAK0hB,GAClChhB,KAAK,SAAU8zC,GACZwB,EAAiBY,GAAsB52C,IAAMw0C,EAE7C7mB,GAAa,GACd,SAAUxmB,GACT,MACIkoB,aAAc,kBACdrvB,IAAKmH,EAAEnH,IACPqK,IAAK,mCAAqClD,EAAEnH,UAGxDU,KAAK,SAAUoD,GACf,OACI4yC,gBAAiB3B,sBAAsB+B,UAAUd,GACjDroB,WAAYA,EACZ7pB,OAAQA,MAKhBk0C,0CAA4C,SAAU9vB,EAAUxG,GAChE,GAAIk2B,GAAgBvC,yBAAyBntB,GACzCwtB,EAAyBF,2BAA2BoC,GACpD9zC,KACAm0C,GAAgB,CAEpB,OAAO14C,MAAKgB,IAAIm1C,EAAuBl1C,IAAI,SAAUi2C,GACjD,MAAOqB,+BAA8BrB,EAAYttC,MAAOuY,GACnDhhB,KAAK,SAAU2C,GACRA,EAAOsqB,aACPsnB,uBAAuBwB,EAAY3uB,KAAM2uB,EAAYvB,SAAU7xC,EAAOqzC,iBAEtEuB,GAAgB,GAGpBn0C,EAASA,EAAOgjB,OAAOzjB,EAAOS,aAEtCpD,KAAK,WACL,OACIitB,WAAYsqB,EACZn0C,OAAQA,MAKhBo0C,sBAAwB,SAAUC,EAAqBz2B,GACvD,GACI00B,GAAuBW,EADvBppB,GAAa,CAGjB,KACIyoB,EAAwBpB,uBAAuBtnB,MAAMyqB,GACvD,MAAOhxC,GACLivC,KAIJ,MAFAW,GAA6BZ,yBAAyBC,GAE/C72C,KAAKszC,uBAAuBkE,EAA2Bv2C,IAAI,SAAU43C,GACxE,GAAIC,GAAUjC,EAAsBgC,GAChClW,EAASmW,EAAQnW,QAAU,MAE/B,OAAO3iC,MAAKyzC,WAAWqF,EAAQr4C,IAAK0hB,GAC/BhhB,KAAK,SAAUwK,GACZ,GAAImoC,GAAgBC,KAAKpoC,EACzBmtC,GAAQr4C,IAAM,aAAekiC,EAAS,WAAamR,EAEnD1lB,GAAa,GACd,SAAUxmB,GACT,MACIkoB,aAAc,WACdrvB,IAAKmH,EAAEnH,IACPqK,IAAK,4BAA8BlD,EAAEnH,UAGjDU,KAAK,SAAUoD,GACf,OACIq0C,oBAAqBnD,uBAAuB8B,UAAUV,GACtDzoB,WAAYA,EACZ7pB,OAAQA,MAKhBw0C,kCAAoC,SAAUpwB,EAAUxG,GACxD,GAAIk2B,GAAgBjC,kBAAkBztB,GAClCpkB,KACA6pB,GAAa,CAEjB,OAAOpuB,MAAKgB,IAAIq3C,EAAcp3C,IAAI,SAAUsnB,GACxC,GAAIqwB,GAAsBrwB,EAAKpW,MAAM6jC,iBAAiB,MAEtD,OAAO2C,uBAAsBC,EAAqBz2B,GAAShhB,KAAK,SAAU2C,GAClEA,EAAOsqB,aACPsiB,WAAWiH,sBAAsBhvB,EAAUJ,EAAMzkB,EAAO80C,qBAExDxqB,GAAa,GAGjB7pB,EAASA,EAAOgjB,OAAOzjB,EAAOS,aAElCpD,KAAK,WACL,OACIitB,WAAYA,EACZ7pB,OAAQA,KAKpBlF,SAAQiyC,kCAAoC,SAAU3oB,EAAUxG,GAC5D,GAAIiM,IAAa,EACb7pB,IAEJ,OAAOvE,MAAKgB,KAAKy3C,0CAA2CM,mCAAmC93C,IAAI,SAAUmN,GACzG,MAAOA,GAAKua,EAAUxG,GACjBhhB,KAAK,SAAU2C,GACZsqB,EAAaA,GAActqB,EAAOsqB,WAClC7pB,EAASA,EAAOgjB,OAAOzjB,EAAOS,aAEtCpD,KAAK,WACL,OACIitB,WAAYA,EACZ7pB,OAAQA;;ADvVpB,YAEA,IAAIvE,MAAOT,QAAQ,UAGfy1C,qBAAuB,SAAU1zC,EAAO6gB,GACxC,GAAI1hB,GAAMa,EAAM8wB,WAAWrrB,IAAMzF,EAAM8wB,WAAWrrB,IAAIuoC,UAAY,KAC9DkF,EAAex0C,KAAK8xC,mBAAmBxwC,EAAM+mB,eAC7CmqB,EAAcxyC,KAAKY,MAAMuhB,EAM7B,QAJKqwB,EAAYjnC,SAAWipC,IACxBhC,EAAYjnC,QAAUipC,GAGnBx0C,KAAK6zC,sBAAsBpzC,EAAK+xC,GAClCrxC,KAAK,SAAU8zC,GACZ,MAAOA,IACR,SAAUrtC,GACT,MACIkoB,aAAc,QACdrvB,IAAKmH,EAAEnH,IACPqK,IAAK,wBAA0BlD,EAAEnH,QAK7Cy0C,qBAAuB,SAAUC,GACjC,MAAOA,GAAOxyC,OAAO,SAAUrB,GAC3B,GAAIb,GAAMa,EAAM8wB,WAAWrrB,IAAMzF,EAAM8wB,WAAWrrB,IAAIuoC,UAAY,IAElE,OAAe,QAAR7uC,IAAiBT,KAAKmzC,UAAU1yC,MAI3C20C,yBAA2B,SAAUvpB,GACrC,MAAOpjB,OAAMC,UAAU/F,OAAOiG,KAAKijB,EAAQ,SAAUG,GACjD,MAAsB,UAAfA,EAAM1M,QAIjB+1B,QAAU,SAAUntB,GACpB,MAAOzf,OAAMC,UAAUC,MAAMC,KAAKsf,GAGtC7oB,SAAQyzC,OAAS,SAAU/zB,EAAKoD,GAC5B,GAAIgzB,GAASE,QAAQt2B,EAAIM,qBAAqB,QAC1Ci2B,EAAcF,yBAAyBr2B,EAAIM,qBAAqB,UAChEk2B,EAAiBL,qBAAqBC,EAAO5tB,OAAO+tB,GAExD,OAAOt1C,MAAKszC,uBAAuBiC,EAAet0C,IAAI,SAAUK,GAC5D,MAAO0zC,sBAAqB1zC,EAAO6gB,GAAShhB,KAAK,SAAU8zC,GACvD3zC,EAAM8wB,WAAWrrB,IAAIuoC,UAAY2F;;ADnD7C,YAEA,IAAIj1C,MAAOT,QAAQ,UAGf+0C,iBAAmB,SAAUC,EAAQpyB,GACrC,GAAIpb,GAAMwtC,EAAOniB,WAAWrrB,IAAIuoC,UAC5BkF,EAAex0C,KAAK8xC,mBAAmByC,EAAOlsB,eAC9CmqB,EAAcxyC,KAAKY,MAAMuhB,EAM7B,QAJKqwB,EAAYjnC,SAAWipC,IACxBhC,EAAYjnC,QAAUipC,GAGnBx0C,KAAKsH,KAAKP,EAAKyrC,GACjBzsB,KAAK,SAAUne,GACZ,MACIkoB,aAAc,SACdrvB,IAAKmH,EAAEnH,IACPqK,IAAK,yBAA2BlD,EAAEnH,QAK9Cg0C,kBAAoB,SAAUpF,GAE9B,MAAOA,GAAKvgC,QAAQ,OAAQ,SAG5B4lC,mCAAqC,SAAUC,EAAYC,GAC3DD,EAAWviB,WAAWyiB,gBAAgB,OACtCF,EAAWlhC,YAAcghC,kBAAkBG,IAG3CE,WAAa,SAAU/1B,GACvB,GAAIg2B,GAAUh2B,EAAIM,qBAAqB,SAEvC,OAAO5W,OAAMC,UAAU/F,OAAOiG,KAAKmsC,EAAS,SAAUR,GAClD,QAASA,EAAOniB,WAAWrrB,MAInC1H,SAAQyzC,OAAS,SAAU/zB,EAAKoD,GAC5B,GAAI4yB,GAAUD,WAAW/1B,EAEzB,OAAO/e,MAAKszC,uBAAuByB,EAAQ9zC,IAAI,SAAUszC,GACrD,MAAOD,kBAAiBC,EAAQpyB,GAAShhB,KAAK,SAAUyzC,GACpDF,mCAAmCH,EAAQK;;AD/CvD,YAEA,IAAIn0C,KAAMlB,QAAQ,OACdC,WAAaD,QAAQ,aAGzBF,SAAQyyC,mBAAqB,SAAU/yB,GACnC,MAAoB,gBAAhBA,EAAIk0B,QACGl0B,EAAIk0B,QAGR,MAGX5zC,QAAQuB,MAAQ,SAAU2I,GACtB,GACIC,GADAC,IAEJ,KAAKD,IAAKD,GACFA,EAAOG,eAAeF,KACvBC,EAASD,GAAKD,EAAOC,GAG5B,OAAOC,IAGXpK,QAAQqyC,WAAa,SAAUwB,GAC3B,MAAOzqC,OAAMC,UAAUC,MAAM0V,MAAM60B,GAAW,KAGlD7zC,QAAQinB,QAAU,SAAU/a,EAASgb,GACjC,MAAKhb,GAGE9K,IAAImG,QAAQ2E,EAASgb,GAFjBA,GAKflnB,QAAQ8zC,UAAY,SAAU1yC,GAC1B,MAAO,SAAWopB,KAAKppB,IAG3BpB,QAAQ2B,IAAM,SAAUoyC,GACpB,GAAI3sC,GAAQjH,WAAWiH,QACnB4sC,EAAsBD,EAASrpC,OAC/BI,IAEJ,OAAwB,KAApBipC,EAASrpC,QACTtD,EAAMG,YACCH,EAAMO,UAGjBosC,EAASnqC,QAAQ,SAAUjC,EAASqD,GAChCrD,EAAQ7F,KAAK,SAAUyI,GACnBypC,GAAuB,EACvBlpC,EAAeE,GAAOT,EAEM,IAAxBypC,GACA5sC,EAAMG,QAAQuD,IAEnB,SAAUvC,GACTnB,EAAMK,OAAOc,OAGdnB,EAAMO,UAGjB3H,QAAQi0C,uBAAyB,SAAUF,GACvC,GAAI7uC,KAEJ,OAAOlF,SAAQ2B,IAAIoyC,EAASnyC,IAAI,SAAU+F,GACtC,MAAOA,GAAQ+e,KAAK,SAAUne,GAC1BrD,EAAOzD,KAAK8G,QAEhBzG,KAAK,WACL,MAAOoD,KAIf,IAAI0uB,eAAgB,KAEhBhsB,iBAAmB,SAAUxG,EAAKiK,GAClC,MAAIA,MAAU,GAAmB,SAAVA,GAA8B,aAAVA,IACjB,OAAlBuoB,eAAoC,aAAVvoB,KAC1BuoB,cAAgB7rB,KAAKC,OAElB5G,EAAM,MAAQwyB,eAEdxyB,EAIfpB,SAAQiI,KAAO,SAAU7G,EAAK0hB,GAC1B,GAGIiR,GAHAD,EAAc,GAAIptB,QAAOyB,eACzBf,EAAQjH,WAAWiH,QACnB6gB,EAAYjoB,QAAQinB,QAAQnE,EAAQ5W,QAAS9K,GAG7C+kB,EAAW,WACX/e,EAAMK,QACFgE,IAAK,qBACLrK,IAAK6mB,IAIb8L,GAAensB,iBAAiBqgB,EAAWnF,EAAQzX,OAEnDyoB,EAAYnhB,iBAAiB,OAAQ,WACN,MAAvBmhB,EAAYpvB,QAAyC,IAAvBovB,EAAYpvB,OAC1C0C,EAAMG,QAAQusB,EAAY1rB,UAE1B+d,MAEL,GAEH2N,EAAYnhB,iBAAiB,QAASwT,GAAU,EAEhD,KACI2N,EAAYzrB,KAAK,MAAO0rB,GAAc,GACtCD,EAAYogB,iBAAiBpxB,EAAQqxB,UACrCrgB,EAAYxrB,KAAK,MACnB,MAAOC,GACL4d,IAGJ,MAAO/e,GAAMO,SAGjB3H,QAAQo0C,WAAa,SAAUhzC,EAAK0hB,GAChC,GAAIqwB,GAAcnzC,QAAQuB,MAAMuhB,EAIhC,OAFAqwB,GAAYgB,SAAW,qCAEhBn0C,QAAQiI,KAAK7G,EAAK+xC,GACpBrxC,KAAK,SAAUwK,GAGZ,IAAK,GAFD+nC,GAAgB,GAEXlqC,EAAI,EAAGA,EAAImC,EAAQ5B,OAAQP,IAChCkqC,GAAiB9Y,OAAOC,aAAqC,IAAxBlvB,EAAQgxB,WAAWnzB,GAG5D,OAAOkqC,KAInB,IAAIC,gBAAiB,SAAUhoC,GAC3B,GAAI2S,GAAa,SAAU0a,EAAQ4a,GAC/B,MAAO5a,GAAO4a,UAAU,EAAGA,EAAU7pC,UAAY6pC,EAGrD,OAAIt1B,GAAW3S,EAAS,UAAY2S,EAAW3S,EAAS,QAC7C,gBAEJ,YAGXtM,SAAQw0C,sBAAwB,SAAUpzC,EAAK0hB,GAC3C,MAAO9iB,SAAQo0C,WAAWhzC,EAAK0hB,GAC1BhhB,KAAK,SAAUwK,GACZ,GAAImoC,GAAgBC,KAAKpoC,GACrB6nC,EAAWG,eAAehoC,EAE9B,OAAO,QAAU6nC,EAAW,WAAaM,IAIrD,IAAIztB,iBAEA2tB,oBAAsB,SAAUrjC,GAKhC,MAHI0V,cAAalf,QAAQwJ,GAAW,GAChC0V,aAAavlB,KAAK6P,GAEf0V,aAAalf,QAAQwJ,GAGhCtR,SAAQ0xC,QAAU,SAAU3iC,EAAM6lC,EAAQC,GACtC,GAAoB,gBAATA,GACP,KAAM,IAAIn0B,OAAM,+BAGpB,OAAO,YACH,GAIIo0B,GAJAxtB,EAAOle,MAAMC,UAAUC,MAAMC,KAAKC,WAElCurC,EAAeH,EAAOttB,GACtB0tB,EAAWL,oBAAoB5lC,EAGnC,OAAI8lC,GAAKG,IAAaH,EAAKG,GAAUD,GAC1BF,EAAKG,GAAUD,IAEtBD,EAAW/lC,EAAKiQ,MAAM,KAAMsI,GAE5ButB,EAAKG,GAAYH,EAAKG,OACtBH,EAAKG,GAAUD,GAAgBD,EAExBA;;Cd/LlB,SAAUr1C,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IAEzCD,QAAQ,MAAM,gBAAgB,gBAAgB,aAAa,mBAAoB,SAAUE,EAAGC,EAAGC,EAAG4mB,EAAGC,GACnG,MAAQnnB,GAAoB,cAAIC,EAAQG,EAAGC,EAAGC,EAAG4mB,EAAGC,KAE1B,gBAAZ5mB,SAIhBC,OAAOD,QAAUN,EAAQQ,QAAQ,OAAOA,QAAQ,kBAAkBA,QAAQ,iBAAiBA,QAAQ,cAAcA,QAAQ,oBAEzHT,EAAoB,cAAIC,EAAQ0B,IAAIylB,cAAcC,cAAc3mB,WAAW4mB,kBAE7EzmB,KAAM,SAAUc,EAAKylB,EAAeC,EAAe3mB,EAAY4mB,GAEjE,GAAIpmB,GAAQ,SAAUS,GAClB,YAEA,IAAInB,MAEA+mB,IAEJ/mB,GAAOgnB,QAAU,SAAU/a,EAASgb,GAChC,MAAKhb,GAGE9K,EAAImG,QAAQ2E,EAASgb,GAFjBA,GAKfjnB,EAAOknB,uBAAyB,SAAU7V,GAKtC,MAHI0V,GAAalf,QAAQwJ,GAAW,GAChC0V,EAAavlB,KAAK6P,GAEf0V,EAAalf,QAAQwJ,IAGhCrR,EAAOsB,MAAQ,SAAU2I,GACrB,GACIC,GADAC,IAEJ,KAAKD,IAAKD,GACFA,EAAOG,eAAeF,KACtBC,EAASD,GAAKD,EAAOC,GAG7B,OAAOC,GAGX,IAAIgd,GAAW,SAAUnC,GACrB,MAAsB,gBAARA,IAA4B,OAARA,GAGlC7D,EAAW,SAAU6D,GACrB,MAAOmC,GAASnC,IACZvb,OAAOL,UAAUmG,SAASwP,MAAMiG,GAAKrD,MAAM,0CAqBnD,OAjBA3hB,GAAOonB,wBAA0B,SAAUC,GACvC,GAAIzb,IACApF,OAAQ,KACRqc,WAWJ,OARe,OAAXwE,EAAK,IAAclG,EAASkG,EAAK,KACjCzb,EAAWpF,OAAS6gB,EAAK,IAAM,KAE/Bzb,EAAWiX,QAAU7iB,EAAOsB,MAAM+lB,EAAK,KAEvCzb,EAAWiX,QAAU7iB,EAAOsB,MAAM+lB,EAAK,IAGpCzb,GAGJ5L,GACTmB,GAGEmmB,EAAW,SAAU5mB,EAAMR,GAC3B,YAEA,IAAIF,MAEAunB,EAA4B,SAAUtd,EAAQud,EAAYC,GAC1D,GAAIC,GAAezd,EAAOud,EAQ1B,OANAvd,GAAOud,GAAc,WACjB,GAAIH,GAAOle,MAAMC,UAAUC,MAAMC,KAAKC,UAEtC,OAAOke,GAAU1I,MAAM1e,MAAOgnB,EAAMK,KAGjCA,EA+DX,OA3DA1nB,GAAO2nB,qBAAuB,SAAUC,EAAW3b,GAC/C,GAAI4b,GAAiB,WACjB,GAAI5f,GAAM,GAAI2f,EAUd,OARAL,GAA0Btf,EAAK,OAAQ,SAAUof,EAAMS,GACnD,GAAIC,GAASV,EAAKrY,QACd7N,EAAMkmB,EAAKrY,QACXgZ,EAAYtnB,EAAKsmB,QAAQ/a,EAAS9K,EAEtC,OAAO2mB,GAAa/I,MAAM1e,MAAO0nB,EAAQC,GAAWC,OAAOZ,MAGxDpf,EAGX,OAAO4f,IAIX7nB,EAAOkoB,mBAAqB,SAAUN,GAClC,GAAIO,GAAgB,EAChBC,EAAe,EACfC,GAA2B,EAC3BlhB,EAAQjH,EAAWiH,QAEnBmhB,EAA2B,WAC3B,GAAIC,GAAkBJ,EAAgBC,CAEf,IAAnBG,GAAwBF,GACxBlhB,EAAMG,SAAS+L,WAAY8U,KAI/BN,EAAiB,WACjB,GAAI5f,GAAM,GAAI2f,EAad,OAXAL,GAA0Btf,EAAK,OAAQ,SAAU4H,EAAG2Y,GAEhD,MADAL,IAAiB,EACVK,EAAazJ,MAAM1e,KAAMkJ,aAGpCtB,EAAIyK,iBAAiB,OAAQ,WACzB0V,GAAgB,EAEhBE,MAGGrgB,EASX,OANA4f,GAAeY,wBAA0B,WAGrC,MAFAJ,IAA2B,EAC3BC,IACOnhB,EAAMO,SAGVmgB,GAGJ7nB,GACTU,EAAMR,GAEJwoB,EAAgB,WAChB,YAEA,IAAI1oB,MAEA2oB,EAAU,SAAUC,GACpB,MAAOzf,OAAMC,UAAUC,MAAMC,KAAKsf,GAGtC5oB,GAAO6oB,wBAA0B,SAAUxX,EAASkG,GAChDlG,EAAQkG,WAAa,IAAMA,EAEvBlG,EAAQyX,aAAezX,EAAQ0X,eAC/B/oB,EAAO6oB,wBAAwBxX,EAAQyX,WAAYvR,GAI3D,IAAIyR,GAAgB,SAAUC,EAAMC,GAChC,GAAIjJ,GAAagJ,EAAKE,iBAClBC,EAAUT,EAAQ1I,EAAWoJ,UAAUxhB,QAAQohB,EAGnDhJ,GAAWqJ,WAAWJ,EAAaE,EAAQ,GAC3CnJ,EAAWsJ,WAAWH,IAGtBI,EAAqB,SAAUP,EAAMQ,GACrC,GAAIC,GAAmBT,EAAKrJ,QAAQpQ,QAAQ,UAAW,IACnDma,EAAUF,EAAkB,IAAMC,CAEtCV,GAAcC,EAAMU,IAGpBC,EAAiB,SAAUP,GAC3B,MAAOV,GAAQU,GAAUQ,OAAO,SAAUjK,EAASqJ,GAC/C,MAAOrJ,GAAUqJ,EAAKrJ,SACvB,KAGHkK,EAAsB,SAAUC,GAChCA,EAAa5V,YAAcyV,EAAeG,EAAapK,MAAM0J,WAG7DW,EAA+B,SAAUC,GACzC,MAAO,6BAMHA,EAAmBjgB,KAAK,KACxB,cAIJkgB,EAA2B,SAAUzK,EAAKwK,EAAoBE,GAC9D,GAAIC,GAAgBJ,EAA6BC,EAEjDtB,GAAQlJ,EAAIjD,iBAAiB,UAAU7S,QAAQ,SAAUogB,GACrD,GAAIM,GAAgB1B,EAAQoB,EAAapK,MAAM0J,UAAUhmB,OAAO,SAAU4lB,GACtE,MAAOA,GAAKqB,cAAgB,GAAI7a,QAAO2a,EAAe,KAAKG,KAAKtB,EAAKqB,eAGrED,GAAc5f,SACd4f,EAAc1gB,QAAQ,SAAUsf,GAC5B,GAAIuB,GAAcvB,EAAKqB,aAAa9a,QAAQ,GAAIC,QAAO2a,EAAe,MAC7B,SAAUva,EAAG4a,EAAaC,GAC/D,MAAOD,GAAcN,EAA2BO,IAGhDF,KAAgBvB,EAAKqB,cACrBd,EAAmBP,EAAMuB,KAIjCV,EAAoBC,MAqChC,OAhCA/pB,GAAO2qB,uBAAyB,SAAUlL,EAAKmL,EAAaJ,GACxDN,EAAyBzK,GAAMmL,GAAc,WACzC,MAAOJ,MAIfxqB,EAAO6qB,0BAA4B,SAAUpL,EAAKqL,GAC9CZ,EAAyBzK,EAAKqL,EAAkB,SAAUnJ,GACtD,MAAOA,GAAMoJ,iBAIrB/qB,EAAOgrB,sBAAwB,SAAUvL,GAMrC,IALA,GAGIwL,GAHAC,EAAazL,EAAI0L,iBAAiB1L,EAAK2L,WAAWC,cAClDC,KACAC,KAGEL,EAAWM,YACbP,EAAiBC,EAAWO,YAAYC,QAAQX,cACJ,iCAAxCG,EAAWO,YAAYE,aACvBL,EAAcL,IAAkB,EAEhCM,EAAiBN,IAAkB,CAI3C,OAAOxhB,QAAOC,KAAK4hB,GAAejoB,OAAO,SAAUqoB,GAC/C,OAAQH,EAAiBG,MAI1B1rB,KAGP4rB,EAAkB,SAAUlD,GAC5B,YAEA,IAAI1oB,MAEA2oB,EAAU,SAAUC,GACpB,MAAOzf,OAAMC,UAAUC,MAAMC,KAAKsf,GAmEtC,OAhEA5oB,GAAO6rB,UAAY,SAAUpM,EAAKqM,GAC9B,GAAIrP,GAAOgD,EAAIlP,cAAcub,GACzBC,EAAiB,oBACftP,KAINiM,EAAaG,wBAAwBpM,EAAMsP,GAC3CrD,EAAaiC,uBAAuBlL,EAAK,SAAU,IAAMsM,KAG7D/rB,EAAOgsB,WAAa,SAAUvM,EAAKwM,GAC/B,GAAIxP,GAAOgD,EAAIlP,cAAc0b,GACzBC,EAAkB,qBAChBzP,KAINiM,EAAaG,wBAAwBpM,EAAMyP,GAC3CxD,EAAaiC,uBAAuBlL,EAAK,UAAW,IAAMyM,KAG9DlsB,EAAOmsB,UAAY,SAAU1M,EAAK2M,GAC9B,GAAI3P,GAAOgD,EAAIlP,cAAc6b,GACzBC,EAAiB,oBACf5P,KAINiM,EAAaG,wBAAwBpM,EAAM4P,GAC3C3D,EAAaiC,uBAAuBlL,EAAK,SAAU,IAAM4M,KAG7DrsB,EAAOssB,mBAAqB,SAAU7M,GAClC,GAAI8M,GAAS9M,EAAIjD,iBAAiB,SAC9BgQ,EAAY/M,EAAIjD,iBAAiB,YACjCiQ,EAAc,SAAUC,GACpB,MAAsB,aAAfA,EAAM1M,MAAsC,UAAf0M,EAAM1M,KAGlD2I,GAAQ4D,GAAQlpB,OAAOopB,GAClB9iB,QAAQ,SAAU+iB,GACXA,EAAMC,QACND,EAAM9V,aAAa,UAAW,IAE9B8V,EAAMhS,gBAAgB,aAIlCiO,EAAQ4D,GAAQlpB,OAAO,SAAUqpB,GAAS,OAAQD,EAAYC,KACzD/iB,QAAQ,SAAU+iB,GACfA,EAAM9V,aAAa,QAAS8V,EAAMpiB,SAG1Cqe,EAAQ6D,GACH7iB,QAAQ,SAAUijB,GACfA,EAASzY,YAAcyY,EAAStiB,SAI5CtK,EAAO6sB,mCAAqC,SAAUpN,GAClDiJ,EAAamC,0BAA0BpL,EAAKiJ,EAAasC,sBAAsBvL,KAG5Ezf,GACT0oB,GAEEoE,EAAoB,SAAUlG,GAC9B,YAEA,IAkDImG,GAlDA/sB,KAEAgtB,EAA2B,WAC3B,GAAIC,GAAM,qJAIN9rB,EAAM,oCAAsCwd,mBAAmBsO,GAC/Dve,EAAMhI,SAASC,cAAc,MAIjC,OAFA+H,GAAIjH,IAAMtG,EAEHuN,GAGPwe,EAAqB,SAAUxe,EAAKye,EAAGC,EAAG9K,GAC1C,GAAI9b,GAASE,SAASC,cAAc,SACpCH,GAAO1B,MAAQ4J,EAAI5J,MACnB0B,EAAOzB,OAAS2J,EAAI3J,MAEpB,IACIsU,GADAzS,EAAUJ,EAAOK,WAAW,KAKhC,OAFAD,GAAQI,UAAU0H,EAAK,EAAG,GAC1B2K,EAAOzS,EAAQga,aAAa,EAAG,EAAG,EAAG,GAAGvH,KACjCA,EAAK,KAAO8T,GAAK9T,EAAK,KAAO+T,GAAK/T,EAAK,KAAOiJ,GAGrD+K,EAAuB,WACvB,GAAI3e,GAAMse,IACN7lB,EAAQjH,EAAWiH,OAiBvB,OAfAT,UAAS6J,cAAc,QAAQY,YAAYzC,GAE3CA,EAAIrH,OAAS,WACTX,SAAS6J,cAAc,QAAQ2C,YAAYxE,EAC3C,KACIvH,EAAMG,SAAS4lB,EAAmBxe,EAAK,EAAG,EAAG,MAC/C,MAAOpG,GAELnB,EAAMG,SAAQ,KAGtBoH,EAAInH,QAAU,WACVJ,EAAMK,UAGHL,EAAMO,QAKjB1H,GAAOstB,kBAAoB,WAIvB,MAHmB/rB,UAAfwrB,IACAA,EAAaM,KAEVN,EAGX,IAAIpE,GAAU,SAAUC,GACpB,MAAOzf,OAAMC,UAAUC,MAAMC,KAAKsf,IAGlCgB,EAAiB,SAAUP,GAC3B,MAAOV,GAAQU,GAAU1nB,IAAI,SAAUsnB,GACnC,MAAOA,GAAKrJ,UACb5V,KAAK,OAGRujB,EAAiB,SAAUC,EAAcnE,GACzC,MAAO,UAAYmE,EAAaxjB,KAAK,MAAQ,IACzC4f,EAAeP,GACf,KAGJoE,EAA6B,SAAUxN,EAAYmJ,EAASF,GAC5D,IACIjJ,EAAWqJ,WAAWJ,EAAaE,EAAQ,GAC7C,MAAO9gB,GAEL,OAEJ2X,EAAWsJ,WAAWH,IAGtBJ,EAAgB,SAAUC,EAAMC,GAChC,GAAIjJ,GAAagJ,EAAKE,iBAClBC,EAAUT,EAAQ1I,EAAWoJ,UAAUxhB,QAAQohB,EAEnDwE,GAA2BxN,EAAYmJ,EAASF,IAGhDY,EAAsB,SAAUC,GAChCA,EAAa5V,YAAcyV,EAAeG,EAAapK,MAAM0J,WAG7DqE,EAAsB,SAAUC,GAChC,GAAIC,GAAUD,EAAIE,SAAWF,EAAIE,SAAW,IAAMF,EAAIC,QAAUD,EAAIC,OACpE,OAAID,GAAIrjB,MACG,IAAMsjB,EAAU,KAAOD,EAAIrjB,MAAQ,IAEnC,IAAMsjB,EAAU,KAI3BE,EAAqB,SAAUC,GAC/B,GAAIC,KAYJ,OAVID,GAAEE,SACFD,EAASxsB,KAAK,OAGlBwsB,EAASxsB,KAAKusB,EAAE/N,MAEZ+N,EAAEG,YAAYzjB,OAAS,GACvBujB,EAASxsB,KAAK,OAASusB,EAAEG,YAAYvsB,IAAI+rB,GAAqB1jB,KAAK,UAGhEgkB,EAAShkB,KAAK,KAIzBhK,GAAOmuB,eAAiB,SAAUJ,GAC9B,GAAIK,GAAaL,EAAEpsB,IAAImsB,EACvB,OAAOM,GAAWpkB,KAAK,MAG3B,IAAIqkB,GAAoB,SAAUC,GAC9B,MAAY,IAALA,GAGPC,EAAuB,SAAUjkB,GAEjC,GAAIqX,GAAQ,qBAAqB6M,KAAKlkB,EACtC,OAAIqX,GACO0M,EAAkBI,WAAW9M,EAAM,KAAO,KAE9CrX,GAGPokB,EAAqB,SAAUC,GAC/B,GAAIC,GAAchI,EAAciI,MAAMF,GAClCG,GAAa,CAejB,OAbAF,GAAYjlB,QAAQ,SAAUokB,GAC1BA,EAAEG,YAAYvkB,QAAQ,SAAUgkB,GAC5B,GAAIoB,GAAiBR,EAAqBZ,EAAIrjB,MAE9CwkB,IAAcC,IAAmBpB,EAAIrjB,MACrCqjB,EAAIrjB,MAAQykB,MAIhBD,IACAH,EAAa3uB,EAAOmuB,eAAeS,IAGhCD,GAGPK,EAAmB,SAAUC,GAC7B,GAAIC,IAAoB,CAmBxB,OAjBAD,GAAgBtlB,QAAQ,SAAUsf,GAC9B,GAAI6F,IAAa,EAEbK,EAAuBxG,EAAQM,EAAKmG,OAAOztB,IAAI,SAAUgtB,GACzD,GAAIU,GAAsBX,EAAmBC,EAG7C,OADAG,IAAcO,IAAwBV,EAC/BU,GAGPP,IACA9F,EAAcC,EAAMsE,EAAe4B,EAAsBlG,EAAKI,WAGlE6F,GAAqBJ,IAGlBI,EAkBX,OAfAlvB,GAAOsvB,4BAA8B,SAAU5oB,GAC3C,GAAI6oB,GAAS7oB,EAAS8V,iBAAiB,QAEvCmM,GAAQ4G,GAAQ5lB,QAAQ,SAAUkJ,GAC9B,GAAIoc,GAAkBtG,EAAQ9V,EAAM8M,MAAM0J,UAAUhmB,OAAO,SAAU4lB,GACjE,MAAOA,GAAKjJ,OAASvZ,OAAO+oB,QAAQC,aAGpCX,EAAaE,EAAiBC,EAC9BH,IACAhF,EAAoBjX,MAKzB7S,GACT4mB,GAEE8I,EAAW,SAAUhvB,EAAM4mB,EAASpnB,EAAYyvB,GAChD,YAEA,IAAI3vB,MAEA4vB,EAAsB,SAAUnQ,EAAKiM,EAAS5mB,EAAOC,GACrD,GAAIsM,GAAUoO,EAAI9Y,cAAc+kB,EAUhC,OARAra,GAAQwB,MAAMgd,WAAa,SAC3Bxe,EAAQwB,MAAM/N,MAAQA,EAAQ,KAC9BuM,EAAQwB,MAAM9N,OAASA,EAAS,KAChCsM,EAAQwB,MAAMC,SAAW,WACzBzB,EAAQwB,MAAMf,IAAO,KAAS/M,EAAU,KACxCsM,EAAQwB,MAAMd,KAAQ,KAASjN,EAAS,KAExC2a,EAAIM,qBAAqB,QAAQ,GAAG5O,YAAYE,GACzCA,EAGXrR,GAAO8vB,kBAAoB,SAAUrQ,EAAKoD,GACtC,GAAIjI,GAASgV,EAAoBD,EAAUjpB,SAAU,SAAUmc,EAAQ/d,MAAO+d,EAAQ9d,QAClFoH,EAAOsT,EAAI9N,gBAAgBoe,UAC3BC,KACA7oB,EAAQjH,EAAWiH,QACnB8oB,EAAUpN,EAAQ7W,kBAAoB,EAEtCkkB,EAAY,WACZ,GAAIzQ,GAAM7E,EAAOuV,eACjBR,GAAUjpB,SAASqZ,qBAAqB,QAAQ,GAAG7M,YAAY0H,GAC/DzT,EAAMG,SACFZ,SAAU+Y,EACVxa,OAAQ+qB,KAIZI,EAAyB,WACzB,GAAIhX,GAAIlZ,EAAWiH,OAMnB,OALI8oB,GAAU,EACV5K,WAAWjM,EAAE9R,QAAS2oB,GAEtB7W,EAAE9R,UAEC8R,EAAE1R,QAGbkT,GAAOvT,OAAS,WACZ+oB,IACKvuB,KAAKwuB,EAAqB5H,yBAC1B5mB,KAAKquB,GAGd,IAAIjoB,GAAM2S,EAAO0V,cAAcpoB,eAC3BmoB,EAAuB/I,EAAQY,mBAAmBjgB,GAClDsoB,EAAkBjJ,EAAQK,qBAAqB0I,EAAsBxN,EAAQ5W,QAejF,OAbA2O,GAAOuV,gBAAgB/nB,OACvBwS,EAAO0V,cAAcpoB,eAAiBqoB,EACtC3V,EAAO0V,cAAc/oB,QAAU,SAAUiE,GACrCwkB,EAAqBxuB,MACjBgvB,aAAc,kBACdhlB,IAAKA,KAIboP,EAAOuV,gBAAgBM,MAAM,mBAC7B7V,EAAOuV,gBAAgBM,MAAMtkB,GAC7ByO,EAAOuV,gBAAgB5hB,QAEhBpH,EAAMO,QAGjB,IAAIgpB,GAA8B,SAAUjR,EAAK3a,EAAOC,GACpD,GAAI6V,GAAS6E,EAAI9Y,cAAc,SAY/B,OAXAiU,GAAO/H,MAAM/N,MAAQA,EAAQ,KAC7B8V,EAAO/H,MAAM9N,OAASA,EAAS,KAE/B6V,EAAO/H,MAAMgd,WAAa,SAC1BjV,EAAO/H,MAAMC,SAAW,WACxB8H,EAAO/H,MAAMf,IAAO,KAAS/M,EAAU,KACvC6V,EAAO/H,MAAMd,KAAQ,KAASjN,EAAS,KAEvC8V,EAAO+V,QAAU,oBAEjB/V,EAAOC,UAAY,KACZD,GAGPgW,EAAmC,SAAU9rB,EAAOC,EAAQ8rB,GAC5D,GAAIC,GAAsBjd,KAAKC,MAAMhP,EAAQ+rB,GACzCE,EAAuBld,KAAKC,MAAM/O,EAAS8rB,EAE/C,OAAOH,GAA4Bf,EAAUjpB,SAAUoqB,EAAqBC,IAG5EC,EAAuC,SAAUC,EAAgBC,EAAgBC,EAAiBN,GAClG,OACI/rB,MAAO+O,KAAK2P,IAAIyN,EAAensB,MAAQ+rB,EAAMK,GAC7CnsB,OAAQ8O,KAAK2P,IAAIyN,EAAelsB,OAAS8rB,EAAMM,KAInDC,EAAuB,SAAU3R,EAAK4R,EAAUH,EAAgBC,EAAiBN,GAEjF,GAEI/e,GAAKC,EAAMuf,EAAeC,EAAgBC,EAC1CngB,EAASogB,EAAMC,EAHfC,EAAsB9d,KAAK2P,IAAI/D,EAAI9N,gBAAgBigB,YAAanS,EAAIhO,KAAKogB,aACzEC,EAAuBje,KAAK2P,IAAI/D,EAAI9N,gBAAgBogB,aAActS,EAAIhO,KAAKsgB,aAActS,EAAIhO,KAAKugB,aAItG,IAAIX,EAAU,CAGV,GAFAhgB,EAAUoO,EAAIlP,cAAc8gB,IAEvBhgB,EACD,MACIqP,QAAS,8BAIjB+Q,GAAOpgB,EAAQE,wBAEfO,EAAM2f,EAAK3f,IACXC,EAAO0f,EAAK1f,KACZuf,EAAgBG,EAAK3sB,MACrBysB,EAAiBE,EAAK1sB,WAEtB+M,GAAM,EACNC,EAAO,EACPuf,EAAgBK,EAChBJ,EAAiBO,CAarB,OAVAJ,GAAcV,GACNlsB,MAAOwsB,EACPvsB,OAAQwsB,GAEZL,EACAC,EACAN,GAEJW,EAAe7B,EAAUsC,iBAAiBxS,EAAI9N,iBAAiBugB,UAG3DngB,KAAMA,EACND,IAAKA,EACLhN,MAAO4sB,EAAY5sB,MACnBC,OAAQ2sB,EAAY3sB,OACpBW,cAAeisB,EACfhsB,eAAgBmsB,EAEhBN,aAAcA,GAItBxxB,GAAOmyB,6BAA+B,SAAU1S,EAAKoD,GACjD,GAGIjI,GAHAzO,EAAOsT,EAAI9N,gBAAgBoe,UAC3B5oB,EAAQjH,EAAWiH,QACnB0pB,EAAOhO,EAAQgO,MAAQ,CA6B3B,OAzBAjW,GAASgW,EAAiC/N,EAAQ/d,MAAO+d,EAAQ9d,OAAQ8rB,GAEzElB,EAAUjpB,SAASqZ,qBAAqB,QAAQ,GAAG5O,YAAYyJ,GAE/DA,EAAOvT,OAAS,WACZ,GACI+qB,GADA3S,EAAM7E,EAAOuV,eAGjB,KACIiC,EAAOhB,EAAqB3R,EAAKoD,EAAQwP,KAAMxP,EAAQ/d,MAAO+d,EAAQ9d,OAAQ8rB,GAE9E1pB,EAAMG,QAAQ8qB,GAChB,MAAO9pB,GACLnB,EAAMK,OAAOc,GACf,QACEqnB,EAAUjpB,SAASqZ,qBAAqB,QAAQ,GAAG7M,YAAY0H,KAKvEA,EAAOuV,gBAAgB/nB,OACvBwS,EAAOuV,gBAAgBM,MAAM,mBAC7B7V,EAAOuV,gBAAgBM,MAAMtkB,GAC7ByO,EAAOuV,gBAAgB5hB,QAEhBpH,EAAMO,QAGjB,IAAI4qB,GAAuB,SAAU7S,EAAKtT,GACtC,GAEIomB,GACAroB,EAAGsoB,EAAmBC,EAHtBC,EAAiB,0BAA0BlE,KAAKriB,GAChDwmB,EAAYhD,EAAUjpB,SAASksB,eAAeC,mBAAmB,GAIrE,IAAKH,EAQL,IAJAH,EAAoB,OAASG,EAAe,GAAK,UACjDC,EAAUhhB,gBAAgBwF,UAAYob,EACtCC,EAAoBG,EAAUpiB,cAAc,OAEvCrG,EAAI,EAAGA,EAAIsoB,EAAkBM,WAAWroB,OAAQP,IACjDuoB,EAAYD,EAAkBM,WAAW5oB,GACzCuV,EAAI9N,gBAAgBiF,aAAa6b,EAAUnS,KAAMmS,EAAUnoB,OAInEtK,GAAO+yB,UAAY,SAAU5mB,GAEzB,GAAIsT,GAAMkQ,EAAUjpB,SAASksB,eAAeC,mBAAmB,GAI/D,OAHApT,GAAI9N,gBAAgBwF,UAAYhL,EAEhCmmB,EAAqB7S,EAAKtT,GACnBsT,EAGX,IAAIuT,GAAe,SAAUC,GAEzB,GAAIC,GAAI,GAAIC,WACRC,EAAkBF,EAAEG,gBAAgB,IAAK,YACzCC,EAAgBF,EAAgBrT,qBAAqB,eAAe,GAAG4L,YAE3E,OAAsB,iCAAlB2H,EAEOL,EAAelT,qBAAqB,eAAetV,OAAS,EAGhEwoB,EAAeM,uBAAuBD,EAAe,eAAe7oB,OAAS,GAGpF+oB,EAAmB,SAAU/T,GAC7B,GAAY,OAARA,GAAgBuT,EAAavT,GAC7B,MACIiB,QAAS,kBAKrB1gB,GAAOyzB,cAAgB,SAAUC,GAC7B,GAAIR,GAAI,GAAIC,WACR1T,EAAMyT,EAAEG,gBAAgBK,EAAO,kBAEnCF,GAAiB/T,GAGrB,IAAIkU,GAAgB,KAEhBhsB,EAAmB,SAAUxG,EAAKiK,GAClC,MAAc,SAAVA,GAA8B,aAAVA,IACE,OAAlBuoB,GAAoC,aAAVvoB,KAC1BuoB,EAAgB7rB,KAAKC,OAElB5G,EAAM,MAAQwyB,GAEdxyB,GAIXyyB,EAAiB,SAAUzyB,EAAK0hB,GAChC,GAAIgR,GAAc,GAAIptB,QAAOyB,eACzB8f,EAAYtnB,EAAKsmB,QAAQnE,EAAQ5W,QAAS9K,GAC1C2yB,EAAensB,EAAiBqgB,EAAWnF,EAAQzX,OACnDjE,EAAQjH,EAAWiH,QACnB+e,EAAW,WACP/e,EAAMK,QAAQkZ,QAAS,wBAG/BmT,GAAYnhB,iBAAiB,OAAQ,WACN,MAAvBmhB,EAAYpvB,QAAyC,IAAvBovB,EAAYpvB,OAC1C0C,EAAMG,QAAQusB,EAAYE,aAE1B7N,MAEL,GAEH2N,EAAYnhB,iBAAiB,QAAS,WAClCwT,MACD,EAEH,KACI2N,EAAYzrB,KAAK,MAAO0rB,GAAc,GACtCD,EAAYrrB,aAAe,WAC3BqrB,EAAYxrB,KAAK,MACnB,MAAO2rB,GACL9N,IAGJ,MAAO/e,GAAMO,QAYjB,OATA1H,GAAOi0B,aAAe,SAAU9yB,EAAK0hB,GACjC,MAAO+Q,GAAezyB,EAAK0hB,GACtBhhB,KAAK,SAAU4d,GAGZ,MAFA+T,GAAiB/T,GAEVA,KAIZzf,GACTU,EAAM4mB,EAASpnB,EAAYuG,QAEzBytB,EAAa,SAAUh0B,EAAYuG,GACnC,YAEA,IAsFI0tB,GAtFAn0B,KAEAo0B,EAAY,SAAUnH,EAAKoH,GAC3B,MAAIA,GACOC,IAAIC,gBAAgB,GAAIC,OAAMvH,IAAOjN,KAAQ,mBAE7C,oCAAsCrB,mBAAmBsO,IAIpEwH,EAAa,SAAUtzB,GACnBA,YAAeqzB,OACfF,IAAII,gBAAgBvzB,IAIxBwzB,EAAyB,qGAEzBC,EAAkC,SAAUzzB,GAC5C,GAAIqF,GAASE,SAASC,cAAc,UAChC3E,EAAQ,GAAIoF,OACZD,EAAQjH,EAAWiH,OAgBvB,OAdAnF,GAAMqF,OAAS,WACX,GAAIT,GAAUJ,EAAOK,WAAW,KAChC,KACID,EAAQI,UAAUhF,EAAO,EAAG,GAE5BwE,EAAOS,UAAU,aACjBE,EAAMG,SAAQ,GAChB,MAAOgB,GACLnB,EAAMG,SAAQ,KAGtBtF,EAAMuF,QAAUJ,EAAMK,OACtBxF,EAAMyF,IAAMtG,EAELgG,EAAMO,SAGbmtB,EAAqD,WAErD,GAAIC,GAAUV,EAAUO,GAAwB,EAChD,OAAOC,GAAgCE,GAClCjzB,KAAK,SAAUkzB,GAEZ,MADAN,GAAWK,GACPC,GACO,EAEJH,EAAgCR,EAAUO,GAAwB,IACpE9yB,KAAK,SAAUmzB,GACZ,MAAOA,MAEhB,WACC,OAAO,KAIfC,EAAuB,WACvB,GAAIxuB,EAAO+tB,KAEP,IAEI,MADA,IAAIA,OAAM,YAAcxU,KAAS,cAC1B,EACT,MAAOgU,IAEb,OAAO,GAGPkB,EAAmB,WACnB,GAAI/tB,GAAQjH,EAAWiH,OAavB,OAXI8tB,IAAwBxuB,EAAO6tB,IAC/BO,IACKhzB,KAAK,SAAUszB,GACZhuB,EAAMG,SAAU6tB,IACjB,WACChuB,EAAMK,WAGdL,EAAMG,SAAQ,GAGXH,EAAMO,SAKb0tB,EAAgB,WAKhB,MAJ4B7zB,UAAxB4yB,IACAA,EAAsBe,KAGnBf,GAGPkB,EAAgB,SAAUpI,GAC1B,MAAOmI,KAAgBvzB,KAAK,SAAUwyB,GAClC,MAAOD,GAAUnH,EAAKoH,KAuC9B,OAnCAr0B,GAAOs1B,UAAY,SAAUrI,GACzB,GAAI9rB,GAAKa,EACLmF,EAAQjH,EAAWiH,QACnBouB,EAAqB,WACjBvzB,EAAMqF,OAAS,KACfrF,EAAMuF,QAAU,MAEpBiuB,EAAU,WACFr0B,GACAszB,EAAWtzB,GAuBvB,OAnBAa,GAAQ,GAAIoF,OACZpF,EAAMqF,OAAS,WACXkuB,IACAC,IAEAruB,EAAMG,QAAQtF,IAElBA,EAAMuF,QAAU,WACZiuB,IAGAruB,EAAMK,UAGV6tB,EAAcpI,GAAKprB,KAAK,SAAU4zB,GAC9Bt0B,EAAMs0B,EACNzzB,EAAMyF,IAAMtG,GACbgG,EAAMK,QAEFL,EAAMO,SAGV1H,GACTE,EAAYuG,QAEVivB,EAAgB,SAAUh1B,EAAMgvB,EAAS9D,EAAgBkB,EAAkBjG,GAC3E,YAEA,IAAI7mB,MAEA21B,EAAgC,SAAUvD,EAAMwD,GAChD,GAAIC,GAAmBC,EACnBC,EAASC,CAEbJ,GAAaA,GAAc,EAC3BC,EAAoBhiB,KAAKoiB,MAAM7D,EAAK1sB,eACpCowB,EAAsBjiB,KAAKoiB,MAAM7D,EAAKzsB,gBAEtCowB,GAAW3D,EAAKrgB,KAChBikB,GAAW5D,EAAKtgB,GAEhB,IAAIghB,IACCoD,EAAKH,EACLI,EAAKH,EACLlxB,MAAS+wB,EACT9wB,OAAU+wB,EAOf,OAJmB,KAAfF,IACA9C,EAAWsD,UAAY,SAAWR,EAAa,KAG5C9C,GAGPuD,EAA0D,SAAUvD,GACpE,GAAIjgB,GAAQigB,EAAWjgB,OAAS,EAChCigB,GAAWjgB,MAAQA,EAAQ,gBAG3ByjB,EAAuD,SAAUxD,GAIjEA,EAAWyD,2BAA4B,GAGvCC,EAAoE,WACpE,MAAO,uEAGPC,EAAsB,SAAU3D,GAChC,GAAIppB,GAAOD,OAAOC,KAAKopB,EACvB,OAAKppB,GAAKe,OAIH,IAAMf,EAAK/H,IAAI,SAAUiI,GAC5B,MAAOA,GAAM,KAAOkpB,EAAWlpB,GAAO,MACvCI,KAAK,KALG,IAQX0sB,EAAuB,SAAUjX,EAAK2S,EAAMwD,GAC5C,GAAIlC,GAAQ7M,EAAc8P,kBAAkBlX,EAE5CiQ,GAAQ+D,cAAcC,EAEtB,IAAIZ,GAAa6C,EAA8BvD,EAAMwD,EAKrD,OAHAS,GAAwDvD,GACxDwD,EAAqDxD,GAGjD,kDACiBV,EAAKttB,MAAQ,aACZstB,EAAKrtB,OAAS,gBACXqtB,EAAKZ,aAAe,KAErCgF,IACA,iBAAmBC,EAAoB3D,GAAc,IACrDY,EACA,yBAkCZ,OA7BA1zB,GAAO42B,kBAAoB,SAAUnX,EAAK2S,EAAMwD,GAG5C,MAFAhK,GAAeiB,mCAAmCpN,GAE3CqN,EAAiBQ,oBAAoBzrB,KAAK,SAAUg1B,GAKvD,MAJIA,IACA/J,EAAiBwC,4BAA4B7P,GAG1CiX,EAAqBjX,EAAK2S,EAAMwD,MAI/C51B,EAAO82B,kBAAoB,SAAUrX,EAAKoD,GAWtC,MAVIA,GAAQje,OACRgnB,EAAeC,UAAUpM,EAAKoD,EAAQje,OAEtCie,EAAQhe,QACR+mB,EAAeI,WAAWvM,EAAKoD,EAAQhe,QAEvCge,EAAQkU,OACRnL,EAAeO,UAAU1M,EAAKoD,EAAQkU,OAGnCrH,EAAQyC,6BAA6B1S,EAAKoD,GAC5ChhB,KAAK,SAAUuwB,GACZ,MAAOpyB,GAAO42B,kBAAkBnX,EAAK2S,EAAMvP,EAAQgO,SAIxD7wB,GACTU,EAAMgvB,EAAS9D,EAAgBkB,EAAkBjG,GAE/CmQ,EAAa,SAAUt2B,EAAMgvB,EAAS9D,EAAgB8J,EAAcxB,EAAWpN,GAC/E,YAEA,IAAI9mB,MAEAi3B,EAAmB,WACnB,OAAQvW,QAAS,yBAGjBwW,EAAe,SAAUjK,GACzB,MAAOiH,GAAUoB,UAAUrI,GACtBprB,KAAK,SAAUG,GACZ,OACIA,MAAOA,EACPirB,IAAKA,IAEV,WACC,KAAMgK,QAIdE,EAAoB,SAAUn1B,EAAOwE,GACrC,IACIA,EAAOK,WAAW,MAAMG,UAAUhF,EAAO,EAAG,GAC9C,MAAOsG,GAEL,KAAM2uB,OAIVG,EAAS,SAAU3X,EAAKjZ,EAAQqc,GAChC,MAAO6S,GAAaoB,kBAAkBrX,EAAKoD,GACtChhB,KAAKq1B,GACLr1B,KAAK,SAAU2C,GAKZ,MAJIgC,IACA2wB,EAAkB3yB,EAAOxC,MAAOwE,GAG7BhC,KAIf6yB,EAA8B,SAAU5X,EAAKoD,GAC7C,MAAO6M,GAAQI,kBAAkBrQ,EAAKoD,GACjChhB,KAAK,SAAU2C,GACZ,GAAIkC,GAAWlC,EAAOkC,QAGtB,OAFAklB,GAAeU,mBAAmB5lB,IAG9BA,SAAUA,EACVzB,OAAQT,EAAOS,UAuC/B,OAlCAjF,GAAOg3B,UAAY,SAAUvX,EAAKjZ,EAAQqc,GACtC,GAAIyU,EAKJ,OAHAA,GAAgB52B,EAAKY,MAAMuhB,GAC3ByU,EAAcC,cAAgB1U,EAAQ9W,aAAc,EAE7C+a,EAAgB0Q,iBAAiB/X,EAAK6X,GACxCz1B,KAAK,SAAUoD,GACZ,MAAI4d,GAAQ9W,UACDsrB,EAA4B5X,EAAKoD,GACnChhB,KAAK,SAAU2C,GACZ,OACIkC,SAAUlC,EAAOkC,SACjBzB,OAAQA,EAAOgjB,OAAOzjB,EAAOS,YAKrCyB,SAAU+Y,EACVxa,OAAQA,KAGjBpD,KAAK,SAAU2C,GACd,MAAO4yB,GAAO5yB,EAAOkC,SAAUF,EAAQqc,GAClChhB,KAAK,SAAU41B,GACZ,OACIz1B,MAAOy1B,EAAWz1B,MAClBirB,IAAKwK,EAAWxK,IAChBhoB,OAAQT,EAAOS,aAMhCjF,GACTU,EAAMgvB,EAAS9D,EAAgB8J,EAAcxB,EAAWpN,GAEtD1mB,EAAiB,SAAUM,EAAMgvB,EAASsH,GAC1C,YAEA,IAAIh3B,MAEA03B,EAAkB,SAAUlxB,EAAQqc,GACpC,GAAI8U,GAAe,IACfC,EAAgB,IAChBzyB,EAAgBqB,EAASA,EAAO1B,MAAQ6yB,EACxCvyB,EAAiBoB,EAASA,EAAOzB,OAAS6yB,EAC1C9yB,EAA0BvD,SAAlBshB,EAAQ/d,MAAsB+d,EAAQ/d,MAAQK,EACtDJ,EAA4BxD,SAAnBshB,EAAQ9d,OAAuB8d,EAAQ9d,OAASK,CAE7D,QACIN,MAAOA,EACPC,OAAQA,IAIZ8yB,EAAmB,SAAUC,GAC7B,GACIjV,GADA5gB,EAAWy1B,EAAgBI,EAAOtxB,OAAQsxB,EAAOjV,QAOrD,OAJAA,GAAUniB,EAAKY,MAAMw2B,EAAOjV,SAC5BA,EAAQ/d,MAAQ7C,EAAS6C,MACzB+d,EAAQ9d,OAAS9C,EAAS8C,OAEnB8d,EAOX7iB,GAAO+3B,aAAe,WAClB,GAAItY,GAAMlW,UAAU,GAChByuB,EAAoB7uB,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAC1DuuB,EAASp3B,EAAK0mB,wBAAwB4Q,EAE1C,OAAOhB,GAAUA,UAAUvX,EAAKqY,EAAOtxB,OAAQqxB,EAAiBC,IAGpE,IAAI5rB,GAAW,SAAUC,EAAM3F,EAAQqc,GACnC,GAAIpD,GAAMiQ,EAAQqD,UAAU5mB,EAE5B,OAAOnM,GAAO+3B,aAAatY,EAAKjZ,EAAQqc,GAO5C7iB,GAAOkM,SAAW,WACd,GAAIC,GAAO5C,UAAU,GACjByuB,EAAoB7uB,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAC1DuuB,EAASp3B,EAAK0mB,wBAAwB4Q,EAE1C,OAAO9rB,GAASC,EAAM2rB,EAAOtxB,OAAQsxB,EAAOjV,SAIhD,IAAIoV,GAA8C,SAAUxY,EAAKte,EAAK0hB,GAClE,GAAIzJ,GAAI1S,SAASksB,eAAeC,mBAAmB,GACnDzZ,GAAE8e,aAAazY,EAAI9N,gBAAiByH,EAAEzH,gBAEtC,IAAIwmB,GAAkBtV,EAAUniB,EAAKY,MAAMuhB,KAM3C,OAJKA,GAAQ5W,UACTksB,EAAgBlsB,QAAU9K,IAI1BuF,SAAU0S,EACVyJ,QAASsV,IAIbC,EAAU,SAAUj3B,EAAKqF,EAAQqc,GACjC,MAAO6M,GAAQuE,aAAa9yB,EAAK0hB,GAC5BhhB,KAAK,SAAU4d,GACZ,GAAI4Y,GAAaJ,EAA4CxY,EAAKte,EAAK0hB,EACvE,OAAO7iB,GAAO+3B,aAAaM,EAAW3xB,SAAUF,EAAQ6xB,EAAWxV,WAgB/E,OARA7iB,GAAOo4B,QAAU,WACb,GAAIj3B,GAAMoI,UAAU,GAChByuB,EAAoB7uB,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAC1DuuB,EAASp3B,EAAK0mB,wBAAwB4Q,EAE1C,OAAOI,GAAQj3B,EAAK22B,EAAOtxB,OAAQsxB,EAAOjV,UAGvC7iB,GACTU,EAAMgvB,EAASsH,EAEjB,OAAO52B;;AQtxCP,YAaA,SAASgsC,YAAWzd,EAAY/e,GAC5B,MAAOy8B,YAAW1d,GAAY2d,KAAK,SAAU1J,GACzC,GAAI3U,GAAU2U,EAAM3U,QAIhBse,EAA2B,QAAf3J,EAAM5iB,MAAkBpQ,EAAOoQ,OAAS4iB,EAAM5iB,IAG9D,IAAKusB,GAAate,IAAcse,IAAate,EACzC,OAAO,CAGX,IAAIue,GAAmB5J,EAAM1U,YAAYue,MAAM,SAAUC,GACrD,GAAI9e,GAAW8e,EAAW9e,QACtBC,EAAW6e,EAAW7e,SACtB8e,EAAWD,EAAWpiC,MACtBA,EAAWsF,EAAOge,EAGtB,KAAKtjB,EAAS,OAAO,CAErB,QAAQsjB,GACJ,IAAK,cACL,IAAK,OACD,MAAOtjB,GAAMygB,gBAAkB4hB,EAAS5hB,aAE5C,KAAK,QACL,IAAK,SACL,IAAK,eACL,IAAK,gBACD4hB,EAAWC,KAAKD,GAChBriC,EAAWsiC,KAAKtiC,EAChB,MAEJ,KAAK,aACDqiC,EAAWE,MAAMF,GACjBriC,EAAWuiC,MAAMviC,EACjB,MAEJ,KAAK,eACL,IAAK,sBACL,IAAsB,qBAClBqiC,EAAWG,UAAUH,GACrBriC,EAAWwiC,UAAUxiC,EACrB,MAEJ,KAAK,OACL,IAAK,QACL,IAAK,cACL,IAAK,aACDqiC,EAAW3S,SAAS2S,EAAU,KAAO,EACrCriC,EAAW0vB,SAAS1vB,EAAO,KAAO,EAI1C,OAAQujB,GACJ,IAAK,MAAO,MAAOvjB,IAASqiC,CAC5B,KAAK,MAAO,MAAgBA,IAATriC,CACnB,SAAY,MAAOA,KAAUqiC,IAIrC,OAAQH,KAAqBve,IAAcue,GAAoBve,IAIvE,QAASoe,YAAW1d,GAChB,MAAOA,GAAW5Q,MAAM,KAAKpc,IAAI,SAAUihC,GACvCA,EAAQA,EAAM7F,MAEd,IAAIgQ,GAAcnK,EAAMjhB,MAAMqrB,gBAC1Bnf,EAAckf,EAAS,GACvB/sB,EAAc+sB,EAAS,GACvB7e,EAAc6e,EAAS,IAAM,GAC7BhT,IAmBJ,OAjBAA,GAAO9L,UAAYJ,GAAuC,QAA3BA,EAAS9C,cACxCgP,EAAO/Z,KAAUA,EAAOA,EAAK+K,cAAgB,MAG7CmD,EAAcA,EAAYvM,MAAM,mBAEhCoY,EAAO7L,YAAcA,EAAYvsB,IAAI,SAAU+qC,GAC3C,GAAIK,GAAWL,EAAW/qB,MAAMsrB,kBAC5Brf,EAAWmf,EAAS,GAAGhiB,cAAcpJ,MAAMurB,cAE/C,QACIrf,SAAUD,EAAQ,GAClBA,QAAUA,EAAQ,GAClBtjB,MAAUyiC,EAAS,MAIpBhT,IAMf,QAAS+S,WAAUK,GACf,GACIC,GADAC,EAAUzT,OAAOuT,EAQrB,OALKE,KACDD,EAAUD,EAAMxrB,MAAM,wBACtB0rB,EAAUD,EAAQ,GAAKA,EAAQ,IAG5BC,EAGX,QAASR,OAAMS,GACX,GAAIhjC,GAAQmkB,WAAW6e,GACnBrQ,EAAQ3B,OAAOgS,GAAY3rB,MAAM4rB,oBAAoB,EAEzD,QAAQtQ,GACJ,IAAK,OAAQ,MAAO3yB,GAAQ,IAC5B,KAAK,OAAQ,MAAe,IAARA,CACpB,SAAa,MAAOA,IAI5B,QAASsiC,MAAKniC,GACV,GAAIH,GAAQmkB,WAAWhkB,GACnBwyB,EAAQ3B,OAAO7wB,GAAQkX,MAAM6rB,gBAAgB,EAEjD,QAAQvQ,GACJ,IAAK,KAAO,MAAe,IAAR3yB,CACnB,KAAK,MAAO,MAAe,IAARA,CACnB,KAAK,KAAO,MAAe,IAARA,EAAa,IAChC,KAAK,KAAO,MAAe,IAARA,EAAa,KAAO,EACvC,KAAK,KAAO,MAAe,IAARA,CACnB,KAAK,KAAO,MAAe,IAARA,CACnB,KAAK,KAAO,MAAe,IAARA,EAAa,EAChC,SAAY,MAAOA,IAlJ3BvK,QAAQ4hB,MAAQyqB,WAChBrsC,QAAQ8uB,MAAQwd,UAIhB,IAAIW,gBAAqB,sDACrBC,iBAAqB,gDACrBC,cAAqB,uBACrBM,eAAqB,+BACrBD,mBAAqB;;AEjBzB,GAAIwB,yBAA0B,SAAU1iC,GAEpC,MAAOA,GAAQmD,QAAQ,gCAAiC,KAGxDw/B,wBAA0B,SAAU1kC,GACpC,MAAOA,GACFkF,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,WAGnBy/B,qBAAuB,SAAU5iC,GACjC,MAAOA,GACFmD,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,SAGnB0/B,mBAAqB,SAAUC,GAC/B,GAAI7kC,GAAQ6kC,EAAK7kC,KAEjB,OAAO,IAAM6kC,EAAK7uB,KAAO,KAAO0uB,wBAAwB1kC,GAAS,KAGjE8kC,WAAa,SAAUC,GACvB,GAAI3jB,GAAU2jB,EAAK3jB,OAMnB,OAH0B,iCAAtB2jB,EAAK1jB,eACLD,EAAUA,EAAQX,eAEfW,GAGP4jB,mBAAqB,SAAUD,GAC/B,GAAIE,GAAmBpmC,MAAMC,UAAUzH,IAAI2H,KAAK+lC,EAAKvc,YAAcuc,EAAKG,MAAO,SAAUL,GACjF,MAAOA,GAAK7uB,OAEfzY,QAAQ,UAAY,CAMzB,OAAK0nC,IACKF,EAAKvmB,YACNumB,EAAK1jB,eAAiB0jB,EAAKvmB,WAAW6C,cACjB,SAArByjB,WAAWC,GAGT,GAFC,WAAaA,EAAK1jB,aAAe,KAM7C8jB,kBAAoB,SAAUJ,GAC9B,MAAOlmC,OAAMC,UAAUzH,IAAI2H,KAAK+lC,EAAKK,WAAY,SAAUC,GACvD,MAAOC,iBAAgBD,KACxB3lC,KAAK,KAGR6lC,aAAe,SAAUR,GACzB,GAAI5G,GAAS,IAAM2G,WAAWC,EAc9B,OAbA5G,IAAU6G,mBAAmBD,GAE7BlmC,MAAMC,UAAUO,QAAQL,KAAK+lC,EAAKvc,YAAcuc,EAAKG,MAAO,SAAUL,GAClE1G,GAAUyG,mBAAmBC,KAG7BE,EAAKK,WAAWjlC,OAAS,GACzBg+B,GAAU,IACVA,GAAUgH,kBAAkBJ,GAC5B5G,GAAU,KAAO2G,WAAWC,GAAQ,KAEpC5G,GAAU,KAEPA,GAGPqH,cAAgB,SAAUT,GAC1B,GAAIU,GAAOV,EAAKW,WAAaX,EAAK/kC,OAAS,EAC3C,OAAO2kC,sBAAqBc,IAG5BE,iBAAmB,SAAUZ,GAC7B,MAAO,OACHA,EAAKh2B,KACA7J,QAAQ,KAAM,SACnB,OAGJ0gC,eAAiB,SAAUb,GAC3B,MAAO,YAAcA,EAAKW,UAAY,OAGtCJ,gBAAkB,SAAUP,GAC5B,MAAsB,cAAlBA,EAAKc,UACa,uBAAlBd,EAAKc,SACEV,kBAAkBJ,GAErBA,EAAK3jB,QACEmkB,aAAaR,GACK,UAAlBA,EAAKc,SACLL,cAAcT,GACI,aAAlBA,EAAKc,SACLF,iBAAiBZ,GACC,mBAAlBA,EAAKc,SACLD,eAAeb,GADnB,OAMftvC,SAAQ42B,kBAAoB,SAAUjwB,GAClC,MAAOqoC,yBAAwBa,gBAAgBlpC","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"ayepromise\",\"imagediff\",\"rasterizeHTML\"], function (a0,b1,c2) {\n      return (root['csscritic'] = factory(a0,b1,c2));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"ayepromise\"),require(\"imagediff\"),require(\"rasterizehtml\"),require(\"../build/csscritic.concat.css\"));\n  } else {\n    root['csscritic'] = factory(ayepromise,imagediff,rasterizeHTML);\n  }\n}(this, function (ayepromise, imagediff, rasterizeHTML) {\n\nvar csscriticLib = {};\n\ncsscriticLib.main = function (regression, reporting, util, storage, selectionFilter) {\n    \"use strict\";\n\n    var module = {};\n\n    var testCases = [],\n        currentComponentLabel;\n\n\n    module.component = function (componentLabel) {\n        currentComponentLabel = componentLabel;\n    };\n\n\n    var supportUrlAsOnlyTestCaseInput = function (testCase) {\n        if (typeof testCase === 'string') {\n            return {\n                url: testCase\n            };\n        }\n        return testCase;\n    };\n\n    module.add = function (testCase) {\n        var augmentedTestCase = util.clone(supportUrlAsOnlyTestCaseInput(testCase));\n\n        if (currentComponentLabel && augmentedTestCase.component === undefined) {\n            augmentedTestCase.component = currentComponentLabel;\n        }\n\n        testCases.push(augmentedTestCase);\n    };\n\n\n    var fetchStartingComparisons = function (testCases) {\n        return util.all(testCases.map(function (testCase) {\n            return storage.readReferenceImage(testCase)\n                .then(function (referenceImageRecord) {\n                    return {\n                        testCase: testCase,\n                        referenceImage: referenceImageRecord.image,\n                        viewport: referenceImageRecord.viewport\n                    };\n                }, function () {\n                    // no referenceImage found\n                    return {\n                        testCase: testCase\n                    };\n                });\n        }));\n    };\n\n    var selectComparisons = function (configuredComparisons) {\n        return configuredComparisons.map(function (configuredComparison) {\n            return {\n                configuredComparison: configuredComparison,\n                selected: !selectionFilter || selectionFilter.isComparisonSelected(configuredComparison)\n            };\n        });\n    };\n\n    var reportConfiguredComparisons = function (comparisonSelection) {\n        return util.all(comparisonSelection.map(function (selection) {\n            var isSelected = selection.selected;\n            return reporting.doReportConfiguredComparison(selection.configuredComparison, isSelected);\n        }));\n    };\n\n    var executeTestCase = function (startingComparison) {\n        return regression.compare(startingComparison).then(function (comparison) {\n            return reporting.doReportComparison(comparison).then(function () {\n                return comparison;\n            });\n        });\n    };\n\n    module.execute = function () {\n        var comparisonSelection, allPassed;\n\n        return fetchStartingComparisons(testCases)\n            .then(function (startingComp) {\n                comparisonSelection = selectComparisons(startingComp);\n\n                return reportConfiguredComparisons(comparisonSelection);\n            })\n            .then(function () {\n                var selectedComparisons = comparisonSelection.filter(function (selection) {\n                    return selection.selected;\n                }).map(function (selection) {\n                    return selection.configuredComparison;\n                });\n\n                return util.all(selectedComparisons.map(\n                    executeTestCase\n                ));\n            })\n            .then(function (comparisons) {\n                allPassed = util.hasTestSuitePassed(comparisons);\n            })\n            .then(function () {\n                return reporting.doReportTestSuite(allPassed);\n            })\n            .then(function () {\n                return allPassed;\n            });\n    };\n\n    return module;\n};\n\ncsscriticLib.regression = function (renderer, util, imagediff) {\n    \"use strict\";\n\n    var module = {};\n\n    var toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux = 1;\n\n    var workAroundFirefoxResourcesSporadicallyMissing = function (htmlImage, referenceImage) {\n        if (referenceImage) {\n            // This does nothing meaningful for us, but seems to trigger Firefox to load any missing resources.\n            imagediff.diff(htmlImage, referenceImage);\n        }\n    };\n\n    var workAroundBrowserIssues = function (pageImage, referenceImage) {\n        workAroundFirefoxResourcesSporadicallyMissing(pageImage, referenceImage);\n\n        return util.workAroundTransparencyIssueInFirefox(pageImage);\n    };\n\n    var compareRenderingAndReference = function (pageImage, referenceImage) {\n        var isEqual;\n\n        return workAroundBrowserIssues(pageImage, referenceImage).then(function (adaptedHtmlImage) {\n            if (referenceImage) {\n                isEqual = imagediff.equal(\n                    adaptedHtmlImage,\n                    referenceImage,\n                    toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux\n                );\n                return isEqual ? \"passed\" : \"failed\";\n            } else {\n                return \"referenceMissing\";\n            }\n        });\n    };\n\n    var comparisonResult = function (textualStatus, testCase, viewport, renderErrors, pageImage, referenceImage) {\n        var result = {\n            status: textualStatus,\n            testCase: testCase,\n            viewport: util.clone(viewport),\n            renderErrors: renderErrors\n        };\n\n        if (pageImage) {\n            result.pageImage = pageImage;\n        }\n        if (referenceImage) {\n            result.referenceImage = referenceImage;\n        }\n        return result;\n    };\n\n    var loadPageAndCompare = function (testCase, viewport, referenceImage) {\n        return renderer.render({\n            url: testCase.url,\n            hover: testCase.hover,\n            active: testCase.active,\n            width: viewport.width,\n            height: viewport.height\n        }).then(function (renderResult) {\n            return compareRenderingAndReference(renderResult.image, referenceImage).then(function (textualStatus) {\n                return comparisonResult(textualStatus,\n                                        testCase,\n                                        viewport,\n                                        renderResult.errors,\n                                        renderResult.image,\n                                        referenceImage);\n            });\n        }, function () {\n            return comparisonResult(\"error\",\n                                    testCase,\n                                    viewport,\n                                    []);\n        });\n    };\n\n    var viewportFallback = function (testCase) {\n        var fallbackWidth = 800,\n            fallbackHeight = 100;\n        return {\n            width: testCase.width || fallbackWidth,\n            height: testCase.height || fallbackHeight\n        };\n    };\n\n    module.compare = function (startingComparison) {\n        var viewport = startingComparison.viewport;\n\n        if (startingComparison.referenceImage === undefined) {\n            viewport = viewportFallback(startingComparison.testCase);\n        }\n\n        return loadPageAndCompare(startingComparison.testCase, viewport, startingComparison.referenceImage);\n    };\n\n    return module;\n};\n\ncsscriticLib.reporting = function (renderer, storage, util) {\n    \"use strict\";\n\n    var module = {};\n\n    var reporters = [];\n\n    module.addReporter = function (reporter) {\n        reporters.push(reporter);\n    };\n\n    var testCaseIsResizable = function (testCase) {\n        return testCase.width === undefined && testCase.height === undefined;\n    };\n\n    var attachPageAcceptHelpers = function (comparison) {\n        var viewportWidth, viewportHeight;\n\n        if (comparison.pageImage) {\n            viewportWidth = comparison.viewport.width;\n            viewportHeight = comparison.viewport.height;\n\n            if (testCaseIsResizable(comparison.testCase)) {\n                comparison.resizePageImage = function (width, height) {\n                    viewportWidth = width;\n                    viewportHeight = height;\n\n                    return renderer.render({\n                        url: comparison.testCase.url,\n                        hover: comparison.testCase.hover,\n                        active: comparison.testCase.active,\n                        width: width,\n                        height: height\n                    }).then(function (renderResult) {\n                        comparison.pageImage = renderResult.image;\n                        return renderResult.image;\n                    });\n                };\n            }\n            comparison.acceptPage = function () {\n                storage.storeReferenceImage(comparison.testCase, comparison.pageImage, {\n                    width: viewportWidth,\n                    height: viewportHeight\n                });\n            };\n        }\n    };\n\n    var reportingMethod = function (reporter, isSelected) {\n        if (isSelected) {\n            return reporter.reportSelectedComparison;\n        } else {\n            return reporter.reportDeselectedComparison;\n        }\n    };\n\n    module.doReportConfiguredComparison = function (configuredComparison, isSelected) {\n        return util.all(reporters.map(function (reporter) {\n            var reportingFunc = reportingMethod(reporter, isSelected);\n            if (reportingFunc) {\n                return reportingFunc(configuredComparison);\n            }\n        }));\n    };\n\n    module.doReportComparison = function (comparison) {\n        var result = util.clone(comparison);\n\n        attachPageAcceptHelpers(result);\n\n        return util.all(reporters.map(function (reporter) {\n            if (reporter.reportComparison) {\n                return reporter.reportComparison(result);\n            }\n        }));\n    };\n\n    module.doReportTestSuite = function (passed) {\n        return util.all(reporters.map(function (reporter) {\n            if (reporter.reportTestSuite) {\n                return reporter.reportTestSuite({success: passed});\n            }\n        }));\n    };\n\n    return module;\n};\n\ncsscriticLib.util = function () {\n    \"use strict\";\n\n    var module = {};\n\n    module.getDataURIForImage = function (image) {\n        var canvas = window.document.createElement(\"canvas\"),\n            context = canvas.getContext(\"2d\");\n\n        canvas.width = image.naturalWidth;\n        canvas.height = image.naturalHeight;\n\n        context.drawImage(image, 0, 0);\n\n        return canvas.toDataURL(\"image/png\");\n    };\n\n    module.getImageForUrl = function (url) {\n        var defer = ayepromise.defer(),\n            image = new window.Image();\n\n        image.onload = function () {\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            defer.reject();\n        };\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var getUncachableURL = function (url) {\n        var delimiter;\n        if (url.indexOf(\"?\") < 0) {\n            delimiter = \"?\";\n        } else {\n            delimiter = \"&\";\n        }\n        return url + delimiter + \"_=\" + Date.now();\n    };\n\n    module.ajax = function (url) {\n        var defer = ayepromise.defer(),\n            xhr = new XMLHttpRequest();\n\n        xhr.onload = function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.response);\n            } else {\n                defer.reject();\n            }\n        };\n\n        xhr.onerror = function () {\n            defer.reject();\n        };\n\n        try {\n            xhr.open('get', getUncachableURL(url), true);\n            xhr.send();\n        } catch (e) {\n            defer.reject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadAsBlob = function (url) {\n        var defer = ayepromise.defer(),\n            xhr = new XMLHttpRequest();\n\n        xhr.onload = function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.response);\n            } else {\n                defer.reject();\n            }\n        };\n\n        xhr.onerror = function () {\n            defer.reject();\n        };\n\n        try {\n            xhr.open('get', getUncachableURL(url), true);\n            xhr.responseType = 'blob';\n            xhr.send();\n        } catch (e) {\n            defer.reject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadBlobAsText = function (blob) {\n        var defer = ayepromise.defer(),\n            reader = new FileReader();\n\n        reader.onload = function (e) {\n            defer.resolve(e.target.result);\n        };\n\n        reader.onerror = function () {\n            defer.reject();\n        };\n\n        reader.readAsText(blob);\n\n        return defer.promise;\n    };\n\n    module.loadBlobAsDataURI = function (blob) {\n        var defer = ayepromise.defer(),\n            reader = new FileReader();\n\n        reader.onload = function (e) {\n            defer.resolve(e.target.result);\n        };\n\n        reader.onerror = function () {\n            defer.reject();\n        };\n\n        reader.readAsDataURL(blob);\n\n        return defer.promise;\n\n    };\n\n    // excludeKeys(theMap, excludeKey...)\n    module.excludeKeys = function (theMap) {\n        var excludeKeys = Array.prototype.slice.call(arguments, 1),\n            newMap = {};\n\n        Object.keys(theMap).forEach(function (key) {\n            if (excludeKeys.indexOf(key) === -1) {\n                newMap[key] = theMap[key];\n            }\n        });\n\n        return newMap;\n    };\n\n    module.serializeMap = function (theMap) {\n        var serializationEntries = [],\n            keys = Object.keys(theMap);\n\n        keys.sort();\n        keys.forEach(function (key) {\n            serializationEntries.push(key + '=' + theMap[key]);\n        });\n        return serializationEntries.join(',');\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n               theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var successfulPromise = function (value) {\n        var defer = ayepromise.defer();\n        defer.resolve(value);\n        return defer.promise;\n    };\n\n    module.workAroundTransparencyIssueInFirefox = function (image) {\n        // Work around bug https://bugzilla.mozilla.org/show_bug.cgi?id=790468 where the content of a canvas\n        //   drawn to another one will be slightly different if transparency is involved.\n        // Here the reference image has been drawn to a canvas once (to serialize it to localStorage), while the\n        //   image of the newly rendered page hasn't.  Solution: apply the same transformation to the second image, too.\n        var dataUri;\n        try {\n            dataUri = module.getDataURIForImage(image);\n        } catch (e) {\n            // Fallback for Chrome & Safari\n            return successfulPromise(image);\n        }\n\n        return module.getImageForUrl(dataUri);\n    };\n\n    module.hasTestSuitePassed = function (comparisons) {\n        var nonPassingTestCases = comparisons.filter(function (comparison) {\n                return comparison.status !== \"passed\";\n            }),\n            allPassed = nonPassingTestCases.length === 0,\n            hasValidTestSetup = comparisons.length > 0;\n\n        return hasValidTestSetup && allPassed;\n    };\n\n    module.all = function (functionReturnValues) {\n        var defer = ayepromise.defer(),\n            pendingFunctionCalls = functionReturnValues.length,\n            resolvedValues = [];\n\n        var functionCallResolved = function (value, idx) {\n            pendingFunctionCalls -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingFunctionCalls === 0) {\n                defer.resolve(resolvedValues);\n            }\n        };\n\n        if (functionReturnValues.length === 0) {\n            defer.resolve([]);\n            return defer.promise;\n        }\n\n        functionReturnValues.forEach(function (returnValue, idx) {\n            if (returnValue && returnValue.then) {\n                returnValue.then(function (result) {\n                    functionCallResolved(result, idx);\n                }, function (e) {\n                    defer.reject(e);\n                });\n            } else {\n                functionCallResolved(returnValue, idx);\n            }\n        });\n        return defer.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.browserRenderer = function (util, jobQueue, rasterizeHTML) {\n    \"use strict\";\n\n    var module = {};\n\n    var cache = {};\n\n    var queue;\n\n    var getOrCreateJobQueue = function () {\n        if (!queue) {\n            queue = jobQueue();\n        }\n        return queue;\n    };\n\n    var extractErrorMessages = function (errors) {\n        return errors.map(function (error) {\n            return error.msg;\n        });\n    };\n\n    var logErrorToConsole = function (e) {\n        console.error(e);\n\n        throw e;\n    };\n\n    var doRenderHtml = function (parameters) {\n        var drawOptions = {\n                cache: 'repeated',\n                cacheBucket: cache,\n                width: parameters.width,\n                height: parameters.height,\n                executeJs: true,\n                executeJsTimeout: 50,\n                baseUrl: parameters.baseUrl\n            };\n        if (parameters.hover) {\n            drawOptions.hover = parameters.hover;\n        }\n        if (parameters.active) {\n            drawOptions.active = parameters.active;\n        }\n\n        return rasterizeHTML.drawHTML(parameters.html, drawOptions).then(function (result) {\n            var renderErrors = extractErrorMessages(result.errors);\n\n            return {\n                image: result.image,\n                errors: renderErrors\n            };\n        }, logErrorToConsole);\n    };\n\n    var renderHtmlFromBlob = function (blob, parameters) {\n        return util.loadBlobAsText(blob).then(function (content) {\n            return doRenderHtml({\n                html: content,\n                baseUrl: parameters.url,\n                width: parameters.width,\n                height: parameters.height,\n                hover: parameters.hover,\n                active: parameters.active\n            });\n        });\n    };\n\n    var loadImageFromBlob = function (blob, parameters) {\n        return util.loadBlobAsDataURI(blob)\n            .then(util.getImageForUrl)\n            .then(function (image) {\n                return {\n                    image: image,\n                    errors: []\n                };\n            }, function () {\n                // It's not an image, so it must be a HTML page\n                return renderHtmlFromBlob(blob, parameters);\n            });\n    };\n\n    module.render = function (parameters) {\n        // Execute render jobs one after another to stabilise rendering (especially JS execution).\n        // Also provides a more fluid response. Performance seems not to be affected.\n        return getOrCreateJobQueue().execute(function () {\n            return util.loadAsBlob(parameters.url)\n                .then(function (blob) {\n                    return loadImageFromBlob(blob, parameters);\n                });\n        });\n    };\n\n    return module;\n};\n\ncsscriticLib.fallbackFilter = function (windowLocation) {\n    \"use strict\";\n\n    var module = {};\n\n    var storageKey = 'csscriticFallbackFilter';\n\n    var fullDescription = function (testCase) {\n        return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n    };\n\n    module.isComparisonSelected = function (comparison) {\n        var filter = sessionStorage.getItem(storageKey);\n\n        if (!filter) {\n            return true;\n        }\n\n        if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n            return true;\n        }\n        if (comparison.testCase.component && comparison.testCase.component === filter) {\n            return true;\n        }\n\n        return !filter || comparison.testCase.url === filter;\n    };\n\n    module.filterFor = function (testCase) {\n        var filter;\n\n        if (testCase.desc) {\n            filter = fullDescription(testCase);\n        } else {\n            filter = testCase.url;\n        }\n        sessionStorage.setItem(storageKey, filter);\n\n        windowLocation.reload();\n    };\n\n    module.filterForComponent = function (componentLabel) {\n        sessionStorage.setItem(storageKey, componentLabel);\n\n        windowLocation.reload();\n    };\n\n    module.clearFilter = function () {\n        sessionStorage.removeItem(storageKey);\n\n        windowLocation.reload();\n    };\n\n    return module;\n};\n\ncsscriticLib.indexeddbstorage = function (util) {\n    \"use strict\";\n\n    var module = {};\n\n    var createDb = function(db) {\n        db.createObjectStore('references', { keyPath: \"testCase\" });\n    };\n\n    var getDb = function () {\n        var defer = ayepromise.defer(),\n            request = indexedDB.open('csscritic', 1);\n\n        request.onsuccess = function (event) {\n            var db = event.target.result;\n            defer.resolve(db);\n        };\n        request.onupgradeneeded = function (event) {\n            var db = event.target.result;\n            createDb(db);\n        };\n        return defer.promise;\n    };\n\n    var buildKey = function (testCase) {\n        var testCaseParameters = util.excludeKeys(testCase, 'url'),\n            serializedParameters = util.serializeMap(testCaseParameters),\n            key = testCase.url;\n\n        if (serializedParameters) {\n            key += ',' + serializedParameters;\n        }\n\n        return key;\n    };\n\n    module.storeReferenceImage = function (testCase, referenceImage, viewport) {\n        var defer = ayepromise.defer(),\n            imageUri;\n\n        imageUri = util.getDataURIForImage(referenceImage);\n\n        var key = buildKey(testCase);\n\n        getDb().then(function (db) {\n            var request = db.transaction(['references'], 'readwrite')\n                .objectStore('references')\n                .put({\n                    testCase: key,\n                    reference: {\n                        imageUri: imageUri,\n                        viewport: viewport\n                    }\n                });\n\n            request.onsuccess = function () {\n                db.close();\n\n                defer.resolve();\n            };\n        });\n\n        return defer.promise;\n    };\n\n    module.readReferenceImage = function (testCase) {\n        var defer = ayepromise.defer(),\n            key = buildKey(testCase);\n\n        getDb().then(function (db) {\n            var request = db.transaction(['references'])\n                .objectStore('references')\n                .get(key);\n\n            request.onsuccess = function () {\n                db.close();\n\n                if (request.result === undefined || request.result.reference === undefined || request.result.reference.imageUri === undefined) {\n                    defer.reject();\n                    return;\n                }\n\n                var dataObj = request.result.reference;\n\n                util.getImageForUrl(dataObj.imageUri).then(function (img) {\n                    var viewport = dataObj.viewport || {\n                        width: img.width,\n                        height: img.height\n                    };\n\n                    defer.resolve({\n                        image: img,\n                        viewport: viewport\n                    });\n                }, defer.reject);\n            };\n        });\n\n        return defer.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.jobQueue = function () {\n    \"use strict\";\n\n    var module = {};\n\n    var jobQueue = [],\n        busy = false;\n\n    var runJob = function (job) {\n        var result = job.func();\n\n        job.resolve(result);\n        return result;\n    };\n\n    var nextInQueue = function () {\n        var job;\n        if (jobQueue.length > 0) {\n            busy = true;\n\n            job = jobQueue.shift();\n\n            runJob(job)\n                .then(nextInQueue, nextInQueue);\n        } else {\n            busy = false;\n        }\n    };\n\n    var constructJob = function (func) {\n        var defer = ayepromise.defer();\n\n        return {\n            func: func,\n            resolve: defer.resolve,\n            promise: defer.promise\n        };\n    };\n\n    module.execute = function (func) {\n        var job = constructJob(func);\n\n        jobQueue.push(job);\n        if (!busy) {\n            nextInQueue();\n        }\n\n        return job.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.niceReporter = function (window, util, selectionFilter, pageNavigationHandlingFallback, rasterizeHTML, packageVersion) {\n    \"use strict\";\n\n    var module = {};\n\n    // our very own templating implementation\n\n    var escapeValue = function (value) {\n        return value.toString()\n            .replace(/&/g, '&amp;')\n            .replace(new RegExp('<'), '&lt;', 'g') // work around https://github.com/cburgmer/inlineresources/issues/2\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&apos;');\n    };\n\n    var template = function (templateStr, values) {\n        return templateStr.replace(/\\{\\{(\\w+)\\}\\}/g, function (_, param) {\n            var value = values[param] !== undefined ? values[param] : '';\n            return escapeValue(value);\n        });\n    };\n\n    var elementFor = function (htmlString) {\n        var tmp = document.createElement('body');\n        tmp.insertAdjacentHTML('beforeend', htmlString);\n        return tmp.firstChild;\n    };\n\n    var findElementIn = function (container, elementClassName) {\n        return container.querySelector('.' + elementClassName);\n    };\n\n    var escapeId = function (id) {\n        return id.replace(/ /g, '_');\n    };\n\n    // container\n\n    var headerClassName = 'header',\n        timeTakenClassName = 'timeTaken',\n        progressBarClassName = 'progressBar',\n        statusTextClassName = 'statusText',\n        headerOptionalClassName = 'optional';\n\n    var createContainer = function (parentContainer) {\n        var reportBody = elementFor('<div class=\"cssCriticNiceReporter\"></div>');\n\n        showHeader(reportBody);\n\n        parentContainer.appendChild(reportBody);\n\n        return reportBody;\n    };\n\n    var elementDimensions = function (element) {\n        var initialPosition = element.getBoundingClientRect(),\n            scrollOffsetTop = document.body.scrollTop || document.documentElement.scrollTop,\n            scrollOffsetLeft = document.body.scrollLeft || document.documentElement.scrollLeft;\n\n        return {\n            top: initialPosition.top + scrollOffsetTop,\n            left: initialPosition.left + scrollOffsetLeft,\n            right: initialPosition.right - initialPosition.width + scrollOffsetLeft,\n            height: initialPosition.height\n        };\n    };\n\n    var px = function (value) {\n        return value + 'px';\n    };\n\n    var makeElementFixedOnScroll = function (element) {\n        var scrollingClass = 'scrolling',\n            smallClass = 'small',\n            smallScrollThreshold = 50,\n            isScrolling = false,\n            isSmall = false,\n            pseudoInlineElement = document.createElement('div'),\n            dimensions;\n\n        window.addEventListener(\"scroll\", function () {\n            if (window.scrollY > 0) {\n                if (! isScrolling) {\n                    isScrolling = true;\n\n                    dimensions = elementDimensions(element);\n\n                    element.classList.add(scrollingClass);\n\n                    element.style.position = 'fixed';\n                    element.style.top = px(dimensions.top);\n                    element.style.left = px(dimensions.left);\n                    element.style.right = px(dimensions.right);\n\n                    pseudoInlineElement.style.height = px(dimensions.height);\n                    element.parentElement.insertBefore(pseudoInlineElement, element);\n                }\n                if (! isSmall && window.scrollY > smallScrollThreshold) {\n                    isSmall = true;\n                    element.classList.add(smallClass);\n                } else if (isSmall && window.scrollY <= smallScrollThreshold) {\n                    isSmall = false;\n                    element.classList.remove(smallClass);\n                }\n            } else {\n                if (isScrolling) {\n                    isScrolling = false;\n\n                    element.classList.remove(scrollingClass);\n                    element.classList.remove(smallClass);\n\n                    element.style.position = '';\n                    element.style.top = '';\n                    element.style.left = '';\n                    element.style.right = '';\n\n                    element.parentElement.removeChild(pseudoInlineElement);\n                }\n            }\n        });\n    };\n\n    var showHeader = function (container) {\n        var header = elementFor(template('<header class=\"{{headerClassName}}\">' +\n                                         '<span class=\"{{timeTakenClassName}}\"></span>' +\n                                         '<a href=\"http://cburgmer.github.io/csscritic/\" class=\"cssCriticVersion\">' +\n                                         'CSS Critic {{packageVersion}}' +\n                                         '</a>' +\n                                         '<ul class=\"{{progressBarClassName}}\"></ul>' +\n                                         '<div class=\"{{headerOptionalClassName}}\">' +\n                                         '<div class=\"{{statusTextClassName}}\" class=\"statusText\"></div>' +\n                                         '</div>' +\n                                         '</header>', {\n                                             headerClassName: headerClassName,\n                                             timeTakenClassName: timeTakenClassName,\n                                             progressBarClassName: progressBarClassName,\n                                             headerOptionalClassName: headerOptionalClassName,\n                                             statusTextClassName: statusTextClassName,\n                                             packageVersion: packageVersion\n                                         }));\n\n        makeElementFixedOnScroll(header);\n        container.appendChild(header);\n    };\n\n    // document title\n\n    var originalTitle;\n\n    var updateStatusInDocumentTitle = function (totalCount, doneCount) {\n        if (originalTitle === undefined) {\n            originalTitle = document.title;\n        }\n\n        document.title = \"(\" + doneCount + \"/\" + totalCount + \") \" + originalTitle;\n    };\n\n    // header\n\n    var padNumber = function (number, length) {\n        number += '';\n        while (number.length < length) {\n            number = \"0\" + number;\n        }\n        return number;\n    };\n\n    var renderMilliseconds = function (time) {\n        var seconds = Math.floor(time / 1000),\n            milliSeconds = time % 1000;\n        return seconds + '.' + padNumber(milliSeconds, 3);\n    };\n\n    var showTimeTaken = function (container, timeTakenInMillis) {\n        var timeTaken = findElementIn(container, timeTakenClassName);\n        timeTaken.textContent = \"finished in \" + renderMilliseconds(timeTakenInMillis) + \"s\";\n    };\n\n    var setOutcomeOnHeader = function (container, successful) {\n        var header = findElementIn(container, headerClassName);\n\n        header.classList.add(successful ? 'pass' : 'fail');\n    };\n\n    // progress bar\n\n    var progressBarPendingClassName = 'pending';\n\n    var testDescription = function (testCase) {\n        var component;\n        if (testCase.desc) {\n            component = testCase.component ? testCase.component + ' ' : '';\n            return component + testCase.desc;\n        } else {\n            return comparisonKey(testCase);\n        }\n    };\n\n    var addTickToProgressBar = function (container, testCase, linkTarget) {\n        var progressBar = findElementIn(container, progressBarClassName),\n            clickableTickTemplate = '<li><a href=\"#{{linkTarget}}\" title=\"{{title}}\"></a></li>',\n            deactivatedTickTemplate = '<li><a title=\"{{title}}\"></a></li>',\n            tickTemplate = linkTarget ? clickableTickTemplate : deactivatedTickTemplate;\n\n        var tick = elementFor(template(tickTemplate, {\n            linkTarget: linkTarget ? escapeId(linkTarget) : '',\n            title: testDescription(testCase)\n        }));\n        tick.classList.add(progressBarPendingClassName);\n        progressBar.appendChild(tick);\n\n        if (pageNavigationHandlingFallback) {\n            pageNavigationHandlingFallback.install(tick.querySelector('a'));\n        }\n\n        return tick;\n    };\n\n    var markTickDone = function (status, renderErrorCount, tickElement) {\n        tickElement.classList.remove(progressBarPendingClassName);\n        tickElement.classList.add(status);\n        if (renderErrorCount > 0) {\n            tickElement.classList.add('hasRenderErrors');\n        }\n    };\n\n    // status bar\n\n    var singularPlural = function (value, singularForm, pluralForm) {\n        if (value === 1) {\n            return singularForm;\n        } else {\n            return pluralForm;\n        }\n    };\n\n    var statusTotalText = function (totalCount, selectedCount) {\n        var totalContent = '{{total}} ' + singularPlural(totalCount, 'entry', 'entries') + ', ';\n        if (selectedCount < totalCount) {\n            totalContent = '{{selected}} of ' + totalContent;\n        }\n        return template('<span>' +\n                        totalContent +\n                        '</span>', {\n            total: totalCount,\n            selected: selectedCount\n        });\n    };\n\n    var statusIssueText = function (issueCount, selectedCount, doneCount) {\n        var issueContent = '{{issues}} ' + singularPlural(issueCount, 'needs', 'need') + ' some love',\n            doneContent = 'all good',\n            noTestsContent = \"nothing here yet\",\n            doneWithoutErrors = selectedCount === doneCount && issueCount === 0,\n            content;\n        if (selectedCount === 0) {\n            content = noTestsContent;\n        } else if (doneWithoutErrors) {\n            content = doneContent;\n        } else {\n            content = issueContent;\n        }\n        return template('<span>' +\n                        content +\n                        '</span>', {\n                            issues: issueCount\n                        });\n    };\n\n    var acceptAllClassName = 'acceptAll';\n\n    var acceptAllButton = function () {\n        return elementFor(template('<button class=\"{{acceptAllClassName}}\">... accept all (I know what I\\'m doing)</button>', {\n            acceptAllClassName: acceptAllClassName\n        }));\n    };\n\n    var showAcceptAllButtonIfNeccessary = function (container, acceptableEntries) {\n        var statusText = findElementIn(container, statusTextClassName),\n            button = statusText.querySelector('.' + acceptAllClassName);\n\n        if (acceptableEntries.length > 2) {\n            button.classList.add('active');\n            button.onclick = function () {\n                acceptableEntries.forEach(function (acceptableEntry) {\n                    acceptableEntry.acceptPage();\n                    acceptComparison(acceptableEntry.entry);\n                });\n\n                button.setAttribute('disabled', 'disabled');\n            };\n        }\n    };\n\n    var installFallbackClearSelectionHandler = function (element) {\n        if (selectionFilter.clearFilter) {\n            element.onclick = function (e) {\n                selectionFilter.clearFilter();\n                e.preventDefault();\n            };\n        }\n    };\n\n    var updateStatusBar = function (container, totalCount, selectedCount, issueCount, doneCount) {\n        var runAllUrl = selectionFilter.clearFilterUrl ? selectionFilter.clearFilterUrl() : '#',\n            runAll = elementFor(template('<a class=\"runAll\" href=\"{{url}}\">Run all</a>', {\n                url: runAllUrl\n            })),\n            statusText = findElementIn(container, statusTextClassName);\n\n        statusText.innerHTML = '';\n        statusText.appendChild(elementFor(statusTotalText(totalCount, selectedCount)));\n        statusText.appendChild(elementFor(statusIssueText(issueCount, selectedCount, doneCount)));\n        statusText.appendChild(acceptAllButton());\n        if (totalCount > selectedCount) {\n            installFallbackClearSelectionHandler(runAll);\n            statusText.appendChild(runAll);\n        }\n    };\n\n    // ToC\n\n    var getOrCreateToc = function (container) {\n        var tocClassName = 'tocParent',\n            toc = container.querySelector('.' + tocClassName);\n\n        if (!toc) {\n            toc = elementFor(template('<div class=\"{{className}}\"><ul class=\"toc\"></ul></div>', {\n                className: tocClassName\n            }));\n            container.querySelector('.' + headerOptionalClassName).appendChild(toc);\n        }\n        return toc.querySelector('ul');\n    };\n\n    var addTocEntry = function (container, componentLabel, linkTarget) {\n        var toc = getOrCreateToc(container),\n            entry = elementFor(template('<li class=\"tocEntry\">' +\n                                        '<a href=\"#{{linkTarget}}\">{{headline}}</a>' +\n                                        '</li>', {\n                                            linkTarget: escapeId(linkTarget),\n                                            headline: componentLabel\n                                        }));\n\n        if (pageNavigationHandlingFallback) {\n            pageNavigationHandlingFallback.install(entry.querySelector('a'));\n        }\n\n        toc.appendChild(entry);\n    };\n\n    // component headline\n\n    var installFallbackComponentSelectionHandler = function (element, componentLabel) {\n        if (selectionFilter.filterForComponent) {\n            element.onclick = function (e) {\n                selectionFilter.filterForComponent(componentLabel);\n                e.preventDefault();\n            };\n        }\n    };\n\n    var addComponentHeading = function (container, componentLabel) {\n        var filterUrl = selectionFilter.filterUrlForComponent ? selectionFilter.filterUrlForComponent(componentLabel) : '#',\n            headlineElement = elementFor(template('<h2 class=\"componentLabel\"><a href=\"{{filterUrl}}\">{{headline}}</a></h2>', {\n                headline: componentLabel,\n                filterUrl: filterUrl\n            }));\n\n        installFallbackComponentSelectionHandler(headlineElement, componentLabel);\n        container.appendChild(headlineElement);\n    };\n\n    // comparisons\n\n    var comparisonKey = function (testCase) {\n        var testCaseParameters = util.excludeKeys(testCase, 'url'),\n            serializedParameters = util.serializeMap(testCaseParameters),\n            key = testCase.url;\n\n        if (serializedParameters) {\n            return key + ',' + serializedParameters;\n        }\n\n        return key;\n    };\n\n    var runningComparisonClassName = 'running',\n        referenceImageContainerClassName = 'referenceImageContainer',\n        errorContainerClassName = 'errorText';\n\n    var imageWrapper = function (image) {\n        var wrapper = elementFor('<div class=\"imageWrapper\"></div>');\n        wrapper.appendChild(image);\n        return wrapper;\n    };\n\n    var serializeValue = function (value) {\n        if (typeof value === 'string') {\n            return \"'\" + value + \"'\";\n        }\n        return value;\n    };\n\n    var testCaseParameters = function (testCase) {\n        var parameters = util.excludeKeys(testCase, 'url', 'desc', 'component'),\n            keys = Object.keys(parameters);\n\n        if (!keys.length) {\n            return '';\n        }\n        keys.sort();\n\n        return '<dl class=\"parameters\">' +\n            keys.map(function (key) {\n                return template('<dt>{{key}}</dt><dd>{{value}}</dd>', {\n                    key: key,\n                    value: serializeValue(parameters[key])\n                });\n            }).join('\\n') +\n            '</dl>';\n    };\n\n    var installFallbackSelectionHandler = function (element, testCase) {\n        if (selectionFilter.filterFor) {\n            element.onclick = function (e) {\n                selectionFilter.filterFor(testCase);\n                e.preventDefault();\n            };\n        }\n    };\n\n    var addComparison = function (container, testCase, referenceImage, key) {\n        var titleLinkClassName = 'titleLink',\n            filterUrl = selectionFilter.filterUrlFor ? selectionFilter.filterUrlFor(testCase) : '#',\n            comparison = elementFor(template('<section class=\"comparison {{runningComparisonClassName}}\">' +\n                                             '<h3 class=\"title\">' +\n                                             '<a class=\"{{titleLinkClassName}}\" href=\"{{filterUrl}}\">{{title}}</a> ' +\n                                             '<a class=\"externalLink\" href=\"{{url}}\"></a>' +\n                                             testCaseParameters(testCase) +\n                                             '</h3>' +\n                                             '<div class=\"{{errorContainerClassName}}\"></div>' +\n                                             '<div>' +\n                                             '<div class=\"{{referenceImageContainerClassName}}\"></div>' +\n                                             '</div>' +\n                                             '</section>', {\n                                                 url: testCase.url,\n                                                 title: testCase.desc ? testCase.desc : testCase.url,\n                                                 filterUrl: filterUrl,\n                                                 runningComparisonClassName: runningComparisonClassName,\n                                                 errorContainerClassName: errorContainerClassName,\n                                                 referenceImageContainerClassName: referenceImageContainerClassName,\n                                                 titleLinkClassName: titleLinkClassName\n                                             })),\n            anchorTarget = elementFor(template('<span class=\"fixedHeaderAnchorTarget\" id=\"{{id}}\"></span>', {\n                id: escapeId(key)\n            })),\n            referenceImageContainer = comparison.querySelector('.' + referenceImageContainerClassName),\n            titleLink = comparison.querySelector('.' + titleLinkClassName);\n\n        if (referenceImage) {\n            referenceImageContainer.appendChild(imageWrapper(referenceImage));\n        }\n        installFallbackSelectionHandler(titleLink, testCase);\n\n        container.appendChild(anchorTarget);\n        container.appendChild(comparison);\n\n        return comparison;\n    };\n\n    var canvasForImageCanvas = function (imageData) {\n        var canvas = document.createElement(\"canvas\"),\n            context;\n\n        canvas.height = imageData.height;\n        canvas.width  = imageData.width;\n\n        context = canvas.getContext(\"2d\");\n        context.putImageData(imageData, 0, 0);\n\n        return canvas;\n    };\n\n    var diffPageImages = function (imageA, imageB) {\n        return imagediff.diff(imageA, imageB, {align: 'top'});\n    };\n\n    var embossChanges = function (imageData) {\n        var d = imageData.data,\n            i;\n        for (i = 0; i < d.length; i += 4) {\n            if (d[i] === 0 && d[i+1] === 0 && d[i+2] === 0) {\n                d[i+3] = 0;\n            } else {\n                d[i] = 0;\n                d[i+1] = 0;\n                d[i+2] = 255;\n                d[i+3] = 255;\n            }\n        }\n        return imageData;\n    };\n\n    var getDifferenceCanvas = function (imageA, imageB) {\n        var differenceImageData = diffPageImages(imageA, imageB),\n            canvas = canvasForImageCanvas(embossChanges(differenceImageData));\n\n        canvas.classList.add('diff');\n        return canvas;\n    };\n\n    // Use a canvas for display to work around https://bugzilla.mozilla.org/show_bug.cgi?id=986403\n    var canvasForImage = function (image) {\n        var canvas = document.createElement(\"canvas\"),\n            width  = image.naturalWidth,\n            height = image.naturalHeight,\n            context;\n\n        canvas.width  = width;\n        canvas.height = height;\n\n        context = canvas.getContext(\"2d\");\n        context.drawImage(image, 0, 0, width, height);\n\n        // fix size in css so the tests will show something (canvas is not supported so far)\n        canvas.style.width = width + 'px';\n        canvas.style.height = height + 'px';\n\n        return canvas;\n    };\n\n    var addImageDiff = function (image, imageForDiff, container) {\n        var referenceImageContainer = container.querySelector('.' + referenceImageContainerClassName);\n\n        referenceImageContainer.appendChild(getDifferenceCanvas(image, imageForDiff));\n    };\n\n    var toggleViewClassName = 'toggleView',\n        acceptClassName = 'accept';\n\n    var acceptComparison = function (container) {\n        var acceptButton = container.querySelector('.' + acceptClassName);\n        acceptButton.setAttribute('disabled', 'disabled');\n        acceptButton.textContent = \"✓\";\n        container.classList.add('accepted');\n    };\n\n    var acceptButton = function (acceptPage, container) {\n        var button = elementFor(template('<button class=\"{{acceptClassName}}\">' +\n                                         '<span>Accept</span>' +\n                                         '</button>', {\n                                             acceptClassName: acceptClassName\n                                         }));\n        button.onclick = function () {\n            acceptPage();\n            acceptComparison(container);\n        };\n        return button;\n    };\n\n    var showPageImage = function (pageImage, testCaseUrl, realView, imageContainer, container) {\n        imageContainer.innerHTML = '';\n        if (realView) {\n            imageContainer.appendChild(imageWrapper(pageAsIframe(pageImage, testCaseUrl)));\n\n            container.classList.add('realView');\n        } else {\n            imageContainer.appendChild(imageWrapper(pageImage));\n\n            container.classList.remove('realView');\n        }\n    };\n\n    var pageImageContainer = function (pageImage, acceptPage, testCaseUrl, container) {\n        var pageImageContainerClassName = 'pageImageContainer',\n            outerPageImageContainer = elementFor(template('<div class=\"outerPageImageContainer\">' +\n                                                          '<div class=\"{{pageImageContainerClassName}}\"></div>' +\n                                                          '<button class=\"{{toggleViewClassName}}\" title=\"Toggle DOM view\"></button>' +\n                                                          '</div>', {\n                                                              pageImageContainerClassName: pageImageContainerClassName,\n                                                              toggleViewClassName: toggleViewClassName\n                                                          })),\n            pageImageContainer = outerPageImageContainer.querySelector('.' + pageImageContainerClassName),\n            toggleButton = outerPageImageContainer.querySelector('.' + toggleViewClassName),\n            showRealView = false,\n            accepted = false,\n            acceptButtonElement;\n\n        if (acceptPage) {\n            acceptButtonElement = acceptButton(function () {\n                accepted = true;\n                acceptPage();\n            }, container);\n\n            outerPageImageContainer.appendChild(acceptButtonElement);\n        }\n\n        showPageImage(pageImage, testCaseUrl, showRealView, pageImageContainer, container);\n\n        toggleButton.onclick = function () {\n            showRealView = !showRealView;\n            showPageImage(pageImage, testCaseUrl, showRealView, pageImageContainer, container);\n\n            if (acceptPage) {\n                if (showRealView) {\n                    acceptButtonElement.setAttribute('disabled', 'disabled');\n                } else if (!accepted) {\n                    acceptButtonElement.removeAttribute('disabled');\n                }\n            }\n        };\n\n        return outerPageImageContainer;\n    };\n\n    var showComparisonWithDiff = function (pageImage, referenceImage, acceptPage, testCaseUrl, container) {\n        addImageDiff(referenceImage, pageImage, container);\n        container.appendChild(pageImageContainer(canvasForImage(pageImage), acceptPage, testCaseUrl, container));\n    };\n\n    var pageAsIframe = function (pageImage, testCaseUrl) {\n        var iframe = document.createElement('iframe');\n        iframe.width = pageImage.width;\n        iframe.height = pageImage.height;\n        iframe.src = testCaseUrl;\n        iframe.scrolling = \"no\";\n        return iframe;\n    };\n\n    var showComparisonWithoutReference = function (pageImage, acceptPage, testCaseUrl, container) {\n        container.appendChild(pageImageContainer(canvasForImage(pageImage), acceptPage, testCaseUrl, container));\n    };\n\n    var sameOriginWarning = 'Make sure the path lies within the ' +\n        '<a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">' +\n        'same origin' +\n        '</a> ' +\n        'as this document.';\n\n    var showComparisonWithError = function (url, container) {\n        var errorMsg = elementFor(template('<span>' +\n                                           'The page \"{{url}}\" could not be rendered. ' +\n                                           sameOriginWarning +\n                                           '</span>', {\n                                               url: url\n                                           })),\n            errorContainer = container.querySelector('.' + errorContainerClassName);\n        errorContainer.appendChild(errorMsg);\n    };\n\n    var showRenderErrors = function (errors, container) {\n        var errorMsg = elementFor(template('<span>' +\n                                           'Had the following errors rendering the page:' +\n                                           '<ul></ul>' +\n                                           sameOriginWarning +\n                                           '</span>')),\n            listElement = errorMsg.querySelector('ul'),\n            errorContainer = container.querySelector('.' + errorContainerClassName);\n\n        errors.map(function (error) {\n            return elementFor(template('<li>{{msg}}</li>', {msg: error}));\n        }).forEach(function (li) {\n            listElement.appendChild(li);\n        });\n\n        errorContainer.appendChild(errorMsg);\n    };\n\n    var updateComparisonStatus = function (status, container) {\n        container.classList.remove(runningComparisonClassName);\n        container.classList.add(status);\n    };\n\n    // browser warning\n\n    var supportsReadingHtmlFromCanvas = function () {\n        return rasterizeHTML.drawHTML('<b></b>').then(function (result) {\n            var canvas = document.createElement(\"canvas\"),\n                context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(result.image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                return true;\n            } catch (e) {\n                return false;\n            }\n        });\n    };\n\n    var browserIssueChecked = false;\n\n    var showBrowserWarningIfNeeded = function (container) {\n        if (browserIssueChecked) {\n            return;\n        }\n        browserIssueChecked = true;\n\n        supportsReadingHtmlFromCanvas().then(function (supported) {\n            if (supported) {\n                return;\n            }\n\n            container.appendChild(elementFor(\n                '<div class=\"browserWarning\">' +\n                    'Your browser is currently not supported, ' +\n                    'as it does not support reading rendered HTML from the canvas ' +\n                    '(<a href=\"https://code.google.com/p/chromium/issues/detail?id=294129\">Chrome #294129</a>, ' +\n                    '<a href=\"https://bugs.webkit.org/show_bug.cgi?id=17352\">Safari #17352</a>). How about trying Firefox?' +\n                    '</div>'\n            ));\n        });\n    };\n\n    // the reporter\n\n    module.NiceReporter = function (outerContainer) {\n        var totalCount = 0,\n            selectedCount = 0,\n            doneCount = 0,\n            issueCount = 0,\n            progressTickElements = {},\n            runningComparisonEntries = {},\n            acceptableComparisons = [],\n            containerElement, timeStarted, lastComponentLabel;\n\n        var container = function () {\n            if (!containerElement) {\n                containerElement = createContainer(outerContainer || document.body);\n            }\n            return containerElement;\n        };\n\n        var registerComparison = function () {\n            totalCount += 1;\n            if (!timeStarted) {\n                timeStarted = Date.now();\n            }\n\n            showBrowserWarningIfNeeded(container());\n            updateStatusInDocumentTitle(totalCount, doneCount);\n            updateStatusBar(container(), totalCount, selectedCount, issueCount);\n        };\n\n        return {\n            reportDeselectedComparison: function (comparison) {\n                registerComparison();\n\n                addTickToProgressBar(container(), comparison.testCase);\n            },\n            reportSelectedComparison: function (comparison) {\n                var key = comparisonKey(comparison.testCase);\n                selectedCount += 1;\n\n                if (comparison.testCase.component && comparison.testCase.component !== lastComponentLabel) {\n                    lastComponentLabel = comparison.testCase.component;\n                    addComponentHeading(container(), comparison.testCase.component);\n                    addTocEntry(container(), comparison.testCase.component, key);\n                }\n\n                registerComparison();\n\n                var tickElement = addTickToProgressBar(container(), comparison.testCase, key);\n                progressTickElements[key] = tickElement;\n\n                var comparisonElement = addComparison(container(),\n                                                      comparison.testCase,\n                                                      comparison.referenceImage,\n                                                      key);\n                runningComparisonEntries[key] = comparisonElement;\n            },\n            reportComparison: function (comparison) {\n                var key = comparisonKey(comparison.testCase),\n                    tickElement = progressTickElements[key],\n                    entry = runningComparisonEntries[key];\n\n                doneCount += 1;\n                if (comparison.status !== 'passed') {\n                    issueCount += 1;\n                }\n\n                updateStatusInDocumentTitle(totalCount, doneCount);\n                updateStatusBar(container(), totalCount, selectedCount, issueCount, doneCount);\n                markTickDone(comparison.status, comparison.renderErrors.length, tickElement);\n\n                if (comparison.status === 'failed') {\n                    showComparisonWithDiff(comparison.pageImage,\n                                           comparison.referenceImage,\n                                           comparison.acceptPage,\n                                           comparison.testCase.url,\n                                           entry);\n                    acceptableComparisons.push(comparison);\n                } else if (comparison.status === 'referenceMissing') {\n                    showComparisonWithoutReference(comparison.pageImage,\n                                                   comparison.acceptPage,\n                                                   comparison.testCase.url,\n                                                   entry);\n                    acceptableComparisons.push(comparison);\n                } else if (comparison.status === 'passed') {\n                    showComparisonWithoutReference(comparison.pageImage,\n                                                   undefined,\n                                                   comparison.testCase.url,\n                                                   entry);\n                } else if (comparison.status === 'error') {\n                    showComparisonWithError(comparison.testCase.url,\n                                            entry);\n                }\n\n                if (comparison.renderErrors.length > 0) {\n                    showRenderErrors(comparison.renderErrors, entry);\n                }\n\n                updateComparisonStatus(comparison.status, entry);\n            },\n            reportTestSuite: function (result) {\n                var acceptableEntries = acceptableComparisons.map(function (comparison) {\n                    var key = comparisonKey(comparison.testCase);\n                    return {\n                        acceptPage: comparison.acceptPage,\n                        entry: runningComparisonEntries[key]\n                    };\n                });\n\n                updateStatusInDocumentTitle(totalCount, doneCount);\n                updateStatusBar(container(), totalCount, selectedCount, issueCount, doneCount);\n\n                showTimeTaken(container(), timeStarted ? Date.now() - timeStarted : 0);\n                setOutcomeOnHeader(container(), result.success);\n                showAcceptAllButtonIfNeccessary(container(), acceptableEntries);\n            }\n        };\n    };\n\n    return module;\n};\n\n/* Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n * Replaces anchors with inner page targets with a JavaScript navigation handling implementation.\n */\ncsscriticLib.pageNavigationHandlingFallback = function () {\n    \"use strict\";\n\n    var module = {};\n\n    var fakeTargetClassName = 'fakeTarget';\n\n    var clearFakeActiveClass = function () {\n        var previousTargets = Array.prototype.slice.call(document.querySelectorAll('.' + fakeTargetClassName));\n        previousTargets.forEach(function (elem) {\n            elem.classList.remove(fakeTargetClassName);\n        });\n    };\n\n    var triggerFakeActiveClass = function (targetElement) {\n        targetElement.classList.add(fakeTargetClassName);\n    };\n\n    var scrollTo = function (id) {\n        var targetElement;\n\n        clearFakeActiveClass();\n        if (id) {\n            targetElement = document.getElementById(id);\n            targetElement.scrollIntoView();\n            triggerFakeActiveClass(targetElement);\n        } else {\n            window.scrollTo(0, 0);\n        }\n    };\n\n    var globalNavigationHandlingInstalled = false;\n\n    var installGlobalNavigationHandling = function () {\n        if (!globalNavigationHandlingInstalled) {\n            globalNavigationHandlingInstalled = true;\n\n            window.onpopstate = function (e) {\n                scrollTo(e.state);\n            };\n        }\n    };\n\n    module.install = function (element) {\n        installGlobalNavigationHandling();\n\n        element.onclick = function (e) {\n            var targetLink = decodeURIComponent(e.target.href),\n                targetId = targetLink.substr(targetLink.indexOf('#')+1);\n\n            scrollTo(targetId);\n            history.pushState(targetId, targetId);\n            e.preventDefault();\n        };\n    };\n\n    return module;\n};\n\ncsscriticLib.urlQueryFilter = function (windowLocation) {\n    \"use strict\";\n\n    var module = {};\n\n    var filterParam = 'filter';\n\n    var parseUrlSearch = function (search) {\n        var paramString = search.replace(/^\\?/, '');\n        if (!paramString) {\n            return [];\n        }\n        return paramString\n            .split('&')\n            .map(function (keyValue) {\n                var equalsIdx = keyValue.indexOf('='),\n                    key, value;\n\n                if (equalsIdx >= 0) {\n                    key = keyValue.substr(0, equalsIdx);\n                    value = keyValue.substr(equalsIdx + 1);\n                } else {\n                    key = keyValue;\n                }\n                return {\n                    key: key,\n                    value: value\n                };\n            });\n    };\n\n    var serializeKeyValuePair = function (pair) {\n        if (pair.value) {\n            return pair.key + '=' + pair.value;\n        }\n        return pair.key;\n    };\n\n    var getFilterValue = function () {\n        var filterKeyValue = parseUrlSearch(windowLocation.search)\n                .filter(function (entryPair) {\n                    return entryPair.key === filterParam;\n                })\n                .pop();\n\n        if (filterKeyValue) {\n            return decodeURIComponent(filterKeyValue.value);\n        }\n    };\n\n    var fullDescription = function (testCase) {\n        return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n    };\n\n    var filter = getFilterValue(),\n        existingQueryParams = parseUrlSearch(windowLocation.search);\n\n    // interface towards main.js\n\n    module.isComparisonSelected = function (comparison) {\n        if (!filter) {\n            return true;\n        }\n\n        if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n            return true;\n        }\n        if (comparison.testCase.component && comparison.testCase.component === filter) {\n            return true;\n        }\n        return comparison.testCase.url === filter;\n    };\n\n    // interface towards browser reporters\n\n    var queryPart = function (selection) {\n        var queryParams = existingQueryParams\n                .filter(function (pair) {\n                    return pair.key !== filterParam;\n                });\n        if (selection) {\n            queryParams.push({\n                key: filterParam,\n                value: encodeURIComponent(selection)\n            });\n        }\n\n        return '?' + queryParams.map(serializeKeyValuePair).join('&');\n    };\n\n    module.filterUrlForComponent = function (componentLabel) {\n        return queryPart(componentLabel);\n    };\n\n    module.filterUrlFor = function (testCase) {\n        if (testCase.desc) {\n            return queryPart(fullDescription(testCase));\n        }\n        return queryPart(testCase.url);\n    };\n\n    module.clearFilterUrl = function () {\n        return queryPart();\n    };\n\n    return module;\n};\n\ncsscriticLib.packageVersion = '1.2.0-alpha';\n\n/* exported csscritic */\nvar csscritic = (function () {\n    \"use strict\";\n\n    var installCallChain = function (func, self) {\n        return function chainableProxy() {\n            func.apply(null, arguments);\n            return self;\n        };\n    };\n\n    var startsWith = function (str, prefix) {\n        // PhantomJS has no startsWith\n        return str.substr(0, prefix.length) === prefix;\n    };\n\n    // Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n    var needsFallback = function () {\n        return startsWith(window.location.href, 'file://');\n    };\n\n    var packageVersion = csscriticLib.packageVersion || 'dev',\n        util = csscriticLib.util();\n\n    var indexedDbStorage = csscriticLib.indexeddbstorage(util);\n\n    var browserRenderer = csscriticLib.browserRenderer(util, csscriticLib.jobQueue, rasterizeHTML),\n        reporting = csscriticLib.reporting(browserRenderer, indexedDbStorage, util),\n        regression = csscriticLib.regression(browserRenderer, util, imagediff),\n        queryFilter = csscriticLib.urlQueryFilter(window.location),\n        fallbackFilter = csscriticLib.fallbackFilter(window.location);\n\n    var filter = needsFallback() ? fallbackFilter : queryFilter;\n\n    var main = csscriticLib.main(\n        regression,\n        reporting,\n        util,\n        indexedDbStorage,\n        filter\n    );\n\n    var pageNavigationHandlingFallback = csscriticLib.pageNavigationHandlingFallback(window.location),\n        niceReporter = csscriticLib.niceReporter(\n            window,\n            util,\n            filter,\n            needsFallback() ? pageNavigationHandlingFallback : undefined,\n            rasterizeHTML,\n            packageVersion\n        );\n\n\n    var self = {};\n\n    self.add = installCallChain(main.add, self);\n    self.component = installCallChain(main.component, self);\n    self.execute = main.execute;\n\n    self.addReporter = installCallChain(reporting.addReporter, self);\n\n    self.NiceReporter = niceReporter.NiceReporter;\n\n    return self;\n}());\n\nreturn csscritic;\n\n}));\n","var css = \".cssCriticNiceReporter{font-family:sans-serif;font-size:16px}.cssCriticNiceReporter a{text-decoration:none;color:inherit}.cssCriticNiceReporter .comparison .title .titleLink:hover,.cssCriticNiceReporter .componentLabel:hover,.cssCriticNiceReporter .errorText a{text-decoration:underline}.cssCriticNiceReporter button{padding:2px 10px;border-radius:3px;border:none;background-color:#00c04e;font-size:inherit;font-family:inherit}.cssCriticNiceReporter button[disabled]{background-color:#ddd}.cssCriticNiceReporter button:hover{background-color:#24d66c}.cssCriticNiceReporter button:not([disabled]):active{background-color:#4cec8d}.cssCriticNiceReporter .errorText{color:#591100;margin-bottom:1em}.cssCriticNiceReporter .errorText:not(:empty)::before{content:\\\" \\\";margin-right:5px;margin-top:-.3rem;width:1.4rem;height:1.4rem;vertical-align:top;display:inline-block;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik04OTYgMTI4cTIwOSAwIDM4NS41IDEwM3QyNzkuNSAyNzkuNSAxMDMgMzg1LjUtMTAzIDM4NS41LTI3OS41IDI3OS41LTM4NS41IDEwMy0zODUuNS0xMDMtMjc5LjUtMjc5LjUtMTAzLTM4NS41IDEwMy0zODUuNSAyNzkuNS0yNzkuNSAzODUuNS0xMDN6bTEyOCAxMjQ3di0xOTBxMC0xNC05LTIzLjV0LTIyLTkuNWgtMTkycS0xMyAwLTIzIDEwdC0xMCAyM3YxOTBxMCAxMyAxMCAyM3QyMyAxMGgxOTJxMTMgMCAyMi05LjV0OS0yMy41em0tMi0zNDRsMTgtNjIxcTAtMTItMTAtMTgtMTAtOC0yNC04aC0yMjBxLTE0IDAtMjQgOC0xMCA2LTEwIDE4bDE3IDYyMXEwIDEwIDEwIDE3LjV0MjQgNy41aDE4NXExNCAwIDIzLjUtNy41dDEwLjUtMTcuNXoiLz48L3N2Zz4K)center center/90% no-repeat}.cssCriticNiceReporter .errorText ul{margin:.2em 0}.cssCriticNiceReporter .header{padding:15px;opacity:1;transition-property:background-color,opacity;transition-duration:1s,0s;transition-delay:0s,0s}.cssCriticNiceReporter .header.scrolling{z-index:1;background-color:#fff;margin-top:-8px;margin-bottom:-8px;border-top:8px solid #fff}.cssCriticNiceReporter .fixedHeaderAnchorTarget{height:130px;margin-top:-130px;display:block;visibility:hidden}.cssCriticNiceReporter .header.pass{background-color:#00c04e}.cssCriticNiceReporter .header.fail{background-color:#ff3100}.cssCriticNiceReporter .timeTaken{float:right;padding:.5em 0 0 1em}.cssCriticNiceReporter .statusText{margin-top:.55rem;display:inline-block}.cssCriticNiceReporter .statusText .runAll{display:block;margin-top:.5em;text-decoration:underline}.cssCriticNiceReporter .acceptAll{display:none;margin:-4px 0 -4px 1em}.cssCriticNiceReporter .acceptAll.active{display:inline-block}.cssCriticNiceReporter .cssCriticVersion{display:block;margin:0 0 .3rem;font-size:.7rem}.cssCriticNiceReporter .header.small:not(:hover){opacity:.85;transition-duration:1s,1s;transition-delay:0s,.5s}.cssCriticNiceReporter .header .optional{max-height:200px;transition:max-height .2s;margin:0 -3px -4px;padding:0 3px 4px;overflow:hidden}.cssCriticNiceReporter .header.small:not(:hover) .optional{max-height:0}.cssCriticNiceReporter .header.small:not(:hover) .timeTaken{display:none}.cssCriticNiceReporter .progressBar{margin:0;list-style:none;padding:0}.cssCriticNiceReporter .progressBar:empty::after{content:'';width:0;height:0;border:.63rem solid;border-radius:50%;display:inline-block;opacity:.15}.cssCriticNiceReporter .progressBar li{display:inline-block;vertical-align:top;margin-right:-.4rem;transition:color 1s}.cssCriticNiceReporter .progressBar a{width:0;height:0;border:.63rem solid;border-radius:50%;display:block}.cssCriticNiceReporter .progressBar .pending{color:grey}.cssCriticNiceReporter .progressBar .passed{color:#048337}.cssCriticNiceReporter .progressBar .failed{color:#b62705}.cssCriticNiceReporter .progressBar .error{color:#591100}.cssCriticNiceReporter .progressBar .referenceMissing{color:#ff0}.cssCriticNiceReporter .progressBar a:focus{outline:0}.cssCriticNiceReporter .progressBar .hasRenderErrors{position:relative}.cssCriticNiceReporter .progressBar .hasRenderErrors a::after{content:' ';position:absolute;top:0;left:0;right:0;bottom:0;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMDg4IDEyNDh2MjI0cTAgMjYtMTkgNDV0LTQ1IDE5aC0yNTZxLTI2IDAtNDUtMTl0LTE5LTQ1di0yMjRxMC0yNiAxOS00NXQ0NS0xOWgyNTZxMjYgMCA0NSAxOXQxOSA0NXptMzAtMTA1NmwtMjggNzY4cS0xIDI2LTIwLjUgNDV0LTQ1LjUgMTloLTI1NnEtMjYgMC00NS41LTE5dC0yMC41LTQ1bC0yOC03NjhxLTEtMjYgMTcuNS00NXQ0NC41LTE5aDMyMHEyNiAwIDQ0LjUgMTl0MTcuNSA0NXoiLz48L3N2Zz4K)center center/70% no-repeat}.cssCriticNiceReporter .componentLabel{margin:1.8em 0 .5em 15px;font-size:1.15rem}.cssCriticNiceReporter .toc{display:inline-block;list-style:none;padding:3px;margin:1rem -3px 0;font-size:.9rem;background:rgba(255,255,255,.3)}.cssCriticNiceReporter .tocEntry{display:inline-block;margin-right:.8rem}.cssCriticNiceReporter .tocEntry:last-child{margin-right:0}.cssCriticNiceReporter .comparison{background-color:#f5f5f5;padding:15px;margin:4px 0 0}.cssCriticNiceReporter .comparison .title{font-weight:400}.cssCriticNiceReporter .fakeTarget+.comparison,.cssCriticNiceReporter :target+.comparison{padding-left:10px;border-left:5px solid rgba(0,0,0,.15)}.cssCriticNiceReporter .comparison .title .externalLink{vertical-align:top;display:inline-block;width:18px;height:18px;margin-left:.2rem;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xNDA4IDkyOHYzMjBxMCAxMTktODQuNSAyMDMuNXQtMjAzLjUgODQuNWgtODMycS0xMTkgMC0yMDMuNS04NC41dC04NC41LTIwMy41di04MzJxMC0xMTkgODQuNS0yMDMuNXQyMDMuNS04NC41aDcwNHExNCAwIDIzIDl0OSAyM3Y2NHEwIDE0LTkgMjN0LTIzIDloLTcwNHEtNjYgMC0xMTMgNDd0LTQ3IDExM3Y4MzJxMCA2NiA0NyAxMTN0MTEzIDQ3aDgzMnE2NiAwIDExMy00N3Q0Ny0xMTN2LTMyMHEwLTE0IDktMjN0MjMtOWg2NHExNCAwIDIzIDl0OSAyM3ptMzg0LTg2NHY1MTJxMCAyNi0xOSA0NXQtNDUgMTktNDUtMTlsLTE3Ni0xNzYtNjUyIDY1MnEtMTAgMTAtMjMgMTB0LTIzLTEwbC0xMTQtMTE0cS0xMC0xMC0xMC0yM3QxMC0yM2w2NTItNjUyLTE3Ni0xNzZxLTE5LTE5LTE5LTQ1dDE5LTQ1IDQ1LTE5aDUxMnEyNiAwIDQ1IDE5dDE5IDQ1eiIvPjwvc3ZnPgo=)center center/90% no-repeat;opacity:.3}.cssCriticNiceReporter .comparison .title .externalLink:hover{opacity:.5}.cssCriticNiceReporter .comparison .parameters,.cssCriticNiceReporter .comparison .parameters dd,.cssCriticNiceReporter .comparison .parameters dt{display:inline-block;margin:0}.cssCriticNiceReporter .comparison .parameters{margin-left:1.5em;color:#444}.cssCriticNiceReporter .comparison .parameters dt{font-style:italic}.cssCriticNiceReporter .comparison .parameters dt::after{content:\\\":\\\"}.cssCriticNiceReporter .comparison .parameters dd{margin-left:.5em;margin-right:.7em}.cssCriticNiceReporter .comparison .parameters dd::after{content:\\\",\\\"}.cssCriticNiceReporter .comparison .parameters dd:last-child::after{content:\\\"\\\"}.cssCriticNiceReporter .running.comparison .referenceImageContainer{opacity:.2}.cssCriticNiceReporter .comparison .referenceImageContainer:empty{display:none}.cssCriticNiceReporter .comparison .imageWrapper{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAKUlEQVQ4jWNYt27df2Lwo0ePiMIMowaOGjgsDSRWIbEWjxo4auCwNBAAenk4PB4atggAAAAASUVORK5CYII=)-5px -5px;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cssCriticNiceReporter .comparison canvas,.cssCriticNiceReporter .comparison img{display:block}.cssCriticNiceReporter .comparison .pageImageContainer,.cssCriticNiceReporter .comparison .referenceImageContainer{border:1px solid #000}.cssCriticNiceReporter .comparison .outerPageImageContainer,.cssCriticNiceReporter .comparison .referenceImageContainer{position:relative;display:inline-block}.cssCriticNiceReporter .comparison .referenceImageContainer .diff{max-height:0;max-width:0;opacity:0}.cssCriticNiceReporter .passed.comparison .referenceImageContainer{display:none}.cssCriticNiceReporter .failed.comparison .referenceImageContainer{margin-bottom:4px}.cssCriticNiceReporter .failed.comparison .referenceImageContainer:hover .diff{max-height:none;max-width:none;opacity:1;transition:opacity 1s}.cssCriticNiceReporter .failed.comparison .referenceImageContainer:hover .imageWrapper{opacity:.5;transition:opacity 1s;position:absolute;top:0;left:0;right:0;bottom:0}.cssCriticNiceReporter .comparison iframe{border:none;display:block;background:0 0}.cssCriticNiceReporter .comparison.realView .pageImageContainer{border-style:dashed}.cssCriticNiceReporter .comparison .toggleView{vertical-align:top;position:absolute;top:0;height:30px;right:-45px;width:30px;font-size:.7rem;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xNjY0IDk2MHEtMTUyLTIzNi0zODEtMzUzIDYxIDEwNCA2MSAyMjUgMCAxODUtMTMxLjUgMzE2LjV0LTMxNi41IDEzMS41LTMxNi41LTEzMS41LTEzMS41LTMxNi41cTAtMTIxIDYxLTIyNS0yMjkgMTE3LTM4MSAzNTMgMTMzIDIwNSAzMzMuNSAzMjYuNXQ0MzQuNSAxMjEuNSA0MzQuNS0xMjEuNSAzMzMuNS0zMjYuNXptLTcyMC0zODRxMC0yMC0xNC0zNHQtMzQtMTRxLTEyNSAwLTIxNC41IDg5LjV0LTg5LjUgMjE0LjVxMCAyMCAxNCAzNHQzNCAxNCAzNC0xNCAxNC0zNHEwLTg2IDYxLTE0N3QxNDctNjFxMjAgMCAzNC0xNHQxNC0zNHptODQ4IDM4NHEwIDM0LTIwIDY5LTE0MCAyMzAtMzc2LjUgMzY4LjV0LTQ5OS41IDEzOC41LTQ5OS41LTEzOS0zNzYuNS0zNjhxLTIwLTM1LTIwLTY5dDIwLTY5cTE0MC0yMjkgMzc2LjUtMzY4dDQ5OS41LTEzOSA0OTkuNSAxMzkgMzc2LjUgMzY4cTIwIDM1IDIwIDY5eiIvPjwvc3ZnPgo=)center center/80% no-repeat;opacity:.3}.cssCriticNiceReporter .comparison .toggleView:hover{opacity:.5}.cssCriticNiceReporter .comparison.realView .toggleView{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik01NTUgMTMzNWw3OC0xNDFxLTg3LTYzLTEzNi0xNTl0LTQ5LTIwM3EwLTEyMSA2MS0yMjUtMjI5IDExNy0zODEgMzUzIDE2NyAyNTggNDI3IDM3NXptMzg5LTc1OXEwLTIwLTE0LTM0dC0zNC0xNHEtMTI1IDAtMjE0LjUgODkuNXQtODkuNSAyMTQuNXEwIDIwIDE0IDM0dDM0IDE0IDM0LTE0IDE0LTM0cTAtODYgNjEtMTQ3dDE0Ny02MXEyMCAwIDM0LTE0dDE0LTM0em0zNjMtMTkxcTAgNy0xIDktMTA1IDE4OC0zMTUgNTY2dC0zMTYgNTY3bC00OSA4OXEtMTAgMTYtMjggMTYtMTIgMC0xMzQtNzAtMTYtMTAtMTYtMjggMC0xMiA0NC04Ny0xNDMtNjUtMjYzLjUtMTczdC0yMDguNS0yNDVxLTIwLTMxLTIwLTY5dDIwLTY5cTE1My0yMzUgMzgwLTM3MXQ0OTYtMTM2cTg5IDAgMTgwIDE3bDU0LTk3cTEwLTE2IDI4LTE2IDUgMCAxOCA2dDMxIDE1LjUgMzMgMTguNSAzMS41IDE4LjUgMTkuNSAxMS41cTE2IDEwIDE2IDI3em0zNyA0NDdxMCAxMzktNzkgMjUzLjV0LTIwOSAxNjQuNWwyODAtNTAycTggNDUgOCA4NHptNDQ4IDEyOHEwIDM1LTIwIDY5LTM5IDY0LTEwOSAxNDUtMTUwIDE3Mi0zNDcuNSAyNjd0LTQxOS41IDk1bDc0LTEzMnEyMTItMTggMzkyLjUtMTM3dDMwMS41LTMwN3EtMTE1LTE3OS0yODItMjk0bDYzLTExMnE5NSA2NCAxODIuNSAxNTN0MTQ0LjUgMTg0cTIwIDM0IDIwIDY5eiIvPjwvc3ZnPgo=);opacity:1}.cssCriticNiceReporter .comparison .accept{vertical-align:top;position:absolute;top:48px;bottom:0;right:-65px;width:50px;font-size:.7rem}.cssCriticNiceReporter .accepted.comparison .accept{font-size:1.4rem}.cssCriticNiceReporter .comparison button span{transform:rotate(-90deg);display:block}.cssCriticNiceReporter .comparison .referenceImageContainer{opacity:1;max-height:1000000px}.cssCriticNiceReporter .accepted.comparison .referenceImageContainer{opacity:0;max-height:0;border-width:0;transition:max-height .001s ease 1s,opacity 1s,border-width .001s ease 1s}.cssCriticNiceReporter .comparison:hover .referenceImageContainer::after{position:absolute;top:0;right:0;transform:translateX(100%);margin-right:-8px;padding:4px;white-space:nowrap;background-color:#000;opacity:.55;color:#fff;font-size:.9rem;border-radius:5px}.cssCriticNiceReporter .failed.comparison:hover .referenceImageContainer::after{content:\\\"< Hover over the reference image to highlight changes\\\"}.cssCriticNiceReporter .failed.comparison .referenceImageContainer:hover::after{display:none}.cssCriticNiceReporter .browserWarning::before{content:\\\"⚠\\\";font-size:1.2rem;padding-right:5px;vertical-align:middle}.cssCriticNiceReporter .browserWarning{position:fixed;top:0;left:0;width:100%;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:2;background-color:rgba(182,39,5,.85);color:#fff;font-size:1.2rem;border:2px solid #000;padding:20px}\"; (require(\"./../node_modules/cssify\"))(css); module.exports = css;","module.exports = function (css, customDocument) {\n  var doc = customDocument || document;\n  if (doc.createStyleSheet) {\n    var sheet = doc.createStyleSheet()\n    sheet.cssText = css;\n    return sheet.ownerNode;\n  } else {\n    var head = doc.getElementsByTagName('head')[0],\n        style = doc.createElement('style');\n\n    style.type = 'text/css';\n\n    if (style.styleSheet) {\n      style.styleSheet.cssText = css;\n    } else {\n      style.appendChild(doc.createTextNode(css));\n    }\n\n    head.appendChild(style);\n    return style;\n  }\n};\n\nmodule.exports.byUrl = function(url) {\n  if (document.createStyleSheet) {\n    return document.createStyleSheet(url).ownerNode;\n  } else {\n    var head = document.getElementsByTagName('head')[0],\n        link = document.createElement('link');\n\n    link.rel = 'stylesheet';\n    link.href = url;\n\n    head.appendChild(link);\n    return link;\n  }\n};\n","// js-imagediff 1.0.3\n// (c) 2011-2012 Carl Sutherland, Humble Software\n// Distributed under the MIT License\n// For original source and documentation visit:\n// http://www.github.com/HumbleSoftware/js-imagediff\n\n(function (name, definition) {\n  var root = this;\n  if (typeof module !== 'undefined') {\n    try {\n      var Canvas = require('canvas');\n    } catch (e) {\n      throw new Error(\n        e.message + '\\n' +\n        'Please see https://github.com/HumbleSoftware/js-imagediff#cannot-find-module-canvas\\n'\n      );\n    }\n    module.exports = definition(root, name, Canvas);\n  } else if (typeof define === 'function' && typeof define.amd === 'object') {\n    define(definition);\n  } else {\n    root[name] = definition(root, name);\n  }\n})('imagediff', function (root, name, Canvas) {\n\n  var\n    TYPE_ARRAY        = /\\[object Array\\]/i,\n    TYPE_CANVAS       = /\\[object (Canvas|HTMLCanvasElement)\\]/i,\n    TYPE_CONTEXT      = /\\[object CanvasRenderingContext2D\\]/i,\n    TYPE_IMAGE        = /\\[object (Image|HTMLImageElement)\\]/i,\n    TYPE_IMAGE_DATA   = /\\[object ImageData\\]/i,\n\n    UNDEFINED         = 'undefined',\n\n    canvas            = getCanvas(),\n    context           = canvas.getContext('2d'),\n    previous          = root[name],\n    imagediff, jasmine;\n\n  // Creation\n  function getCanvas (width, height) {\n    var\n      canvas = Canvas ?\n        new Canvas() :\n        document.createElement('canvas');\n    if (width) canvas.width = width;\n    if (height) canvas.height = height;\n    return canvas;\n  }\n  function getImageData (width, height) {\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    return context.createImageData(width, height);\n  }\n  // expost canvas module\n  function getCanvasRef() {\n    return Canvas;\n  }\n\n\n  // Type Checking\n  function isImage (object) {\n    return isType(object, TYPE_IMAGE);\n  }\n  function isCanvas (object) {\n    return isType(object, TYPE_CANVAS);\n  }\n  function isContext (object) {\n    return isType(object, TYPE_CONTEXT);\n  }\n  function isImageData (object) {\n    return !!(object &&\n      isType(object, TYPE_IMAGE_DATA) &&\n      typeof(object.width) !== UNDEFINED &&\n      typeof(object.height) !== UNDEFINED &&\n      typeof(object.data) !== UNDEFINED);\n  }\n  function isImageType (object) {\n    return (\n      isImage(object) ||\n      isCanvas(object) ||\n      isContext(object) ||\n      isImageData(object)\n    );\n  }\n  function isType (object, type) {\n    return typeof (object) === 'object' && !!Object.prototype.toString.apply(object).match(type);\n  }\n\n\n  // Type Conversion\n  function copyImageData (imageData) {\n    var\n      height = imageData.height,\n      width = imageData.width,\n      data = imageData.data,\n      newImageData, newData, i;\n\n    canvas.width = width;\n    canvas.height = height;\n    newImageData = context.getImageData(0, 0, width, height);\n    newData = newImageData.data;\n\n    for (i = imageData.data.length; i--;) {\n        newData[i] = data[i];\n    }\n\n    return newImageData;\n  }\n  function toImageData (object) {\n    if (isImage(object)) { return toImageDataFromImage(object); }\n    if (isCanvas(object)) { return toImageDataFromCanvas(object); }\n    if (isContext(object)) { return toImageDataFromContext(object); }\n    if (isImageData(object)) { return object; }\n  }\n  function toImageDataFromImage (image) {\n    var\n      height = image.height,\n      width = image.width;\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    context.drawImage(image, 0, 0);\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromCanvas (canvas) {\n    var\n      height = canvas.height,\n      width = canvas.width,\n      context = canvas.getContext('2d');\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromContext (context) {\n    var\n      canvas = context.canvas,\n      height = canvas.height,\n      width = canvas.width;\n    return context.getImageData(0, 0, width, height);\n  }\n  function toCanvas (object) {\n    var\n      data = toImageData(object),\n      canvas = getCanvas(data.width, data.height),\n      context = canvas.getContext('2d');\n\n    context.putImageData(data, 0, 0);\n    return canvas;\n  }\n\n\n  // ImageData Equality Operators\n  function equalWidth (a, b) {\n    return a.width === b.width;\n  }\n  function equalHeight (a, b) {\n    return a.height === b.height;\n  }\n  function equalDimensions (a, b) {\n    return equalHeight(a, b) && equalWidth(a, b);\n  }\n  function equal (a, b, tolerance) {\n\n    var\n      aData     = a.data,\n      bData     = b.data,\n      length    = aData.length,\n      i;\n\n    tolerance = tolerance || 0;\n\n    if (!equalDimensions(a, b)) return false;\n    for (i = length; i--;) if (aData[i] !== bData[i] && Math.abs(aData[i] - bData[i]) > tolerance) return false;\n\n    return true;\n  }\n\n\n  // Diff\n  function diff (a, b, options) {\n    return (equalDimensions(a, b) ? diffEqual : diffUnequal)(a, b, options);\n  }\n  function diffEqual (a, b, options) {\n\n    var\n      height  = a.height,\n      width   = a.width,\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      length  = cData.length,\n      row, column,\n      i, j, k, v;\n\n    for (i = 0; i < length; i += 4) {\n      cData[i] = Math.abs(aData[i] - bData[i]);\n      cData[i+1] = Math.abs(aData[i+1] - bData[i+1]);\n      cData[i+2] = Math.abs(aData[i+2] - bData[i+2]);\n      cData[i+3] = Math.abs(255 - Math.abs(aData[i+3] - bData[i+3]));\n    }\n\n    return c;\n  }\n  function diffUnequal (a, b, options) {\n\n    var\n      height  = Math.max(a.height, b.height),\n      width   = Math.max(a.width, b.width),\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      align   = options && options.align,\n      rowOffset,\n      columnOffset,\n      row, column,\n      i, j, k, v;\n\n\n    for (i = cData.length - 1; i > 0; i = i - 4) {\n      cData[i] = 255;\n    }\n\n    // Add First Image\n    offsets(a);\n    for (row = a.height; row--;){\n      for (column = a.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * a.width + column);\n        cData[i+0] = aData[j+0]; // r\n        cData[i+1] = aData[j+1]; // g\n        cData[i+2] = aData[j+2]; // b\n        // cData[i+3] = aData[j+3]; // a\n      }\n    }\n\n    // Subtract Second Image\n    offsets(b);\n    for (row = b.height; row--;){\n      for (column = b.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * b.width + column);\n        cData[i+0] = Math.abs(cData[i+0] - bData[j+0]); // r\n        cData[i+1] = Math.abs(cData[i+1] - bData[j+1]); // g\n        cData[i+2] = Math.abs(cData[i+2] - bData[j+2]); // b\n      }\n    }\n\n    // Helpers\n    function offsets (imageData) {\n      if (align === 'top') {\n        rowOffset = 0;\n        columnOffset = 0;\n      } else {\n        rowOffset = Math.floor((height - imageData.height) / 2);\n        columnOffset = Math.floor((width - imageData.width) / 2);\n      }\n    }\n\n    return c;\n  }\n\n\n  // Validation\n  function checkType () {\n    var i;\n    for (i = 0; i < arguments.length; i++) {\n      if (!isImageType(arguments[i])) {\n        throw {\n          name : 'ImageTypeError',\n          message : 'Submitted object was not an image.'\n        };\n      }\n    }\n  }\n\n\n  // Jasmine Matchers\n  function get (element, content) {\n    element = document.createElement(element);\n    if (element && content) {\n      element.innerHTML = content;\n    }\n    return element;\n  }\n\n  jasmine = {\n\n    toBeImageData : function () {\n      return imagediff.isImageData(this.actual);\n    },\n\n    toImageDiffEqual : function (expected, tolerance) {\n\n      if (typeof (document) !== UNDEFINED) {\n        this.message = function () {\n          var\n            div     = get('div'),\n            a       = get('div', '<div>Actual:</div>'),\n            b       = get('div', '<div>Expected:</div>'),\n            c       = get('div', '<div>Diff:</div>'),\n            diff    = imagediff.diff(this.actual, expected),\n            canvas  = getCanvas(),\n            context;\n\n          canvas.height = diff.height;\n          canvas.width  = diff.width;\n\n          div.style.overflow = 'hidden';\n          a.style.float = 'left';\n          b.style.float = 'left';\n          c.style.float = 'left';\n\n          context = canvas.getContext('2d');\n          context.putImageData(diff, 0, 0);\n\n          a.appendChild(toCanvas(this.actual));\n          b.appendChild(toCanvas(expected));\n          c.appendChild(canvas);\n\n          div.appendChild(a);\n          div.appendChild(b);\n          div.appendChild(c);\n\n          return [\n            div,\n            \"Expected not to be equal.\"\n          ];\n        };\n      }\n\n      return imagediff.equal(this.actual, expected, tolerance);\n    }\n  };\n\n\n  // Image Output\n  function imageDataToPNG (imageData, outputFile, callback) {\n\n    var\n      canvas = toCanvas(imageData),\n      base64Data,\n      decodedImage;\n\n    callback = callback || Function;\n\n    base64Data = canvas.toDataURL().replace(/^data:image\\/\\w+;base64,/,\"\");\n    decodedImage = new Buffer(base64Data, 'base64');\n    require('fs').writeFile(outputFile, decodedImage, callback);\n  }\n\n\n  // Definition\n  imagediff = {\n\n    createCanvas : getCanvas,\n    createImageData : getImageData,\n    getCanvasRef: getCanvasRef,\n\n    isImage : isImage,\n    isCanvas : isCanvas,\n    isContext : isContext,\n    isImageData : isImageData,\n    isImageType : isImageType,\n\n    toImageData : function (object) {\n      checkType(object);\n      if (isImageData(object)) { return copyImageData(object); }\n      return toImageData(object);\n    },\n\n    equal : function (a, b, tolerance) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return equal(a, b, tolerance);\n    },\n    diff : function (a, b, options) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return diff(a, b, options);\n    },\n\n    jasmine : jasmine,\n\n    // Compatibility\n    noConflict : function () {\n      root[name] = previous;\n      return imagediff;\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    imagediff.imageDataToPNG = imageDataToPNG;\n  }\n\n  return imagediff;\n});\n","// UMD header\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.ayepromise = factory();\n    }\n}(this, function () {\n    'use strict';\n\n    var ayepromise = {};\n\n    /* Wrap an arbitrary number of functions and allow only one of them to be\n       executed and only once */\n    var once = function () {\n        var wasCalled = false;\n\n        return function wrapper(wrappedFunction) {\n            return function () {\n                if (wasCalled) {\n                    return;\n                }\n                wasCalled = true;\n                wrappedFunction.apply(null, arguments);\n            };\n        };\n    };\n\n    var getThenableIfExists = function (obj) {\n        // Make sure we only access the accessor once as required by the spec\n        var then = obj && obj.then;\n\n        if (typeof obj === \"object\" && typeof then === \"function\") {\n            // Bind function back to it's object (so fan's of 'this' don't get sad)\n            return function() { return then.apply(obj, arguments); };\n        }\n    };\n\n    var aThenHandler = function (onFulfilled, onRejected) {\n        var defer = ayepromise.defer();\n\n        var doHandlerCall = function (func, value) {\n            setTimeout(function () {\n                var returnValue;\n                try {\n                    returnValue = func(value);\n                } catch (e) {\n                    defer.reject(e);\n                    return;\n                }\n\n                if (returnValue === defer.promise) {\n                    defer.reject(new TypeError('Cannot resolve promise with itself'));\n                } else {\n                    defer.resolve(returnValue);\n                }\n            }, 1);\n        };\n\n        var callFulfilled = function (value) {\n            if (onFulfilled && onFulfilled.call) {\n                doHandlerCall(onFulfilled, value);\n            } else {\n                defer.resolve(value);\n            }\n        };\n\n        var callRejected = function (value) {\n            if (onRejected && onRejected.call) {\n                doHandlerCall(onRejected, value);\n            } else {\n                defer.reject(value);\n            }\n        };\n\n        return {\n            promise: defer.promise,\n            handle: function (state, value) {\n                if (state === FULFILLED) {\n                    callFulfilled(value);\n                } else {\n                    callRejected(value);\n                }\n            }\n        };\n    };\n\n    // States\n    var PENDING = 0,\n        FULFILLED = 1,\n        REJECTED = 2;\n\n    ayepromise.defer = function () {\n        var state = PENDING,\n            outcome,\n            thenHandlers = [];\n\n        var doSettle = function (settledState, value) {\n            state = settledState;\n            // persist for handlers registered after settling\n            outcome = value;\n\n            thenHandlers.forEach(function (then) {\n                then.handle(state, outcome);\n            });\n\n            // Discard all references to handlers to be garbage collected\n            thenHandlers = null;\n        };\n\n        var doFulfill = function (value) {\n            doSettle(FULFILLED, value);\n        };\n\n        var doReject = function (error) {\n            doSettle(REJECTED, error);\n        };\n\n        var registerThenHandler = function (onFulfilled, onRejected) {\n            var thenHandler = aThenHandler(onFulfilled, onRejected);\n\n            if (state === PENDING) {\n                thenHandlers.push(thenHandler);\n            } else {\n                thenHandler.handle(state, outcome);\n            }\n\n            return thenHandler.promise;\n        };\n\n        var safelyResolveThenable = function (thenable) {\n            // Either fulfill, reject or reject with error\n            var onceWrapper = once();\n            try {\n                thenable(\n                    onceWrapper(transparentlyResolveThenablesAndSettle),\n                    onceWrapper(doReject)\n                );\n            } catch (e) {\n                onceWrapper(doReject)(e);\n            }\n        };\n\n        var transparentlyResolveThenablesAndSettle = function (value) {\n            var thenable;\n\n            try {\n                thenable = getThenableIfExists(value);\n            } catch (e) {\n                doReject(e);\n                return;\n            }\n\n            if (thenable) {\n                safelyResolveThenable(thenable);\n            } else {\n                doFulfill(value);\n            }\n        };\n\n        var onceWrapper = once();\n        return {\n            resolve: onceWrapper(transparentlyResolveThenablesAndSettle),\n            reject: onceWrapper(doReject),\n            promise: {\n                then: registerThenHandler,\n                fail: function (onRejected) {\n                    return registerThenHandler(null, onRejected);\n                }\n            }\n        };\n    };\n\n    return ayepromise;\n}));\n","/*! rasterizeHTML.js - v1.1.0 - 2015-03-26\n* http://www.github.com/cburgmer/rasterizeHTML.js\n* Copyright (c) 2015 Christoph Burgmer; Licensed MIT */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"url\",\"cssMediaQuery\",\"xmlserializer\",\"ayepromise\",\"inlineresources\"], function (a0,b1,c2,d3,e4) {\n      return (root['rasterizeHTML'] = factory(a0,b1,c2,d3,e4));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"url\"),require(\"css-mediaquery\"),require(\"xmlserializer\"),require(\"ayepromise\"),require(\"inlineresources\"));\n  } else {\n    root['rasterizeHTML'] = factory(url,cssMediaQuery,xmlserializer,ayepromise,inlineresources);\n  }\n}(this, function (url, cssMediaQuery, xmlserializer, ayepromise, inlineresources) {\n\nvar util = (function (url) {\n    \"use strict\";\n\n    var module = {};\n\n    var uniqueIdList = [];\n\n    module.joinUrl = function (baseUrl, relUrl) {\n        if (!baseUrl) {\n            return relUrl;\n        }\n        return url.resolve(baseUrl, relUrl);\n    };\n\n    module.getConstantUniqueIdFor = function (element) {\n        // HACK, using a list results in O(n), but how do we hash e.g. a DOM node?\n        if (uniqueIdList.indexOf(element) < 0) {\n            uniqueIdList.push(element);\n        }\n        return uniqueIdList.indexOf(element);\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n                theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var isObject = function (obj) {\n        return typeof obj === \"object\" && obj !== null;\n    };\n\n    var isCanvas = function (obj) {\n        return isObject(obj) &&\n            Object.prototype.toString.apply(obj).match(/\\[object (Canvas|HTMLCanvasElement)\\]/i);\n    };\n\n    // args: canvas, options\n    module.parseOptionalParameters = function (args) {\n        var parameters = {\n            canvas: null,\n            options: {}\n        };\n\n        if (args[0] == null || isCanvas(args[0])) {\n            parameters.canvas = args[0] || null;\n\n            parameters.options = module.clone(args[1]);\n        } else {\n            parameters.options = module.clone(args[0]);\n        }\n\n        return parameters;\n    };\n\n    return module;\n}(url));\n\n// Proxy objects by monkey patching\nvar proxies = (function (util, ayepromise) {\n    \"use strict\";\n\n    var module = {};\n\n    var monkeyPatchInstanceMethod = function (object, methodName, proxyFunc) {\n        var originalFunc = object[methodName];\n\n        object[methodName] = function () {\n            var args = Array.prototype.slice.call(arguments);\n\n            return proxyFunc.apply(this, [args, originalFunc]);\n        };\n\n        return originalFunc;\n    };\n\n    // Bases all XHR calls on the given base URL\n    module.baseUrlRespectingXhr = function (XHRObject, baseUrl) {\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'open', function (args, originalOpen) {\n                var method = args.shift(),\n                    url = args.shift(),\n                    joinedUrl = util.joinUrl(baseUrl, url);\n\n                return originalOpen.apply(this, [method, joinedUrl].concat(args));\n            });\n\n            return xhr;\n        };\n\n        return xhrConstructor;\n    };\n\n    // Provides a convenient way of being notified when all pending XHR calls are finished\n    module.finishNotifyingXhr = function (XHRObject) {\n        var totalXhrCount = 0,\n            doneXhrCount = 0,\n            waitingForPendingToClose = false,\n            defer = ayepromise.defer();\n\n        var checkAllRequestsFinished = function () {\n            var pendingXhrCount = totalXhrCount - doneXhrCount;\n\n            if (pendingXhrCount <= 0 && waitingForPendingToClose) {\n                defer.resolve({totalCount: totalXhrCount});\n            }\n        };\n\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'send', function (_, originalSend) {\n                totalXhrCount += 1;\n                return originalSend.apply(this, arguments);\n            });\n\n            xhr.addEventListener('load', function () {\n                doneXhrCount += 1;\n\n                checkAllRequestsFinished();\n            });\n\n            return xhr;\n        };\n\n        xhrConstructor.waitForRequestsToFinish = function () {\n            waitingForPendingToClose = true;\n            checkAllRequestsFinished();\n            return defer.promise;\n        };\n\n        return xhrConstructor;\n    };\n\n    return module;\n}(util, ayepromise));\n\nvar documentUtil = (function () {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.addClassNameRecursively = function (element, className) {\n        element.className += ' ' + className;\n\n        if (element.parentNode !== element.ownerDocument) {\n            module.addClassNameRecursively(element.parentNode, className);\n        }\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        // Exchange rule with the new text\n        styleSheet.insertRule(newRuleText, ruleIdx+1);\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var updateRuleSelector = function (rule, updatedSelector) {\n        var styleDefinitions = rule.cssText.replace(/^[^\\{]+/, ''),\n            newRule = updatedSelector + ' ' + styleDefinitions;\n\n        changeCssRule(rule, newRule);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).reduce(function (cssText, rule) {\n            return cssText + rule.cssText;\n        }, '');\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var matchingSimpleSelectorsRegex = function (simpleSelectorList) {\n        return '(' +\n            '(?:^|[^.#:\\\\w])' +            // start of string or not a simple selector character,\n            '|' +                          // ... or ...\n            '(?=\\\\W)' +                    // the next character parsed is not an alphabetic character (and thus a natural boundary)\n            ')' +\n            '(' +\n            simpleSelectorList.join('|') + // one out of the given simple selectors\n            ')' +\n            '(?=\\\\W|$)';                   // followed either by a non-alphabetic character or the end of the string\n    };\n\n    var replaceSimpleSelectorsBy = function (doc, simpleSelectorList, caseInsensitiveReplaceFunc) {\n        var selectorRegex = matchingSimpleSelectorsRegex(simpleSelectorList);\n\n        asArray(doc.querySelectorAll('style')).forEach(function (styleElement) {\n            var matchingRules = asArray(styleElement.sheet.cssRules).filter(function (rule) {\n                return rule.selectorText && new RegExp(selectorRegex, 'i').test(rule.selectorText);\n            });\n\n            if (matchingRules.length) {\n                matchingRules.forEach(function (rule) {\n                    var newSelector = rule.selectorText.replace(new RegExp(selectorRegex, 'gi'),\n                                                             function (_, prefixMatch, selectorMatch) {\n                        return prefixMatch + caseInsensitiveReplaceFunc(selectorMatch);\n                    });\n\n                    if (newSelector !== rule.selectorText) {\n                        updateRuleSelector(rule, newSelector);\n                    }\n                });\n\n                rewriteStyleContent(styleElement);\n            }\n        });\n    };\n\n    module.rewriteCssSelectorWith = function (doc, oldSelector, newSelector) {\n        replaceSimpleSelectorsBy(doc, [oldSelector], function () {\n            return newSelector;\n        });\n    };\n\n    module.lowercaseCssTypeSelectors = function (doc, matchingTagNames) {\n        replaceSimpleSelectorsBy(doc, matchingTagNames, function (match) {\n            return match.toLowerCase();\n        });\n    };\n\n    module.findHtmlOnlyNodeNames = function (doc) {\n        var treeWalker = doc.createTreeWalker(doc, NodeFilter.SHOW_ELEMENT),\n            htmlNodeNames = {},\n            nonHtmlNodeNames = {},\n            currentTagName;\n\n        while(treeWalker.nextNode()) {\n            currentTagName = treeWalker.currentNode.tagName.toLowerCase();\n            if (treeWalker.currentNode.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n                htmlNodeNames[currentTagName] = true;\n            } else {\n                nonHtmlNodeNames[currentTagName] = true;\n            }\n        }\n\n        return Object.keys(htmlNodeNames).filter(function (tagName) {\n            return !nonHtmlNodeNames[tagName];\n        });\n    };\n\n    return module;\n}());\n\nvar documentHelper = (function (documentUtil) {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.fakeHover = function (doc, hoverSelector) {\n        var elem = doc.querySelector(hoverSelector),\n            fakeHoverClass = 'rasterizehtmlhover';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeHoverClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':hover', '.' + fakeHoverClass);\n    };\n\n    module.fakeActive = function (doc, activeSelector) {\n        var elem = doc.querySelector(activeSelector),\n            fakeActiveClass = 'rasterizehtmlactive';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeActiveClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':active', '.' + fakeActiveClass);\n    };\n\n    module.fakeFocus = function (doc, focusSelector) {\n        var elem = doc.querySelector(focusSelector),\n            fakeFocusClass = 'rasterizehtmlfocus';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeFocusClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':focus', '.' + fakeFocusClass);\n    };\n\n    module.persistInputValues = function (doc) {\n        var inputs = doc.querySelectorAll('input'),\n            textareas = doc.querySelectorAll('textarea'),\n            isCheckable = function (input) {\n                return input.type === 'checkbox' || input.type === 'radio';\n            };\n\n        asArray(inputs).filter(isCheckable)\n            .forEach(function (input) {\n                if (input.checked) {\n                    input.setAttribute('checked', '');\n                } else {\n                    input.removeAttribute('checked');\n                }\n            });\n\n        asArray(inputs).filter(function (input) { return !isCheckable(input); })\n            .forEach(function (input) {\n                input.setAttribute('value', input.value);\n            });\n\n        asArray(textareas)\n            .forEach(function (textarea) {\n                textarea.textContent = textarea.value;\n            });\n    };\n\n    module.rewriteTagNameSelectorsToLowerCase = function (doc) {\n        documentUtil.lowercaseCssTypeSelectors(doc, documentUtil.findHtmlOnlyNodeNames(doc));\n    };\n\n    return module;\n}(documentUtil));\n\nvar mediaQueryHelper = (function (cssMediaQuery) {\n    \"use strict\";\n\n    var module = {};\n\n    var svgImgBlueByEmMediaQuery = function () {\n        var svg = '<svg id=\"svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\">' +\n                '<style>@media (max-width: 1em) { svg { background: #00f; } }</style>' +\n                '</svg>';\n\n        var url = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg),\n            img = document.createElement('img');\n\n        img.src = url;\n\n        return img;\n    };\n\n    var firstPixelHasColor = function (img, r, g, b) {\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = img.width;\n        canvas.height = img.height;\n\n        var context = canvas.getContext(\"2d\"),\n            data;\n\n        context.drawImage(img, 0, 0);\n        data = context.getImageData(0, 0, 1, 1).data;\n        return data[0] === r && data[1] === g && data[2] === b;\n    };\n\n    var hasEmMediaQueryIssue = function () {\n        var img = svgImgBlueByEmMediaQuery(),\n            defer = ayepromise.defer();\n\n        document.querySelector('body').appendChild(img);\n\n        img.onload = function () {\n            document.querySelector('body').removeChild(img);\n            try {\n                defer.resolve(!firstPixelHasColor(img, 0, 0, 255));\n            } catch (e) {\n                // Fails in PhantomJS, let's assume the issue exists\n                defer.resolve(true);\n            }\n        };\n        img.onerror = function () {\n            defer.reject();\n        };\n\n        return defer.promise;\n    };\n\n    var hasEmIssue;\n\n    module.needsEmWorkaround = function () {\n        if (hasEmIssue === undefined) {\n            hasEmIssue = hasEmMediaQueryIssue();\n        }\n        return hasEmIssue;\n    };\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).map(function (rule) {\n            return rule.cssText;\n        }).join('\\n');\n    };\n\n    var mediaQueryRule = function (mediaQueries, cssRules) {\n        return '@media ' + mediaQueries.join(', ') + '{' +\n            cssRulesToText(cssRules) +\n            '}';\n    };\n\n    var exchangeRuleWithNewContent = function (styleSheet, ruleIdx, newRuleText) {\n        try {\n            styleSheet.insertRule(newRuleText, ruleIdx+1);\n        } catch (e) {\n            // In case the browser does not like our new rule we just keep the existing one and quietly leave\n            return;\n        }\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        exchangeRuleWithNewContent(styleSheet, ruleIdx, newRuleText);\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var serializeExpression = function (exp) {\n        var feature = exp.modifier ? exp.modifier + '-' + exp.feature : exp.feature;\n        if (exp.value) {\n            return '(' + feature + ': ' + exp.value + ')';\n        } else {\n            return '(' + feature + ')';\n        }\n    };\n\n    var serializeQueryPart = function (q) {\n        var segments = [];\n\n        if (q.inverse) {\n            segments.push(\"not\");\n        }\n\n        segments.push(q.type);\n\n        if (q.expressions.length > 0) {\n            segments.push('and ' + q.expressions.map(serializeExpression).join(' and '));\n        }\n\n        return segments.join(' ');\n    };\n\n    // poor man's testability\n    module.serializeQuery = function (q) {\n        var queryParts = q.map(serializeQueryPart);\n        return queryParts.join(', ');\n    };\n\n    var transformEmIntoPx = function (em) {\n        return em * 16;\n    };\n\n    var replaceEmValueWithPx = function (value) {\n        // Match a number with em unit. Doesn't match all, but should be enough for now\n        var match = /^((?:\\d+\\.)?\\d+)em/.exec(value);\n        if (match) {\n            return transformEmIntoPx(parseFloat(match[1])) + 'px';\n        }\n        return value;\n    };\n\n    var substituteEmWithPx = function (mediaQuery) {\n        var parsedQuery = cssMediaQuery.parse(mediaQuery),\n            hasChanges = false;\n\n        parsedQuery.forEach(function (q) {\n            q.expressions.forEach(function (exp) {\n                var rewrittenValue = replaceEmValueWithPx(exp.value);\n\n                hasChanges |= rewrittenValue !== exp.value;\n                exp.value = rewrittenValue;\n            });\n        });\n\n        if (hasChanges) {\n            mediaQuery = module.serializeQuery(parsedQuery);\n        }\n\n        return mediaQuery;\n    };\n\n    var replaceEmsWithPx = function (mediaQueryRules) {\n        var anyRuleHasChanges = false;\n\n        mediaQueryRules.forEach(function (rule) {\n            var hasChanges = false;\n\n            var reworkedMediaQueries = asArray(rule.media).map(function (mediaQuery) {\n                var rewrittenMediaQuery = substituteEmWithPx(mediaQuery);\n\n                hasChanges |= rewrittenMediaQuery !== mediaQuery;\n                return rewrittenMediaQuery;\n            });\n\n            if (hasChanges) {\n                changeCssRule(rule, mediaQueryRule(reworkedMediaQueries, rule.cssRules));\n            }\n\n            anyRuleHasChanges |= hasChanges;\n        });\n\n        return anyRuleHasChanges;\n    };\n\n    module.workAroundWebKitEmSizeIssue = function (document) {\n        var styles = document.querySelectorAll('style');\n\n        asArray(styles).forEach(function (style) {\n            var mediaQueryRules = asArray(style.sheet.cssRules).filter(function (rule) {\n                return rule.type === window.CSSRule.MEDIA_RULE;\n            });\n\n            var hasChanges = replaceEmsWithPx(mediaQueryRules);\n            if (hasChanges) {\n                rewriteStyleContent(style);\n            }\n        });\n    };\n\n    return module;\n}(cssMediaQuery));\n\nvar browser = (function (util, proxies, ayepromise, theWindow) {\n    \"use strict\";\n\n    var module = {};\n\n    var createHiddenElement = function (doc, tagName, width, height) {\n        var element = doc.createElement(tagName);\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading CSS\n        element.style.visibility = \"hidden\";\n        element.style.width = width + \"px\";\n        element.style.height = height + \"px\";\n        element.style.position = \"absolute\";\n        element.style.top = (-10000 - height) + \"px\";\n        element.style.left = (-10000 - width) + \"px\";\n        // We need to add the element to the document so that its content gets loaded\n        doc.getElementsByTagName(\"body\")[0].appendChild(element);\n        return element;\n    };\n\n    module.executeJavascript = function (doc, options) {\n        var iframe = createHiddenElement(theWindow.document, \"iframe\", options.width, options.height),\n            html = doc.documentElement.outerHTML,\n            iframeErrorsMessages = [],\n            defer = ayepromise.defer(),\n            timeout = options.executeJsTimeout || 0;\n\n        var doResolve = function () {\n            var doc = iframe.contentDocument;\n            theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            defer.resolve({\n                document: doc,\n                errors: iframeErrorsMessages\n            });\n        };\n\n        var waitForJavaScriptToRun = function () {\n            var d = ayepromise.defer();\n            if (timeout > 0) {\n                setTimeout(d.resolve, timeout);\n            } else {\n                d.resolve();\n            }\n            return d.promise;\n        };\n\n        iframe.onload = function () {\n            waitForJavaScriptToRun()\n                .then(finishNotifyXhrProxy.waitForRequestsToFinish)\n                .then(doResolve);\n        };\n\n        var xhr = iframe.contentWindow.XMLHttpRequest,\n            finishNotifyXhrProxy = proxies.finishNotifyingXhr(xhr),\n            baseUrlXhrProxy = proxies.baseUrlRespectingXhr(finishNotifyXhrProxy, options.baseUrl);\n\n        iframe.contentDocument.open();\n        iframe.contentWindow.XMLHttpRequest = baseUrlXhrProxy;\n        iframe.contentWindow.onerror = function (msg) {\n            iframeErrorsMessages.push({\n                resourceType: \"scriptExecution\",\n                msg: msg\n            });\n        };\n\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var createHiddenSandboxedIFrame = function (doc, width, height) {\n        var iframe = doc.createElement('iframe');\n        iframe.style.width = width + \"px\";\n        iframe.style.height = height + \"px\";\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading content\n        iframe.style.visibility = \"hidden\";\n        iframe.style.position = \"absolute\";\n        iframe.style.top = (-10000 - height) + \"px\";\n        iframe.style.left = (-10000 - width) + \"px\";\n        // Don't execute JS, all we need from sandboxing is access to the iframe's document\n        iframe.sandbox = 'allow-same-origin';\n        // Don't include a scrollbar on Linux\n        iframe.scrolling = 'no';\n        return iframe;\n    };\n\n    var createIframeWithSizeAtZoomLevel1 = function (width, height, zoom) {\n        var scaledViewportWidth = Math.floor(width / zoom),\n            scaledViewportHeight = Math.floor(height / zoom);\n\n        return createHiddenSandboxedIFrame(theWindow.document, scaledViewportWidth, scaledViewportHeight);\n    };\n\n    var calculateZoomedContentSizeAndRoundUp = function (actualViewport, requestedWidth, requestedHeight, zoom) {\n        return {\n            width: Math.max(actualViewport.width * zoom, requestedWidth),\n            height: Math.max(actualViewport.height * zoom, requestedHeight)\n        };\n    };\n\n    var calculateContentSize = function (doc, selector, requestedWidth, requestedHeight, zoom) {\n            // clientWidth/clientHeight needed for PhantomJS\n        var actualViewportWidth = Math.max(doc.documentElement.scrollWidth, doc.body.clientWidth),\n            actualViewportHeight = Math.max(doc.documentElement.scrollHeight, doc.body.scrollHeight, doc.body.clientHeight),\n            top, left, originalWidth, originalHeight, rootFontSize,\n            element, rect, contentSize;\n\n        if (selector) {\n            element = doc.querySelector(selector);\n\n            if (!element) {\n                throw {\n                    message: \"Clipping selector not found\"\n                };\n            }\n\n            rect = element.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            originalWidth = rect.width;\n            originalHeight = rect.height;\n        } else {\n            top = 0;\n            left = 0;\n            originalWidth = actualViewportWidth;\n            originalHeight = actualViewportHeight;\n        }\n\n        contentSize = calculateZoomedContentSizeAndRoundUp({\n                width: originalWidth,\n                height: originalHeight\n            },\n            requestedWidth,\n            requestedHeight,\n            zoom);\n\n        rootFontSize = theWindow.getComputedStyle(doc.documentElement).fontSize;\n\n        return {\n            left: left,\n            top: top,\n            width: contentSize.width,\n            height: contentSize.height,\n            viewportWidth: actualViewportWidth,\n            viewportHeight: actualViewportHeight,\n\n            rootFontSize: rootFontSize\n        };\n    };\n\n    module.calculateDocumentContentSize = function (doc, options) {\n        var html = doc.documentElement.outerHTML,\n            defer = ayepromise.defer(),\n            zoom = options.zoom || 1,\n            iframe;\n\n\n        iframe = createIframeWithSizeAtZoomLevel1(options.width, options.height, zoom);\n        // We need to add the element to the document so that its content gets loaded\n        theWindow.document.getElementsByTagName(\"body\")[0].appendChild(iframe);\n\n        iframe.onload = function () {\n            var doc = iframe.contentDocument,\n                size;\n\n            try {\n                size = calculateContentSize(doc, options.clip, options.width, options.height, zoom);\n\n                defer.resolve(size);\n            } catch (e) {\n                defer.reject(e);\n            } finally {\n                theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            }\n        };\n\n        // srcdoc doesn't work in PhantomJS yet\n        iframe.contentDocument.open();\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var addHTMLTagAttributes = function (doc, html) {\n        var attributeMatch = /<html((?:\\s+[^>]*)?)>/im.exec(html),\n            helperDoc = theWindow.document.implementation.createHTMLDocument(''),\n            htmlTagSubstitute,\n            i, elementSubstitute, attribute;\n\n        if (!attributeMatch) {\n            return;\n        }\n\n        htmlTagSubstitute = '<div' + attributeMatch[1] + '></div>';\n        helperDoc.documentElement.innerHTML = htmlTagSubstitute;\n        elementSubstitute = helperDoc.querySelector('div');\n\n        for (i = 0; i < elementSubstitute.attributes.length; i++) {\n            attribute = elementSubstitute.attributes[i];\n            doc.documentElement.setAttribute(attribute.name, attribute.value);\n        }\n    };\n\n    module.parseHTML = function (html) {\n        // We should be using the DOMParser, but it is not supported in older browsers\n        var doc = theWindow.document.implementation.createHTMLDocument('');\n        doc.documentElement.innerHTML = html;\n\n        addHTMLTagAttributes(doc, html);\n        return doc;\n    };\n\n    var isParseError = function (parsedDocument) {\n        // http://stackoverflow.com/questions/11563554/how-do-i-detect-xml-parsing-errors-when-using-javascripts-domparser-in-a-cross\n        var p = new DOMParser(),\n            errorneousParse = p.parseFromString('<', 'text/xml'),\n            parsererrorNS = errorneousParse.getElementsByTagName(\"parsererror\")[0].namespaceURI;\n\n        if (parsererrorNS === 'http://www.w3.org/1999/xhtml') {\n            // In PhantomJS the parseerror element doesn't seem to have a special namespace, so we are just guessing here :(\n            return parsedDocument.getElementsByTagName(\"parsererror\").length > 0;\n        }\n\n        return parsedDocument.getElementsByTagNameNS(parsererrorNS, 'parsererror').length > 0;\n    };\n\n    var failOnParseError = function (doc) {\n        if (doc === null || isParseError(doc)) {\n            throw {\n                message: \"Invalid source\"\n            };\n        }\n    };\n\n    module.validateXHTML = function (xhtml) {\n        var p = new DOMParser(),\n            doc = p.parseFromString(xhtml, \"application/xml\");\n\n        failOnParseError(doc);\n    };\n\n    var lastCacheDate = null;\n\n    var getUncachableURL = function (url, cache) {\n        if (cache === 'none' || cache === 'repeated') {\n            if (lastCacheDate === null || cache !== 'repeated') {\n                lastCacheDate = Date.now();\n            }\n            return url + \"?_=\" + lastCacheDate;\n        } else {\n            return url;\n        }\n    };\n\n    var doDocumentLoad = function (url, options) {\n        var ajaxRequest = new window.XMLHttpRequest(),\n            joinedUrl = util.joinUrl(options.baseUrl, url),\n            augmentedUrl = getUncachableURL(joinedUrl, options.cache),\n            defer = ayepromise.defer(),\n            doReject = function () {\n                defer.reject({message: \"Unable to load page\"});\n            };\n\n        ajaxRequest.addEventListener(\"load\", function () {\n            if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n                defer.resolve(ajaxRequest.responseXML);\n            } else {\n                doReject();\n            }\n        }, false);\n\n        ajaxRequest.addEventListener(\"error\", function () {\n            doReject();\n        }, false);\n\n        try {\n            ajaxRequest.open('GET', augmentedUrl, true);\n            ajaxRequest.responseType = \"document\";\n            ajaxRequest.send(null);\n        } catch (err) {\n            doReject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadDocument = function (url, options) {\n        return doDocumentLoad(url, options)\n            .then(function (doc) {\n                failOnParseError(doc);\n\n                return doc;\n            });\n    };\n\n    return module;\n}(util, proxies, ayepromise, window));\n\nvar svg2image = (function (ayepromise, window) {\n    \"use strict\";\n\n    var module = {};\n\n    var urlForSvg = function (svg, useBlobs) {\n        if (useBlobs) {\n            return URL.createObjectURL(new Blob([svg], {\"type\": \"image/svg+xml\"}));\n        } else {\n            return \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg);\n        }\n    };\n\n    var cleanUpUrl = function (url) {\n        if (url instanceof Blob) {\n            URL.revokeObjectURL(url);\n        }\n    };\n\n    var simpleForeignObjectSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1\" height=\"1\"><foreignObject></foreignObject></svg>';\n\n    var supportsReadingObjectFromCanvas = function (url) {\n        var canvas = document.createElement(\"canvas\"),\n            image = new Image(),\n            defer = ayepromise.defer();\n\n        image.onload = function () {\n            var context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                defer.resolve(true);\n            } catch (e) {\n                defer.resolve(false);\n            }\n        };\n        image.onerror = defer.reject;\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var readingBackFromCanvasBenefitsFromOldSchoolDataUris = function () {\n        // Check for work around for https://code.google.com/p/chromium/issues/detail?id=294129\n        var blobUrl = urlForSvg(simpleForeignObjectSvg, true);\n        return supportsReadingObjectFromCanvas(blobUrl)\n            .then(function (supportsReadingFromBlobs) {\n                cleanUpUrl(blobUrl);\n                if (supportsReadingFromBlobs) {\n                    return false;\n                }\n                return supportsReadingObjectFromCanvas(urlForSvg(simpleForeignObjectSvg, false))\n                    .then(function (s) {\n                        return s;\n                    });\n            }, function () {\n                return false;\n            });\n    };\n\n    var supportsBlobBuilding = function () {\n        if (window.Blob) {\n            // Available as constructor only in newer builds for all browsers\n            try {\n                new Blob(['<b></b>'], { \"type\" : \"text/xml\" });\n                return true;\n            } catch (err) {}\n        }\n        return false;\n    };\n\n    var checkBlobSupport = function () {\n        var defer = ayepromise.defer();\n\n        if (supportsBlobBuilding && window.URL) {\n            readingBackFromCanvasBenefitsFromOldSchoolDataUris()\n                .then(function (doesBenefit) {\n                    defer.resolve(! doesBenefit);\n                }, function () {\n                    defer.reject();\n                });\n        } else {\n            defer.resolve(false);\n        }\n\n        return defer.promise;\n    };\n\n    var checkForBlobsResult;\n\n    var checkForBlobs = function () {\n        if (checkForBlobsResult === undefined) {\n            checkForBlobsResult = checkBlobSupport();\n        }\n\n        return checkForBlobsResult;\n    };\n\n    var buildImageUrl = function (svg) {\n        return checkForBlobs().then(function (useBlobs) {\n            return urlForSvg(svg, useBlobs);\n        });\n    };\n\n    module.renderSvg = function (svg) {\n        var url, image,\n            defer = ayepromise.defer(),\n            resetEventHandlers = function () {\n                image.onload = null;\n                image.onerror = null;\n            },\n            cleanUp = function () {\n                if (url) {\n                    cleanUpUrl(url);\n                }\n            };\n\n        image = new Image();\n        image.onload = function() {\n            resetEventHandlers();\n            cleanUp();\n\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            cleanUp();\n\n            // Webkit calls the onerror handler if the SVG is faulty\n            defer.reject();\n        };\n\n        buildImageUrl(svg).then(function (imageUrl) {\n            url = imageUrl;\n            image.src = url;\n        }, defer.reject);\n\n        return defer.promise;\n    };\n\n    return module;\n}(ayepromise, window));\n\nvar document2svg = (function (util, browser, documentHelper, mediaQueryHelper, xmlserializer) {\n    \"use strict\";\n\n    var module = {};\n\n    var zoomedElementSizingAttributes = function (size, zoomFactor) {\n        var closestScaledWith, closestScaledHeight,\n            offsetX, offsetY;\n\n        zoomFactor = zoomFactor || 1;\n        closestScaledWith = Math.round(size.viewportWidth);\n        closestScaledHeight = Math.round(size.viewportHeight);\n\n        offsetX = -size.left;\n        offsetY = -size.top;\n\n        var attributes = {\n             'x': offsetX,\n             'y': offsetY,\n             'width': closestScaledWith,\n             'height': closestScaledHeight\n        };\n\n        if (zoomFactor !== 1) {\n            attributes.transform = 'scale(' + zoomFactor + ')';\n        }\n\n        return attributes;\n    };\n\n    var workAroundCollapsingMarginsAcrossSVGElementInWebKitLike = function (attributes) {\n        var style = attributes.style || '';\n        attributes.style = style + 'float: left;';\n    };\n\n    var workAroundSafariSometimesNotShowingExternalResources = function (attributes) {\n        /* Let's hope that works some magic. The spec says SVGLoad only fires\n         * now when all externals are available.\n         * http://www.w3.org/TR/SVG/struct.html#ExternalResourcesRequired */\n        attributes.externalResourcesRequired = true;\n    };\n\n    var workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll = function () {\n        return '<style scoped=\"\">html::-webkit-scrollbar { display: none; }</style>';\n    };\n\n    var serializeAttributes = function (attributes) {\n        var keys = Object.keys(attributes);\n        if (!keys.length) {\n            return '';\n        }\n\n        return ' ' + keys.map(function (key) {\n            return key + '=\"' + attributes[key] + '\"';\n        }).join(' ');\n    };\n\n    var convertDocumentToSvg = function (doc, size, zoomFactor) {\n        var xhtml = xmlserializer.serializeToString(doc);\n\n        browser.validateXHTML(xhtml);\n\n        var attributes = zoomedElementSizingAttributes(size, zoomFactor);\n\n        workAroundCollapsingMarginsAcrossSVGElementInWebKitLike(attributes);\n        workAroundSafariSometimesNotShowingExternalResources(attributes);\n\n        return (\n            '<svg xmlns=\"http://www.w3.org/2000/svg\"' +\n                ' width=\"' + size.width + '\"' +\n                ' height=\"' + size.height + '\"' +\n                ' font-size=\"' + size.rootFontSize + '\"' +\n                '>' +\n                workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll() +\n                '<foreignObject' + serializeAttributes(attributes) + '>' +\n                xhtml +\n                '</foreignObject>' +\n                '</svg>'\n        );\n    };\n\n    module.getSvgForDocument = function (doc, size, zoomFactor) {\n        documentHelper.rewriteTagNameSelectorsToLowerCase(doc);\n\n        return mediaQueryHelper.needsEmWorkaround().then(function (needsWorkaround) {\n            if (needsWorkaround) {\n                mediaQueryHelper.workAroundWebKitEmSizeIssue(doc);\n            }\n\n            return convertDocumentToSvg(doc, size, zoomFactor);\n        });\n    };\n\n    module.drawDocumentAsSvg = function (doc, options) {\n        if (options.hover) {\n            documentHelper.fakeHover(doc, options.hover);\n        }\n        if (options.active) {\n            documentHelper.fakeActive(doc, options.active);\n        }\n        if (options.focus) {\n            documentHelper.fakeFocus(doc, options.focus);\n        }\n\n        return browser.calculateDocumentContentSize(doc, options)\n            .then(function (size) {\n                return module.getSvgForDocument(doc, size, options.zoom);\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, mediaQueryHelper, xmlserializer));\n\nvar rasterize = (function (util, browser, documentHelper, document2svg, svg2image, inlineresources) {\n    \"use strict\";\n\n    var module = {};\n\n    var generalDrawError = function () {\n        return {message: \"Error rendering page\"};\n    };\n\n    var drawSvgAsImg = function (svg) {\n        return svg2image.renderSvg(svg)\n            .then(function (image) {\n                return {\n                    image: image,\n                    svg: svg\n                };\n            }, function () {\n                throw generalDrawError();\n            });\n    };\n\n    var drawImageOnCanvas = function (image, canvas) {\n        try {\n            canvas.getContext(\"2d\").drawImage(image, 0, 0);\n        } catch (e) {\n            // Firefox throws a 'NS_ERROR_NOT_AVAILABLE' if the SVG is faulty\n            throw generalDrawError();\n        }\n    };\n\n    var doDraw = function (doc, canvas, options) {\n        return document2svg.drawDocumentAsSvg(doc, options)\n            .then(drawSvgAsImg)\n            .then(function (result) {\n                if (canvas) {\n                    drawImageOnCanvas(result.image, canvas);\n                }\n\n                return result;\n            });\n    };\n\n    var operateJavaScriptOnDocument = function (doc, options) {\n        return browser.executeJavascript(doc, options)\n            .then(function (result) {\n                var document = result.document;\n                documentHelper.persistInputValues(document);\n\n                return {\n                    document: document,\n                    errors: result.errors\n                };\n            });\n    };\n\n    module.rasterize = function (doc, canvas, options) {\n        var inlineOptions;\n\n        inlineOptions = util.clone(options);\n        inlineOptions.inlineScripts = options.executeJs === true;\n\n        return inlineresources.inlineReferences(doc, inlineOptions)\n            .then(function (errors) {\n                if (options.executeJs) {\n                    return operateJavaScriptOnDocument(doc, options)\n                        .then(function (result) {\n                            return {\n                                document: result.document,\n                                errors: errors.concat(result.errors)\n                            };\n                        });\n                } else {\n                    return {\n                        document: doc,\n                        errors: errors\n                    };\n                }\n            }).then(function (result) {\n                return doDraw(result.document, canvas, options)\n                    .then(function (drawResult) {\n                        return {\n                            image: drawResult.image,\n                            svg: drawResult.svg,\n                            errors: result.errors\n                        };\n                    });\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, document2svg, svg2image, inlineresources));\n\nvar rasterizeHTML = (function (util, browser, rasterize) {\n    \"use strict\";\n\n    var module = {};\n\n    var getViewportSize = function (canvas, options) {\n        var defaultWidth = 300,\n            defaultHeight = 200,\n            fallbackWidth = canvas ? canvas.width : defaultWidth,\n            fallbackHeight = canvas ? canvas.height : defaultHeight,\n            width = options.width !== undefined ? options.width : fallbackWidth,\n            height = options.height !== undefined ? options.height : fallbackHeight;\n\n        return {\n            width: width,\n            height: height\n        };\n    };\n\n    var constructOptions = function (params) {\n        var viewport = getViewportSize(params.canvas, params.options),\n            options;\n\n        options = util.clone(params.options);\n        options.width = viewport.width;\n        options.height = viewport.height;\n\n        return options;\n    };\n\n    /**\n     * Draws a Document to the canvas.\n     * rasterizeHTML.drawDocument( document [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawDocument = function () {\n        var doc = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return rasterize.rasterize(doc, params.canvas, constructOptions(params));\n    };\n\n    var drawHTML = function (html, canvas, options) {\n        var doc = browser.parseHTML(html);\n\n        return module.drawDocument(doc, canvas, options);\n    };\n\n    /**\n     * Draws a HTML string to the canvas.\n     * rasterizeHTML.drawHTML( html [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawHTML = function () {\n        var html = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawHTML(html, params.canvas, params.options);\n    };\n\n    // work around https://bugzilla.mozilla.org/show_bug.cgi?id=925493\n    var workAroundFirefoxNotLoadingStylesheetStyles = function (doc, url, options) {\n        var d = document.implementation.createHTMLDocument('');\n        d.replaceChild(doc.documentElement, d.documentElement);\n\n        var extendedOptions = options ? util.clone(options) : {};\n\n        if (!options.baseUrl) {\n            extendedOptions.baseUrl = url;\n        }\n\n        return {\n            document: d,\n            options: extendedOptions\n        };\n    };\n\n    var drawURL = function (url, canvas, options) {\n        return browser.loadDocument(url, options)\n            .then(function (doc) {\n                var workaround = workAroundFirefoxNotLoadingStylesheetStyles(doc, url, options);\n                return module.drawDocument(workaround.document, canvas, workaround.options);\n            });\n    };\n\n    /**\n     * Draws a page to the canvas.\n     * rasterizeHTML.drawURL( url [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawURL = function () {\n        var url = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawURL(url, params.canvas, params.options);\n    };\n\n    return module;\n}(util, browser, rasterize));\n\nreturn rasterizeHTML;\n\n}));\n","\"use strict\";\n\nmodule.exports = function Canvas () {\n  return document.createElement('canvas');\n};\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('is-array')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\nBuffer.poolSize = 8192 // not used by this implementation\n\nvar kMaxLength = 0x3fffffff\nvar rootParent = {}\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Note:\n *\n * - Implementation must support adding new properties to `Uint8Array` instances.\n *   Firefox 4-29 lacked support, fixed in Firefox 30+.\n *   See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *  - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *  - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *    incorrect length in some situations.\n *\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they will\n * get the Object implementation, which is slower but will work correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = (function () {\n  try {\n    var buf = new ArrayBuffer(0)\n    var arr = new Uint8Array(buf)\n    arr.foo = function () { return 42 }\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        new Uint8Array(1).subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n})()\n\n/**\n * Class: Buffer\n * =============\n *\n * The Buffer constructor returns instances of `Uint8Array` that are augmented\n * with function properties for all the node `Buffer` API functions. We use\n * `Uint8Array` so that square bracket notation works as expected -- it returns\n * a single octet.\n *\n * By augmenting the instances, we can avoid modifying the `Uint8Array`\n * prototype.\n */\nfunction Buffer (subject, encoding) {\n  var self = this\n  if (!(self instanceof Buffer)) return new Buffer(subject, encoding)\n\n  var type = typeof subject\n  var length\n\n  if (type === 'number') {\n    length = +subject\n  } else if (type === 'string') {\n    length = Buffer.byteLength(subject, encoding)\n  } else if (type === 'object' && subject !== null) {\n    // assume object is array-like\n    if (subject.type === 'Buffer' && isArray(subject.data)) subject = subject.data\n    length = +subject.length\n  } else {\n    throw new TypeError('must start with number, buffer, array or string')\n  }\n\n  if (length > kMaxLength) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum size: 0x' +\n      kMaxLength.toString(16) + ' bytes')\n  }\n\n  if (length < 0) length = 0\n  else length >>>= 0 // coerce to uint32\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Preferred: Return an augmented `Uint8Array` instance for best performance\n    self = Buffer._augment(new Uint8Array(length)) // eslint-disable-line consistent-this\n  } else {\n    // Fallback: Return THIS instance of Buffer (created by `new`)\n    self.length = length\n    self._isBuffer = true\n  }\n\n  var i\n  if (Buffer.TYPED_ARRAY_SUPPORT && typeof subject.byteLength === 'number') {\n    // Speed optimization -- use set if we're copying from a typed array\n    self._set(subject)\n  } else if (isArrayish(subject)) {\n    // Treat array-ish objects as a byte array\n    if (Buffer.isBuffer(subject)) {\n      for (i = 0; i < length; i++) {\n        self[i] = subject.readUInt8(i)\n      }\n    } else {\n      for (i = 0; i < length; i++) {\n        self[i] = ((subject[i] % 256) + 256) % 256\n      }\n    }\n  } else if (type === 'string') {\n    self.write(subject, 0, encoding)\n  } else if (type === 'number' && !Buffer.TYPED_ARRAY_SUPPORT) {\n    for (i = 0; i < length; i++) {\n      self[i] = 0\n    }\n  }\n\n  if (length > 0 && length <= Buffer.poolSize) self.parent = rootParent\n\n  return self\n}\n\nfunction SlowBuffer (subject, encoding) {\n  if (!(this instanceof SlowBuffer)) return new SlowBuffer(subject, encoding)\n\n  var buf = new Buffer(subject, encoding)\n  delete buf.parent\n  return buf\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n  for (var i = 0, len = Math.min(x, y); i < len && a[i] === b[i]; i++) {}\n  if (i !== len) {\n    x = a[i]\n    y = b[i]\n  }\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'binary':\n    case 'base64':\n    case 'raw':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, totalLength) {\n  if (!isArray(list)) throw new TypeError('list argument must be an Array of Buffers.')\n\n  if (list.length === 0) {\n    return new Buffer(0)\n  } else if (list.length === 1) {\n    return list[0]\n  }\n\n  var i\n  if (totalLength === undefined) {\n    totalLength = 0\n    for (i = 0; i < list.length; i++) {\n      totalLength += list[i].length\n    }\n  }\n\n  var buf = new Buffer(totalLength)\n  var pos = 0\n  for (i = 0; i < list.length; i++) {\n    var item = list[i]\n    item.copy(buf, pos)\n    pos += item.length\n  }\n  return buf\n}\n\nBuffer.byteLength = function byteLength (str, encoding) {\n  var ret\n  str = str + ''\n  switch (encoding || 'utf8') {\n    case 'ascii':\n    case 'binary':\n    case 'raw':\n      ret = str.length\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = str.length * 2\n      break\n    case 'hex':\n      ret = str.length >>> 1\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8ToBytes(str).length\n      break\n    case 'base64':\n      ret = base64ToBytes(str).length\n      break\n    default:\n      ret = str.length\n  }\n  return ret\n}\n\n// pre-set for values that may exist in the future\nBuffer.prototype.length = undefined\nBuffer.prototype.parent = undefined\n\n// toString(encoding, start=0, end=buffer.length)\nBuffer.prototype.toString = function toString (encoding, start, end) {\n  var loweredCase = false\n\n  start = start >>> 0\n  end = end === undefined || end === Infinity ? this.length : end >>> 0\n\n  if (!encoding) encoding = 'utf8'\n  if (start < 0) start = 0\n  if (end > this.length) end = this.length\n  if (end <= start) return ''\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'binary':\n        return binarySlice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return 0\n  return Buffer.compare(this, b)\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset) {\n  if (byteOffset > 0x7fffffff) byteOffset = 0x7fffffff\n  else if (byteOffset < -0x80000000) byteOffset = -0x80000000\n  byteOffset >>= 0\n\n  if (this.length === 0) return -1\n  if (byteOffset >= this.length) return -1\n\n  // Negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = Math.max(this.length + byteOffset, 0)\n\n  if (typeof val === 'string') {\n    if (val.length === 0) return -1 // special case: looking for empty string always fails\n    return String.prototype.indexOf.call(this, val, byteOffset)\n  }\n  if (Buffer.isBuffer(val)) {\n    return arrayIndexOf(this, val, byteOffset)\n  }\n  if (typeof val === 'number') {\n    if (Buffer.TYPED_ARRAY_SUPPORT && Uint8Array.prototype.indexOf === 'function') {\n      return Uint8Array.prototype.indexOf.call(this, val, byteOffset)\n    }\n    return arrayIndexOf(this, [ val ], byteOffset)\n  }\n\n  function arrayIndexOf (arr, val, byteOffset) {\n    var foundIndex = -1\n    for (var i = 0; byteOffset + i < arr.length; i++) {\n      if (arr[byteOffset + i] === val[foundIndex === -1 ? 0 : i - foundIndex]) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === val.length) return byteOffset + foundIndex\n      } else {\n        foundIndex = -1\n      }\n    }\n    return -1\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\n// `get` will be removed in Node 0.13+\nBuffer.prototype.get = function get (offset) {\n  console.log('.get() is deprecated. Access using array indexes instead.')\n  return this.readUInt8(offset)\n}\n\n// `set` will be removed in Node 0.13+\nBuffer.prototype.set = function set (v, offset) {\n  console.log('.set() is deprecated. Access using array indexes instead.')\n  return this.writeUInt8(v, offset)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new Error('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; i++) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) throw new Error('Invalid hex string')\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n  return charsWritten\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(asciiToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction binaryWrite (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(base64ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction utf16leWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n  return charsWritten\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Support both (string, offset, length, encoding)\n  // and the legacy (string, encoding, offset, length)\n  if (isFinite(offset)) {\n    if (!isFinite(length)) {\n      encoding = length\n      length = undefined\n    }\n  } else {  // legacy\n    var swap = encoding\n    encoding = offset\n    offset = length\n    length = swap\n  }\n\n  offset = Number(offset) || 0\n\n  if (length < 0 || offset < 0 || offset > this.length) {\n    throw new RangeError('attempt to write outside buffer bounds')\n  }\n\n  var remaining = this.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n  encoding = String(encoding || 'utf8').toLowerCase()\n\n  var ret\n  switch (encoding) {\n    case 'hex':\n      ret = hexWrite(this, string, offset, length)\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8Write(this, string, offset, length)\n      break\n    case 'ascii':\n      ret = asciiWrite(this, string, offset, length)\n      break\n    case 'binary':\n      ret = binaryWrite(this, string, offset, length)\n      break\n    case 'base64':\n      ret = base64Write(this, string, offset, length)\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = utf16leWrite(this, string, offset, length)\n      break\n    default:\n      throw new TypeError('Unknown encoding: ' + encoding)\n  }\n  return ret\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  var res = ''\n  var tmp = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    if (buf[i] <= 0x7F) {\n      res += decodeUtf8Char(tmp) + String.fromCharCode(buf[i])\n      tmp = ''\n    } else {\n      tmp += '%' + buf[i].toString(16)\n    }\n  }\n\n  return res + decodeUtf8Char(tmp)\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction binarySlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; i++) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = Buffer._augment(this.subarray(start, end))\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; i++) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  if (newBuf.length) newBuf.parent = this.parent || this\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('buffer must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) >>> 0 & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) >>> 0 & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = value\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; i++) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; i++) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = value\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkInt(\n      this, value, offset, byteLength,\n      Math.pow(2, 8 * byteLength - 1) - 1,\n      -Math.pow(2, 8 * byteLength - 1)\n    )\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkInt(\n      this, value, offset, byteLength,\n      Math.pow(2, 8 * byteLength - 1) - 1,\n      -Math.pow(2, 8 * byteLength - 1)\n    )\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = value\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n  if (offset < 0) throw new RangeError('index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, target_start, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (target_start >= target.length) target_start = target.length\n  if (!target_start) target_start = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (target_start < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - target_start < end - start) {\n    end = target.length - target_start + start\n  }\n\n  var len = end - start\n\n  if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < len; i++) {\n      target[i + target_start] = this[i + start]\n    }\n  } else {\n    target._set(this.subarray(start, start + len), target_start)\n  }\n\n  return len\n}\n\n// fill(value, start=0, end=buffer.length)\nBuffer.prototype.fill = function fill (value, start, end) {\n  if (!value) value = 0\n  if (!start) start = 0\n  if (!end) end = this.length\n\n  if (end < start) throw new RangeError('end < start')\n\n  // Fill 0 bytes; we're done\n  if (end === start) return\n  if (this.length === 0) return\n\n  if (start < 0 || start >= this.length) throw new RangeError('start out of bounds')\n  if (end < 0 || end > this.length) throw new RangeError('end out of bounds')\n\n  var i\n  if (typeof value === 'number') {\n    for (i = start; i < end; i++) {\n      this[i] = value\n    }\n  } else {\n    var bytes = utf8ToBytes(value.toString())\n    var len = bytes.length\n    for (i = start; i < end; i++) {\n      this[i] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n/**\n * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.\n * Added in Node 0.12. Only available in browsers that support ArrayBuffer.\n */\nBuffer.prototype.toArrayBuffer = function toArrayBuffer () {\n  if (typeof Uint8Array !== 'undefined') {\n    if (Buffer.TYPED_ARRAY_SUPPORT) {\n      return (new Buffer(this)).buffer\n    } else {\n      var buf = new Uint8Array(this.length)\n      for (var i = 0, len = buf.length; i < len; i += 1) {\n        buf[i] = this[i]\n      }\n      return buf.buffer\n    }\n  } else {\n    throw new TypeError('Buffer.toArrayBuffer not supported in this browser')\n  }\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar BP = Buffer.prototype\n\n/**\n * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods\n */\nBuffer._augment = function _augment (arr) {\n  arr.constructor = Buffer\n  arr._isBuffer = true\n\n  // save reference to original Uint8Array set method before overwriting\n  arr._set = arr.set\n\n  // deprecated, will be removed in node 0.13+\n  arr.get = BP.get\n  arr.set = BP.set\n\n  arr.write = BP.write\n  arr.toString = BP.toString\n  arr.toLocaleString = BP.toString\n  arr.toJSON = BP.toJSON\n  arr.equals = BP.equals\n  arr.compare = BP.compare\n  arr.indexOf = BP.indexOf\n  arr.copy = BP.copy\n  arr.slice = BP.slice\n  arr.readUIntLE = BP.readUIntLE\n  arr.readUIntBE = BP.readUIntBE\n  arr.readUInt8 = BP.readUInt8\n  arr.readUInt16LE = BP.readUInt16LE\n  arr.readUInt16BE = BP.readUInt16BE\n  arr.readUInt32LE = BP.readUInt32LE\n  arr.readUInt32BE = BP.readUInt32BE\n  arr.readIntLE = BP.readIntLE\n  arr.readIntBE = BP.readIntBE\n  arr.readInt8 = BP.readInt8\n  arr.readInt16LE = BP.readInt16LE\n  arr.readInt16BE = BP.readInt16BE\n  arr.readInt32LE = BP.readInt32LE\n  arr.readInt32BE = BP.readInt32BE\n  arr.readFloatLE = BP.readFloatLE\n  arr.readFloatBE = BP.readFloatBE\n  arr.readDoubleLE = BP.readDoubleLE\n  arr.readDoubleBE = BP.readDoubleBE\n  arr.writeUInt8 = BP.writeUInt8\n  arr.writeUIntLE = BP.writeUIntLE\n  arr.writeUIntBE = BP.writeUIntBE\n  arr.writeUInt16LE = BP.writeUInt16LE\n  arr.writeUInt16BE = BP.writeUInt16BE\n  arr.writeUInt32LE = BP.writeUInt32LE\n  arr.writeUInt32BE = BP.writeUInt32BE\n  arr.writeIntLE = BP.writeIntLE\n  arr.writeIntBE = BP.writeIntBE\n  arr.writeInt8 = BP.writeInt8\n  arr.writeInt16LE = BP.writeInt16LE\n  arr.writeInt16BE = BP.writeInt16BE\n  arr.writeInt32LE = BP.writeInt32LE\n  arr.writeInt32BE = BP.writeInt32BE\n  arr.writeFloatLE = BP.writeFloatLE\n  arr.writeFloatBE = BP.writeFloatBE\n  arr.writeDoubleLE = BP.writeDoubleLE\n  arr.writeDoubleBE = BP.writeDoubleBE\n  arr.fill = BP.fill\n  arr.inspect = BP.inspect\n  arr.toArrayBuffer = BP.toArrayBuffer\n\n  return arr\n}\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-z\\-]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction isArrayish (subject) {\n  return isArray(subject) || Buffer.isBuffer(subject) ||\n      subject && typeof subject === 'object' &&\n      typeof subject.length === 'number'\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n  var i = 0\n\n  for (; i < length; i++) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (leadSurrogate) {\n        // 2 leads in a row\n        if (codePoint < 0xDC00) {\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          leadSurrogate = codePoint\n          continue\n        } else {\n          // valid surrogate pair\n          codePoint = leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00 | 0x10000\n          leadSurrogate = null\n        }\n      } else {\n        // no lead yet\n\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else {\n          // valid lead\n          leadSurrogate = codePoint\n          continue\n        }\n      }\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n      leadSurrogate = null\n    }\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x200000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; i++) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction decodeUtf8Char (str) {\n  try {\n    return decodeURIComponent(str)\n  } catch (err) {\n    return String.fromCharCode(0xFFFD) // UTF 8 invalid char\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar punycode = require('punycode');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a puny coded representation of \"domain\".\n      // It only converts the part of the domain name that\n      // has non ASCII characters. I.e. it dosent matter if\n      // you call it with a domain that already is in ASCII.\n      var domainArray = this.hostname.split('.');\n      var newOut = [];\n      for (var i = 0; i < domainArray.length; ++i) {\n        var s = domainArray[i];\n        newOut.push(s.match(/[^A-Za-z0-9_-]/) ?\n            'xn--' + punycode.encode(s) : s);\n      }\n      this.hostname = newOut.join('.');\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  Object.keys(this).forEach(function(k) {\n    result[k] = this[k];\n  }, this);\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    Object.keys(relative).forEach(function(k) {\n      if (k !== 'protocol')\n        result[k] = relative[k];\n    });\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      Object.keys(relative).forEach(function(k) {\n        result[k] = relative[k];\n      });\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especialy happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!isNull(result.pathname) || !isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host) && (last === '.' || last === '..') ||\n      last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last == '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especialy happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!isNull(result.pathname) || !isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n\nfunction isString(arg) {\n  return typeof arg === \"string\";\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isNull(arg) {\n  return arg === null;\n}\nfunction isNullOrUndefined(arg) {\n  return  arg == null;\n}\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","/*! http://mths.be/punycode v1.2.4 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^ -~]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /\\x2E|\\u3002|\\uFF0E|\\uFF61/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\twhile (length--) {\n\t\t\tarray[length] = fn(array[length]);\n\t\t}\n\t\treturn array;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings.\n\t * @private\n\t * @param {String} domain The domain name.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\treturn map(string.split(regexSeparators), fn).join('.');\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <http://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * http://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols to a Punycode string of ASCII-only\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name to Unicode. Only the\n\t * Punycoded parts of the domain name will be converted, i.e. it doesn't\n\t * matter if you call it on a string that has already been converted to\n\t * Unicode.\n\t * @memberOf punycode\n\t * @param {String} domain The Punycode domain name to convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(domain) {\n\t\treturn mapDomain(domain, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name to Punycode. Only the\n\t * non-ASCII parts of the domain name will be converted, i.e. it doesn't\n\t * matter if you call it with a domain that's already in ASCII.\n\t * @memberOf punycode\n\t * @param {String} domain The domain name to convert, as a Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name.\n\t */\n\tfunction toASCII(domain) {\n\t\treturn mapDomain(domain, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.2.4',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <http://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","\n/**\n * isArray\n */\n\nvar isArray = Array.isArray;\n\n/**\n * toString\n */\n\nvar str = Object.prototype.toString;\n\n/**\n * Whether or not the given `val`\n * is an array.\n *\n * example:\n *\n *        isArray([]);\n *        // > true\n *        isArray(arguments);\n *        // > false\n *        isArray('');\n *        // > false\n *\n * @param {mixed} val\n * @return {bool}\n */\n\nmodule.exports = isArray || function (val) {\n  return !! val && '[object Array]' == str.call(val);\n};\n","exports.read = function(buffer, offset, isLE, mLen, nBytes) {\n  var e, m,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      nBits = -7,\n      i = isLE ? (nBytes - 1) : 0,\n      d = isLE ? -1 : 1,\n      s = buffer[offset + i];\n\n  i += d;\n\n  e = s & ((1 << (-nBits)) - 1);\n  s >>= (-nBits);\n  nBits += eLen;\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  m = e & ((1 << (-nBits)) - 1);\n  e >>= (-nBits);\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity);\n  } else {\n    m = m + Math.pow(2, mLen);\n    e = e - eBias;\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen);\n};\n\nexports.write = function(buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0),\n      i = isLE ? 0 : (nBytes - 1),\n      d = isLE ? 1 : -1,\n      s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0;\n\n  value = Math.abs(value);\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0;\n    e = eMax;\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2);\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * Math.pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);\n      e = 0;\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8);\n\n  e = (e << mLen) | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8);\n\n  buffer[offset + i - d] |= s * 128;\n};\n","/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\n\n'use strict';\n\nexports.match = matchQuery;\nexports.parse = parseQuery;\n\n// -----------------------------------------------------------------------------\n\nvar RE_MEDIA_QUERY     = /(?:(only|not)?\\s*([^\\s\\(\\)]+)(?:\\s*and)?\\s*)?(.+)?/i,\n    RE_MQ_EXPRESSION   = /\\(\\s*([^\\s\\:\\)]+)\\s*(?:\\:\\s*([^\\s\\)]+))?\\s*\\)/,\n    RE_MQ_FEATURE      = /^(?:(min|max)-)?(.+)/,\n    RE_LENGTH_UNIT     = /(em|rem|px|cm|mm|in|pt|pc)?$/,\n    RE_RESOLUTION_UNIT = /(dpi|dpcm|dppx)?$/;\n\nfunction matchQuery(mediaQuery, values) {\n    return parseQuery(mediaQuery).some(function (query) {\n        var inverse = query.inverse;\n\n        // Either the parsed or specified `type` is \"all\", or the types must be\n        // equal for a match.\n        var typeMatch = query.type === 'all' || values.type === query.type;\n\n        // Quit early when `type` doesn't match, but take \"not\" into account.\n        if ((typeMatch && inverse) || !(typeMatch || inverse)) {\n            return false;\n        }\n\n        var expressionsMatch = query.expressions.every(function (expression) {\n            var feature  = expression.feature,\n                modifier = expression.modifier,\n                expValue = expression.value,\n                value    = values[feature];\n\n            // Missing or falsy values don't match.\n            if (!value) { return false; }\n\n            switch (feature) {\n                case 'orientation':\n                case 'scan':\n                    return value.toLowerCase() === expValue.toLowerCase();\n\n                case 'width':\n                case 'height':\n                case 'device-width':\n                case 'device-height':\n                    expValue = toPx(expValue);\n                    value    = toPx(value);\n                    break;\n\n                case 'resolution':\n                    expValue = toDpi(expValue);\n                    value    = toDpi(value);\n                    break;\n\n                case 'aspect-ratio':\n                case 'device-aspect-ratio':\n                case /* Deprecated */ 'device-pixel-ratio':\n                    expValue = toDecimal(expValue);\n                    value    = toDecimal(value);\n                    break;\n\n                case 'grid':\n                case 'color':\n                case 'color-index':\n                case 'monochrome':\n                    expValue = parseInt(expValue, 10) || 1;\n                    value    = parseInt(value, 10) || 0;\n                    break;\n            }\n\n            switch (modifier) {\n                case 'min': return value >= expValue;\n                case 'max': return value <= expValue;\n                default   : return value === expValue;\n            }\n        });\n\n        return (expressionsMatch && !inverse) || (!expressionsMatch && inverse);\n    });\n}\n\nfunction parseQuery(mediaQuery) {\n    return mediaQuery.split(',').map(function (query) {\n        query = query.trim();\n\n        var captures    = query.match(RE_MEDIA_QUERY),\n            modifier    = captures[1],\n            type        = captures[2],\n            expressions = captures[3] || '',\n            parsed      = {};\n\n        parsed.inverse = !!modifier && modifier.toLowerCase() === 'not';\n        parsed.type    = type ? type.toLowerCase() : 'all';\n\n        // Split expressions into a list.\n        expressions = expressions.match(/\\([^\\)]+\\)/g) || [];\n\n        parsed.expressions = expressions.map(function (expression) {\n            var captures = expression.match(RE_MQ_EXPRESSION),\n                feature  = captures[1].toLowerCase().match(RE_MQ_FEATURE);\n\n            return {\n                modifier: feature[1],\n                feature : feature[2],\n                value   : captures[2]\n            };\n        });\n\n        return parsed;\n    });\n}\n\n// -- Utilities ----------------------------------------------------------------\n\nfunction toDecimal(ratio) {\n    var decimal = Number(ratio),\n        numbers;\n\n    if (!decimal) {\n        numbers = ratio.match(/^(\\d+)\\s*\\/\\s*(\\d+)$/);\n        decimal = numbers[1] / numbers[2];\n    }\n\n    return decimal;\n}\n\nfunction toDpi(resolution) {\n    var value = parseFloat(resolution),\n        units = String(resolution).match(RE_RESOLUTION_UNIT)[1];\n\n    switch (units) {\n        case 'dpcm': return value / 2.54;\n        case 'dppx': return value * 96;\n        default    : return value;\n    }\n}\n\nfunction toPx(length) {\n    var value = parseFloat(length),\n        units = String(length).match(RE_LENGTH_UNIT)[1];\n\n    switch (units) {\n        case 'em' : return value * 16;\n        case 'rem': return value * 16;\n        case 'cm' : return value * 96 / 2.54;\n        case 'mm' : return value * 96 / 2.54 / 10;\n        case 'in' : return value * 96;\n        case 'pt' : return value * 72;\n        case 'pc' : return value * 72 / 12;\n        default   : return value;\n    }\n}\n","var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n;(function (exports) {\n\t'use strict';\n\n  var Arr = (typeof Uint8Array !== 'undefined')\n    ? Uint8Array\n    : Array\n\n\tvar PLUS   = '+'.charCodeAt(0)\n\tvar SLASH  = '/'.charCodeAt(0)\n\tvar NUMBER = '0'.charCodeAt(0)\n\tvar LOWER  = 'a'.charCodeAt(0)\n\tvar UPPER  = 'A'.charCodeAt(0)\n\tvar PLUS_URL_SAFE = '-'.charCodeAt(0)\n\tvar SLASH_URL_SAFE = '_'.charCodeAt(0)\n\n\tfunction decode (elt) {\n\t\tvar code = elt.charCodeAt(0)\n\t\tif (code === PLUS ||\n\t\t    code === PLUS_URL_SAFE)\n\t\t\treturn 62 // '+'\n\t\tif (code === SLASH ||\n\t\t    code === SLASH_URL_SAFE)\n\t\t\treturn 63 // '/'\n\t\tif (code < NUMBER)\n\t\t\treturn -1 //no match\n\t\tif (code < NUMBER + 10)\n\t\t\treturn code - NUMBER + 26 + 26\n\t\tif (code < UPPER + 26)\n\t\t\treturn code - UPPER\n\t\tif (code < LOWER + 26)\n\t\t\treturn code - LOWER + 26\n\t}\n\n\tfunction b64ToByteArray (b64) {\n\t\tvar i, j, l, tmp, placeHolders, arr\n\n\t\tif (b64.length % 4 > 0) {\n\t\t\tthrow new Error('Invalid string. Length must be a multiple of 4')\n\t\t}\n\n\t\t// the number of equal signs (place holders)\n\t\t// if there are two placeholders, than the two characters before it\n\t\t// represent one byte\n\t\t// if there is only one, then the three characters before it represent 2 bytes\n\t\t// this is just a cheap hack to not do indexOf twice\n\t\tvar len = b64.length\n\t\tplaceHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0\n\n\t\t// base64 is 4/3 + up to two characters of the original data\n\t\tarr = new Arr(b64.length * 3 / 4 - placeHolders)\n\n\t\t// if there are placeholders, only get up to the last complete 4 chars\n\t\tl = placeHolders > 0 ? b64.length - 4 : b64.length\n\n\t\tvar L = 0\n\n\t\tfunction push (v) {\n\t\t\tarr[L++] = v\n\t\t}\n\n\t\tfor (i = 0, j = 0; i < l; i += 4, j += 3) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))\n\t\t\tpush((tmp & 0xFF0000) >> 16)\n\t\t\tpush((tmp & 0xFF00) >> 8)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\tif (placeHolders === 2) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)\n\t\t\tpush(tmp & 0xFF)\n\t\t} else if (placeHolders === 1) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)\n\t\t\tpush((tmp >> 8) & 0xFF)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\treturn arr\n\t}\n\n\tfunction uint8ToBase64 (uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length\n\n\t\tfunction encode (num) {\n\t\t\treturn lookup.charAt(num)\n\t\t}\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)\n\t\t}\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n\t\t\toutput += tripletToBase64(temp)\n\t\t}\n\n\t\t// pad the end with zeros, but make sure to not forget the extra bytes\n\t\tswitch (extraBytes) {\n\t\t\tcase 1:\n\t\t\t\ttemp = uint8[uint8.length - 1]\n\t\t\t\toutput += encode(temp >> 2)\n\t\t\t\toutput += encode((temp << 4) & 0x3F)\n\t\t\t\toutput += '=='\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\ttemp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])\n\t\t\t\toutput += encode(temp >> 10)\n\t\t\t\toutput += encode((temp >> 4) & 0x3F)\n\t\t\t\toutput += encode((temp << 2) & 0x3F)\n\t\t\t\toutput += '='\n\t\t\t\tbreak\n\t\t}\n\n\t\treturn output\n\t}\n\n\texports.toByteArray = b64ToByteArray\n\texports.fromByteArray = uint8ToBase64\n}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))\n","var removeInvalidCharacters = function (content) {\n    // See http://www.w3.org/TR/xml/#NT-Char for valid XML 1.0 characters\n    return content.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\n};\n\nvar serializeAttributeValue = function (value) {\n    return value\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&apos;');\n};\n\nvar serializeTextContent = function (content) {\n    return content\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n};\n\nvar serializeAttribute = function (attr) {\n    var value = attr.value;\n\n    return ' ' + attr.name + '=\"' + serializeAttributeValue(value) + '\"';\n};\n\nvar getTagName = function (node) {\n    var tagName = node.tagName;\n\n    // Aid in serializing of original HTML documents\n    if (node.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n        tagName = tagName.toLowerCase();\n    }\n    return tagName;\n};\n\nvar serializeNamespace = function (node) {\n    var nodeHasXmlnsAttr = Array.prototype.map.call(node.attributes || node.attrs, function (attr) {\n            return attr.name;\n        })\n        .indexOf('xmlns') >= 0;\n    // Serialize the namespace as an xmlns attribute whenever the element\n    // doesn't already have one and the inherited namespace does not match\n    // the element's namespace.\n    // As a special case, always include an xmlns for html elements, in case\n    // of broken namespaceURI handling by browsers.\n    if (!nodeHasXmlnsAttr &&\n            (!node.parentNode ||\n             node.namespaceURI !== node.parentNode.namespaceURI ||\n             getTagName(node) === 'html')) {\n         return ' xmlns=\"' + node.namespaceURI + '\"';\n    } else {\n        return '';\n    }\n};\n\nvar serializeChildren = function (node) {\n    return Array.prototype.map.call(node.childNodes, function (childNode) {\n        return nodeTreeToXHTML(childNode);\n    }).join('');\n};\n\nvar serializeTag = function (node) {\n    var output = '<' + getTagName(node);\n    output += serializeNamespace(node);\n\n    Array.prototype.forEach.call(node.attributes || node.attrs, function (attr) {\n        output += serializeAttribute(attr);\n    });\n\n    if (node.childNodes.length > 0) {\n        output += '>';\n        output += serializeChildren(node);\n        output += '</' + getTagName(node) + '>';\n    } else {\n        output += '/>';\n    }\n    return output;\n};\n\nvar serializeText = function (node) {\n    var text = node.nodeValue || node.value || '';\n    return serializeTextContent(text);\n};\n\nvar serializeComment = function (node) {\n    return '<!--' +\n        node.data\n            .replace(/-/g, '&#45;') +\n        '-->';\n};\n\nvar serializeCDATA = function (node) {\n    return '<![CDATA[' + node.nodeValue + ']]>';\n};\n\nvar nodeTreeToXHTML = function (node) {\n    if (node.nodeName === '#document' ||\n        node.nodeName === '#document-fragment') {\n        return serializeChildren(node);\n    } else {\n        if (node.tagName) {\n            return serializeTag(node);\n        } else if (node.nodeName === '#text') {\n            return serializeText(node);\n        } else if (node.nodeName === '#comment') {\n            return serializeComment(node);\n        } else if (node.nodeName === '#cdata-section') {\n            return serializeCDATA(node);\n        }\n    }\n};\n\nexports.serializeToString = function (document) {\n    return removeInvalidCharacters(nodeTreeToXHTML(document));\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","\"use strict\";\n\nvar util = require('./util'),\n    inlineImage = require('./inlineImage'),\n    inlineScript = require('./inlineScript'),\n    inlineCss = require('./inlineCss'),\n    cssSupport = require('./cssSupport');\n\n\nvar getUrlBasePath = function (url) {\n    return util.joinUrl(url, '.');\n};\n\nvar parameterHashFunction = function (params) {\n    // HACK JSON.stringify is poor man's hashing;\n    // same objects might not receive same result as key order is not guaranteed\n    var a = params.map(function (param, idx) {\n        // Only include options relevant for method\n        if (idx === (params.length - 1)) {\n            param = {\n                // Two different HTML pages on the same path level have the same base path, but a different URL\n                baseUrl: getUrlBasePath(param.baseUrl)\n            };\n        }\n        return JSON.stringify(param);\n    });\n    return a;\n};\n\nvar memoizeFunctionOnCaching = function (func, options) {\n    if ((options.cache !== false && options.cache !== 'none') && options.cacheBucket) {\n        return util.memoize(func, parameterHashFunction, options.cacheBucket);\n    } else {\n        return func;\n    }\n};\n\n/* Style inlining */\n\nvar requestExternalsForStylesheet = function (styleContent, alreadyLoadedCssUrls, options) {\n    var cssRules = cssSupport.rulesForCssText(styleContent);\n\n    return inlineCss.loadCSSImportsForRules(cssRules, alreadyLoadedCssUrls, options).then(function (cssImportResult) {\n        return inlineCss.loadAndInlineCSSResourcesForRules(cssRules, options).then(function (cssResourcesResult) {\n            var errors = cssImportResult.errors.concat(cssResourcesResult.errors),\n                hasChanges = cssImportResult.hasChanges || cssResourcesResult.hasChanges;\n\n            if (hasChanges) {\n                styleContent = cssSupport.cssRulesToText(cssRules);\n            }\n\n            return {\n                hasChanges: hasChanges,\n                content: styleContent,\n                errors: errors\n            };\n        });\n    });\n};\n\nvar loadAndInlineCssForStyle = function (style, options, alreadyLoadedCssUrls) {\n    var styleContent = style.textContent,\n        processExternals = memoizeFunctionOnCaching(requestExternalsForStylesheet, options);\n\n    return processExternals(styleContent, alreadyLoadedCssUrls, options).then(function (result) {\n        if (result.hasChanges) {\n            style.childNodes[0].nodeValue = result.content;\n        }\n\n        return util.cloneArray(result.errors);\n    });\n};\n\nvar getCssStyleElements = function (doc) {\n    var styles = doc.getElementsByTagName(\"style\");\n\n    return Array.prototype.filter.call(styles, function (style) {\n        return !style.attributes.type || style.attributes.type.nodeValue === \"text/css\";\n    });\n};\n\nexports.loadAndInlineStyles = function (doc, options) {\n    var styles = getCssStyleElements(doc),\n        allErrors = [],\n        alreadyLoadedCssUrls = [],\n        inlineOptions;\n\n    inlineOptions = util.clone(options);\n    inlineOptions.baseUrl = inlineOptions.baseUrl || util.getDocumentBaseUrl(doc);\n\n    return util.all(styles.map(function (style) {\n        return loadAndInlineCssForStyle(style, inlineOptions, alreadyLoadedCssUrls).then(function (errors) {\n            allErrors = allErrors.concat(errors);\n        });\n    })).then(function () {\n        return allErrors;\n    });\n};\n\n/* CSS link inlining */\n\nvar substituteLinkWithInlineStyle = function (oldLinkNode, styleContent) {\n    var parent = oldLinkNode.parentNode,\n        styleNode;\n\n    styleContent = styleContent.trim();\n    if (styleContent) {\n        styleNode = oldLinkNode.ownerDocument.createElement(\"style\");\n        styleNode.type = \"text/css\";\n        styleNode.appendChild(oldLinkNode.ownerDocument.createTextNode(styleContent));\n\n        parent.insertBefore(styleNode, oldLinkNode);\n    }\n\n    parent.removeChild(oldLinkNode);\n};\n\nvar requestStylesheetAndInlineResources = function (url, options) {\n    return util.ajax(url, options)\n        .then(function (content) {\n            var cssRules = cssSupport.rulesForCssText(content);\n\n            return {\n                content: content,\n                cssRules: cssRules\n            };\n        })\n        .then(function (result) {\n            var hasChangesFromPathAdjustment = inlineCss.adjustPathsOfCssResources(url, result.cssRules);\n\n            return {\n                content: result.content,\n                cssRules: result.cssRules,\n                hasChanges: hasChangesFromPathAdjustment\n            };\n        })\n        .then(function (result) {\n            return inlineCss.loadCSSImportsForRules(result.cssRules, [], options)\n                .then(function (cssImportResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssImportResult.hasChanges,\n                        errors: cssImportResult.errors\n                    };\n                });\n        })\n        .then(function (result) {\n            return inlineCss.loadAndInlineCSSResourcesForRules(result.cssRules, options)\n                .then(function (cssResourcesResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssResourcesResult.hasChanges,\n                        errors: result.errors.concat(cssResourcesResult.errors)\n                    };\n                });\n        })\n        .then(function (result) {\n            var content = result.content;\n            if (result.hasChanges) {\n                content = cssSupport.cssRulesToText(result.cssRules);\n            }\n            return {\n                content: content,\n                errors: result.errors\n            };\n        });\n};\n\nvar loadLinkedCSS = function (link, options) {\n    var cssHref = link.attributes.href.nodeValue,\n        documentBaseUrl = util.getDocumentBaseUrl(link.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBaseUrl) {\n        ajaxOptions.baseUrl = documentBaseUrl;\n    }\n\n    var processStylesheet = memoizeFunctionOnCaching(requestStylesheetAndInlineResources, options);\n\n    return processStylesheet(cssHref, ajaxOptions).then(function (result) {\n        return {\n            content: result.content,\n            errors: util.cloneArray(result.errors)\n        };\n    });\n};\n\nvar getCssStylesheetLinks = function (doc) {\n    var links = doc.getElementsByTagName(\"link\");\n\n    return Array.prototype.filter.call(links, function (link) {\n        return link.attributes.rel && link.attributes.rel.nodeValue === \"stylesheet\" &&\n            (!link.attributes.type || link.attributes.type.nodeValue === \"text/css\");\n    });\n};\n\nexports.loadAndInlineCssLinks = function (doc, options) {\n    var links = getCssStylesheetLinks(doc),\n        errors = [];\n\n    return util.all(links.map(function (link) {\n        return loadLinkedCSS(link, options).then(function(result) {\n            substituteLinkWithInlineStyle(link, result.content + \"\\n\");\n\n            errors = errors.concat(result.errors);\n        }, function (e) {\n            errors.push({\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            });\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\n/* Main */\n\nexports.loadAndInlineImages = inlineImage.inline;\nexports.loadAndInlineScript = inlineScript.inline;\n\nexports.inlineReferences = function (doc, options) {\n    var allErrors = [],\n        inlineFuncs = [\n            exports.loadAndInlineImages,\n            exports.loadAndInlineStyles,\n            exports.loadAndInlineCssLinks];\n\n    if (options.inlineScripts !== false) {\n        inlineFuncs.push(exports.loadAndInlineScript);\n    }\n\n    return util.all(inlineFuncs.map(function (func) {\n        return func(doc, options)\n            .then(function (errors) {\n                allErrors = allErrors.concat(errors);\n            });\n    })).then(function () {\n        return allErrors;\n    });\n};\n","\"use strict\";\n\nvar url = require('url'),\n    ayepromise = require('ayepromise');\n\n\nexports.getDocumentBaseUrl = function (doc) {\n    if (doc.baseURI !== 'about:blank') {\n        return doc.baseURI;\n    }\n\n    return null;\n};\n\nexports.clone = function (object) {\n    var theClone = {},\n        i;\n    for (i in object) {\n        if (object.hasOwnProperty(i)) {\n           theClone[i] = object[i];\n        }\n    }\n    return theClone;\n};\n\nexports.cloneArray = function (nodeList) {\n    return Array.prototype.slice.apply(nodeList, [0]);\n};\n\nexports.joinUrl = function (baseUrl, relUrl) {\n    if (!baseUrl) {\n        return relUrl;\n    }\n    return url.resolve(baseUrl, relUrl);\n};\n\nexports.isDataUri = function (url) {\n    return (/^data:/).test(url);\n};\n\nexports.all = function (promises) {\n    var defer = ayepromise.defer(),\n        pendingPromiseCount = promises.length,\n        resolvedValues = [];\n\n    if (promises.length === 0) {\n        defer.resolve([]);\n        return defer.promise;\n    }\n\n    promises.forEach(function (promise, idx) {\n        promise.then(function (value) {\n            pendingPromiseCount -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingPromiseCount === 0) {\n                defer.resolve(resolvedValues);\n            }\n        }, function (e) {\n            defer.reject(e);\n        });\n    });\n    return defer.promise;\n};\n\nexports.collectAndReportErrors = function (promises) {\n    var errors = [];\n\n    return exports.all(promises.map(function (promise) {\n        return promise.fail(function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\nvar lastCacheDate = null;\n\nvar getUncachableURL = function (url, cache) {\n    if (cache === false || cache === 'none' || cache === 'repeated') {\n        if (lastCacheDate === null || cache !== 'repeated') {\n            lastCacheDate = Date.now();\n        }\n        return url + \"?_=\" + lastCacheDate;\n    } else {\n        return url;\n    }\n};\n\nexports.ajax = function (url, options) {\n    var ajaxRequest = new window.XMLHttpRequest(),\n        defer = ayepromise.defer(),\n        joinedUrl = exports.joinUrl(options.baseUrl, url),\n        augmentedUrl;\n\n    var doReject = function () {\n        defer.reject({\n            msg: 'Unable to load url',\n            url: joinedUrl\n        });\n    };\n\n    augmentedUrl = getUncachableURL(joinedUrl, options.cache);\n\n    ajaxRequest.addEventListener(\"load\", function () {\n        if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n            defer.resolve(ajaxRequest.response);\n        } else {\n            doReject();\n        }\n    }, false);\n\n    ajaxRequest.addEventListener(\"error\", doReject, false);\n\n    try {\n        ajaxRequest.open('GET', augmentedUrl, true);\n        ajaxRequest.overrideMimeType(options.mimeType);\n        ajaxRequest.send(null);\n    } catch (e) {\n        doReject();\n    }\n\n    return defer.promise;\n};\n\nexports.binaryAjax = function (url, options) {\n    var ajaxOptions = exports.clone(options);\n\n    ajaxOptions.mimeType = 'text/plain; charset=x-user-defined';\n\n    return exports.ajax(url, ajaxOptions)\n        .then(function (content) {\n            var binaryContent = \"\";\n\n            for (var i = 0; i < content.length; i++) {\n                binaryContent += String.fromCharCode(content.charCodeAt(i) & 0xFF);\n            }\n\n            return binaryContent;\n        });\n};\n\nvar detectMimeType = function (content) {\n    var startsWith = function (string, substring) {\n        return string.substring(0, substring.length) === substring;\n    };\n\n    if (startsWith(content, '<?xml') || startsWith(content, '<svg')) {\n        return 'image/svg+xml';\n    }\n    return 'image/png';\n};\n\nexports.getDataURIForImageURL = function (url, options) {\n    return exports.binaryAjax(url, options)\n        .then(function (content) {\n            var base64Content = btoa(content),\n                mimeType = detectMimeType(content);\n\n            return 'data:' + mimeType + ';base64,' + base64Content;\n        });\n};\n\nvar uniqueIdList = [];\n\nvar constantUniqueIdFor = function (element) {\n    // HACK, using a list results in O(n), but how do we hash a function?\n    if (uniqueIdList.indexOf(element) < 0) {\n        uniqueIdList.push(element);\n    }\n    return uniqueIdList.indexOf(element);\n};\n\nexports.memoize = function (func, hasher, memo) {\n    if (typeof memo !== \"object\") {\n        throw new Error(\"cacheBucket is not an object\");\n    }\n\n    return function () {\n        var args = Array.prototype.slice.call(arguments);\n\n        var argumentHash = hasher(args),\n            funcHash = constantUniqueIdFor(func),\n            retValue;\n\n        if (memo[funcHash] && memo[funcHash][argumentHash]) {\n            return memo[funcHash][argumentHash];\n        } else {\n            retValue = func.apply(null, args);\n\n            memo[funcHash] = memo[funcHash] || {};\n            memo[funcHash][argumentHash] = retValue;\n\n            return retValue;\n        }\n    };\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar loadLinkedScript = function (script, options) {\n    var src = script.attributes.src.nodeValue,\n        documentBase = util.getDocumentBaseUrl(script.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.ajax(src, ajaxOptions)\n        .fail(function (e) {\n            throw {\n                resourceType: \"script\",\n                url: e.url,\n                msg: \"Unable to load script \" + e.url\n            };\n        });\n};\n\nvar escapeClosingTags = function (text) {\n    // http://stackoverflow.com/questions/9246382/escaping-script-tag-inside-javascript\n    return text.replace(/<\\//g, '<\\\\/');\n};\n\nvar substituteExternalScriptWithInline = function (scriptNode, jsCode) {\n    scriptNode.attributes.removeNamedItem('src');\n    scriptNode.textContent = escapeClosingTags(jsCode);\n};\n\nvar getScripts = function (doc) {\n    var scripts = doc.getElementsByTagName(\"script\");\n\n    return Array.prototype.filter.call(scripts, function (script) {\n        return !!script.attributes.src;\n    });\n};\n\nexports.inline = function (doc, options) {\n    var scripts = getScripts(doc);\n\n    return util.collectAndReportErrors(scripts.map(function (script) {\n        return loadLinkedScript(script, options).then(function (jsCode) {\n            substituteExternalScriptWithInline(script, jsCode);\n        });\n    }));\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar encodeImageAsDataURI = function (image, options) {\n    var url = image.attributes.src ? image.attributes.src.nodeValue : null,\n        documentBase = util.getDocumentBaseUrl(image.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.getDataURIForImageURL(url, ajaxOptions)\n        .then(function (dataURI) {\n            return dataURI;\n        }, function (e) {\n            throw {\n                resourceType: \"image\",\n                url: e.url,\n                msg: \"Unable to load image \" + e.url\n            };\n        });\n};\n\nvar filterExternalImages = function (images) {\n    return images.filter(function (image) {\n        var url = image.attributes.src ? image.attributes.src.nodeValue : null;\n\n        return url !== null && !util.isDataUri(url);\n    });\n};\n\nvar filterInputsForImageType = function (inputs) {\n    return Array.prototype.filter.call(inputs, function (input) {\n        return input.type === \"image\";\n    });\n};\n\nvar toArray = function (arrayLike) {\n    return Array.prototype.slice.call(arrayLike);\n};\n\nexports.inline = function (doc, options) {\n    var images = toArray(doc.getElementsByTagName(\"img\")),\n        imageInputs = filterInputsForImageType(doc.getElementsByTagName(\"input\")),\n        externalImages = filterExternalImages(images.concat(imageInputs));\n\n    return util.collectAndReportErrors(externalImages.map(function (image) {\n        return encodeImageAsDataURI(image, options).then(function (dataURI) {\n            image.attributes.src.nodeValue = dataURI;\n        });\n    }));\n};\n","\"use strict\";\n\nvar ayepromise = require('ayepromise'),\n    util = require('./util'),\n    cssSupport = require('./cssSupport'),\n    backgroundValueParser = require('./backgroundValueParser'),\n    fontFaceSrcValueParser = require('css-font-face-src');\n\n\nvar updateCssPropertyValue = function (rule, property, value) {\n    rule.style.setProperty(property, value, rule.style.getPropertyPriority(property));\n};\n\nvar findBackgroundImageRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.STYLE_RULE && (rule.style.getPropertyValue('background-image') || rule.style.getPropertyValue('background'));\n    });\n};\n\nvar findBackgroundDeclarations = function (rules) {\n    var backgroundDeclarations = [];\n\n    rules.forEach(function (rule) {\n        if (rule.style.getPropertyValue('background-image')) {\n            backgroundDeclarations.push({\n                property: 'background-image',\n                value: rule.style.getPropertyValue('background-image'),\n                rule: rule\n            });\n        } else if (rule.style.getPropertyValue('background')) {\n            backgroundDeclarations.push({\n                property: 'background',\n                value: rule.style.getPropertyValue('background'),\n                rule: rule\n            });\n        }\n    });\n\n    return backgroundDeclarations;\n};\n\nvar findFontFaceRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.FONT_FACE_RULE && rule.style.getPropertyValue(\"src\");\n    });\n};\n\nvar findCSSImportRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.IMPORT_RULE && rule.href;\n    });\n};\n\nvar findExternalBackgroundUrls = function (parsedBackground) {\n    var matchIndices = [];\n\n    parsedBackground.forEach(function (backgroundLayer, i) {\n        if (backgroundLayer.url && !util.isDataUri(backgroundLayer.url)) {\n            matchIndices.push(i);\n        }\n    });\n\n    return matchIndices;\n};\n\nvar findExternalFontFaceUrls = function (parsedFontFaceSources) {\n    var sourceIndices = [];\n    parsedFontFaceSources.forEach(function (sourceItem, i) {\n        if (sourceItem.url && !util.isDataUri(sourceItem.url)) {\n            sourceIndices.push(i);\n        }\n    });\n    return sourceIndices;\n};\n\nexports.adjustPathsOfCssResources = function (baseUrl, cssRules) {\n    var backgroundRules = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(backgroundRules),\n        change = false;\n\n    backgroundDeclarations.forEach(function (declaration) {\n        var parsedBackground = backgroundValueParser.parse(declaration.value),\n            externalBackgroundIndices = findExternalBackgroundUrls(parsedBackground),\n            backgroundValue;\n\n        if (externalBackgroundIndices.length > 0) {\n            externalBackgroundIndices.forEach(function (backgroundLayerIndex) {\n                var relativeUrl = parsedBackground[backgroundLayerIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n                parsedBackground[backgroundLayerIndex].url = url;\n            });\n\n            backgroundValue = backgroundValueParser.serialize(parsedBackground);\n\n            updateCssPropertyValue(declaration.rule, declaration.property, backgroundValue);\n\n            change = true;\n        }\n    });\n    findFontFaceRules(cssRules).forEach(function (rule) {\n        var fontFaceSrcDeclaration = rule.style.getPropertyValue(\"src\"),\n            parsedFontFaceSources, externalFontFaceUrlIndices;\n\n        try {\n            parsedFontFaceSources = fontFaceSrcValueParser.parse(fontFaceSrcDeclaration);\n        } catch (e) {\n            return;\n        }\n        externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n        if (externalFontFaceUrlIndices.length > 0) {\n            externalFontFaceUrlIndices.forEach(function (fontFaceUrlIndex) {\n                var relativeUrl = parsedFontFaceSources[fontFaceUrlIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n\n                parsedFontFaceSources[fontFaceUrlIndex].url = url;\n            });\n\n            cssSupport.changeFontFaceRuleSrc(cssRules, rule, fontFaceSrcValueParser.serialize(parsedFontFaceSources));\n\n            change = true;\n        }\n    });\n    findCSSImportRules(cssRules).forEach(function (rule) {\n        var cssUrl = rule.href,\n            url = util.joinUrl(baseUrl, cssUrl);\n\n        cssSupport.exchangeRule(cssRules, rule, \"@import url(\" + url + \");\");\n\n        change = true;\n    });\n\n    return change;\n};\n\n/* CSS import inlining */\n\nvar substituteRule = function (cssRules, rule, newCssRules) {\n    var position = cssRules.indexOf(rule);\n\n    cssRules.splice(position, 1);\n\n    newCssRules.forEach(function (newRule, i) {\n        cssRules.splice(position + i, 0, newRule);\n    });\n};\n\nvar fulfilledPromise = function (value) {\n    var defer = ayepromise.defer();\n    defer.resolve(value);\n    return defer.promise;\n};\n\nvar loadAndInlineCSSImport = function (cssRules, rule, alreadyLoadedCssUrls, options) {\n    var url = rule.href,\n        cssHrefRelativeToDoc;\n\n    url = cssSupport.unquoteString(url);\n\n    cssHrefRelativeToDoc = util.joinUrl(options.baseUrl, url);\n\n    if (alreadyLoadedCssUrls.indexOf(cssHrefRelativeToDoc) >= 0) {\n        // Remove URL by adding empty string\n        substituteRule(cssRules, rule, []);\n        return fulfilledPromise([]);\n    } else {\n        alreadyLoadedCssUrls.push(cssHrefRelativeToDoc);\n    }\n\n    return util.ajax(url, options)\n        .then(function (cssText) {\n            var externalCssRules = cssSupport.rulesForCssText(cssText);\n\n            // Recursively follow @import statements\n            return exports.loadCSSImportsForRules(externalCssRules, alreadyLoadedCssUrls, options)\n                .then(function (result) {\n                    exports.adjustPathsOfCssResources(url, externalCssRules);\n\n                    substituteRule(cssRules, rule, externalCssRules);\n\n                    return result.errors;\n                });\n        }, function (e) {\n            throw {\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            };\n        });\n};\n\nexports.loadCSSImportsForRules = function (cssRules, alreadyLoadedCssUrls, options) {\n    var rulesToInline = findCSSImportRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        return loadAndInlineCSSImport(cssRules, rule, alreadyLoadedCssUrls, options).then(function (moreErrors) {\n            errors = errors.concat(moreErrors);\n\n            hasChanges = true;\n        }, function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\n/* CSS linked resource inlining */\n\nvar loadAndInlineBackgroundImages = function (backgroundValue, options) {\n    var parsedBackground = backgroundValueParser.parse(backgroundValue),\n        externalBackgroundLayerIndices = findExternalBackgroundUrls(parsedBackground),\n        hasChanges = false;\n\n    return util.collectAndReportErrors(externalBackgroundLayerIndices.map(function (backgroundLayerIndex) {\n        var url = parsedBackground[backgroundLayerIndex].url;\n\n        return util.getDataURIForImageURL(url, options)\n            .then(function (dataURI) {\n                parsedBackground[backgroundLayerIndex].url = dataURI;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"backgroundImage\",\n                    url: e.url,\n                    msg: \"Unable to load background-image \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            backgroundValue: backgroundValueParser.serialize(parsedBackground),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineBackgroundImages = function (cssRules, options) {\n    var rulesToInline = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(rulesToInline),\n        errors = [],\n        cssHasChanges = false;\n\n    return util.all(backgroundDeclarations.map(function (declaration) {\n        return loadAndInlineBackgroundImages(declaration.value, options)\n            .then(function (result) {\n                if (result.hasChanges) {\n                    updateCssPropertyValue(declaration.rule, declaration.property, result.backgroundValue);\n\n                    cssHasChanges = true;\n                }\n\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: cssHasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar loadAndInlineFontFace = function (srcDeclarationValue, options) {\n    var hasChanges = false,\n        parsedFontFaceSources, externalFontFaceUrlIndices;\n\n    try {\n        parsedFontFaceSources = fontFaceSrcValueParser.parse(srcDeclarationValue);\n    } catch (e) {\n        parsedFontFaceSources = [];\n    }\n    externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n    return util.collectAndReportErrors(externalFontFaceUrlIndices.map(function (urlIndex) {\n        var fontSrc = parsedFontFaceSources[urlIndex],\n            format = fontSrc.format || \"woff\";\n\n        return util.binaryAjax(fontSrc.url, options)\n            .then(function (content) {\n                var base64Content = btoa(content);\n                fontSrc.url = 'data:font/' + format + ';base64,' + base64Content;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"fontFace\",\n                    url: e.url,\n                    msg: \"Unable to load font-face \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            srcDeclarationValue: fontFaceSrcValueParser.serialize(parsedFontFaceSources),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineFontFace = function (cssRules, options) {\n    var rulesToInline = findFontFaceRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        var srcDeclarationValue = rule.style.getPropertyValue(\"src\");\n\n        return loadAndInlineFontFace(srcDeclarationValue, options).then(function (result) {\n            if (result.hasChanges) {\n                cssSupport.changeFontFaceRuleSrc(cssRules, rule, result.srcDeclarationValue);\n\n                hasChanges = true;\n            }\n\n            errors = errors.concat(result.errors);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nexports.loadAndInlineCSSResourcesForRules = function (cssRules, options) {\n    var hasChanges = false,\n        errors = [];\n\n    return util.all([iterateOverRulesAndInlineBackgroundImages, iterateOverRulesAndInlineFontFace].map(function (func) {\n        return func(cssRules, options)\n            .then(function (result) {\n                hasChanges = hasChanges || result.hasChanges;\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n","\"use strict\";\n\nvar cssom = require('cssom');\n\n\nexports.unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nvar rulesForCssTextFromBrowser = function (styleContent) {\n    var doc = document.implementation.createHTMLDocument(\"\"),\n        styleElement = document.createElement(\"style\"),\n        rules;\n\n    styleElement.textContent = styleContent;\n    // the style will only be parsed once it is added to a document\n    doc.body.appendChild(styleElement);\n    rules = styleElement.sheet.cssRules;\n\n    return Array.prototype.slice.call(rules);\n};\n\nvar browserHasBackgroundImageUrlIssue = (function () {\n    // Checks for http://code.google.com/p/chromium/issues/detail?id=161644\n    var rules = rulesForCssTextFromBrowser('a{background:url(i)}');\n    return !rules.length || rules[0].cssText.indexOf('url()') >= 0;\n}());\n\nexports.rulesForCssText = function (styleContent) {\n    if (browserHasBackgroundImageUrlIssue && cssom.parse) {\n        return cssom.parse(styleContent).cssRules;\n    } else {\n        return rulesForCssTextFromBrowser(styleContent);\n    }\n};\n\nexports.cssRulesToText = function (cssRules) {\n    return cssRules.reduce(function (cssText, rule) {\n        return cssText + rule.cssText;\n    }, '');\n};\n\nexports.exchangeRule = function (cssRules, rule, newRuleText) {\n    var ruleIdx = cssRules.indexOf(rule),\n        styleSheet = rule.parentStyleSheet;\n\n    // Generate a new rule\n    styleSheet.insertRule(newRuleText, ruleIdx+1);\n    styleSheet.deleteRule(ruleIdx);\n    // Exchange with the new\n    cssRules[ruleIdx] = styleSheet.cssRules[ruleIdx];\n};\n\n// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=443978\nexports.changeFontFaceRuleSrc = function (cssRules, rule, newSrc) {\n    var newRuleText = '@font-face { font-family: ' + rule.style.getPropertyValue(\"font-family\") + '; ';\n\n    if (rule.style.getPropertyValue(\"font-style\")) {\n        newRuleText += 'font-style: ' + rule.style.getPropertyValue(\"font-style\") + '; ';\n    }\n\n    if (rule.style.getPropertyValue(\"font-weight\")) {\n        newRuleText += 'font-weight: ' + rule.style.getPropertyValue(\"font-weight\") + '; ';\n    }\n\n    newRuleText += 'src: ' + newSrc + '}';\n    exports.exchangeRule(cssRules, rule, newRuleText);\n};\n","// Simple, stupid \"background\"/\"background-image\" value parser that just aims at exposing the image URLs\n\"use strict\";\n\nvar cssSupport = require('./cssSupport');\n\n\nvar trimCSSWhitespace = function (url) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return url.replace(whitespaceRegex, \"$1\");\n};\n\n// TODO exporting this for the sake of unit testing. Should rather test the background value parser explicitly.\nexports.extractCssUrl = function (cssUrl) {\n    var urlRegex = /^url\\(([^\\)]+)\\)/,\n        quotedUrl;\n\n    if (!urlRegex.test(cssUrl)) {\n        throw new Error(\"Invalid url\");\n    }\n\n    quotedUrl = urlRegex.exec(cssUrl)[1];\n    return cssSupport.unquoteString(trimCSSWhitespace(quotedUrl));\n};\n\nvar sliceBackgroundDeclaration = function (backgroundDeclarationText) {\n    var functionParamRegexS = \"\\\\s*(?:\\\"[^\\\"]*\\\"|'[^']*'|[^\\\\(]+)\\\\s*\",\n        valueRegexS = \"(\" + \"url\\\\(\" + functionParamRegexS + \"\\\\)\" + \"|\" + \"[^,\\\\s]+\" + \")\",\n        simpleSingularBackgroundRegexS = \"(?:\\\\s*\" + valueRegexS + \")+\",\n        simpleBackgroundRegexS = \"^\\\\s*(\" + simpleSingularBackgroundRegexS + \")\" +\n                                  \"(?:\\\\s*,\\\\s*(\" + simpleSingularBackgroundRegexS + \"))*\" +\n                                  \"\\\\s*$\",\n        simpleSingularBackgroundRegex = new RegExp(simpleSingularBackgroundRegexS, \"g\"),\n        outerRepeatedMatch,\n        backgroundLayers = [],\n        getValues = function (singularBackgroundDeclaration) {\n            var valueRegex = new RegExp(valueRegexS, \"g\"),\n                backgroundValues = [],\n                repeatedMatch;\n\n            repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            while (repeatedMatch) {\n                backgroundValues.push(repeatedMatch[1]);\n                repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            }\n            return backgroundValues;\n        };\n\n    if (backgroundDeclarationText.match(new RegExp(simpleBackgroundRegexS))) {\n        outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        while (outerRepeatedMatch) {\n            backgroundLayers.push(getValues(outerRepeatedMatch[0]));\n            outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        }\n\n        return backgroundLayers;\n    }\n    return [];\n};\n\nvar findBackgroundImageUrlInValues = function (values) {\n    var i, url;\n\n    for(i = 0; i < values.length; i++) {\n        try {\n            url = exports.extractCssUrl(values[i]);\n            return {\n                url: url,\n                idx: i\n            };\n        } catch (e) {}\n    }\n};\n\nexports.parse = function (backgroundValue) {\n    var backgroundLayers = sliceBackgroundDeclaration(backgroundValue);\n\n    return backgroundLayers.map(function (backgroundLayerValues) {\n        var urlMatch = findBackgroundImageUrlInValues(backgroundLayerValues);\n\n        if (urlMatch) {\n            return {\n                preUrl: backgroundLayerValues.slice(0, urlMatch.idx),\n                url: urlMatch.url,\n                postUrl: backgroundLayerValues.slice(urlMatch.idx+1),\n            };\n        } else {\n            return {\n                preUrl: backgroundLayerValues\n            };\n        }\n    });\n};\n\nexports.serialize = function (parsedBackground) {\n    var backgroundLayers = parsedBackground.map(function (backgroundLayer) {\n        var values = [].concat(backgroundLayer.preUrl);\n\n        if (backgroundLayer.url) {\n            values.push('url(\"' + backgroundLayer.url + '\")');\n        }\n        if (backgroundLayer.postUrl) {\n            values = values.concat(backgroundLayer.postUrl);\n        }\n\n        return values.join(' ');\n    });\n\n    return backgroundLayers.join(', ');\n};\n","'use strict';\n\nexports.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nexports.CSSRule = require('./CSSRule').CSSRule;\nexports.CSSStyleRule = require('./CSSStyleRule').CSSStyleRule;\nexports.MediaList = require('./MediaList').MediaList;\nexports.CSSMediaRule = require('./CSSMediaRule').CSSMediaRule;\nexports.CSSImportRule = require('./CSSImportRule').CSSImportRule;\nexports.CSSFontFaceRule = require('./CSSFontFaceRule').CSSFontFaceRule;\nexports.StyleSheet = require('./StyleSheet').StyleSheet;\nexports.CSSStyleSheet = require('./CSSStyleSheet').CSSStyleSheet;\nexports.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nexports.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nexports.MatcherList = require('./MatcherList').MatcherList;\nexports.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\nexports.CSSValue = require('./CSSValue').CSSValue;\nexports.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nexports.parse = require('./parse').parse;\nexports.clone = require('./clone').clone;\n","var grammar = require('./grammar');\n\n\nexports.SyntaxError = function (message, offset) {\n    this.message  = message;\n    this.offset   = offset;\n};\n\nexports.parse = function (fontFaceSourceValue) {\n    try {\n        return grammar.parse(fontFaceSourceValue);\n    } catch (e) {\n        throw new exports.SyntaxError(e.message, e.offset);\n    }\n};\n\nexports.serialize = function (parsedFontFaceSources) {\n    return parsedFontFaceSources.map(function (sourceItem) {\n        var itemValue;\n\n        if (sourceItem.url) {\n            itemValue = 'url(\"' + sourceItem.url + '\")';\n            if (sourceItem.format) {\n                itemValue += ' format(\"' + sourceItem.format + '\")';\n            }\n        } else {\n            itemValue = 'local(\"' + sourceItem.local + '\")';\n        }\n        return itemValue;\n    }).join(', ');\n};\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-cssrule-interface\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSRule\n */\nCSSOM.CSSRule = function CSSRule() {\n\tthis.parentRule = null;\n\tthis.parentStyleSheet = null;\n};\n\nCSSOM.CSSRule.STYLE_RULE = 1;\nCSSOM.CSSRule.IMPORT_RULE = 3;\nCSSOM.CSSRule.MEDIA_RULE = 4;\nCSSOM.CSSRule.FONT_FACE_RULE = 5;\nCSSOM.CSSRule.PAGE_RULE = 6;\nCSSOM.CSSRule.WEBKIT_KEYFRAMES_RULE = 8;\nCSSOM.CSSRule.WEBKIT_KEYFRAME_RULE = 9;\n\n// Obsolete in CSSOM http://dev.w3.org/csswg/cssom/\n//CSSOM.CSSRule.UNKNOWN_RULE = 0;\n//CSSOM.CSSRule.CHARSET_RULE = 2;\n\n// Never implemented\n//CSSOM.CSSRule.VARIABLES_RULE = 7;\n\nCSSOM.CSSRule.prototype = {\n\tconstructor: CSSOM.CSSRule\n\t//FIXME\n};\n\n\n//.CommonJS\nexports.CSSRule = CSSOM.CSSRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-medialist-interface\n */\nCSSOM.MediaList = function MediaList(){\n\tthis.length = 0;\n};\n\nCSSOM.MediaList.prototype = {\n\n\tconstructor: CSSOM.MediaList,\n\n\t/**\n\t * @return {string}\n\t */\n\tget mediaText() {\n\t\treturn Array.prototype.join.call(this, \", \");\n\t},\n\n\t/**\n\t * @param {string} value\n\t */\n\tset mediaText(value) {\n\t\tvar values = value.split(\",\");\n\t\tvar length = this.length = values.length;\n\t\tfor (var i=0; i<length; i++) {\n\t\t\tthis[i] = values[i].trim();\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tappendMedium: function(medium) {\n\t\tif (Array.prototype.indexOf.call(this, medium) === -1) {\n\t\t\tthis[this.length] = medium;\n\t\t\tthis.length++;\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tdeleteMedium: function(medium) {\n\t\tvar index = Array.prototype.indexOf.call(this, medium);\n\t\tif (index !== -1) {\n\t\t\tArray.prototype.splice.call(this, index, 1);\n\t\t}\n\t}\n\n};\n\n\n//.CommonJS\nexports.MediaList = CSSOM.MediaList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssstylerule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleRule\n */\nCSSOM.CSSStyleRule = function CSSStyleRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.selectorText = \"\";\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSStyleRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSStyleRule.prototype.constructor = CSSOM.CSSStyleRule;\nCSSOM.CSSStyleRule.prototype.type = 1;\n\nObject.defineProperty(CSSOM.CSSStyleRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar text;\n\t\tif (this.selectorText) {\n\t\t\ttext = this.selectorText + \" {\" + this.style.cssText + \"}\";\n\t\t} else {\n\t\t\ttext = \"\";\n\t\t}\n\t\treturn text;\n\t},\n\tset: function(cssText) {\n\t\tvar rule = CSSOM.CSSStyleRule.parse(cssText);\n\t\tthis.style = rule.style;\n\t\tthis.selectorText = rule.selectorText;\n\t}\n});\n\n\n/**\n * NON-STANDARD\n * lightweight version of parse.js.\n * @param {string} ruleText\n * @return CSSStyleRule\n */\nCSSOM.CSSStyleRule.parse = function(ruleText) {\n\tvar i = 0;\n\tvar state = \"selector\";\n\tvar index;\n\tvar j = i;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true\n\t};\n\n\tvar styleRule = new CSSOM.CSSStyleRule;\n\tvar selector, name, value, priority=\"\";\n\n\tfor (var character; character = ruleText.charAt(i); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\t// Squash 2 or more white-spaces in the row into 1\n\t\t\t\tswitch (ruleText.charAt(i - 1)) {\n\t\t\t\t\tcase \" \":\n\t\t\t\t\tcase \"\\t\":\n\t\t\t\t\tcase \"\\r\":\n\t\t\t\t\tcase \"\\n\":\n\t\t\t\t\tcase \"\\f\":\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuffer += \" \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf('\"', j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow '\" is missing';\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf(\"'\", j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow \"' is missing\";\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (ruleText.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = ruleText.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tthrow new SyntaxError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && ruleText.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t} else if (state === \"name\") {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tstate = \"selector\";\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\t}\n\t}\n\n\treturn styleRule;\n\n};\n\n\n//.CommonJS\nexports.CSSStyleRule = CSSOM.CSSStyleRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssmediarule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSMediaRule\n */\nCSSOM.CSSMediaRule = function CSSMediaRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.media = new CSSOM.MediaList;\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSMediaRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSMediaRule.prototype.constructor = CSSOM.CSSMediaRule;\nCSSOM.CSSMediaRule.prototype.type = 4;\n//FIXME\n//CSSOM.CSSMediaRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSMediaRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://opensource.apple.com/source/WebCore/WebCore-658.28/css/CSSMediaRule.cpp\nObject.defineProperty(CSSOM.CSSMediaRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@media \" + this.media.mediaText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSMediaRule = CSSOM.CSSMediaRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration\n */\nCSSOM.CSSStyleDeclaration = function CSSStyleDeclaration(){\n\tthis.length = 0;\n\tthis.parentRule = null;\n\n\t// NON-STANDARD\n\tthis._importants = {};\n};\n\n\nCSSOM.CSSStyleDeclaration.prototype = {\n\n\tconstructor: CSSOM.CSSStyleDeclaration,\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-getPropertyValue\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set.\n\t */\n\tgetPropertyValue: function(name) {\n\t\treturn this[name] || \"\";\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {string} [priority=null] \"important\" or null\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-setProperty\n\t */\n\tsetProperty: function(name, value, priority) {\n\t\tif (this[name]) {\n\t\t\t// Property already exist. Overwrite it.\n\t\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\t\tif (index < 0) {\n\t\t\t\tthis[this.length] = name;\n\t\t\t\tthis.length++;\n\t\t\t}\n\t\t} else {\n\t\t\t// New property.\n\t\t\tthis[this.length] = name;\n\t\t\tthis.length++;\n\t\t}\n\t\tthis[name] = value;\n\t\tthis._importants[name] = priority;\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-removeProperty\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set or the property name does not correspond to a known CSS property.\n\t */\n\tremoveProperty: function(name) {\n\t\tif (!(name in this)) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\tif (index < 0) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar prevValue = this[name];\n\t\tthis[name] = \"\";\n\n\t\t// That's what WebKit and Opera do\n\t\tArray.prototype.splice.call(this, index, 1);\n\n\t\t// That's what Firefox does\n\t\t//this[index] = \"\"\n\n\t\treturn prevValue;\n\t},\n\n\tgetPropertyCSSValue: function() {\n\t\t//FIXME\n\t},\n\n\t/**\n\t *\n\t * @param {String} name\n\t */\n\tgetPropertyPriority: function(name) {\n\t\treturn this._importants[name] || \"\";\n\t},\n\n\n\t/**\n\t *   element.style.overflow = \"auto\"\n\t *   element.style.getPropertyShorthand(\"overflow-x\")\n\t *   -> \"overflow\"\n\t */\n\tgetPropertyShorthand: function() {\n\t\t//FIXME\n\t},\n\n\tisPropertyImplicit: function() {\n\t\t//FIXME\n\t},\n\n\t// Doesn't work in IE < 9\n\tget cssText(){\n\t\tvar properties = [];\n\t\tfor (var i=0, length=this.length; i < length; ++i) {\n\t\t\tvar name = this[i];\n\t\t\tvar value = this.getPropertyValue(name);\n\t\t\tvar priority = this.getPropertyPriority(name);\n\t\t\tif (priority) {\n\t\t\t\tpriority = \" !\" + priority;\n\t\t\t}\n\t\t\tproperties[i] = name + \": \" + value + priority + \";\";\n\t\t}\n\t\treturn properties.join(\" \");\n\t},\n\n\tset cssText(cssText){\n\t\tvar i, name;\n\t\tfor (i = this.length; i--;) {\n\t\t\tname = this[i];\n\t\t\tthis[name] = \"\";\n\t\t}\n\t\tArray.prototype.splice.call(this, 0, this.length);\n\t\tthis._importants = {};\n\n\t\tvar dummyRule = CSSOM.parse('#bogus{' + cssText + '}').cssRules[0].style;\n\t\tvar length = dummyRule.length;\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tname = dummyRule[i];\n\t\t\tthis.setProperty(dummyRule[i], dummyRule.getPropertyValue(name), dummyRule.getPropertyPriority(name));\n\t\t}\n\t}\n};\n\n\n//.CommonJS\nexports.CSSStyleDeclaration = CSSOM.CSSStyleDeclaration;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleDeclaration.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssimportrule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSImportRule\n */\nCSSOM.CSSImportRule = function CSSImportRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.href = \"\";\n\tthis.media = new CSSOM.MediaList;\n\tthis.styleSheet = new CSSOM.CSSStyleSheet;\n};\n\nCSSOM.CSSImportRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSImportRule.prototype.constructor = CSSOM.CSSImportRule;\nCSSOM.CSSImportRule.prototype.type = 3;\n\nObject.defineProperty(CSSOM.CSSImportRule.prototype, \"cssText\", {\n  get: function() {\n    var mediaText = this.media.mediaText;\n    return \"@import url(\" + this.href + \")\" + (mediaText ? \" \" + mediaText : \"\") + \";\";\n  },\n  set: function(cssText) {\n    var i = 0;\n\n    /**\n     * @import url(partial.css) screen, handheld;\n     *        ||               |\n     *        after-import     media\n     *         |\n     *         url\n     */\n    var state = '';\n\n    var buffer = '';\n    var index;\n    var mediaText = '';\n    for (var character; character = cssText.charAt(i); i++) {\n\n      switch (character) {\n        case ' ':\n        case '\\t':\n        case '\\r':\n        case '\\n':\n        case '\\f':\n          if (state === 'after-import') {\n            state = 'url';\n          } else {\n            buffer += character;\n          }\n          break;\n\n        case '@':\n          if (!state && cssText.indexOf('@import', i) === i) {\n            state = 'after-import';\n            i += 'import'.length;\n            buffer = '';\n          }\n          break;\n\n        case 'u':\n          if (state === 'url' && cssText.indexOf('url(', i) === i) {\n            index = cssText.indexOf(')', i + 1);\n            if (index === -1) {\n              throw i + ': \")\" not found';\n            }\n            i += 'url('.length;\n            var url = cssText.slice(i, index);\n            if (url[0] === url[url.length - 1]) {\n              if (url[0] === '\"' || url[0] === \"'\") {\n                url = url.slice(1, -1);\n              }\n            }\n            this.href = url;\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case '\"':\n          if (state === 'url') {\n            index = cssText.indexOf('\"', i + 1);\n            if (!index) {\n              throw i + \": '\\\"' not found\";\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case \"'\":\n          if (state === 'url') {\n            index = cssText.indexOf(\"'\", i + 1);\n            if (!index) {\n              throw i + ': \"\\'\" not found';\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case ';':\n          if (state === 'media') {\n            if (buffer) {\n              this.media.mediaText = buffer.trim();\n            }\n          }\n          break;\n\n        default:\n          if (state === 'media') {\n            buffer += character;\n          }\n          break;\n      }\n    }\n  }\n});\n\n\n//.CommonJS\nexports.CSSImportRule = CSSOM.CSSImportRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-stylesheet-interface\n */\nCSSOM.StyleSheet = function StyleSheet() {\n\tthis.parentStyleSheet = null;\n};\n\n\n//.CommonJS\nexports.StyleSheet = CSSOM.StyleSheet;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#css-font-face-rule\n */\nCSSOM.CSSFontFaceRule = function CSSFontFaceRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSFontFaceRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSFontFaceRule.prototype.constructor = CSSOM.CSSFontFaceRule;\nCSSOM.CSSFontFaceRule.prototype.type = 5;\n//FIXME\n//CSSOM.CSSFontFaceRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSFontFaceRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSFontFaceRule.cpp\nObject.defineProperty(CSSOM.CSSFontFaceRule.prototype, \"cssText\", {\n  get: function() {\n    return \"@font-face {\" + this.style.cssText + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSFontFaceRule = CSSOM.CSSFontFaceRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tStyleSheet: require(\"./StyleSheet\").StyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet\n */\nCSSOM.CSSStyleSheet = function CSSStyleSheet() {\n\tCSSOM.StyleSheet.call(this);\n\tthis.cssRules = [];\n};\n\n\nCSSOM.CSSStyleSheet.prototype = new CSSOM.StyleSheet;\nCSSOM.CSSStyleSheet.prototype.constructor = CSSOM.CSSStyleSheet;\n\n\n/**\n * Used to insert a new rule into the style sheet. The new rule now becomes part of the cascade.\n *\n *   sheet = new Sheet(\"body {margin: 0}\")\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *   sheet.insertRule(\"img {border: none}\", 0)\n *   -> 0\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *\n * @param {string} rule\n * @param {number} index\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-insertRule\n * @return {number} The index within the style sheet's rule collection of the newly inserted rule.\n */\nCSSOM.CSSStyleSheet.prototype.insertRule = function(rule, index) {\n\tif (index < 0 || index > this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tvar cssRule = CSSOM.parse(rule).cssRules[0];\n\tcssRule.parentStyleSheet = this;\n\tthis.cssRules.splice(index, 0, cssRule);\n\treturn index;\n};\n\n\n/**\n * Used to delete a rule from the style sheet.\n *\n *   sheet = new Sheet(\"img{border:none} body{margin:0}\")\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *   sheet.deleteRule(0)\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *\n * @param {number} index within the style sheet's rule list of the rule to remove.\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-deleteRule\n */\nCSSOM.CSSStyleSheet.prototype.deleteRule = function(index) {\n\tif (index < 0 || index >= this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tthis.cssRules.splice(index, 1);\n};\n\n\n/**\n * NON-STANDARD\n * @return {string} serialize stylesheet\n */\nCSSOM.CSSStyleSheet.prototype.toString = function() {\n\tvar result = \"\";\n\tvar rules = this.cssRules;\n\tfor (var i=0; i<rules.length; i++) {\n\t\tresult += rules[i].cssText + \"\\n\";\n\t}\n\treturn result;\n};\n\n\n//.CommonJS\nexports.CSSStyleSheet = CSSOM.CSSStyleSheet;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleSheet.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframesRule\n */\nCSSOM.CSSKeyframesRule = function CSSKeyframesRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.name = '';\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSKeyframesRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSKeyframesRule.prototype.constructor = CSSOM.CSSKeyframesRule;\nCSSOM.CSSKeyframesRule.prototype.type = 8;\n//FIXME\n//CSSOM.CSSKeyframesRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframesRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframesRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframesRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(\"  \" + this.cssRules[i].cssText);\n    }\n    return \"@\" + (this._vendorPrefix || '') + \"keyframes \" + this.name + \" { \\n\" + cssTexts.join(\"\\n\") + \"\\n}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframesRule = CSSOM.CSSKeyframesRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleDeclaration: require('./CSSStyleDeclaration').CSSStyleDeclaration\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframeRule\n */\nCSSOM.CSSKeyframeRule = function CSSKeyframeRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.keyText = '';\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSKeyframeRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSKeyframeRule.prototype.constructor = CSSOM.CSSKeyframeRule;\nCSSOM.CSSKeyframeRule.prototype.type = 9;\n//FIXME\n//CSSOM.CSSKeyframeRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframeRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframeRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframeRule.prototype, \"cssText\", {\n  get: function() {\n    return this.keyText + \" {\" + this.style.cssText + \"} \";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframeRule = CSSOM.CSSKeyframeRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.MatcherList = function MatcherList(){\n    this.length = 0;\n};\n\nCSSOM.MatcherList.prototype = {\n\n    constructor: CSSOM.MatcherList,\n\n    /**\n     * @return {string}\n     */\n    get matcherText() {\n        return Array.prototype.join.call(this, \", \");\n    },\n\n    /**\n     * @param {string} value\n     */\n    set matcherText(value) {\n        // just a temporary solution, actually it may be wrong by just split the value with ',', because a url can include ','.\n        var values = value.split(\",\");\n        var length = this.length = values.length;\n        for (var i=0; i<length; i++) {\n            this[i] = values[i].trim();\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    appendMatcher: function(matcher) {\n        if (Array.prototype.indexOf.call(this, matcher) === -1) {\n            this[this.length] = matcher;\n            this.length++;\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    deleteMatcher: function(matcher) {\n        var index = Array.prototype.indexOf.call(this, matcher);\n        if (index !== -1) {\n            Array.prototype.splice.call(this, index, 1);\n        }\n    }\n\n};\n\n\n//.CommonJS\nexports.MatcherList = CSSOM.MatcherList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n    CSSRule: require(\"./CSSRule\").CSSRule,\n    MatcherList: require(\"./MatcherList\").MatcherList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.CSSDocumentRule = function CSSDocumentRule() {\n    CSSOM.CSSRule.call(this);\n    this.matcher = new CSSOM.MatcherList;\n    this.cssRules = [];\n};\n\nCSSOM.CSSDocumentRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSDocumentRule.prototype.constructor = CSSOM.CSSDocumentRule;\nCSSOM.CSSDocumentRule.prototype.type = 10;\n//FIXME\n//CSSOM.CSSDocumentRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSDocumentRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSDocumentRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n        cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@-moz-document \" + this.matcher.matcherText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSDocumentRule = CSSOM.CSSDocumentRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n *\n * TODO: add if needed\n */\nCSSOM.CSSValue = function CSSValue() {\n};\n\nCSSOM.CSSValue.prototype = {\n\tconstructor: CSSOM.CSSValue,\n\n\t// @see: http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n\tset cssText(text) {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Exception('DOMException: property \"cssText\" of \"' + name + '\" is readonly!');\n\t},\n\n\tget cssText() {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Exception('getter \"cssText\" of \"' + name + '\" is not implemented!');\n\t},\n\n\t_getConstructorName: function() {\n\t\tvar s = this.constructor.toString(),\n\t\t\t\tc = s.match(/function\\s([^\\(]+)/),\n\t\t\t\tname = c[1];\n\n\t\treturn name;\n\t}\n};\n\n\n//.CommonJS\nexports.CSSValue = CSSOM.CSSValue;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @param {string} token\n */\nCSSOM.parse = function parse(token) {\n\n\tvar i = 0;\n\n\t/**\n\t\t\"before-selector\" or\n\t\t\"selector\" or\n\t\t\"atRule\" or\n\t\t\"atBlock\" or\n\t\t\"before-name\" or\n\t\t\"name\" or\n\t\t\"before-value\" or\n\t\t\"value\"\n\t*/\n\tvar state = \"before-selector\";\n\n\tvar index;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true,\n\t\t\"atRule\": true,\n\t\t\"importRule-begin\": true,\n\t\t\"importRule\": true,\n\t\t\"atBlock\": true,\n\t\t'documentRule-begin': true\n\t};\n\n\tvar styleSheet = new CSSOM.CSSStyleSheet;\n\n\t// @type CSSStyleSheet|CSSMediaRule|CSSFontFaceRule|CSSKeyframesRule|CSSDocumentRule\n\tvar currentScope = styleSheet;\n\n\t// @type CSSMediaRule|CSSKeyframesRule|CSSDocumentRule\n\tvar parentRule;\n\n\tvar selector, name, value, priority=\"\", styleRule, mediaRule, importRule, fontFaceRule, keyframesRule, keyframeRule, documentRule;\n\n\tvar atKeyframesRegExp = /@(-(?:\\w+-)+)?keyframes/g;\n\n\tvar parseError = function(message) {\n\t\tvar lines = token.substring(0, i).split('\\n');\n\t\tvar lineCount = lines.length;\n\t\tvar charCount = lines.pop().length + 1;\n\t\tvar error = new Error(message + ' (line ' + lineCount + ', char ' + charCount + ')');\n\t\terror.line = lineCount;\n\t\terror.char = charCount;\n\t\terror.styleSheet = styleSheet;\n\t\tthrow error;\n\t};\n\n\tfor (var character; character = token.charAt(i); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf('\"', index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError('Unmatched \"');\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\')\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf(\"'\", index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError(\"Unmatched '\");\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\')\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (token.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = token.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tparseError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tif (state === \"importRule-begin\") {\n\t\t\t\tbuffer += \" \";\n\t\t\t\tstate = \"importRule\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// At-rule\n\t\tcase \"@\":\n\t\t\tif (token.indexOf(\"@-moz-document\", i) === i) {\n\t\t\t\tstate = \"documentRule-begin\";\n\t\t\t\tdocumentRule = new CSSOM.CSSDocumentRule;\n\t\t\t\tdocumentRule.__starts = i;\n\t\t\t\ti += \"-moz-document\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@media\", i) === i) {\n\t\t\t\tstate = \"atBlock\";\n\t\t\t\tmediaRule = new CSSOM.CSSMediaRule;\n\t\t\t\tmediaRule.__starts = i;\n\t\t\t\ti += \"media\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@import\", i) === i) {\n\t\t\t\tstate = \"importRule-begin\";\n\t\t\t\ti += \"import\".length;\n\t\t\t\tbuffer += \"@import\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@font-face\", i) === i) {\n\t\t\t\tstate = \"fontFaceRule-begin\";\n\t\t\t\ti += \"font-face\".length;\n\t\t\t\tfontFaceRule = new CSSOM.CSSFontFaceRule;\n\t\t\t\tfontFaceRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tatKeyframesRegExp.lastIndex = i;\n\t\t\t\tvar matchKeyframes = atKeyframesRegExp.exec(token);\n\t\t\t\tif (matchKeyframes && matchKeyframes.index === i) {\n\t\t\t\t\tstate = \"keyframesRule-begin\";\n\t\t\t\t\tkeyframesRule = new CSSOM.CSSKeyframesRule;\n\t\t\t\t\tkeyframesRule.__starts = i;\n\t\t\t\t\tkeyframesRule._vendorPrefix = matchKeyframes[1]; // Will come out as undefined if no prefix was found\n\t\t\t\t\ti += matchKeyframes[0].length - 1;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (state == \"selector\") {\n\t\t\t\t\tstate = \"atRule\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\" || state === \"atRule\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tstyleRule.style.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"atBlock\") {\n\t\t\t\tmediaRule.media.mediaText = buffer.trim();\n\t\t\t\tcurrentScope = parentRule = mediaRule;\n\t\t\t\tmediaRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"fontFaceRule-begin\") {\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tfontFaceRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tfontFaceRule.parentStyleSheet = styleSheet;\n\t\t\t\tstyleRule = fontFaceRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"keyframesRule-begin\") {\n\t\t\t\tkeyframesRule.name = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tkeyframesRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tkeyframesRule.parentStyleSheet = styleSheet;\n\t\t\t\tcurrentScope = parentRule = keyframesRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t} else if (state === \"keyframeRule-begin\") {\n\t\t\t\tstyleRule = new CSSOM.CSSKeyframeRule;\n\t\t\t\tstyleRule.keyText = buffer.trim();\n\t\t\t\tstyleRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"documentRule-begin\") {\n\t\t\t\t// FIXME: what if this '{' is in the url text of the match function?\n\t\t\t\tdocumentRule.matcher.matcherText = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tdocumentRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tcurrentScope = parentRule = documentRule;\n\t\t\t\tdocumentRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase '(':\n\t\t\tif (state === 'value') {\n\t\t\t\t// ie css expression mode\n\t\t\t\tif (buffer.trim() == 'expression') {\n\t\t\t\t\tvar info = (new CSSOM.CSSValueExpression(token, i)).parse();\n\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\tparseError(info.error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuffer += info.expression;\n\t\t\t\t\t\ti = info.idx;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tindex = token.indexOf(')', i + 1);\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\tparseError('Unmatched \"(\"');\n\t\t\t\t\t}\n\t\t\t\t\tbuffer += token.slice(i, index + 1);\n\t\t\t\t\ti = index;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && token.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"atRule\":\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule\":\n\t\t\t\t\timportRule = new CSSOM.CSSImportRule;\n\t\t\t\t\timportRule.parentStyleSheet = importRule.styleSheet.parentStyleSheet = styleSheet;\n\t\t\t\t\timportRule.cssText = buffer + character;\n\t\t\t\t\tstyleSheet.cssRules.push(importRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbuffer += character;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\tcase \"before-name\":\n\t\t\t\tcase \"name\":\n\t\t\t\t\tstyleRule.__ends = i + 1;\n\t\t\t\t\tif (parentRule) {\n\t\t\t\t\t\tstyleRule.parentRule = parentRule;\n\t\t\t\t\t}\n\t\t\t\t\tstyleRule.parentStyleSheet = styleSheet;\n\t\t\t\t\tcurrentScope.cssRules.push(styleRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tif (currentScope.constructor === CSSOM.CSSKeyframesRule) {\n\t\t\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"keyframeRule-begin\":\n\t\t\t\tcase \"before-selector\":\n\t\t\t\tcase \"selector\":\n\t\t\t\t\t// End of media/document rule.\n\t\t\t\t\tif (!parentRule) {\n\t\t\t\t\t\tparseError(\"Unexpected }\");\n\t\t\t\t\t}\n\t\t\t\t\tcurrentScope.__ends = i + 1;\n\t\t\t\t\t// Nesting rules aren't supported yet\n\t\t\t\t\tstyleSheet.cssRules.push(currentScope);\n\t\t\t\t\tcurrentScope = styleSheet;\n\t\t\t\t\tparentRule = null;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tswitch (state) {\n\t\t\t\tcase \"before-selector\":\n\t\t\t\t\tstate = \"selector\";\n\t\t\t\t\tstyleRule = new CSSOM.CSSStyleRule;\n\t\t\t\t\tstyleRule.__starts = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-name\":\n\t\t\t\t\tstate = \"name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-value\":\n\t\t\t\t\tstate = \"value\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule-begin\":\n\t\t\t\t\tstate = \"importRule\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn styleSheet;\n};\n\n\n//.CommonJS\nexports.parse = CSSOM.parse;\n// The following modules cannot be included sooner due to the mutual dependency with parse.js\nCSSOM.CSSStyleSheet = require(\"./CSSStyleSheet\").CSSStyleSheet;\nCSSOM.CSSStyleRule = require(\"./CSSStyleRule\").CSSStyleRule;\nCSSOM.CSSImportRule = require(\"./CSSImportRule\").CSSImportRule;\nCSSOM.CSSMediaRule = require(\"./CSSMediaRule\").CSSMediaRule;\nCSSOM.CSSFontFaceRule = require(\"./CSSFontFaceRule\").CSSFontFaceRule;\nCSSOM.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nCSSOM.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nCSSOM.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nCSSOM.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nCSSOM.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule,\n\tCSSMediaRule: require(\"./CSSMediaRule\").CSSMediaRule,\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSKeyframeRule: require('./CSSKeyframeRule').CSSKeyframeRule,\n\tCSSKeyframesRule: require('./CSSKeyframesRule').CSSKeyframesRule\n};\n///CommonJS\n\n\n/**\n * Produces a deep copy of stylesheet — the instance variables of stylesheet are copied recursively.\n * @param {CSSStyleSheet|CSSOM.CSSStyleSheet} stylesheet\n * @nosideeffects\n * @return {CSSOM.CSSStyleSheet}\n */\nCSSOM.clone = function clone(stylesheet) {\n\n\tvar cloned = new CSSOM.CSSStyleSheet;\n\n\tvar rules = stylesheet.cssRules;\n\tif (!rules) {\n\t\treturn cloned;\n\t}\n\n\tvar RULE_TYPES = {\n\t\t1: CSSOM.CSSStyleRule,\n\t\t4: CSSOM.CSSMediaRule,\n\t\t//3: CSSOM.CSSImportRule,\n\t\t//5: CSSOM.CSSFontFaceRule,\n\t\t//6: CSSOM.CSSPageRule,\n\t\t8: CSSOM.CSSKeyframesRule,\n\t\t9: CSSOM.CSSKeyframeRule\n\t};\n\n\tfor (var i=0, rulesLength=rules.length; i < rulesLength; i++) {\n\t\tvar rule = rules[i];\n\t\tvar ruleClone = cloned.cssRules[i] = new RULE_TYPES[rule.type];\n\n\t\tvar style = rule.style;\n\t\tif (style) {\n\t\t\tvar styleClone = ruleClone.style = new CSSOM.CSSStyleDeclaration;\n\t\t\tfor (var j=0, styleLength=style.length; j < styleLength; j++) {\n\t\t\t\tvar name = styleClone[j] = style[j];\n\t\t\t\tstyleClone[name] = style[name];\n\t\t\t\tstyleClone._importants[name] = style.getPropertyPriority(name);\n\t\t\t}\n\t\t\tstyleClone.length = style.length;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('keyText')) {\n\t\t\truleClone.keyText = rule.keyText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('selectorText')) {\n\t\t\truleClone.selectorText = rule.selectorText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('mediaText')) {\n\t\t\truleClone.mediaText = rule.mediaText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('cssRules')) {\n\t\t\truleClone.cssRules = clone(rule).cssRules;\n\t\t}\n\t}\n\n\treturn cloned;\n\n};\n\n//.CommonJS\nexports.clone = CSSOM.clone;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSValue: require('./CSSValue').CSSValue\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://msdn.microsoft.com/en-us/library/ms537634(v=vs.85).aspx\n *\n */\nCSSOM.CSSValueExpression = function CSSValueExpression(token, idx) {\n\tthis._token = token;\n\tthis._idx = idx;\n};\n\nCSSOM.CSSValueExpression.prototype = new CSSOM.CSSValue;\nCSSOM.CSSValueExpression.prototype.constructor = CSSOM.CSSValueExpression;\n\n/**\n * parse css expression() value\n *\n * @return {Object}\n *\t\t\t\t - error:\n *\t\t\t\t or\n *\t\t\t\t - idx:\n *\t\t\t\t - expression:\n *\n * Example:\n *\n * .selector {\n *\t\tzoom: expression(documentElement.clientWidth > 1000 ? '1000px' : 'auto');\n * }\n */\nCSSOM.CSSValueExpression.prototype.parse = function() {\n\tvar token = this._token,\n\t\t\tidx = this._idx;\n\n\tvar character = '',\n\t\t\texpression = '',\n\t\t\terror = '',\n\t\t\tinfo,\n\t\t\tparen = [];\n\n\n\tfor (; ; ++idx) {\n\t\tcharacter = token.charAt(idx);\n\n\t\t// end of token\n\t\tif (character == '') {\n\t\t\terror = 'css expression error: unfinished expression!';\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch(character) {\n\t\t\tcase '(':\n\t\t\t\tparen.push(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase ')':\n\t\t\t\tparen.pop(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase '/':\n\t\t\t\tif (info = this._parseJSComment(token, idx)) { // comment?\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = info.idx;\n\t\t\t\t\t\t// ignore the comment\n\t\t\t\t\t}\n\t\t\t\t} else if (info = this._parseJSRexExp(token, idx)) { // regexp\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else { // other\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"'\":\n\t\t\tcase '\"':\n\t\t\t\tinfo = this._parseJSString(token, idx, character);\n\t\t\t\tif (info) { // string\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else {\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (error) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// end of expression\n\t\tif (paren.length == 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tvar ret;\n\tif (error) {\n\t\tret = {\n\t\t\terror: error\n\t\t}\n\t} else {\n\t\tret = {\n\t\t\tidx: idx,\n\t\t\texpression: expression\n\t\t}\n\t}\n\n\treturn ret;\n};\n\n\n/**\n *\n * @return {Object|false}\n *          - idx:\n *          - text:\n *          or\n *          - error:\n *          or\n *          false\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSComment = function(token, idx) {\n\tvar nextChar = token.charAt(idx + 1),\n\t\t\ttext;\n\n\tif (nextChar == '/' || nextChar == '*') {\n\t\tvar startIdx = idx,\n\t\t\t\tendIdx,\n\t\t\t\tcommentEndChar;\n\n\t\tif (nextChar == '/') { // line comment\n\t\t\tcommentEndChar = '\\n';\n\t\t} else if (nextChar == '*') { // block comment\n\t\t\tcommentEndChar = '*/';\n\t\t}\n\n\t\tendIdx = token.indexOf(commentEndChar, startIdx + 1 + 1);\n\t\tif (endIdx !== -1) {\n\t\t\tendIdx = endIdx + commentEndChar.length - 1;\n\t\t\ttext = token.substring(idx, endIdx + 1);\n\t\t\treturn {\n\t\t\t\tidx: endIdx,\n\t\t\t\ttext: text\n\t\t\t}\n\t\t} else {\n\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\treturn {\n\t\t\t\terror: error\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n};\n\n\n/**\n *\n * @return {Object|false}\n *\t\t\t\t\t- idx:\n *\t\t\t\t\t- text:\n *\t\t\t\t\tor \n *\t\t\t\t\tfalse\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSString = function(token, idx, sep) {\n\tvar endIdx = this._findMatchedIdx(token, idx, sep),\n\t\t\ttext;\n\n\tif (endIdx === -1) {\n\t\treturn false;\n\t} else {\n\t\ttext = token.substring(idx, endIdx + sep.length);\n\n\t\treturn {\n\t\t\tidx: endIdx,\n\t\t\ttext: text\n\t\t}\n\t}\n};\n\n\n/**\n * parse regexp in css expression\n *\n * @return {Object|false}\n *\t\t\t\t - idx:\n *\t\t\t\t - regExp:\n *\t\t\t\t or \n *\t\t\t\t false\n */\n\n/*\n\nall legal RegExp\n \n/a/\n(/a/)\n[/a/]\n[12, /a/]\n\n!/a/\n\n+/a/\n-/a/\n* /a/\n/ /a/\n%/a/\n\n===/a/\n!==/a/\n==/a/\n!=/a/\n>/a/\n>=/a/\n</a/\n<=/a/\n\n&/a/\n|/a/\n^/a/\n~/a/\n<</a/\n>>/a/\n>>>/a/\n\n&&/a/\n||/a/\n?/a/\n=/a/\n,/a/\n\n\t\tdelete /a/\n\t\t\t\tin /a/\ninstanceof /a/\n\t\t\t new /a/\n\t\ttypeof /a/\n\t\t\tvoid /a/\n\n*/\nCSSOM.CSSValueExpression.prototype._parseJSRexExp = function(token, idx) {\n\tvar before = token.substring(0, idx).replace(/\\s+$/, \"\"),\n\t\t\tlegalRegx = [\n\t\t\t\t/^$/,\n\t\t\t\t/\\($/,\n\t\t\t\t/\\[$/,\n\t\t\t\t/\\!$/,\n\t\t\t\t/\\+$/,\n\t\t\t\t/\\-$/,\n\t\t\t\t/\\*$/,\n\t\t\t\t/\\/\\s+/,\n\t\t\t\t/\\%$/,\n\t\t\t\t/\\=$/,\n\t\t\t\t/\\>$/,\n\t\t\t\t/\\<$/,\n\t\t\t\t/\\&$/,\n\t\t\t\t/\\|$/,\n\t\t\t\t/\\^$/,\n\t\t\t\t/\\~$/,\n\t\t\t\t/\\?$/,\n\t\t\t\t/\\,$/,\n\t\t\t\t/delete$/,\n\t\t\t\t/in$/,\n\t\t\t\t/instanceof$/,\n\t\t\t\t/new$/,\n\t\t\t\t/typeof$/,\n\t\t\t\t/void$/,\n\t\t\t];\n\n\tvar isLegal = legalRegx.some(function(reg) {\n\t\treturn reg.test(before);\n\t});\n\n\tif (!isLegal) {\n\t\treturn false;\n\t} else {\n\t\tvar sep = '/';\n\n\t\t// same logic as string\n\t\treturn this._parseJSString(token, idx, sep);\n\t}\n};\n\n\n/**\n *\n * find next sep(same line) index in `token`\n *\n * @return {Number}\n *\n */\nCSSOM.CSSValueExpression.prototype._findMatchedIdx = function(token, idx, sep) {\n\tvar startIdx = idx,\n\t\t\tendIdx;\n\n\tvar NOT_FOUND = -1;\n\n\twhile(true) {\n\t\tendIdx = token.indexOf(sep, startIdx + 1);\n\n\t\tif (endIdx === -1) { // not found\n\t\t\tendIdx = NOT_FOUND;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tvar text = token.substring(idx + 1, endIdx),\n\t\t\t\t\tmatched = text.match(/\\\\+$/);\n\t\t\tif (!matched || matched[0] % 2 == 0) { // not escaped\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tstartIdx = endIdx;\n\t\t\t}\n\t\t}\n\t}\n\n\t// boundary must be in the same line(js sting or regexp)\n\tvar nextNewLineIdx = token.indexOf('\\n', idx + 1);\n\tif (nextNewLineIdx < endIdx) {\n\t\tendIdx = NOT_FOUND;\n\t}\n\n\n\treturn endIdx;\n}\n\n\n\n\n//.CommonJS\nexports.CSSValueExpression = CSSOM.CSSValueExpression;\n///CommonJS\n","module.exports = (function() {\n  /*\n   * Generated by PEG.js 0.8.0.\n   *\n   * http://pegjs.majda.cz/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function SyntaxError(message, expected, found, offset, line, column) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.offset   = offset;\n    this.line     = line;\n    this.column   = column;\n\n    this.name     = \"SyntaxError\";\n  }\n\n  peg$subclass(SyntaxError, Error);\n\n  function parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n\n        peg$FAILED = {},\n\n        peg$startRuleFunctions = { start: peg$parsestart },\n        peg$startRuleFunction  = peg$parsestart,\n\n        peg$c0 = [],\n        peg$c1 = function() { return []},\n        peg$c2 = peg$FAILED,\n        peg$c3 = \",\",\n        peg$c4 = { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n        peg$c5 = function(x, xs) { return [x].concat(xs); },\n        peg$c6 = function(entry) { return [entry]; },\n        peg$c7 = function(url, format) { return {url: url, format: format}; },\n        peg$c8 = function(url) { return {url: url}; },\n        peg$c9 = \"url(\",\n        peg$c10 = { type: \"literal\", value: \"url(\", description: \"\\\"url(\\\"\" },\n        peg$c11 = \")\",\n        peg$c12 = { type: \"literal\", value: \")\", description: \"\\\")\\\"\" },\n        peg$c13 = function(value) { return value; },\n        peg$c14 = \"format(\",\n        peg$c15 = { type: \"literal\", value: \"format(\", description: \"\\\"format(\\\"\" },\n        peg$c16 = \"local(\",\n        peg$c17 = { type: \"literal\", value: \"local(\", description: \"\\\"local(\\\"\" },\n        peg$c18 = function(value) { return {local: value}; },\n        peg$c19 = /^[^)]/,\n        peg$c20 = { type: \"class\", value: \"[^)]\", description: \"[^)]\" },\n        peg$c21 = function(chars) { return util.extractValue(chars.join(\"\")); },\n        peg$c22 = /^[ \\t\\r\\n\\f]/,\n        peg$c23 = { type: \"class\", value: \"[ \\\\t\\\\r\\\\n\\\\f]\", description: \"[ \\\\t\\\\r\\\\n\\\\f]\" },\n\n        peg$currPos          = 0,\n        peg$reportedPos      = 0,\n        peg$cachedPos        = 0,\n        peg$cachedPosDetails = { line: 1, column: 1, seenCR: false },\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleFunctions)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$reportedPos, peg$currPos);\n    }\n\n    function offset() {\n      return peg$reportedPos;\n    }\n\n    function line() {\n      return peg$computePosDetails(peg$reportedPos).line;\n    }\n\n    function column() {\n      return peg$computePosDetails(peg$reportedPos).column;\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        peg$reportedPos\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(message, null, peg$reportedPos);\n    }\n\n    function peg$computePosDetails(pos) {\n      function advance(details, startPos, endPos) {\n        var p, ch;\n\n        for (p = startPos; p < endPos; p++) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n        }\n      }\n\n      if (peg$cachedPos !== pos) {\n        if (peg$cachedPos > pos) {\n          peg$cachedPos = 0;\n          peg$cachedPosDetails = { line: 1, column: 1, seenCR: false };\n        }\n        advance(peg$cachedPosDetails, peg$cachedPos, pos);\n        peg$cachedPos = pos;\n      }\n\n      return peg$cachedPosDetails;\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, pos) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0180-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1080-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      var posDetails = peg$computePosDetails(pos),\n          found      = pos < input.length ? input.charAt(pos) : null;\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        pos,\n        posDetails.line,\n        posDetails.column\n      );\n    }\n\n    function peg$parsestart() {\n      var s0, s1;\n\n      s0 = peg$parsesourceEntries();\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = [];\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c1();\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntries() {\n      var s0, s1, s2, s3, s4, s5;\n\n      s0 = peg$currPos;\n      s1 = peg$parsesourceEntry();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewhitespace();\n        }\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s3 = peg$c3;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c4); }\n          }\n          if (s3 !== peg$FAILED) {\n            s4 = [];\n            s5 = peg$parsewhitespace();\n            while (s5 !== peg$FAILED) {\n              s4.push(s5);\n              s5 = peg$parsewhitespace();\n            }\n            if (s4 !== peg$FAILED) {\n              s5 = peg$parsesourceEntries();\n              if (s5 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c5(s1, s5);\n                s0 = s1;\n              } else {\n                peg$currPos = s0;\n                s0 = peg$c2;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$c2;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parsesourceEntry();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c6(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntry() {\n      var s0;\n\n      s0 = peg$parseurlEntry();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parselocalEntry();\n      }\n\n      return s0;\n    }\n\n    function peg$parseurlEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      s1 = peg$parseurl();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        if (s3 !== peg$FAILED) {\n          while (s3 !== peg$FAILED) {\n            s2.push(s3);\n            s3 = peg$parsewhitespace();\n          }\n        } else {\n          s2 = peg$c2;\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = peg$parseformat();\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c7(s1, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parseurl();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c8(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parseurl() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 4) === peg$c9) {\n        s1 = peg$c9;\n        peg$currPos += 4;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c10); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parseformat() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 7) === peg$c14) {\n        s1 = peg$c14;\n        peg$currPos += 7;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c15); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parselocalEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 6) === peg$c16) {\n        s1 = peg$c16;\n        peg$currPos += 6;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c17); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c18(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parsevalue() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      if (peg$c19.test(input.charAt(peg$currPos))) {\n        s2 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c20); }\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          if (peg$c19.test(input.charAt(peg$currPos))) {\n            s2 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c20); }\n          }\n        }\n      } else {\n        s1 = peg$c2;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c21(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsewhitespace() {\n      var s0;\n\n      if (peg$c22.test(input.charAt(peg$currPos))) {\n        s0 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c23); }\n      }\n\n      return s0;\n    }\n\n\n      var util = require('../util');\n\n\n    peg$result = peg$startRuleFunction();\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(null, peg$maxFailExpected, peg$maxFailPos);\n    }\n  }\n\n  return {\n    SyntaxError: SyntaxError,\n    parse:       parse\n  };\n})();\n","var trimCSSWhitespace = function (value) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return value.replace(whitespaceRegex, \"$1\");\n};\n\nvar unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nexports.extractValue = function (value) {\n    return unquoteString(trimCSSWhitespace(value));\n};\n"]}